<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="./favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parrot Story!!</title>
  <script type="module" crossorigin>var Fc=Object.defineProperty;var Bc=(r,e,t)=>e in r?Fc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var pe=(r,e,t)=>Bc(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const Rc="modulepreload",Ic=function(r,e){return new URL(r,e).href},mn={},Ls=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),h=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=a(t.map(c=>{if(c=Ic(c,s),c in mn)return;mn[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(!!s)for(let m=o.length-1;m>=0;m--){const p=o[m];if(p.href===c&&(!u||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":Rc,u||(g.as="script"),g.crossOrigin="",g.href=c,h&&g.setAttribute("nonce",h),document.head.appendChild(g),u)return new Promise((m,p)=>{g.addEventListener("load",m),g.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})};var y=(r=>(r.Application="application",r.WebGLPipes="webgl-pipes",r.WebGLPipesAdaptor="webgl-pipes-adaptor",r.WebGLSystem="webgl-system",r.WebGPUPipes="webgpu-pipes",r.WebGPUPipesAdaptor="webgpu-pipes-adaptor",r.WebGPUSystem="webgpu-system",r.CanvasSystem="canvas-system",r.CanvasPipesAdaptor="canvas-pipes-adaptor",r.CanvasPipes="canvas-pipes",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r.MaskEffect="mask-effect",r.BlendMode="blend-mode",r.TextureSource="texture-source",r.Environment="environment",r.ShapeBuilder="shape-builder",r.Batcher="batcher",r))(y||{});const zr=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},ps=(r,e)=>zr(r).priority??e,M={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(zr).forEach(e=>{e.type.forEach(t=>{var s,i;return(i=(s=this._removeHandlers)[t])==null?void 0:i.call(s,e)})}),this},add(...r){return r.map(zr).forEach(e=>{e.type.forEach(t=>{var n,a;const s=this._addHandlers,i=this._queue;s[t]?(a=s[t])==null||a.call(s,e):(i[t]=i[t]||[],(n=i[t])==null||n.push(e))})}),this},handle(r,e,t){var a;const s=this._addHandlers,i=this._removeHandlers;if(s[r]||i[r])throw new Error(`Extension type ${r} already has a handler`);s[r]=e,i[r]=t;const n=this._queue;return n[r]&&((a=n[r])==null||a.forEach(o=>e(o)),delete n[r]),this},handleByMap(r,e){return this.handle(r,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByNamedList(r,e,t=-1){return this.handle(r,s=>{e.findIndex(n=>n.name===s.name)>=0||(e.push({name:s.name,value:s.ref}),e.sort((n,a)=>ps(a.value,t)-ps(n.value,t)))},s=>{const i=e.findIndex(n=>n.name===s.name);i!==-1&&e.splice(i,1)})},handleByList(r,e,t=-1){return this.handle(r,s=>{e.includes(s.ref)||(e.push(s.ref),e.sort((i,n)=>ps(n,t)-ps(i,t)))},s=>{const i=e.indexOf(s.ref);i!==-1&&e.splice(i,1)})},mixin(r,...e){for(const t of e)Object.defineProperties(r.prototype,Object.getOwnPropertyDescriptors(t))}},Gc={extension:{type:y.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Ls(()=>Promise.resolve().then(()=>l0),void 0,import.meta.url)}},Dc={extension:{type:y.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Ls(()=>Promise.resolve().then(()=>h0),void 0,import.meta.url)}};class le{constructor(e,t,s){this._x=t||0,this._y=s||0,this._observer=e}clone(e){return new le(e??this._observer,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this._observer._onUpdate(this)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}function io(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var sr={exports:{}},_n;function Uc(){return _n||(_n=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function n(l,h,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new i(c,u||l,d),g=t?t+h:h;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function a(l,h){--l._eventsCount===0?l._events=new s:delete l._events[h]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var h=[],c,u;if(this._eventsCount===0)return h;for(u in c=this._events)e.call(c,u)&&h.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},o.prototype.listeners=function(h){var c=t?t+h:h,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,g=new Array(f);d<f;d++)g[d]=u[d].fn;return g},o.prototype.listenerCount=function(h){var c=t?t+h:h,u=this._events[c];return u?u.fn?1:u.length:0},o.prototype.emit=function(h,c,u,d,f,g){var m=t?t+h:h;if(!this._events[m])return!1;var p=this._events[m],_=arguments.length,x,b;if(p.fn){switch(p.once&&this.removeListener(h,p.fn,void 0,!0),_){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,u),!0;case 4:return p.fn.call(p.context,c,u,d),!0;case 5:return p.fn.call(p.context,c,u,d,f),!0;case 6:return p.fn.call(p.context,c,u,d,f,g),!0}for(b=1,x=new Array(_-1);b<_;b++)x[b-1]=arguments[b];p.fn.apply(p.context,x)}else{var v=p.length,S;for(b=0;b<v;b++)switch(p[b].once&&this.removeListener(h,p[b].fn,void 0,!0),_){case 1:p[b].fn.call(p[b].context);break;case 2:p[b].fn.call(p[b].context,c);break;case 3:p[b].fn.call(p[b].context,c,u);break;case 4:p[b].fn.call(p[b].context,c,u,d);break;default:if(!x)for(S=1,x=new Array(_-1);S<_;S++)x[S-1]=arguments[S];p[b].fn.apply(p[b].context,x)}}return!0},o.prototype.on=function(h,c,u){return n(this,h,c,u,!1)},o.prototype.once=function(h,c,u){return n(this,h,c,u,!0)},o.prototype.removeListener=function(h,c,u,d){var f=t?t+h:h;if(!this._events[f])return this;if(!c)return a(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!d||g.once)&&(!u||g.context===u)&&a(this,f);else{for(var m=0,p=[],_=g.length;m<_;m++)(g[m].fn!==c||d&&!g[m].once||u&&g[m].context!==u)&&p.push(g[m]);p.length?this._events[f]=p.length===1?p[0]:p:a(this,f)}return this},o.prototype.removeAllListeners=function(h){var c;return h?(c=t?t+h:h,this._events[c]&&a(this,c)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(sr)),sr.exports}var Oc=Uc();const ge=io(Oc),Lc=Math.PI*2,Nc=180/Math.PI,Hc=Math.PI/180;class Y{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Y(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return rr.x=0,rr.y=0,rr}}const rr=new Y;class E{constructor(e=1,t=0,s=0,i=1,n=0,a=0){this.array=null,this.a=e,this.b=t,this.c=s,this.d=i,this.tx=n,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,s,i,n,a){return this.a=e,this.b=t,this.c=s,this.d=i,this.tx=n,this.ty=a,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const s=t||this.array;return e?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(e,t){t=t||new Y;const s=e.x,i=e.y;return t.x=this.a*s+this.c*i+this.tx,t.y=this.b*s+this.d*i+this.ty,t}applyInverse(e,t){t=t||new Y;const s=this.a,i=this.b,n=this.c,a=this.d,o=this.tx,l=this.ty,h=1/(s*a+n*-i),c=e.x,u=e.y;return t.x=a*h*c+-n*h*u+(l*n-o*a)*h,t.y=s*h*u+-i*h*c+(-l*s+o*i)*h,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),s=Math.sin(e),i=this.a,n=this.c,a=this.tx;return this.a=i*t-this.b*s,this.b=i*s+this.b*t,this.c=n*t-this.d*s,this.d=n*s+this.d*t,this.tx=a*t-this.ty*s,this.ty=a*s+this.ty*t,this}append(e){const t=this.a,s=this.b,i=this.c,n=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*s+e.b*n,this.c=e.c*t+e.d*i,this.d=e.c*s+e.d*n,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*s+e.ty*n+this.ty,this}appendFrom(e,t){const s=e.a,i=e.b,n=e.c,a=e.d,o=e.tx,l=e.ty,h=t.a,c=t.b,u=t.c,d=t.d;return this.a=s*h+i*u,this.b=s*c+i*d,this.c=n*h+a*u,this.d=n*c+a*d,this.tx=o*h+l*u+t.tx,this.ty=o*c+l*d+t.ty,this}setTransform(e,t,s,i,n,a,o,l,h){return this.a=Math.cos(o+h)*n,this.b=Math.sin(o+h)*n,this.c=-Math.sin(o-l)*a,this.d=Math.cos(o-l)*a,this.tx=e-(s*this.a+i*this.c),this.ty=t-(s*this.b+i*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const s=this.a,i=this.c;this.a=s*e.a+this.b*e.c,this.b=s*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,s=this.b,i=this.c,n=this.d,a=e.pivot,o=-Math.atan2(-i,n),l=Math.atan2(s,t),h=Math.abs(o+l);return h<1e-5||Math.abs(Lc-h)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=l),e.scale.x=Math.sqrt(t*t+s*s),e.scale.y=Math.sqrt(i*i+n*n),e.position.x=this.tx+(a.x*t+a.y*i),e.position.y=this.ty+(a.x*s+a.y*n),e}invert(){const e=this.a,t=this.b,s=this.c,i=this.d,n=this.tx,a=e*i-t*s;return this.a=i/a,this.b=-t/a,this.c=-s/a,this.d=e/a,this.tx=(s*this.ty-i*n)/a,this.ty=-(e*this.ty-t*n)/a,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new E;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return Vc.identity()}static get shared(){return Wc.identity()}}const Wc=new E,Vc=new E,rt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],it=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],nt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],at=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Yr=[],no=[],ms=Math.sign;function zc(){for(let r=0;r<16;r++){const e=[];Yr.push(e);for(let t=0;t<16;t++){const s=ms(rt[r]*rt[t]+nt[r]*it[t]),i=ms(it[r]*rt[t]+at[r]*it[t]),n=ms(rt[r]*nt[t]+nt[r]*at[t]),a=ms(it[r]*nt[t]+at[r]*at[t]);for(let o=0;o<16;o++)if(rt[o]===s&&it[o]===i&&nt[o]===n&&at[o]===a){e.push(o);break}}}for(let r=0;r<16;r++){const e=new E;e.set(rt[r],it[r],nt[r],at[r],0,0),no.push(e)}}zc();const K={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>rt[r],uY:r=>it[r],vX:r=>nt[r],vY:r=>at[r],inv:r=>r&8?r&15:-r&7,add:(r,e)=>Yr[r][e],sub:(r,e)=>Yr[r][K.inv(e)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,e)=>Math.abs(r)*2<=Math.abs(e)?e>=0?K.S:K.N:Math.abs(e)*2<=Math.abs(r)?r>0?K.E:K.W:e>0?r>0?K.SE:K.SW:r>0?K.NE:K.NW,matrixAppendRotationInv:(r,e,t=0,s=0)=>{const i=no[K.inv(e)];i.tx=t,i.ty=s,r.append(i)}},_s=[new Y,new Y,new Y,new Y];class W{constructor(e=0,t=0,s=0,i=0){this.type="rectangle",this.x=Number(e),this.y=Number(t),this.width=Number(s),this.height=Number(i)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new W(0,0,0,0)}clone(){return new W(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}strokeContains(e,t,s,i=.5){const{width:n,height:a}=this;if(n<=0||a<=0)return!1;const o=this.x,l=this.y,h=s*(1-i),c=s-h,u=o-h,d=o+n+h,f=l-h,g=l+a+h,m=o+c,p=o+n-c,_=l+c,x=l+a-c;return e>=u&&e<=d&&t>=f&&t<=g&&!(e>m&&e<p&&t>_&&t<x)}intersects(e,t){if(!t){const I=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=I)return!1;const P=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>P}const s=this.left,i=this.right,n=this.top,a=this.bottom;if(i<=s||a<=n)return!1;const o=_s[0].set(e.left,e.top),l=_s[1].set(e.left,e.bottom),h=_s[2].set(e.right,e.top),c=_s[3].set(e.right,e.bottom);if(h.x<=o.x||l.y<=o.y)return!1;const u=Math.sign(t.a*t.d-t.b*t.c);if(u===0||(t.apply(o,o),t.apply(l,l),t.apply(h,h),t.apply(c,c),Math.max(o.x,l.x,h.x,c.x)<=s||Math.min(o.x,l.x,h.x,c.x)>=i||Math.max(o.y,l.y,h.y,c.y)<=n||Math.min(o.y,l.y,h.y,c.y)>=a))return!1;const d=u*(l.y-o.y),f=u*(o.x-l.x),g=d*s+f*n,m=d*i+f*n,p=d*s+f*a,_=d*i+f*a;if(Math.max(g,m,p,_)<=d*o.x+f*o.y||Math.min(g,m,p,_)>=d*c.x+f*c.y)return!1;const x=u*(o.y-h.y),b=u*(h.x-o.x),v=x*s+b*n,S=x*i+b*n,T=x*s+b*a,w=x*i+b*a;return!(Math.max(v,S,T,w)<=x*o.x+b*o.y||Math.min(v,S,T,w)>=x*c.x+b*c.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(s-t,0),this.y=i,this.height=Math.max(n-i,0),this}ceil(e=1,t=.001){const s=Math.ceil((this.x+this.width-t)*e)/e,i=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=s-this.x,this.height=i-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),s=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=s-t,this.y=i,this.height=n-i,this}getBounds(e){return e||(e=new W),e.copyFrom(this),e}containsRect(e){if(this.width<=0||this.height<=0)return!1;const t=e.x,s=e.y,i=e.x+e.width,n=e.y+e.height;return t>=this.x&&t<this.x+this.width&&s>=this.y&&s<this.y+this.height&&i>=this.x&&i<this.x+this.width&&n>=this.y&&n<this.y+this.height}set(e,t,s,i){return this.x=e,this.y=t,this.width=s,this.height=i,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const ir={default:-1};function X(r="default"){return ir[r]===void 0&&(ir[r]=-1),++ir[r]}const yn={},H="8.0.0",Yc="8.3.4";function U(r,e,t=3){if(yn[e])return;let s=new Error().stack;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`):(s=s.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${r}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`),console.warn(s))),yn[e]=!0}const ao=()=>{};function vt(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function xn(r){return!(r&r-1)&&!!r}function oo(r){const e={};for(const t in r)r[t]!==void 0&&(e[t]=r[t]);return e}const bn=Object.create(null);function jc(r){const e=bn[r];return e===void 0&&(bn[r]=X("resource")),e}const lo=class ho extends ge{constructor(e={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e={...ho.defaultOptions,...e},this.addressMode=e.addressMode,this.addressModeU=e.addressModeU??this.addressModeU,this.addressModeV=e.addressModeV??this.addressModeV,this.addressModeW=e.addressModeW??this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=e.magFilter??this.magFilter,this.minFilter=e.minFilter??this.minFilter,this.mipmapFilter=e.mipmapFilter??this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=e.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){U(H,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=jc(e),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};lo.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let De=lo;const co=class uo extends ge{constructor(e={}){super(),this.options=e,this.uid=X("textureSource"),this._resourceType="textureSource",this._resourceId=X("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e={...uo.defaultOptions,...e},this.label=e.label??"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new De(oo(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){var t,s;this.style!==e&&((t=this._style)==null||t.off("change",this._onStyleChange,this),this._style=e,(s=this._style)==null||s.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=X("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){const{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,t,s){s||(s=this._resolution),e||(e=this.width),t||(t=this.height);const i=Math.round(e*s),n=Math.round(t*s);return this.width=i/s,this.height=n/s,this._resolution=s,this.pixelWidth===i&&this.pixelHeight===n?!1:(this._refreshPOT(),this.pixelWidth=i,this.pixelHeight=n,this.emit("resize",this),this._resourceId=X("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=xn(this.pixelWidth)&&xn(this.pixelHeight)}static test(e){throw new Error("Unimplemented")}};co.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let J=co;class xi extends J{constructor(e){const t=e.resource||new Float32Array(e.width*e.height*4);let s=e.format;s||(t instanceof Float32Array?s="rgba32float":t instanceof Int32Array||t instanceof Uint32Array?s="rgba32uint":t instanceof Int16Array||t instanceof Uint16Array?s="rgba16uint":(t instanceof Int8Array,s="bgra8unorm")),super({...e,resource:t,format:s}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}xi.extension=y.TextureSource;const vn=new E;class fo{constructor(e,t){this.mapCoord=new E,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof t>"u"?this.clampMargin=e.width<10?0:.5:this.clampMargin=t,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){var t;this.texture!==e&&((t=this._texture)==null||t.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,t){t===void 0&&(t=e);const s=this.mapCoord;for(let i=0;i<e.length;i+=2){const n=e[i],a=e[i+1];t[i]=n*s.a+a*s.c+s.tx,t[i+1]=n*s.b+a*s.d+s.ty}return t}update(){const e=this._texture;this._updateID++;const t=e.uvs;this.mapCoord.set(t.x1-t.x0,t.y1-t.y0,t.x3-t.x0,t.y3-t.y0,t.x0,t.y0);const s=e.orig,i=e.trim;i&&(vn.set(s.width/i.width,0,0,s.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(vn));const n=e.source,a=this.uClampFrame,o=this.clampMargin/n._resolution,l=this.clampOffset/n._resolution;return a[0]=(e.frame.x+o+l)/n.width,a[1]=(e.frame.y+o+l)/n.height,a[2]=(e.frame.x+e.frame.width-o+l)/n.width,a[3]=(e.frame.y+e.frame.height-o+l)/n.height,this.uClampOffset[0]=this.clampOffset/n.pixelWidth,this.uClampOffset[1]=this.clampOffset/n.pixelHeight,this.isSimple=e.frame.width===n.width&&e.frame.height===n.height&&e.rotate===0,!0}}class k extends ge{constructor({source:e,label:t,frame:s,orig:i,trim:n,defaultAnchor:a,defaultBorders:o,rotate:l,dynamic:h}={}){if(super(),this.uid=X("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new W,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=t,this.source=(e==null?void 0:e.source)??new J,this.noFrame=!s,s)this.frame.copyFrom(s);else{const{width:c,height:u}=this._source;this.frame.width=c,this.frame.height=u}this.orig=i||this.frame,this.trim=n,this.rotate=l??0,this.defaultAnchor=a,this.defaultBorders=o,this.destroyed=!1,this.dynamic=h||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new fo(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:e,frame:t}=this,{width:s,height:i}=this._source,n=t.x/s,a=t.y/i,o=t.width/s,l=t.height/i;let h=this.rotate;if(h){const c=o/2,u=l/2,d=n+c,f=a+u;h=K.add(h,K.NW),e.x0=d+c*K.uX(h),e.y0=f+u*K.uY(h),h=K.add(h,2),e.x1=d+c*K.uX(h),e.y1=f+u*K.uY(h),h=K.add(h,2),e.x2=d+c*K.uX(h),e.y2=f+u*K.uY(h),h=K.add(h,2),e.x3=d+c*K.uX(h),e.y3=f+u*K.uY(h)}else e.x0=n,e.y0=a,e.x1=n+o,e.y1=a,e.x2=n+o,e.y2=a+l,e.x3=n,e.y3=a+l}destroy(e=!1){this._source&&e&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return U(H,"Texture.baseTexture is now Texture.source"),this._source}}k.EMPTY=new k({label:"EMPTY",source:new J({label:"EMPTY"})});k.EMPTY.destroy=ao;k.WHITE=new k({source:new xi({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});k.WHITE.destroy=ao;function go(r,e,t){const{width:s,height:i}=t.orig,n=t.trim;if(n){const a=n.width,o=n.height;r.minX=n.x-e._x*s,r.maxX=r.minX+a,r.minY=n.y-e._y*i,r.maxY=r.minY+o}else r.minX=-e._x*s,r.maxX=r.minX+s,r.minY=-e._y*i,r.maxY=r.minY+i}const wn=new E;class ie{constructor(e=1/0,t=1/0,s=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=wn,this.minX=e,this.minY=t,this.maxX=s,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new W);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=wn,this}set(e,t,s,i){this.minX=e,this.minY=t,this.maxX=s,this.maxY=i}addFrame(e,t,s,i,n){n||(n=this.matrix);const a=n.a,o=n.b,l=n.c,h=n.d,c=n.tx,u=n.ty;let d=this.minX,f=this.minY,g=this.maxX,m=this.maxY,p=a*e+l*t+c,_=o*e+h*t+u;p<d&&(d=p),_<f&&(f=_),p>g&&(g=p),_>m&&(m=_),p=a*s+l*t+c,_=o*s+h*t+u,p<d&&(d=p),_<f&&(f=_),p>g&&(g=p),_>m&&(m=_),p=a*e+l*i+c,_=o*e+h*i+u,p<d&&(d=p),_<f&&(f=_),p>g&&(g=p),_>m&&(m=_),p=a*s+l*i+c,_=o*s+h*i+u,p<d&&(d=p),_<f&&(f=_),p>g&&(g=p),_>m&&(m=_),this.minX=d,this.minY=f,this.maxX=g,this.maxY=m}addRect(e,t){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,t)}addBounds(e,t){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,t)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const t=this.minX,s=this.minY,i=this.maxX,n=this.maxY,{a,b:o,c:l,d:h,tx:c,ty:u}=e;let d=a*t+l*s+c,f=o*t+h*s+u;this.minX=d,this.minY=f,this.maxX=d,this.maxY=f,d=a*i+l*s+c,f=o*i+h*s+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=a*t+l*n+c,f=o*t+h*n+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=a*i+l*n+c,f=o*i+h*n+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,t,s,i){return this.minX<e&&(this.minX=e),this.maxX>t&&(this.maxX=t),this.minY<s&&(this.minY=s),this.maxY>i&&(this.maxY=i),this}pad(e,t=e){return this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new ie(this.minX,this.minY,this.maxX,this.maxY)}scale(e,t=e){return this.minX*=e,this.minY*=t,this.maxX*=e,this.maxY*=t,this}get x(){return this.minX}set x(e){const t=this.maxX-this.minX;this.minX=e,this.maxX=e+t}get y(){return this.minY}set y(e){const t=this.maxY-this.minY;this.minY=e,this.maxY=e+t}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,t,s,i){let n=this.minX,a=this.minY,o=this.maxX,l=this.maxY;i||(i=this.matrix);const h=i.a,c=i.b,u=i.c,d=i.d,f=i.tx,g=i.ty;for(let m=t;m<s;m+=2){const p=e[m],_=e[m+1],x=h*p+u*_+f,b=c*p+d*_+g;n=x<n?x:n,a=b<a?b:a,o=x>o?x:o,l=b>l?b:l}this.minX=n,this.minY=a,this.maxX=o,this.maxY=l}containsPoint(e,t){return this.minX<=e&&this.minY<=t&&this.maxX>=e&&this.maxY>=t}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}var $c={grad:.9,turn:360,rad:360/(2*Math.PI)},Me=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},ee=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*r)/t+0},ye=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),r>t?t:r>e?r:e},po=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},Tn=function(r){return{r:ye(r.r,0,255),g:ye(r.g,0,255),b:ye(r.b,0,255),a:ye(r.a)}},nr=function(r){return{r:ee(r.r),g:ee(r.g),b:ee(r.b),a:ee(r.a,3)}},Xc=/^#([0-9a-f]{3,8})$/i,ys=function(r){var e=r.toString(16);return e.length<2?"0"+e:e},mo=function(r){var e=r.r,t=r.g,s=r.b,i=r.a,n=Math.max(e,t,s),a=n-Math.min(e,t,s),o=a?n===e?(t-s)/a:n===t?2+(s-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:i}},_o=function(r){var e=r.h,t=r.s,s=r.v,i=r.a;e=e/360*6,t/=100,s/=100;var n=Math.floor(e),a=s*(1-t),o=s*(1-(e-n)*t),l=s*(1-(1-e+n)*t),h=n%6;return{r:255*[s,o,a,a,l,s][h],g:255*[l,s,s,o,a,a][h],b:255*[a,a,l,s,s,o][h],a:i}},Sn=function(r){return{h:po(r.h),s:ye(r.s,0,100),l:ye(r.l,0,100),a:ye(r.a)}},An=function(r){return{h:ee(r.h),s:ee(r.s),l:ee(r.l),a:ee(r.a,3)}},Pn=function(r){return _o((t=(e=r).s,{h:e.h,s:(t*=((s=e.l)<50?s:100-s)/100)>0?2*t/(s+t)*100:0,v:s+t,a:e.a}));var e,t,s},zt=function(r){return{h:(e=mo(r)).h,s:(i=(200-(t=e.s))*(s=e.v)/100)>0&&i<200?t*s/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,t,s,i},Kc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,qc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Zc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Qc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,jr={string:[[function(r){var e=Xc.exec(r);return e?(r=e[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?ee(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?ee(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var e=Zc.exec(r)||Qc.exec(r);return e?e[2]!==e[4]||e[4]!==e[6]?null:Tn({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(r){var e=Kc.exec(r)||qc.exec(r);if(!e)return null;var t,s,i=Sn({h:(t=e[1],s=e[2],s===void 0&&(s="deg"),Number(t)*($c[s]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Pn(i)},"hsl"]],object:[[function(r){var e=r.r,t=r.g,s=r.b,i=r.a,n=i===void 0?1:i;return Me(e)&&Me(t)&&Me(s)?Tn({r:Number(e),g:Number(t),b:Number(s),a:Number(n)}):null},"rgb"],[function(r){var e=r.h,t=r.s,s=r.l,i=r.a,n=i===void 0?1:i;if(!Me(e)||!Me(t)||!Me(s))return null;var a=Sn({h:Number(e),s:Number(t),l:Number(s),a:Number(n)});return Pn(a)},"hsl"],[function(r){var e=r.h,t=r.s,s=r.v,i=r.a,n=i===void 0?1:i;if(!Me(e)||!Me(t)||!Me(s))return null;var a=function(o){return{h:po(o.h),s:ye(o.s,0,100),v:ye(o.v,0,100),a:ye(o.a)}}({h:Number(e),s:Number(t),v:Number(s),a:Number(n)});return _o(a)},"hsv"]]},kn=function(r,e){for(var t=0;t<e.length;t++){var s=e[t][0](r);if(s)return[s,e[t][1]]}return[null,void 0]},Jc=function(r){return typeof r=="string"?kn(r.trim(),jr.string):typeof r=="object"&&r!==null?kn(r,jr.object):[null,void 0]},ar=function(r,e){var t=zt(r);return{h:t.h,s:ye(t.s+100*e,0,100),l:t.l,a:t.a}},or=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},Cn=function(r,e){var t=zt(r);return{h:t.h,s:t.s,l:ye(t.l+100*e,0,100),a:t.a}},$r=function(){function r(e){this.parsed=Jc(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return ee(or(this.rgba),2)},r.prototype.isDark=function(){return or(this.rgba)<.5},r.prototype.isLight=function(){return or(this.rgba)>=.5},r.prototype.toHex=function(){return e=nr(this.rgba),t=e.r,s=e.g,i=e.b,a=(n=e.a)<1?ys(ee(255*n)):"","#"+ys(t)+ys(s)+ys(i)+a;var e,t,s,i,n,a},r.prototype.toRgb=function(){return nr(this.rgba)},r.prototype.toRgbString=function(){return e=nr(this.rgba),t=e.r,s=e.g,i=e.b,(n=e.a)<1?"rgba("+t+", "+s+", "+i+", "+n+")":"rgb("+t+", "+s+", "+i+")";var e,t,s,i,n},r.prototype.toHsl=function(){return An(zt(this.rgba))},r.prototype.toHslString=function(){return e=An(zt(this.rgba)),t=e.h,s=e.s,i=e.l,(n=e.a)<1?"hsla("+t+", "+s+"%, "+i+"%, "+n+")":"hsl("+t+", "+s+"%, "+i+"%)";var e,t,s,i,n},r.prototype.toHsv=function(){return e=mo(this.rgba),{h:ee(e.h),s:ee(e.s),v:ee(e.v),a:ee(e.a,3)};var e},r.prototype.invert=function(){return Pe({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},r.prototype.saturate=function(e){return e===void 0&&(e=.1),Pe(ar(this.rgba,e))},r.prototype.desaturate=function(e){return e===void 0&&(e=.1),Pe(ar(this.rgba,-e))},r.prototype.grayscale=function(){return Pe(ar(this.rgba,-1))},r.prototype.lighten=function(e){return e===void 0&&(e=.1),Pe(Cn(this.rgba,e))},r.prototype.darken=function(e){return e===void 0&&(e=.1),Pe(Cn(this.rgba,-e))},r.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},r.prototype.alpha=function(e){return typeof e=="number"?Pe({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):ee(this.rgba.a,3);var t},r.prototype.hue=function(e){var t=zt(this.rgba);return typeof e=="number"?Pe({h:e,s:t.s,l:t.l,a:t.a}):ee(t.h)},r.prototype.isEqual=function(e){return this.toHex()===Pe(e).toHex()},r}(),Pe=function(r){return r instanceof $r?r:new $r(r)},En=[],eu=function(r){r.forEach(function(e){En.indexOf(e)<0&&(e($r,jr),En.push(e))})};function tu(r,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var i in t)s[t[i]]=i;var n={};r.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,l,h=s[this.toHex()];if(h)return h;if(a!=null&&a.closest){var c=this.toRgb(),u=1/0,d="black";if(!n.length)for(var f in t)n[f]=new r(t[f]).toRgb();for(var g in t){var m=(o=c,l=n[g],Math.pow(o.r-l.r,2)+Math.pow(o.g-l.g,2)+Math.pow(o.b-l.b,2));m<u&&(u=m,d=g)}return d}},e.string.push([function(a){var o=a.toLowerCase(),l=o==="transparent"?"#0000":t[o];return l?new r(l).toRgb():null},"name"])}eu([tu]);const wt=class Nt{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Nt)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,e))&&(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}_isSourceEqual(e,t){const s=typeof e;if(s!==typeof t)return!1;if(s==="number"||s==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((n,a)=>n===t[a]);if(e!==null&&t!==null){const n=Object.keys(e),a=Object.keys(t);return n.length!==a.length?!1:n.every(o=>e[o]===t[o])}return e===t}toRgba(){const[e,t,s,i]=this._components;return{r:e,g:t,b:s,a:i}}toRgb(){const[e,t,s]=this._components;return{r:e,g:t,b:s}}toRgbaString(){const[e,t,s]=this.toUint8RgbArray();return`rgba(${e},${t},${s},${this.alpha})`}toUint8RgbArray(e){const[t,s,i]=this._components;return this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb),e[0]=Math.round(t*255),e[1]=Math.round(s*255),e[2]=Math.round(i*255),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e||(e=this._arrayRgba);const[t,s,i,n]=this._components;return e[0]=t,e[1]=s,e[2]=i,e[3]=n,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb);const[t,s,i]=this._components;return e[0]=t,e[1]=s,e[2]=i,e}toNumber(){return this._int}toBgrNumber(){const[e,t,s]=this.toUint8RgbArray();return(s<<16)+(t<<8)+e}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,s,i,n]=Nt._temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=s,this._components[2]*=i,this._components[3]*=n,this._refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let s=this._int>>16&255,i=this._int>>8&255,n=this._int&255;return t&&(s=s*e+.5|0,i=i*e+.5|0,n=n*e+.5|0),(e*255<<24)+(s<<16)+(i<<8)+n}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(e){let t,s,i,n;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const a=e;t=(a>>16&255)/255,s=(a>>8&255)/255,i=(a&255)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,s,i,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,s,i,n=255]=e,t/=255,s/=255,i/=255,n/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=Nt.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const a=Pe(e);a.isValid()&&({r:t,g:s,b:i,a:n}=a.rgba,t/=255,s/=255,i/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=s,this._components[2]=i,this._components[3]=n,this._refreshInt();else throw new Error(`Unable to convert color ${e}`)}_refreshInt(){this._clamp(this._components);const[e,t,s]=this._components;this._int=(e*255<<16)+(t*255<<8)+(s*255|0)}_clamp(e,t=0,s=1){return typeof e=="number"?Math.min(Math.max(e,t),s):(e.forEach((i,n)=>{e[n]=Math.min(Math.max(i,t),s)}),e)}static isColorLike(e){return typeof e=="number"||typeof e=="string"||e instanceof Number||e instanceof Nt||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e.r!==void 0&&e.g!==void 0&&e.b!==void 0||e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0&&e.a!==void 0}};wt.shared=new wt;wt._temp=new wt;wt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let V=wt;const su={cullArea:null,cullable:!1,cullableChildren:!0};class bi{constructor(e,t){this._pool=[],this._count=0,this._index=0,this._classType=e,t&&this.prepopulate(t)}prepopulate(e){for(let t=0;t<e;t++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){var s;let t;return this._index>0?t=this._pool[--this._index]:t=new this._classType,(s=t.init)==null||s.call(t,e),t}return(e){var t;(t=e.reset)==null||t.call(e),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}}class ru{constructor(){this._poolsByClass=new Map}prepopulate(e,t){this.getPool(e).prepopulate(t)}get(e,t){return this.getPool(e).get(t)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new bi(e)),this._poolsByClass.get(e)}stats(){const e={};return this._poolsByClass.forEach(t=>{const s=e[t._classType.name]?t._classType.name+t._classType.ID:t._classType.name;e[s]={free:t.totalFree,used:t.totalUsed,size:t.totalSize}}),e}}const te=new ru,iu={get isCachedAsTexture(){var r;return!!((r=this.renderGroup)!=null&&r.isCachedAsTexture)},cacheAsTexture(r){typeof r=="boolean"&&r===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(r===!0?{}:r))},updateCacheTexture(){var r;(r=this.renderGroup)==null||r.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(r){U("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(r)}};function yo(r,e,t){const s=r.length;let i;if(e>=s||t===0)return;t=e+t>s?s-e:t;const n=s-t;for(i=e;i<n;++i)r[i]=r[i+t];r.length=n}const nu={allowChildren:!0,removeChildren(r=0,e){var n;const t=e??this.children.length,s=t-r,i=[];if(s>0&&s<=t){for(let o=t-1;o>=r;o--){const l=this.children[o];l&&(i.push(l),l.parent=null)}yo(this.children,r,t);const a=this.renderGroup||this.parentRenderGroup;a&&a.removeChildren(i);for(let o=0;o<i.length;++o){const l=i[o];(n=l.parentRenderLayer)==null||n.detach(l),this.emit("childRemoved",l,this,o),i[o].emit("removed",this)}return i.length>0&&this._didViewChangeTick++,i}else if(s===0&&this.children.length===0)return i;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(r){const e=this.getChildAt(r);return this.removeChild(e)},getChildAt(r){if(r<0||r>=this.children.length)throw new Error(`getChildAt: Index (${r}) does not exist.`);return this.children[r]},setChildIndex(r,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(r),this.addChildAt(r,e)},getChildIndex(r){const e=this.children.indexOf(r);if(e===-1)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(r,e){this.allowChildren||U(H,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:t}=this;if(e<0||e>t.length)throw new Error(`${r}addChildAt: The index ${e} supplied is out of bounds ${t.length}`);if(r.parent){const i=r.parent.children.indexOf(r);if(r.parent===this&&i===e)return r;i!==-1&&r.parent.children.splice(i,1)}e===t.length?t.push(r):t.splice(e,0,r),r.parent=this,r.didChange=!0,r._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(r),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",r,this,e),r.emit("added",this),r},swapChildren(r,e){if(r===e)return;const t=this.getChildIndex(r),s=this.getChildIndex(e);this.children[t]=e,this.children[s]=r;const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var r;(r=this.parent)==null||r.removeChild(this)},reparentChild(...r){return r.length===1?this.reparentChildAt(r[0],this.children.length):(r.forEach(e=>this.reparentChildAt(e,this.children.length)),r[0])},reparentChildAt(r,e){if(r.parent===this)return this.setChildIndex(r,e),r;const t=r.worldTransform.clone();r.removeFromParent(),this.addChildAt(r,e);const s=this.worldTransform.clone();return s.invert(),t.prepend(s),r.setFromMatrix(t),r}},au={collectRenderables(r,e,t){this.parentRenderLayer&&this.parentRenderLayer!==t||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(r,e,t):this.renderGroup?e.renderPipes.renderGroup.addRenderGroup(this.renderGroup,r):this.collectRenderablesWithEffects(r,e,t))},collectRenderablesSimple(r,e,t){const s=this.children,i=s.length;for(let n=0;n<i;n++)s[n].collectRenderables(r,e,t)},collectRenderablesWithEffects(r,e,t){const{renderPipes:s}=e;for(let i=0;i<this.effects.length;i++){const n=this.effects[i];s[n.pipe].push(n,this,r)}this.collectRenderablesSimple(r,e,t);for(let i=this.effects.length-1;i>=0;i--){const n=this.effects[i];s[n.pipe].pop(n,this,r)}}};class Ns{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}class ou{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let t=0;t<this._tests.length;t++){const s=this._tests[t];if(s.test(e))return te.get(s.maskClass,e)}return e}returnMaskEffect(e){te.return(e)}}const Xr=new ou;M.handleByList(y.MaskEffect,Xr._effectClasses);const lu={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const r=this.renderGroup||this.parentRenderGroup;r&&(r.structureDidChange=!0)},addEffect(r){this.effects.indexOf(r)===-1&&(this.effects.push(r),this.effects.sort((t,s)=>t.priority-s.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(r){const e=this.effects.indexOf(r);e!==-1&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(r){const e=this._maskEffect;(e==null?void 0:e.mask)!==r&&(e&&(this.removeEffect(e),Xr.returnMaskEffect(e),this._maskEffect=null),r!=null&&(this._maskEffect=Xr.getMaskEffect(r),this.addEffect(this._maskEffect)))},get mask(){var r;return(r=this._maskEffect)==null?void 0:r.mask},setMask(r){this._maskOptions={...this._maskOptions,...r},r.mask&&(this.mask=r.mask),this._markStructureAsChanged()},set filters(r){var n;!Array.isArray(r)&&r&&(r=[r]);const e=this._filterEffect||(this._filterEffect=new Ns);r=r;const t=(r==null?void 0:r.length)>0,s=((n=e.filters)==null?void 0:n.length)>0,i=t!==s;r=Array.isArray(r)?r.slice(0):r,e.filters=Object.freeze(r),i&&(t?this.addEffect(e):(this.removeEffect(e),e.filters=r??null))},get filters(){var r;return(r=this._filterEffect)==null?void 0:r.filters},set filterArea(r){this._filterEffect||(this._filterEffect=new Ns),this._filterEffect.filterArea=r},get filterArea(){var r;return(r=this._filterEffect)==null?void 0:r.filterArea}},hu={label:null,get name(){return U(H,"Container.name property has been removed, use Container.label instead"),this.label},set name(r){U(H,"Container.name property has been removed, use Container.label instead"),this.label=r},getChildByName(r,e=!1){return this.getChildByLabel(r,e)},getChildByLabel(r,e=!1){const t=this.children;for(let s=0;s<t.length;s++){const i=t[s];if(i.label===r||r instanceof RegExp&&r.test(i.label))return i}if(e)for(let s=0;s<t.length;s++){const n=t[s].getChildByLabel(r,!0);if(n)return n}return null},getChildrenByLabel(r,e=!1,t=[]){const s=this.children;for(let i=0;i<s.length;i++){const n=s[i];(n.label===r||r instanceof RegExp&&r.test(n.label))&&t.push(n)}if(e)for(let i=0;i<s.length;i++)s[i].getChildrenByLabel(r,!0,t);return t}},ne=new bi(E),Re=new bi(ie),cu=new E,uu={getFastGlobalBounds(r,e){e||(e=new ie),e.clear(),this._getGlobalBoundsRecursive(!!r,e,this.parentRenderLayer),e.isValid||e.set(0,0,0,0);const t=this.renderGroup||this.parentRenderGroup;return e.applyMatrix(t.worldTransform),e},_getGlobalBoundsRecursive(r,e,t){let s=e;if(r&&this.parentRenderLayer&&this.parentRenderLayer!==t||this.localDisplayStatus!==7||!this.measurable)return;const i=!!this.effects.length;if((this.renderGroup||i)&&(s=Re.get().clear()),this.boundsArea)e.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const a=this.bounds;s.addFrame(a.minX,a.minY,a.maxX,a.maxY,this.groupTransform)}const n=this.children;for(let a=0;a<n.length;a++)n[a]._getGlobalBoundsRecursive(r,s,t)}if(i){let n=!1;const a=this.renderGroup||this.parentRenderGroup;for(let o=0;o<this.effects.length;o++)this.effects[o].addBounds&&(n||(n=!0,s.applyMatrix(a.worldTransform)),this.effects[o].addBounds(s,!0));n&&(s.applyMatrix(a.worldTransform.copyTo(cu).invert()),e.addBounds(s,this.relativeGroupTransform)),e.addBounds(s),Re.return(s)}else this.renderGroup&&(e.addBounds(s,this.relativeGroupTransform),Re.return(s))}};function vi(r,e,t){t.clear();let s,i;return r.parent?e?s=r.parent.worldTransform:(i=ne.get().identity(),s=wi(r,i)):s=E.IDENTITY,xo(r,t,s,e),i&&ne.return(i),t.isValid||t.set(0,0,0,0),t}function xo(r,e,t,s){var o,l;if(!r.visible||!r.measurable)return;let i;s?i=r.worldTransform:(r.updateLocalTransform(),i=ne.get(),i.appendFrom(r.localTransform,t));const n=e,a=!!r.effects.length;if(a&&(e=Re.get().clear()),r.boundsArea)e.addRect(r.boundsArea,i);else{r.bounds&&(e.matrix=i,e.addBounds(r.bounds));for(let h=0;h<r.children.length;h++)xo(r.children[h],e,i,s)}if(a){for(let h=0;h<r.effects.length;h++)(l=(o=r.effects[h]).addBounds)==null||l.call(o,e);n.addBounds(e,E.IDENTITY),Re.return(e)}s||ne.return(i)}function wi(r,e){const t=r.parent;return t&&(wi(t,e),t.updateLocalTransform(),e.append(t.localTransform)),e}function bo(r,e){if(r===16777215||!e)return e;if(e===16777215||!r)return r;const t=r>>16&255,s=r>>8&255,i=r&255,n=e>>16&255,a=e>>8&255,o=e&255,l=t*n/255|0,h=s*a/255|0,c=i*o/255|0;return(l<<16)+(h<<8)+c}const Mn=16777215;function Hs(r,e){return r===Mn?e:e===Mn?r:bo(r,e)}function Is(r){return((r&255)<<16)+(r&65280)+(r>>16&255)}const du={getGlobalAlpha(r){if(r)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,t=this.parent;for(;t;)e*=t.alpha,t=t.parent;return e},getGlobalTransform(r,e){if(e)return r.copyFrom(this.worldTransform);this.updateLocalTransform();const t=wi(this,ne.get().identity());return r.appendFrom(this.localTransform,t),ne.return(t),r},getGlobalTint(r){if(r)return this.renderGroup?Is(this.renderGroup.worldColor):this.parentRenderGroup?Is(Hs(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,t=this.parent;for(;t;)e=Hs(e,t.localColor),t=t.parent;return Is(e)}};function Ti(r,e,t){return e.clear(),t||(t=E.IDENTITY),vo(r,e,t,r,!0),e.isValid||e.set(0,0,0,0),e}function vo(r,e,t,s,i){var l,h;let n;if(i)n=ne.get(),n=t.copyTo(n);else{if(!r.visible||!r.measurable)return;r.updateLocalTransform();const c=r.localTransform;n=ne.get(),n.appendFrom(c,t)}const a=e,o=!!r.effects.length;if(o&&(e=Re.get().clear()),r.boundsArea)e.addRect(r.boundsArea,n);else{r.renderPipeId&&(e.matrix=n,e.addBounds(r.bounds));const c=r.children;for(let u=0;u<c.length;u++)vo(c[u],e,n,s,!1)}if(o){for(let c=0;c<r.effects.length;c++)(h=(l=r.effects[c]).addLocalBounds)==null||h.call(l,e,s);a.addBounds(e,E.IDENTITY),Re.return(e)}ne.return(n)}function wo(r,e){const t=r.children;for(let s=0;s<t.length;s++){const i=t[s],n=i.uid,a=(i._didViewChangeTick&65535)<<16|i._didContainerChangeTick&65535,o=e.index;(e.data[o]!==n||e.data[o+1]!==a)&&(e.data[e.index]=n,e.data[e.index+1]=a,e.didChange=!0),e.index=o+2,i.children.length&&wo(i,e)}return e.didChange}const fu=new E,gu={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(r,e){const t=Math.sign(this.scale.x)||1;e!==0?this.scale.x=r/e*t:this.scale.x=t},_setHeight(r,e){const t=Math.sign(this.scale.y)||1;e!==0?this.scale.y=r/e*t:this.scale.y=t},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new ie});const r=this._localBoundsCacheData;return r.index=1,r.didChange=!1,r.data[0]!==this._didViewChangeTick&&(r.didChange=!0,r.data[0]=this._didViewChangeTick),wo(this,r),r.didChange&&Ti(this,r.localBounds,fu),r.localBounds},getBounds(r,e){return vi(this,r,e||new ie)}},pu={_onRender:null,set onRender(r){const e=this.renderGroup||this.parentRenderGroup;if(!r){this._onRender&&(e==null||e.removeOnRender(this)),this._onRender=null;return}this._onRender||e==null||e.addOnRender(this),this._onRender=r},get onRender(){return this._onRender}},mu={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(r){this._zIndex!==r&&(this._zIndex=r,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(_u))}};function _u(r,e){return r._zIndex-e._zIndex}const yu={getGlobalPosition(r=new Y,e=!1){return this.parent?this.parent.toGlobal(this._position,r,e):(r.x=this._position.x,r.y=this._position.y),r},toGlobal(r,e,t=!1){const s=this.getGlobalTransform(ne.get(),t);return e=s.apply(r,e),ne.return(s),e},toLocal(r,e,t,s){e&&(r=e.toGlobal(r,t,s));const i=this.getGlobalTransform(ne.get(),s);return t=i.applyInverse(r,t),ne.return(i),t}};class To{constructor(){this.uid=X("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let xu=0;class bu{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this.textureStyle=new De(this.textureOptions)}createTexture(e,t,s){const i=new J({...this.textureOptions,width:e,height:t,resolution:1,antialias:s,autoGarbageCollect:!1});return new k({source:i,label:`texturePool_${xu++}`})}getOptimalTexture(e,t,s=1,i){let n=Math.ceil(e*s-1e-6),a=Math.ceil(t*s-1e-6);n=vt(n),a=vt(a);const o=(n<<17)+(a<<1)+(i?1:0);this._texturePool[o]||(this._texturePool[o]=[]);let l=this._texturePool[o].pop();return l||(l=this.createTexture(n,a,i)),l.source._resolution=s,l.source.width=n/s,l.source.height=a/s,l.source.pixelWidth=n,l.source.pixelHeight=a,l.frame.x=0,l.frame.y=0,l.frame.width=e,l.frame.height=t,l.updateUvs(),this._poolKeyHash[l.uid]=o,l}getSameSizeTexture(e,t=!1){const s=e.source;return this.getOptimalTexture(e.width,e.height,s._resolution,t)}returnTexture(e,t=!1){const s=this._poolKeyHash[e.uid];t&&(e.source.style=this.textureStyle),this._texturePool[s].push(e)}clear(e){if(e=e!==!1,e)for(const t in this._texturePool){const s=this._texturePool[t];if(s)for(let i=0;i<s.length;i++)s[i].destroy(!0)}this._texturePool={}}}const re=new bu;class vu{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new E,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new To,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;const t=e.children;for(let s=0;s<t.length;s++){const i=t[s];i._updateFlags=15,this.addChild(i)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(re.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const e in this.childrenToUpdate){const t=this.childrenToUpdate[e];t.list.fill(null),t.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){const t=this.renderGroupChildren.indexOf(e);t>-1&&this.renderGroupChildren.splice(t,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup){this.addRenderGroupChild(e.renderGroup);return}e._onRender&&this.addOnRender(e);const t=e.children;for(let s=0;s<t.length;s++)this.addChild(t[s])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup){this._removeRenderGroupChild(e.renderGroup);return}const t=e.children;for(let s=0;s<t.length;s++)this.removeChild(t[s])}removeChildren(e){for(let t=0;t<e.length;t++)this.removeChild(e[t])}onChildUpdate(e){let t=this.childrenToUpdate[e.relativeRenderGroupDepth];t||(t=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),t.list[t.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(e){for(let t=0;t<this._onRenderContainers.length;t++)this._onRenderContainers[t]._onRender(e)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){const t=this.root.children;for(let s=0;s<t.length;s++)this._getChildren(t[s],e);return e}_getChildren(e,t=[]){if(t.push(e),e.renderGroup)return t;const s=e.children;for(let i=0;i<s.length;i++)this._getChildren(s[i],t);return t}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new E),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new E),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const e=this._parentCacheAsTextureRenderGroup;return e?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new E),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(e.inverseWorldTransform).translate(-e._textureBounds.x,-e._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function wu(r,e,t={}){for(const s in e)!t[s]&&e[s]!==void 0&&(r[s]=e[s])}const lr=new le(null),hr=new le(null),cr=new le(null,1,1),Ws=1,Si=2,Yt=4;class ae extends ge{constructor(e={}){var t,s;super(),this.uid=X("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new E,this.relativeGroupTransform=new E,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new le(this,0,0),this._scale=cr,this._pivot=hr,this._skew=lr,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],wu(this,e,{children:!0,parent:!0,effects:!0}),(t=e.children)==null||t.forEach(i=>this.addChild(i)),(s=e.parent)==null||s.addChild(this)}static mixin(e){U("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),M.mixin(ae,e)}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=e&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...e){if(this.allowChildren||U(H,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let i=0;i<e.length;i++)this.addChild(e[i]);return e[0]}const t=e[0],s=this.renderGroup||this.parentRenderGroup;return t.parent===this?(this.children.splice(this.children.indexOf(t),1),this.children.push(t),s&&(s.structureDidChange=!0),t):(t.parent&&t.parent.removeChild(t),this.children.push(t),this.sortableChildren&&(this.sortDirty=!0),t.parent=this,t.didChange=!0,t._updateFlags=15,s&&s.addChild(t),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this),this._didViewChangeTick++,t._zIndex!==0&&t.depthOfChildModified(),t)}removeChild(...e){if(e.length>1){for(let i=0;i<e.length;i++)this.removeChild(e[i]);return e[0]}const t=e[0],s=this.children.indexOf(t);return s>-1&&(this._didViewChangeTick++,this.children.splice(s,1),this.renderGroup?this.renderGroup.removeChild(t):this.parentRenderGroup&&this.parentRenderGroup.removeChild(t),t.parentRenderLayer&&t.parentRenderLayer.detach(t),t.parent=null,this.emit("childRemoved",t,this,s),t.emit("removed",this)),t}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const e=this.parentRenderGroup;e==null||e.removeChild(this),this.renderGroup=te.get(vu,this),this.groupTransform=E.IDENTITY,e==null||e.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const e=this.parentRenderGroup;e==null||e.removeChild(this),te.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,e==null||e.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new E),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*Nc}set angle(e){this.rotation=e*Hc}get pivot(){return this._pivot===hr&&(this._pivot=new le(this,0,0)),this._pivot}set pivot(e){this._pivot===hr&&(this._pivot=new le(this,0,0)),typeof e=="number"?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===lr&&(this._skew=new le(this,0,0)),this._skew}set skew(e){this._skew===lr&&(this._skew=new le(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===cr&&(this._scale=new le(this,1,1)),this._scale}set scale(e){this._scale===cr&&(this._scale=new le(this,0,0)),typeof e=="number"?this._scale.set(e):this._scale.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){const t=this.getLocalBounds().width;this._setWidth(e,t)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){const t=this.getLocalBounds().height;this._setHeight(e,t)}getSize(e){e||(e={});const t=this.getLocalBounds();return e.width=Math.abs(this.scale.x*t.width),e.height=Math.abs(this.scale.y*t.height),e}setSize(e,t){const s=this.getLocalBounds();typeof e=="object"?(t=e.height??e.width,e=e.width):t??(t=e),e!==void 0&&this._setWidth(e,s.width),t!==void 0&&this._setHeight(t,s.height)}_updateSkew(){const e=this._rotation,t=this._skew;this._cx=Math.cos(e+t._y),this._sx=Math.sin(e+t._y),this._cy=-Math.sin(e-t._x),this._sy=Math.cos(e-t._x)}updateTransform(e){return this.position.set(typeof e.x=="number"?e.x:this.position.x,typeof e.y=="number"?e.y:this.position.y),this.scale.set(typeof e.scaleX=="number"?e.scaleX||1:this.scale.x,typeof e.scaleY=="number"?e.scaleY||1:this.scale.y),this.rotation=typeof e.rotation=="number"?e.rotation:this.rotation,this.skew.set(typeof e.skewX=="number"?e.skewX:this.skew.x,typeof e.skewY=="number"?e.skewY:this.skew.y),this.pivot.set(typeof e.pivotX=="number"?e.pivotX:this.pivot.x,typeof e.pivotY=="number"?e.pivotY:this.pivot.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){const e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;const t=this.localTransform,s=this._scale,i=this._pivot,n=this._position,a=s._x,o=s._y,l=i._x,h=i._y;t.a=this._cx*a,t.b=this._sx*a,t.c=this._cy*o,t.d=this._sy*o,t.tx=n._x-(l*t.a+h*t.c),t.ty=n._y-(l*t.b+h*t.d)}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=Ws,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){const s=V.shared.setValue(e??16777215).toBgrNumber();s!==this.localColor&&(this.localColor=s,this._updateFlags|=Ws,this._onUpdate())}get tint(){return Is(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Si,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(e){const t=e?2:0;(this.localDisplayStatus&2)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Yt,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(e){const t=e?0:4;(this.localDisplayStatus&4)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Yt,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(e){const t=e?1:0;(this.localDisplayStatus&1)!==t&&(this._updateFlags|=Yt,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(e=!1){var i;if(this.destroyed)return;this.destroyed=!0;let t;if(this.children.length&&(t=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof e=="boolean"?e:e==null?void 0:e.children)&&t)for(let n=0;n<t.length;++n)t[n].destroy(e);(i=this.renderGroup)==null||i.destroy(),this.renderGroup=null}}M.mixin(ae,nu,uu,yu,pu,gu,lu,hu,mu,su,iu,du,au);class Ai extends ae{constructor(e){super(e),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new ie(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}containsPoint(e){const t=this.bounds,{x:s,y:i}=e;return s>=t.minX&&s<=t.maxX&&i>=t.minY&&i<=t.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this)}destroy(e){var t,s;super.destroy(e),this._bounds=null;for(const i in this._gpuData)(s=(t=this._gpuData[i]).destroy)==null||s.call(t);this._gpuData=null}collectRenderablesSimple(e,t,s){const{renderPipes:i}=t;i.blendMode.setBlendMode(this,this.groupBlendMode,e),i[this.renderPipeId].addRenderable(this,e),this.didViewUpdate=!1;const a=this.children,o=a.length;for(let l=0;l<o;l++)a[l].collectRenderables(e,t,s)}}class Ue extends Ai{constructor(e=k.EMPTY){e instanceof k&&(e={texture:e});const{texture:t=k.EMPTY,anchor:s,roundPixels:i,width:n,height:a,...o}=e;super({label:"Sprite",...o}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new le({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:t.defaultAnchor&&(this.anchor=t.defaultAnchor),this.texture=t,this.allowChildren=!1,this.roundPixels=i??!1,n!==void 0&&(this.width=n),a!==void 0&&(this.height=a)}static from(e,t=!1){return e instanceof k?new Ue(e):new Ue(k.from(e,t))}set texture(e){e||(e=k.EMPTY);const t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return go(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return U("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const e=this._anchor,t=this._texture,s=this._bounds,{width:i,height:n}=t.orig;s.minX=-e._x*i,s.maxX=s.minX+i,s.minY=-e._y*n,s.maxY=s.minY+n}destroy(e=!1){if(super.destroy(e),typeof e=="boolean"?e:e==null?void 0:e.texture){const s=typeof e=="boolean"?e:e==null?void 0:e.textureSource;this._texture.destroy(s)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width),this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height),this._height=e}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,t){typeof e=="object"?(t=e.height??e.width,e=e.width):t??(t=e),e!==void 0&&this._setWidth(e,this._texture.orig.width),t!==void 0&&this._setHeight(t,this._texture.orig.height)}}const Tu=new ie;function So(r,e,t){const s=Tu;r.measurable=!0,vi(r,t,s),e.addBoundsMask(s),r.measurable=!1}let ur=0;const Fn=500;function B(...r){ur!==Fn&&(ur++,ur===Fn?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...r))}function Ao(r,e,t){const s=Re.get();r.measurable=!0;const i=ne.get().identity(),n=Po(r,t,i);Ti(r,s,n),r.measurable=!1,e.addBoundsMask(s),ne.return(i),Re.return(s)}function Po(r,e,t){return r?(r!==e&&(Po(r.parent,e,t),r.updateLocalTransform(),t.append(r.localTransform)),t):(B("Mask bounds, renderable is not inside the root container"),t)}class ko{constructor(e){this.priority=0,this.inverse=!1,this.pipe="alphaMask",e!=null&&e.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof Ue),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,t){this.inverse||So(this.mask,e,t)}addLocalBounds(e,t){Ao(this.mask,e,t)}containsPoint(e,t){const s=this.mask;return t(s,e)}destroy(){this.reset()}static test(e){return e instanceof Ue}}ko.extension=y.MaskEffect;class Co{constructor(e){this.priority=0,this.pipe="colorMask",e!=null&&e.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}}Co.extension=y.MaskEffect;class Eo{constructor(e){this.priority=0,this.pipe="stencilMask",e!=null&&e.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,t){So(this.mask,e,t)}addLocalBounds(e,t){Ao(this.mask,e,t)}containsPoint(e,t){const s=this.mask;return t(s,e)}destroy(){this.reset()}static test(e){return e instanceof ae}}Eo.extension=y.MaskEffect;const Su={createCanvas:(r,e)=>{const t=document.createElement("canvas");return t.width=r,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,e)=>fetch(r,e),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")};let Bn=Su;const O={get(){return Bn},set(r){Bn=r}};class Ie extends J{constructor(e){e.resource||(e.resource=O.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity,this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,t=this.height,s=this._resolution){const i=super.resize(e,t,s);return i&&this.resizeCanvas(),i}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Ie.extension=y.TextureSource;class ct extends J{constructor(e){super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||globalThis.VideoFrame&&e instanceof VideoFrame}}ct.extension=y.TextureSource;var Zt=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(Zt||{});class dr{constructor(e,t=null,s=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=t,this.priority=s,this._once=i}match(e,t=null){return this._fn===e&&this._context===t}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));const t=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const Mo=class ce{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new dr(null,null,1/0),this.deltaMS=1/ce.targetFPMS,this.elapsedMS=1/ce.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,s=Zt.NORMAL){return this._addListener(new dr(e,t,s))}addOnce(e,t,s=Zt.NORMAL){return this._addListener(new dr(e,t,s,!0))}_addListener(e){let t=this._head.next,s=this._head;if(!t)e.connect(s);else{for(;t;){if(e.priority>t.priority){e.connect(s);break}s=t,t=t.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,t){let s=this._head.next;for(;s;)s.match(e,t)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*ce.targetFPMS;const s=this._head;let i=s.next;for(;i;)i=i.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,t)/1e3,ce.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!ce._shared){const e=ce._shared=new ce;e.autoStart=!0,e._protected=!0}return ce._shared}static get system(){if(!ce._system){const e=ce._system=new ce;e.autoStart=!0,e._protected=!0}return ce._system}};Mo.targetFPMS=.06;let Ce=Mo,fr;async function Fo(){return fr??(fr=(async()=>{var a;const e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const t=await new Promise(o=>{const l=document.createElement("video");l.onloadeddata=()=>o(l),l.onerror=()=>o(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!t)return"premultiply-alpha-on-upload";const s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,n),e.deleteFramebuffer(i),e.deleteTexture(s),(a=e.getExtension("WEBGL_lose_context"))==null||a.loseContext(),n[0]<=n[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),fr}const qs=class Bo extends J{constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...Bo.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const e=Ce.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const e=this.resource,t=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(t.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await Fo(),this._load=new Promise((s,i)=>{this.isValid?s(this):(this._resolve=s,this._reject=i,t.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${t.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ce.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ce.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ce.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement}};qs.extension=y.TextureSource;qs.defaultOptions={...J.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};qs.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Gs=qs;const we=(r,e,t=!1)=>(Array.isArray(r)||(r=[r]),e?r.map(s=>typeof s=="string"||t?e(s):s):r);class Au{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||B(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const s=we(e);let i;for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];if(h.test(t)){i=h.getCacheableAssets(s,t);break}}const n=new Map(Object.entries(i||{}));i||s.forEach(l=>{n.set(l,t)});const a=[...n.keys()],o={cacheKeys:a,keys:s};s.forEach(l=>{this._cacheMap.set(l,o)}),a.forEach(l=>{const h=i?i[l]:t;this._cache.has(l)&&this._cache.get(l)!==h&&B("[Cache] already has key:",l),this._cache.set(l,n.get(l))})}remove(e){if(!this._cacheMap.has(e)){B(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(i=>{this._cache.delete(i)}),t.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const $=new Au,Kr=[];M.handleByList(y.TextureSource,Kr);function Ro(r={}){const e=r&&r.resource,t=e?r.resource:r,s=e?r:{resource:r};for(let i=0;i<Kr.length;i++){const n=Kr[i];if(n.test(t))return new n(s)}throw new Error(`Could not find a source type for resource: ${s.resource}`)}function Pu(r={},e=!1){const t=r&&r.resource,s=t?r.resource:r,i=t?r:{resource:r};if(!e&&$.has(s))return $.get(s);const n=new k({source:Ro(i)});return n.on("destroy",()=>{$.has(s)&&$.remove(s)}),e||$.set(s,n),n}function ku(r,e=!1){return typeof r=="string"?$.get(r):r instanceof J?new k({source:r}):Pu(r,e)}k.from=ku;J.from=Ro;M.add(ko,Co,Eo,Gs,ct,Ie,xi);var Xe=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(Xe||{});function be(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function It(r){return r.split("?")[0].split("#")[0]}function Cu(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Eu(r,e,t){return r.replace(new RegExp(Cu(e),"g"),t)}function Mu(r,e){let t="",s=0,i=-1,n=0,a=-1;for(let o=0;o<=r.length;++o){if(o<r.length)a=r.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(i===o-1||n===1))if(i!==o-1&&n===2){if(t.length<2||s!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",s=0):(t=t.slice(0,l),s=t.length-1-t.lastIndexOf("/")),i=o,n=0;continue}}else if(t.length===2||t.length===1){t="",s=0,i=o,n=0;continue}}}else t.length>0?t+=`/${r.slice(i+1,o)}`:t=r.slice(i+1,o),s=o-i-1;i=o,n=0}else a===46&&n!==-1?++n:n=-1}return t}const de={toPosix(r){return Eu(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){be(r),r=this.toPosix(r);const e=/^file:\/\/\//.exec(r);if(e)return e[0];const t=/^[^/:]+:\/{0,2}/.exec(r);return t?t[0]:""},toAbsolute(r,e,t){if(be(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const s=It(this.toPosix(e??O.get().getBaseUrl())),i=It(this.toPosix(t??this.rootname(s)));return r=this.toPosix(r),r.startsWith("/")?de.join(i,r.slice(1)):this.isAbsolute(r)?r:this.join(s,r)},normalize(r){if(be(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let e="";const t=r.startsWith("/");this.hasProtocol(r)&&(e=this.rootname(r),r=r.slice(e.length));const s=r.endsWith("/");return r=Mu(r),r.length>0&&s&&(r+="/"),t?`/${r}`:e+r},isAbsolute(r){return be(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){const s=r[t];if(be(s),s.length>0)if(e===void 0)e=s;else{const i=r[t-1]??"";this.joinExtensions.includes(this.extname(i).toLowerCase())?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(r){if(be(r),r.length===0)return".";r=this.toPosix(r);let e=r.charCodeAt(0);const t=e===47;let s=-1,i=!0;const n=this.getProtocol(r),a=r;r=r.slice(n.length);for(let o=r.length-1;o>=1;--o)if(e=r.charCodeAt(o),e===47){if(!i){s=o;break}}else i=!1;return s===-1?t?"/":this.isUrl(a)?n+r:n:t&&s===1?"//":n+r.slice(0,s)},rootname(r){be(r),r=this.toPosix(r);let e="";if(r.startsWith("/")?e="/":e=this.getProtocol(r),this.isUrl(r)){const t=r.indexOf("/",e.length);t!==-1?e=r.slice(0,t):e=r,e.endsWith("/")||(e+="/")}return e},basename(r,e){be(r),e&&be(e),r=It(this.toPosix(r));let t=0,s=-1,i=!0,n;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e.length===r.length&&e===r)return"";let a=e.length-1,o=-1;for(n=r.length-1;n>=0;--n){const l=r.charCodeAt(n);if(l===47){if(!i){t=n+1;break}}else o===-1&&(i=!1,o=n+1),a>=0&&(l===e.charCodeAt(a)?--a===-1&&(s=n):(a=-1,s=o))}return t===s?s=o:s===-1&&(s=r.length),r.slice(t,s)}for(n=r.length-1;n>=0;--n)if(r.charCodeAt(n)===47){if(!i){t=n+1;break}}else s===-1&&(i=!1,s=n+1);return s===-1?"":r.slice(t,s)},extname(r){be(r),r=It(this.toPosix(r));let e=-1,t=0,s=-1,i=!0,n=0;for(let a=r.length-1;a>=0;--a){const o=r.charCodeAt(a);if(o===47){if(!i){t=a+1;break}continue}s===-1&&(i=!1,s=a+1),o===46?e===-1?e=a:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||s===-1||n===0||n===1&&e===s-1&&e===t+1?"":r.slice(e,s)},parse(r){be(r);const e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;r=It(this.toPosix(r));let t=r.charCodeAt(0);const s=this.isAbsolute(r);let i;e.root=this.rootname(r),s||this.hasProtocol(r)?i=1:i=0;let n=-1,a=0,o=-1,l=!0,h=r.length-1,c=0;for(;h>=i;--h){if(t=r.charCodeAt(h),t===47){if(!l){a=h+1;break}continue}o===-1&&(l=!1,o=h+1),t===46?n===-1?n=h:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||o===-1||c===0||c===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&s?e.base=e.name=r.slice(1,o):e.base=e.name=r.slice(a,o)):(a===0&&s?(e.name=r.slice(1,n),e.base=r.slice(1,o)):(e.name=r.slice(a,n),e.base=r.slice(a,o)),e.ext=r.slice(n,o)),e.dir=this.dirname(r),e},sep:"/",delimiter:":",joinExtensions:[".html"]};function Io(r,e,t,s,i){const n=e[t];for(let a=0;a<n.length;a++){const o=n[a];t<e.length-1?Io(r.replace(s[t],o),e,t+1,s,i):i.push(r.replace(s[t],o))}}function Fu(r){const e=/\{(.*?)\}/g,t=r.match(e),s=[];if(t){const i=[];t.forEach(n=>{const a=n.substring(1,n.length-1).split(",");i.push(a)}),Io(r,i,0,t,s)}else s.push(r);return s}const Vs=r=>!Array.isArray(r);class Pt{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(t[s])}`).join("&")}}getAlias(e){const{alias:t,src:s}=e;return we(t||s,n=>typeof n=="string"?n:Array.isArray(n)?n.map(a=>(a==null?void 0:a.src)??a):n!=null&&n.src?n.src:n,!0)}addManifest(e){this._manifest&&B("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const s=[];let i=t;Array.isArray(t)||(i=Object.entries(t).map(([n,a])=>typeof a=="string"||Array.isArray(a)?{alias:n,src:a}:{alias:n,...a})),i.forEach(n=>{const a=n.src,o=n.alias;let l;if(typeof o=="string"){const h=this._createBundleAssetId(e,o);s.push(h),l=[o,h]}else{const h=o.map(c=>this._createBundleAssetId(e,c));s.push(...h),l=[...o,...h]}this.add({...n,alias:l,src:a})}),this._bundles[e]=s}add(e){const t=[];Array.isArray(e)?t.push(...e):t.push(e);let s;s=n=>{this.hasKey(n)&&B(`[Resolver] already has key: ${n} overwriting`)},we(t).forEach(n=>{const{src:a}=n;let{data:o,format:l,loadParser:h}=n;const c=we(a).map(f=>typeof f=="string"?Fu(f):Array.isArray(f)?f:[f]),u=this.getAlias(n);Array.isArray(u)?u.forEach(s):s(u);const d=[];c.forEach(f=>{f.forEach(g=>{let m={};if(typeof g!="object"){m.src=g;for(let p=0;p<this._parsers.length;p++){const _=this._parsers[p];if(_.test(g)){m=_.parse(g);break}}}else o=g.data??o,l=g.format??l,h=g.loadParser??h,m={...m,...g};if(!u)throw new Error(`[Resolver] alias is undefined for this asset: ${m.src}`);m=this._buildResolvedAsset(m,{aliases:u,data:o,format:l,loadParser:h}),d.push(m)})}),u.forEach(f=>{this._assetMap[f]=d})})}resolveBundle(e){const t=Vs(e);e=we(e);const s={};return e.forEach(i=>{const n=this._bundles[i];if(n){const a=this.resolve(n),o={};for(const l in a){const h=a[l];o[this._extractAssetIdFromBundle(i,l)]=h}s[i]=o}}),t?s[e[0]]:s}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const s={};for(const i in t)s[i]=t[i].src;return s}return t.src}resolve(e){const t=Vs(e);e=we(e);const s={};return e.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let n=this._assetMap[i];const a=this._getPreferredOrder(n);a==null||a.priority.forEach(o=>{a.params[o].forEach(l=>{const h=n.filter(c=>c[o]?c[o]===l:!1);h.length&&(n=h)})}),this._resolverHash[i]=n[0]}else this._resolverHash[i]=this._buildResolvedAsset({alias:[i],src:i},{});s[i]=this._resolverHash[i]}),t?s[e[0]]:s}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const s=e[t],i=this._preferredOrder.find(n=>n.params.format.includes(s.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}_buildResolvedAsset(e,t){const{aliases:s,data:i,loadParser:n,format:a}=t;return(this._basePath||this._rootPath)&&(e.src=de.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=s??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...i||{},...e.data},e.loadParser=n??e.loadParser,e.format=a??e.format??Bu(e.src),e}}Pt.RETINA_PREFIX=/@([0-9\.]+)x/;function Bu(r){return r.split(".").pop().split("?").shift().split("#").shift()}const qr=(r,e)=>{const t=e.split("?")[1];return t&&(r+=`?${t}`),r},Go=class Ht{constructor(e,t){this.linkedSheets=[];let s=e;(e==null?void 0:e.source)instanceof J&&(s={texture:e,data:t});const{texture:i,data:n,cachePrefix:a=""}=s;this.cachePrefix=a,this._texture=i instanceof k?i:null,this.textureSource=i.source,this.textures={},this.animations={},this.data=n;const o=parseFloat(n.meta.scale);o?(this.resolution=o,i.source.resolution=this.resolution):this.resolution=i.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Ht.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const s=Ht.BATCH_SIZE;for(;t-e<s&&t<this._frameKeys.length;){const i=this._frameKeys[t],n=this._frames[i],a=n.frame;if(a){let o=null,l=null;const h=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new W(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);n.rotated?o=new W(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new W(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(l=new W(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[i]=new k({source:this.textureSource,frame:o,orig:c,trim:l,rotate:n.rotated?2:0,defaultAnchor:n.anchor,defaultBorders:n.borders,label:i.toString()})}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let s=0;s<e[t].length;s++){const i=e[t][s];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ht.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ht.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};Go.BATCH_SIZE=1e3;let Rn=Go;const Ru=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Do(r,e,t){const s={};if(r.forEach(i=>{s[i]=e}),Object.keys(e.textures).forEach(i=>{s[`${e.cachePrefix}${i}`]=e.textures[i]}),!t){const i=de.dirname(r[0]);e.linkedSheets.forEach((n,a)=>{const o=Do([`${i}/${e.data.meta.related_multi_packs[a]}`],n,!0);Object.assign(s,o)})}return s}const Iu={extension:y.Asset,cache:{test:r=>r instanceof Rn,getCacheableAssets:(r,e)=>Do(r,e,!1)},resolver:{extension:{type:y.ResolveParser,name:"resolveSpritesheet"},test:r=>{const t=r.split("?")[0].split("."),s=t.pop(),i=t.pop();return s==="json"&&Ru.includes(i)},parse:r=>{var t;const e=r.split(".");return{resolution:parseFloat(((t=Pt.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:e[e.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:y.LoadParser,priority:Xe.Normal,name:"spritesheetLoader"},async testParse(r,e){return de.extname(e.src).toLowerCase()===".json"&&!!r.frames},async parse(r,e,t){var u,d;const{texture:s,imageFilename:i,textureOptions:n,cachePrefix:a}=(e==null?void 0:e.data)??{};let o=de.dirname(e.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let l;if(s instanceof k)l=s;else{const f=qr(o+(i??r.meta.image),e.src);l=(await t.load([{src:f,data:n}]))[f]}const h=new Rn({texture:l.source,data:r,cachePrefix:a});await h.parse();const c=(u=r==null?void 0:r.meta)==null?void 0:u.related_multi_packs;if(Array.isArray(c)){const f=[];for(const m of c){if(typeof m!="string")continue;let p=o+m;(d=e.data)!=null&&d.ignoreMultiPack||(p=qr(p,e.src),f.push(t.load({src:p,data:{textureOptions:n,ignoreMultiPack:!0}})))}const g=await Promise.all(f);h.linkedSheets=g,g.forEach(m=>{m.linkedSheets=[h].concat(h.linkedSheets.filter(p=>p!==m))})}return h},async unload(r,e,t){await t.unload(r.textureSource._sourceOrigin),r.destroy(!1)}}};M.add(Iu);class ns{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ns.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Y,this.page=new Y,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,s){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,s,i,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var gr=/iPhone/i,In=/iPod/i,Gn=/iPad/i,Dn=/\biOS-universal(?:.+)Mac\b/i,pr=/\bAndroid(?:.+)Mobile\b/i,Un=/Android/i,ft=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,xs=/Silk/i,Fe=/Windows Phone/i,On=/\bWindows(?:.+)ARM\b/i,Ln=/BlackBerry/i,Nn=/BB10/i,Hn=/Opera Mini/i,Wn=/\b(CriOS|Chrome)(?:.+)Mobile/i,Vn=/Mobile(?:.+)Firefox\b/i,zn=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function Gu(r){return function(e){return e.test(r)}}function Yn(r){var e={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?e.userAgent=r:r&&r.userAgent&&(e={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var t=e.userAgent,s=t.split("[FBAN");typeof s[1]<"u"&&(t=s[0]),s=t.split("Twitter"),typeof s[1]<"u"&&(t=s[0]);var i=Gu(t),n={apple:{phone:i(gr)&&!i(Fe),ipod:i(In),tablet:!i(gr)&&(i(Gn)||zn(e))&&!i(Fe),universal:i(Dn),device:(i(gr)||i(In)||i(Gn)||i(Dn)||zn(e))&&!i(Fe)},amazon:{phone:i(ft),tablet:!i(ft)&&i(xs),device:i(ft)||i(xs)},android:{phone:!i(Fe)&&i(ft)||!i(Fe)&&i(pr),tablet:!i(Fe)&&!i(ft)&&!i(pr)&&(i(xs)||i(Un)),device:!i(Fe)&&(i(ft)||i(xs)||i(pr)||i(Un))||i(/\bokhttp\b/i)},windows:{phone:i(Fe),tablet:i(On),device:i(Fe)||i(On)},other:{blackberry:i(Ln),blackberry10:i(Nn),opera:i(Hn),firefox:i(Vn),chrome:i(Wn),device:i(Ln)||i(Nn)||i(Hn)||i(Vn)||i(Wn)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Du=Yn.default??Yn,Uu=Du(globalThis.navigator),Ou=9,bs=100,Lu=0,Nu=0,jn=2,$n=1,Hu=-1e3,Wu=-1e3,Vu=2,Pi=class Uo{constructor(e,t=Uu){this._mobileInfo=t,this.debug=!1,this._activateOnTab=!0,this._deactivateOnMouseMove=!0,this._isActive=!1,this._isMobileAccessibility=!1,this._div=null,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(t.tablet||t.phone)&&this._createTouchHook(),this._renderer=e}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const e=document.createElement("button");e.style.width=`${$n}px`,e.style.height=`${$n}px`,e.style.position="absolute",e.style.top=`${Hu}px`,e.style.left=`${Wu}px`,e.style.zIndex=Vu.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){if(this._isActive)return;this._isActive=!0,this._div||(this._div=document.createElement("div"),this._div.style.width=`${bs}px`,this._div.style.height=`${bs}px`,this._div.style.position="absolute",this._div.style.top=`${Lu}px`,this._div.style.left=`${Nu}px`,this._div.style.zIndex=jn.toString(),this._div.style.pointerEvents="none"),this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._deactivateOnMouseMove&&(this._onMouseMove=this._onMouseMove.bind(this),globalThis.document.addEventListener("mousemove",this._onMouseMove,!0));const e=this._renderer.view.canvas;if(e.parentNode)e.parentNode.appendChild(this._div),this._initAccessibilitySetup();else{const t=new MutationObserver(()=>{e.parentNode&&(e.parentNode.appendChild(this._div),t.disconnect(),this._initAccessibilitySetup())});t.observe(document.body,{childList:!0,subtree:!0})}}_initAccessibilitySetup(){this._renderer.runners.postrender.add(this),this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered)}_deactivate(){if(!(!this._isActive||this._isMobileAccessibility)){this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),this._activateOnTab&&globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this);for(const e of this._children)e._accessibleDiv&&e._accessibleDiv.parentNode&&(e._accessibleDiv.parentNode.removeChild(e._accessibleDiv),e._accessibleDiv=null),e._accessibleActive=!1;this._pool.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this._div&&this._div.parentNode&&this._div.parentNode.removeChild(this._div),this._pool=[],this._children=[]}}_updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&(e._accessibleActive||this._addChild(e),e._renderId=this._renderId);const t=e.children;if(t)for(let s=0;s<t.length;s++)this._updateAccessibleObjects(t[s])}init(e){const s={accessibilityOptions:{...Uo.defaultOptions,...(e==null?void 0:e.accessibilityOptions)||{}}};this.debug=s.accessibilityOptions.debug,this._activateOnTab=s.accessibilityOptions.activateOnTab,this._deactivateOnMouseMove=s.accessibilityOptions.deactivateOnMouseMove,s.accessibilityOptions.enabledByDefault?this._activate():this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._renderer.runners.postrender.remove(this)}postrender(){const e=performance.now();if(this._mobileInfo.android.device&&e<this._androidUpdateCount||(this._androidUpdateCount=e+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas))return;const t=new Set;if(this._renderer.lastObjectRendered){this._updateAccessibleObjects(this._renderer.lastObjectRendered);for(const s of this._children)s._renderId===this._renderId&&t.add(this._children.indexOf(s))}for(let s=this._children.length-1;s>=0;s--){const i=this._children[s];t.has(s)||(i._accessibleDiv&&i._accessibleDiv.parentNode&&(i._accessibleDiv.parentNode.removeChild(i._accessibleDiv),this._pool.push(i._accessibleDiv),i._accessibleDiv=null),i._accessibleActive=!1,yo(this._children,s,1))}if(this._renderer.renderingToScreen){const{x:s,y:i,width:n,height:a}=this._renderer.screen,o=this._div;o.style.left=`${s}px`,o.style.top=`${i}px`,o.style.width=`${n}px`,o.style.height=`${a}px`}for(let s=0;s<this._children.length;s++){const i=this._children[s];if(!i._accessibleActive||!i._accessibleDiv)continue;const n=i._accessibleDiv,a=i.hitArea||i.getBounds().rectangle;if(i.hitArea){const o=i.worldTransform,l=this._renderer.resolution,h=this._renderer.resolution;n.style.left=`${(o.tx+a.x*o.a)*l}px`,n.style.top=`${(o.ty+a.y*o.d)*h}px`,n.style.width=`${a.width*o.a*l}px`,n.style.height=`${a.height*o.d*h}px`}else{this._capHitArea(a);const o=this._renderer.resolution,l=this._renderer.resolution;n.style.left=`${a.x*o}px`,n.style.top=`${a.y*l}px`,n.style.width=`${a.width*o}px`,n.style.height=`${a.height*l}px`}}this._renderId++}_updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}_capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:s}=this._renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>s&&(e.height=s-e.y)}_addChild(e){let t=this._pool.pop();t||(e.accessibleType==="button"?t=document.createElement("button"):(t=document.createElement(e.accessibleType),t.style.cssText=`
                        color: transparent;
                        pointer-events: none;
                        padding: 0;
                        margin: 0;
                        border: 0;
                        outline: 0;
                        background: transparent;
                        box-sizing: border-box;
                        user-select: none;
                        -webkit-user-select: none;
                        -moz-user-select: none;
                        -ms-user-select: none;
                    `,e.accessibleText&&(t.innerText=e.accessibleText)),t.style.width=`${bs}px`,t.style.height=`${bs}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=jn.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`container ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this._updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.container=e,this._children.push(e),this._div.appendChild(e._accessibleDiv),e.interactive&&(e._accessibleDiv.tabIndex=e.tabIndex)}_dispatchEvent(e,t){const{container:s}=e.target,i=this._renderer.events.rootBoundary,n=Object.assign(new ns(i),{target:s});i.rootTarget=this._renderer.lastObjectRendered,t.forEach(a=>i.dispatchEvent(n,a))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode!==Ou||!this._activateOnTab||this._activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this._deactivate()}destroy(){this._deactivate(),this._destroyTouchHook(),this._div=null,this._pool=null,this._children=null,this._renderer=null,this._activateOnTab&&globalThis.removeEventListener("keydown",this._onKeyDown)}setAccessibilityEnabled(e){e?this._activate():this._deactivate()}};Pi.extension={type:[y.WebGLSystem,y.WebGPUSystem],name:"accessibility"};Pi.defaultOptions={enabledByDefault:!1,debug:!1,activateOnTab:!0,deactivateOnMouseMove:!0};let zu=Pi;const Yu={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,accessibleType:"button",accessibleText:null,accessiblePointerEvents:"auto",accessibleChildren:!0,_accessibleActive:!1,_accessibleDiv:null,_renderId:-1},mr=Object.create(null),Xn=Object.create(null);function Qt(r,e){let t=Xn[r];return t===void 0&&(mr[e]===void 0&&(mr[e]=1),Xn[r]=t=mr[e]++),t}let gt;function Oo(){return(!gt||gt!=null&&gt.isContextLost())&&(gt=O.get().createCanvas().getContext("webgl",{})),gt}let vs;function ju(){if(!vs){vs="mediump";const r=Oo();r&&r.getShaderPrecisionFormat&&(vs=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision?"highp":"mediump")}return vs}function $u(r,e,t){return e?r:t?(r=r.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${r}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${r}
        `}function Xu(r,e,t){const s=t?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if(r.substring(0,9)!=="precision"){let i=t?e.requestedFragmentPrecision:e.requestedVertexPrecision;return i==="highp"&&s!=="highp"&&(i="mediump"),`precision ${i} float;
${r}`}else if(s!=="highp"&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}function Ku(r,e){return e?`#version 300 es
${r}`:r}const qu={},Zu={};function Qu(r,{name:e="pixi-program"},t=!0){e=e.replace(/\s+/g,"-"),e+=t?"-fragment":"-vertex";const s=t?qu:Zu;return s[e]?(s[e]++,e+=`-${s[e]}`):s[e]=1,r.indexOf("#define SHADER_NAME")!==-1?r:`${`#define SHADER_NAME ${e}`}
${r}`}function Ju(r,e){return e?r.replace("#version 300 es",""):r}const _r={stripVersion:Ju,ensurePrecision:Xu,addProgramDefines:$u,setProgramName:Qu,insertVersion:Ku},yr=Object.create(null),Lo=class Zr{constructor(e){e={...Zr.defaultOptions,...e};const t=e.fragment.indexOf("#version 300 es")!==-1,s={stripVersion:t,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:ju()},setProgramName:{name:e.name},addProgramDefines:t,insertVersion:t};let i=e.fragment,n=e.vertex;Object.keys(_r).forEach(a=>{const o=s[a];i=_r[a](i,o,!0),n=_r[a](n,o,!1)}),this.fragment=i,this.vertex=n,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=Qt(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const t=`${e.vertex}:${e.fragment}`;return yr[t]||(yr[t]=new Zr(e)),yr[t]}};Lo.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let kt=Lo;const Kn={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function je(r){return Kn[r]??Kn.float32}const ed={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function td({source:r,entryPoint:e}){const t={},s=r.indexOf(`fn ${e}`);if(s!==-1){const i=r.indexOf("->",s);if(i!==-1){const n=r.substring(s,i),a=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let o;for(;(o=a.exec(n))!==null;){const l=ed[o[3]]??"float32";t[o[2]]={location:parseInt(o[1],10),format:l,stride:je(l).stride,offset:0,instance:!1,start:0}}}}return t}function xr(r){var u,d;const e=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,t=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,i=/var(<[^>]+>)? (\w+)/,n=/:\s*(\w+)/,a=/struct\s+(\w+)\s*{([^}]+)}/g,o=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,h=(u=r.match(e))==null?void 0:u.map(f=>({group:parseInt(f.match(t)[1],10),binding:parseInt(f.match(s)[1],10),name:f.match(i)[2],isUniform:f.match(i)[1]==="<uniform>",type:f.match(n)[1]}));if(!h)return{groups:[],structs:[]};const c=((d=r.match(a))==null?void 0:d.map(f=>{const g=f.match(l)[1],m=f.match(o).reduce((p,_)=>{const[x,b]=_.split(":");return p[x.trim()]=b.trim(),p},{});return m?{name:g,members:m}:null}).filter(({name:f})=>h.some(g=>g.type===f)))??[];return{groups:h,structs:c}}var Wt=(r=>(r[r.VERTEX=1]="VERTEX",r[r.FRAGMENT=2]="FRAGMENT",r[r.COMPUTE=4]="COMPUTE",r))(Wt||{});function sd({groups:r}){const e=[];for(let t=0;t<r.length;t++){const s=r[t];e[s.group]||(e[s.group]=[]),s.isUniform?e[s.group].push({binding:s.binding,visibility:Wt.VERTEX|Wt.FRAGMENT,buffer:{type:"uniform"}}):s.type==="sampler"?e[s.group].push({binding:s.binding,visibility:Wt.FRAGMENT,sampler:{type:"filtering"}}):s.type==="texture_2d"&&e[s.group].push({binding:s.binding,visibility:Wt.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}function rd({groups:r}){const e=[];for(let t=0;t<r.length;t++){const s=r[t];e[s.group]||(e[s.group]={}),e[s.group][s.name]=s.binding}return e}function id(r,e){const t=new Set,s=new Set,i=[...r.structs,...e.structs].filter(a=>t.has(a.name)?!1:(t.add(a.name),!0)),n=[...r.groups,...e.groups].filter(a=>{const o=`${a.name}-${a.binding}`;return s.has(o)?!1:(s.add(o),!0)});return{structs:i,groups:n}}const br=Object.create(null);class dt{constructor(e){var o,l;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:t,vertex:s,layout:i,gpuLayout:n,name:a}=e;if(this.name=a,this.fragment=t,this.vertex=s,t.source===s.source){const h=xr(t.source);this.structsAndGroups=h}else{const h=xr(s.source),c=xr(t.source);this.structsAndGroups=id(h,c)}this.layout=i??rd(this.structsAndGroups),this.gpuLayout=n??sd(this.structsAndGroups),this.autoAssignGlobalUniforms=((o=this.layout[0])==null?void 0:o.globalUniforms)!==void 0,this.autoAssignLocalUniforms=((l=this.layout[1])==null?void 0:l.localUniforms)!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:e,fragment:t}=this,s=e.source+t.source+e.entryPoint+t.entryPoint;this._layoutKey=Qt(s,"program")}get attributeData(){return this._attributeData??(this._attributeData=td(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(e){const t=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return br[t]||(br[t]=new dt(e)),br[t]}}const No=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],nd=No.reduce((r,e)=>(r[e]=!0,r),{});function ad(r,e){switch(r){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ho=class Wo{constructor(e,t){this._touched=0,this.uid=X("uniform"),this._resourceType="uniformGroup",this._resourceId=X("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,t={...Wo.defaultOptions,...t},this.uniformStructures=e;const s={};for(const i in e){const n=e[i];if(n.name=i,n.size=n.size??1,!nd[n.type])throw new Error(`Uniform type ${n.type} is not supported. Supported uniform types are: ${No.join(", ")}`);n.value??(n.value=ad(n.type,n.size)),s[i]=n.value}this.uniforms=s,this._dirtyId=1,this.ubo=t.ubo,this.isStatic=t.isStatic,this._signature=Qt(Object.keys(s).map(i=>`${i}-${e[i].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Ho.defaultOptions={ubo:!1,isStatic:!1};let oe=Ho;class Ge{constructor(e){this.resources=Object.create(null),this._dirty=!0;let t=0;for(const s in e){const i=e[s];this.setResource(i,t++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const e=[];let t=0;for(const s in this.resources)e[t++]=this.resources[s]._resourceId;this._key=e.join("|")}setResource(e,t){var i,n;const s=this.resources[t];e!==s&&(s&&((i=e.off)==null||i.call(e,"change",this.onResourceChange,this)),(n=e.on)==null||n.call(e,"change",this.onResourceChange,this),this.resources[t]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e){const t=this.resources;for(const s in t)t[s]._touched=e}destroy(){var t;const e=this.resources;for(const s in e){const i=e[s];(t=i.off)==null||t.call(i,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(e){if(this._dirty=!0,e.destroyed){const t=this.resources;for(const s in t)t[s]===e&&(t[s]=null)}else this._updateKey()}}var Se=(r=>(r[r.WEBGL=1]="WEBGL",r[r.WEBGPU=2]="WEBGPU",r[r.BOTH=3]="BOTH",r))(Se||{});class xe extends ge{constructor(e){super(),this.uid=X("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:t,glProgram:s,groups:i,resources:n,compatibleRenderers:a,groupMap:o}=e;this.gpuProgram=t,this.glProgram=s,a===void 0&&(a=0,t&&(a|=Se.WEBGPU),s&&(a|=Se.WEBGL)),this.compatibleRenderers=a;const l={};if(!n&&!i&&(n={}),n&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!t&&i&&!o)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!t&&i&&o)for(const h in o)for(const c in o[h]){const u=o[h][c];l[u]={group:h,binding:c,name:u}}else if(t&&i&&!o){const h=t.structsAndGroups.groups;o={},h.forEach(c=>{o[c.group]=o[c.group]||{},o[c.group][c.binding]=c.name,l[c.name]=c})}else if(n){i={},o={},t&&t.structsAndGroups.groups.forEach(u=>{o[u.group]=o[u.group]||{},o[u.group][u.binding]=u.name,l[u.name]=u});let h=0;for(const c in n)l[c]||(i[99]||(i[99]=new Ge,this._ownedBindGroups.push(i[99])),l[c]={group:99,binding:h,name:c},o[99]=o[99]||{},o[99][h]=c,h++);for(const c in n){const u=c;let d=n[c];!d.source&&!d._resourceType&&(d=new oe(d));const f=l[u];f&&(i[f.group]||(i[f.group]=new Ge,this._ownedBindGroups.push(i[f.group])),i[f.group].setResource(d,f.binding))}}this.groups=i,this._uniformBindMap=o,this.resources=this._buildResourceAccessor(i,l)}addResource(e,t,s){var i,n;(i=this._uniformBindMap)[t]||(i[t]={}),(n=this._uniformBindMap[t])[s]||(n[s]=e),this.groups[t]||(this.groups[t]=new Ge,this._ownedBindGroups.push(this.groups[t]))}_buildResourceAccessor(e,t){const s={};for(const i in t){const n=t[i];Object.defineProperty(s,n.name,{get(){return e[n.group].getResource(n.binding)},set(a){e[n.group].setResource(a,n.binding)}})}return s}destroy(e=!1){var t,s;this.emit("destroy",this),e&&((t=this.gpuProgram)==null||t.destroy(),(s=this.glProgram)==null||s.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(i=>{i.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(e){const{gpu:t,gl:s,...i}=e;let n,a;return t&&(n=dt.from(t)),s&&(a=kt.from(s)),new xe({gpuProgram:n,glProgram:a,...i})}}const od={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},vr=0,wr=1,Tr=2,Sr=3,Ar=4,Pr=5,Qr=class Vo{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<vr)}set blend(e){!!(this.data&1<<vr)!==e&&(this.data^=1<<vr)}get offsets(){return!!(this.data&1<<wr)}set offsets(e){!!(this.data&1<<wr)!==e&&(this.data^=1<<wr)}set cullMode(e){if(e==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=e==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<Tr)}set culling(e){!!(this.data&1<<Tr)!==e&&(this.data^=1<<Tr)}get depthTest(){return!!(this.data&1<<Sr)}set depthTest(e){!!(this.data&1<<Sr)!==e&&(this.data^=1<<Sr)}get depthMask(){return!!(this.data&1<<Pr)}set depthMask(e){!!(this.data&1<<Pr)!==e&&(this.data^=1<<Pr)}get clockwiseFrontFace(){return!!(this.data&1<<Ar)}set clockwiseFrontFace(e){!!(this.data&1<<Ar)!==e&&(this.data^=1<<Ar)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!=="none",this._blendMode=e,this._blendModeId=od[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new Vo;return e.depthTest=!1,e.blend=!0,e}};Qr.default2d=Qr.for2d();let Ae=Qr;const zo=class Jr extends xe{constructor(e){e={...Jr.defaultOptions,...e},super(e),this.enabled=!0,this._state=Ae.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,t,s,i){e.applyFilter(this,t,s,i)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){const{gpu:t,gl:s,...i}=e;let n,a;return t&&(n=dt.from(t)),s&&(a=kt.from(s)),new Jr({gpuProgram:n,glProgram:a,...i})}};zo.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let ld=zo;const ei=[];M.handleByNamedList(y.Environment,ei);async function hd(r){if(!r)for(let e=0;e<ei.length;e++){const t=ei[e];if(t.value.test()){await t.value.load();return}}}let Gt;function Yo(){if(typeof Gt=="boolean")return Gt;try{Gt=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Gt=!1}return Gt}function cd(r,e,t=2){const s=e&&e.length,i=s?e[0]*t:r.length;let n=jo(r,0,i,t,!0);const a=[];if(!n||n.next===n.prev)return a;let o,l,h;if(s&&(n=pd(r,e,n,t)),r.length>80*t){o=1/0,l=1/0;let c=-1/0,u=-1/0;for(let d=t;d<i;d+=t){const f=r[d],g=r[d+1];f<o&&(o=f),g<l&&(l=g),f>c&&(c=f),g>u&&(u=g)}h=Math.max(c-o,u-l),h=h!==0?32767/h:0}return Jt(n,a,t,o,l,h,0),a}function jo(r,e,t,s,i){let n;if(i===Pd(r,e,t,s)>0)for(let a=e;a<t;a+=s)n=qn(a/s|0,r[a],r[a+1],n);else for(let a=t-s;a>=e;a-=s)n=qn(a/s|0,r[a],r[a+1],n);return n&&Tt(n,n.next)&&(ts(n),n=n.next),n}function ut(r,e){if(!r)return r;e||(e=r);let t=r,s;do if(s=!1,!t.steiner&&(Tt(t,t.next)||q(t.prev,t,t.next)===0)){if(ts(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e}function Jt(r,e,t,s,i,n,a){if(!r)return;!a&&n&&bd(r,s,i,n);let o=r;for(;r.prev!==r.next;){const l=r.prev,h=r.next;if(n?dd(r,s,i,n):ud(r)){e.push(l.i,r.i,h.i),ts(r),r=h.next,o=h.next;continue}if(r=h,r===o){a?a===1?(r=fd(ut(r),e),Jt(r,e,t,s,i,n,2)):a===2&&gd(r,e,t,s,i,n):Jt(ut(r),e,t,s,i,n,1);break}}}function ud(r){const e=r.prev,t=r,s=r.next;if(q(e,t,s)>=0)return!1;const i=e.x,n=t.x,a=s.x,o=e.y,l=t.y,h=s.y,c=Math.min(i,n,a),u=Math.min(o,l,h),d=Math.max(i,n,a),f=Math.max(o,l,h);let g=s.next;for(;g!==e;){if(g.x>=c&&g.x<=d&&g.y>=u&&g.y<=f&&Vt(i,o,n,l,a,h,g.x,g.y)&&q(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function dd(r,e,t,s){const i=r.prev,n=r,a=r.next;if(q(i,n,a)>=0)return!1;const o=i.x,l=n.x,h=a.x,c=i.y,u=n.y,d=a.y,f=Math.min(o,l,h),g=Math.min(c,u,d),m=Math.max(o,l,h),p=Math.max(c,u,d),_=ti(f,g,e,t,s),x=ti(m,p,e,t,s);let b=r.prevZ,v=r.nextZ;for(;b&&b.z>=_&&v&&v.z<=x;){if(b.x>=f&&b.x<=m&&b.y>=g&&b.y<=p&&b!==i&&b!==a&&Vt(o,c,l,u,h,d,b.x,b.y)&&q(b.prev,b,b.next)>=0||(b=b.prevZ,v.x>=f&&v.x<=m&&v.y>=g&&v.y<=p&&v!==i&&v!==a&&Vt(o,c,l,u,h,d,v.x,v.y)&&q(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;b&&b.z>=_;){if(b.x>=f&&b.x<=m&&b.y>=g&&b.y<=p&&b!==i&&b!==a&&Vt(o,c,l,u,h,d,b.x,b.y)&&q(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=x;){if(v.x>=f&&v.x<=m&&v.y>=g&&v.y<=p&&v!==i&&v!==a&&Vt(o,c,l,u,h,d,v.x,v.y)&&q(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function fd(r,e){let t=r;do{const s=t.prev,i=t.next.next;!Tt(s,i)&&Xo(s,t,t.next,i)&&es(s,i)&&es(i,s)&&(e.push(s.i,t.i,i.i),ts(t),ts(t.next),t=r=i),t=t.next}while(t!==r);return ut(t)}function gd(r,e,t,s,i,n){let a=r;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Td(a,o)){let l=Ko(a,o);a=ut(a,a.next),l=ut(l,l.next),Jt(a,e,t,s,i,n,0),Jt(l,e,t,s,i,n,0);return}o=o.next}a=a.next}while(a!==r)}function pd(r,e,t,s){const i=[];for(let n=0,a=e.length;n<a;n++){const o=e[n]*s,l=n<a-1?e[n+1]*s:r.length,h=jo(r,o,l,s,!1);h===h.next&&(h.steiner=!0),i.push(wd(h))}i.sort(md);for(let n=0;n<i.length;n++)t=_d(i[n],t);return t}function md(r,e){let t=r.x-e.x;if(t===0&&(t=r.y-e.y,t===0)){const s=(r.next.y-r.y)/(r.next.x-r.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=s-i}return t}function _d(r,e){const t=yd(r,e);if(!t)return e;const s=Ko(t,r);return ut(s,s.next),ut(t,t.next)}function yd(r,e){let t=e;const s=r.x,i=r.y;let n=-1/0,a;if(Tt(r,t))return t;do{if(Tt(r,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const u=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=s&&u>n&&(n=u,a=t.x<t.next.x?t:t.next,u===s))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,l=a.x,h=a.y;let c=1/0;t=a;do{if(s>=t.x&&t.x>=l&&s!==t.x&&$o(i<h?s:n,i,l,h,i<h?n:s,i,t.x,t.y)){const u=Math.abs(i-t.y)/(s-t.x);es(t,r)&&(u<c||u===c&&(t.x>a.x||t.x===a.x&&xd(a,t)))&&(a=t,c=u)}t=t.next}while(t!==o);return a}function xd(r,e){return q(r.prev,r,e.prev)<0&&q(e.next,r,r.next)<0}function bd(r,e,t,s){let i=r;do i.z===0&&(i.z=ti(i.x,i.y,e,t,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,vd(i)}function vd(r){let e,t=1;do{let s=r,i;r=null;let n=null;for(e=0;s;){e++;let a=s,o=0;for(let h=0;h<t&&(o++,a=a.nextZ,!!a);h++);let l=t;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||s.z<=a.z)?(i=s,s=s.nextZ,o--):(i=a,a=a.nextZ,l--),n?n.nextZ=i:r=i,i.prevZ=n,n=i;s=a}n.nextZ=null,t*=2}while(e>1);return r}function ti(r,e,t,s,i){return r=(r-t)*i|0,e=(e-s)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function wd(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function $o(r,e,t,s,i,n,a,o){return(i-a)*(e-o)>=(r-a)*(n-o)&&(r-a)*(s-o)>=(t-a)*(e-o)&&(t-a)*(n-o)>=(i-a)*(s-o)}function Vt(r,e,t,s,i,n,a,o){return!(r===a&&e===o)&&$o(r,e,t,s,i,n,a,o)}function Td(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!Sd(r,e)&&(es(r,e)&&es(e,r)&&Ad(r,e)&&(q(r.prev,r,e.prev)||q(r,e.prev,e))||Tt(r,e)&&q(r.prev,r,r.next)>0&&q(e.prev,e,e.next)>0)}function q(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Tt(r,e){return r.x===e.x&&r.y===e.y}function Xo(r,e,t,s){const i=Ts(q(r,e,t)),n=Ts(q(r,e,s)),a=Ts(q(t,s,r)),o=Ts(q(t,s,e));return!!(i!==n&&a!==o||i===0&&ws(r,t,e)||n===0&&ws(r,s,e)||a===0&&ws(t,r,s)||o===0&&ws(t,e,s))}function ws(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Ts(r){return r>0?1:r<0?-1:0}function Sd(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&Xo(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function es(r,e){return q(r.prev,r,r.next)<0?q(r,e,r.next)>=0&&q(r,r.prev,e)>=0:q(r,e,r.prev)<0||q(r,r.next,e)<0}function Ad(r,e){let t=r,s=!1;const i=(r.x+e.x)/2,n=(r.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&i<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==r);return s}function Ko(r,e){const t=si(r.i,r.x,r.y),s=si(e.i,e.x,e.y),i=r.next,n=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,s.next=t,t.prev=s,n.next=s,s.prev=n,s}function qn(r,e,t,s){const i=si(r,e,t);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function ts(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function si(r,e,t){return{i:r,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Pd(r,e,t,s){let i=0;for(let n=e,a=t-s;n<t;n+=s)i+=(r[a]-r[n])*(r[n+1]+r[a+1]),a=n;return i}var ue=(r=>(r[r.NONE=0]="NONE",r[r.COLOR=16384]="COLOR",r[r.STENCIL=1024]="STENCIL",r[r.DEPTH=256]="DEPTH",r[r.COLOR_DEPTH=16640]="COLOR_DEPTH",r[r.COLOR_STENCIL=17408]="COLOR_STENCIL",r[r.DEPTH_STENCIL=1280]="DEPTH_STENCIL",r[r.ALL=17664]="ALL",r))(ue||{});class qo{constructor(e){this.items=[],this._name=e}emit(e,t,s,i,n,a,o,l){const{name:h,items:c}=this;for(let u=0,d=c.length;u<d;u++)c[u][h](e,t,s,i,n,a,o,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&this.items.splice(t,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const kd=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Zo=class Qo extends ge{constructor(e){super(),this.uid=X("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;const t=[...kd,...this.config.runners??[]];this._addRunners(...t),this._unsafeEvalCheck()}async init(e={}){const t=e.skipExtensionImports===!0?!0:e.manageImports===!1;await hd(t),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const s in this._systemsHash)e={...this._systemsHash[s].constructor.defaultOptions,...e};e={...Qo.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let s=0;s<this.runners.init.items.length;s++)await this.runners.init.items[s].init(e);this._initOptions=e}render(e,t){let s=e;if(s instanceof ae&&(s={container:s},t&&(U(H,"passing a second argument is deprecated, please use render options instead"),s.target=t.renderTexture)),s.target||(s.target=this.view.renderTarget),s.target===this.view.renderTarget&&(this._lastObjectRendered=s.container,s.clearColor??(s.clearColor=this.background.colorRgba),s.clear??(s.clear=this.background.clearBeforeRender)),s.clearColor){const i=Array.isArray(s.clearColor)&&s.clearColor.length===4;s.clearColor=i?s.clearColor:V.shared.setValue(s.clearColor).toArray()}s.transform||(s.container.updateLocalTransform(),s.transform=s.container.localTransform),s.container.enableRenderGroup(),this.runners.prerender.emit(s),this.runners.renderStart.emit(s),this.runners.render.emit(s),this.runners.renderEnd.emit(s),this.runners.postrender.emit(s)}resize(e,t,s){const i=this.view.resolution;this.view.resize(e,t,s),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),s!==void 0&&s!==i&&this.runners.resolutionChange.emit(s)}clear(e={}){const t=this;e.target||(e.target=t.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=ue.ALL);const{clear:s,clearColor:i,target:n}=e;V.shared.setValue(i??this.background.colorRgba),t.renderTarget.clear(n,s,V.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(t=>{this.runners[t]=new qo(t)})}_addSystems(e){let t;for(t in e){const s=e[t];this._addSystem(s.value,s.name)}}_addSystem(e,t){const s=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=s,this._systemsHash[t]=s;for(const i in this.runners)this.runners[i].add(s);return this}_addPipes(e,t){const s=t.reduce((i,n)=>(i[n.name]=n.value,i),{});e.forEach(i=>{const n=i.value,a=i.name,o=s[a];this.renderPipes[a]=new n(this,o?new o:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Yo())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Zo.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Zs=Zo,Ss;function Cd(r){return Ss!==void 0||(Ss=(()=>{var t;const e={stencil:!0,failIfMajorPerformanceCaveat:r??Zs.defaultOptions.failIfMajorPerformanceCaveat};try{if(!O.get().getWebGLRenderingContext())return!1;let i=O.get().createCanvas().getContext("webgl",e);const n=!!((t=i==null?void 0:i.getContextAttributes())!=null&&t.stencil);if(i){const a=i.getExtension("WEBGL_lose_context");a&&a.loseContext()}return i=null,n}catch{return!1}})()),Ss}let As;async function Ed(r={}){return As!==void 0||(As=await(async()=>{const e=O.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(r)).requestDevice(),!0}catch{return!1}})()),As}const Zn=["webgl","webgpu","canvas"];async function Md(r){let e=[];r.preference?(e.push(r.preference),Zn.forEach(n=>{n!==r.preference&&e.push(n)})):e=Zn.slice();let t,s={};for(let n=0;n<e.length;n++){const a=e[n];if(a==="webgpu"&&await Ed()){const{WebGPURenderer:o}=await Ls(async()=>{const{WebGPURenderer:l}=await Promise.resolve().then(()=>b_);return{WebGPURenderer:l}},void 0,import.meta.url);t=o,s={...r,...r.webgpu};break}else if(a==="webgl"&&Cd(r.failIfMajorPerformanceCaveat??Zs.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:o}=await Ls(async()=>{const{WebGLRenderer:l}=await Promise.resolve().then(()=>t_);return{WebGLRenderer:l}},void 0,import.meta.url);t=o,s={...r,...r.webgl};break}else if(a==="canvas")throw s={...r},new Error("CanvasRenderer is not yet implemented")}if(delete s.webgpu,delete s.webgl,!t)throw new Error("No available renderer for the current environment");const i=new t;return await i.init(s),i}const zs="8.10.0";class Jo{static init(){var e;(e=globalThis.__PIXI_APP_INIT__)==null||e.call(globalThis,this,zs)}static destroy(){}}Jo.extension=y.Application;class el{constructor(e){this._renderer=e}init(){var e;(e=globalThis.__PIXI_RENDERER_INIT__)==null||e.call(globalThis,this._renderer,zs)}destroy(){this._renderer=null}}el.extension={type:[y.WebGLSystem,y.WebGPUSystem],name:"initHook",priority:-10};const tl=class ri{constructor(...e){this.stage=new ae,e[0]!==void 0&&U(H,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await Md(e),ri._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return U(H,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,t=!1){const s=ri._plugins.slice(0);s.reverse(),s.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};tl._plugins=[];let sl=tl;M.handleByList(y.Application,sl._plugins);M.add(Jo);class rl{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let t,s;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,s=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;t=i,s=n}this.renderer.resize(t,s),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}rl.extension=y.Application;class il{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Zt.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ce.shared:new Ce,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}il.extension=y.Application;class nl extends ge{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return U(H,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return U(H,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return U(H,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return U(H,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return U(H,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(e=!1){var t;this.emit("destroy",this),this.removeAllListeners();for(const s in this.chars)(t=this.chars[s].texture)==null||t.destroy();this.chars=null,e&&(this.pages.forEach(s=>s.texture.destroy(!0)),this.pages=null)}}const Fd=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Ys(r){const e=typeof r.fontSize=="number"?`${r.fontSize}px`:r.fontSize;let t=r.fontFamily;Array.isArray(r.fontFamily)||(t=r.fontFamily.split(","));for(let s=t.length-1;s>=0;s--){let i=t[s].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!Fd.includes(i)&&(i=`"${i}"`),t[s]=i}return`${r.fontStyle} ${r.fontVariant} ${r.fontWeight} ${e} ${t.join(",")}`}const kr={willReadFrequently:!0},Ee=class C{static get experimentalLetterSpacingSupported(){let e=C._experimentalLetterSpacingSupported;if(e===void 0){const t=O.get().getCanvasRenderingContext2D().prototype;e=C._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,s,i,n,a,o,l,h){this.text=e,this.style=t,this.width=s,this.height=i,this.lines=n,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=l,this.fontProperties=h}static measureText(e=" ",t,s=C._canvas,i=t.wordWrap){var _;const n=Ys(t),a=C.measureFont(n);a.fontSize===0&&(a.fontSize=t.fontSize,a.ascent=t.fontSize);const o=C.__context;o.font=n;const h=(i?C._wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),c=new Array(h.length);let u=0;for(let x=0;x<h.length;x++){const b=C._measureText(h[x],t.letterSpacing,o);c[x]=b,u=Math.max(u,b)}const d=((_=t._stroke)==null?void 0:_.width)||0;let f=u+d;t.dropShadow&&(f+=t.dropShadow.distance);const g=t.lineHeight||a.fontSize;let m=Math.max(g,a.fontSize+d)+(h.length-1)*(g+t.leading);return t.dropShadow&&(m+=t.dropShadow.distance),new C(e,t,f,m,h,c,g+t.leading,u,a)}static _measureText(e,t,s){let i=!1;C.experimentalLetterSpacingSupported&&(C.experimentalLetterSpacing?(s.letterSpacing=`${t}px`,s.textLetterSpacing=`${t}px`,i=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));const n=s.measureText(e);let a=n.width;const o=-n.actualBoundingBoxLeft;let h=n.actualBoundingBoxRight-o;if(a>0)if(i)a-=t,h-=t;else{const c=(C.graphemeSegmenter(e).length-1)*t;a+=c,h+=c}return Math.max(a,h)}static _wordWrap(e,t,s=C._canvas){const i=s.getContext("2d",kr);let n=0,a="",o="";const l=Object.create(null),{letterSpacing:h,whiteSpace:c}=t,u=C._collapseSpaces(c),d=C._collapseNewlines(c);let f=!u;const g=t.wordWrapWidth+h,m=C._tokenize(e);for(let p=0;p<m.length;p++){let _=m[p];if(C._isNewline(_)){if(!d){o+=C._addLine(a),f=!u,a="",n=0;continue}_=" "}if(u){const b=C.isBreakingSpace(_),v=C.isBreakingSpace(a[a.length-1]);if(b&&v)continue}const x=C._getFromCache(_,h,l,i);if(x>g)if(a!==""&&(o+=C._addLine(a),a="",n=0),C.canBreakWords(_,t.breakWords)){const b=C.wordWrapSplit(_);for(let v=0;v<b.length;v++){let S=b[v],T=S,w=1;for(;b[v+w];){const R=b[v+w];if(!C.canBreakChars(T,R,_,v,t.breakWords))S+=R;else break;T=R,w++}v+=w-1;const I=C._getFromCache(S,h,l,i);I+n>g&&(o+=C._addLine(a),f=!1,a="",n=0),a+=S,n+=I}}else{a.length>0&&(o+=C._addLine(a),a="",n=0);const b=p===m.length-1;o+=C._addLine(_,!b),f=!1,a="",n=0}else x+n>g&&(f=!1,o+=C._addLine(a),a="",n=0),(a.length>0||!C.isBreakingSpace(_)||f)&&(a+=_,n+=x)}return o+=C._addLine(a,!1),o}static _addLine(e,t=!0){return e=C._trimRight(e),e=t?`${e}
`:e,e}static _getFromCache(e,t,s,i){let n=s[e];return typeof n!="number"&&(n=C._measureText(e,t,i)+t,s[e]=n),n}static _collapseSpaces(e){return e==="normal"||e==="pre-line"}static _collapseNewlines(e){return e==="normal"}static _trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const s=e[t];if(!C.isBreakingSpace(s))break;e=e.slice(0,-1)}return e}static _isNewline(e){return typeof e!="string"?!1:C._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:C._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const t=[];let s="";if(typeof e!="string")return t;for(let i=0;i<e.length;i++){const n=e[i],a=e[i+1];if(C.isBreakingSpace(n,a)||C._isNewline(n)){s!==""&&(t.push(s),s=""),t.push(n);continue}s+=n}return s!==""&&t.push(s),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,s,i,n){return!0}static wordWrapSplit(e){return C.graphemeSegmenter(e)}static measureFont(e){if(C._fonts[e])return C._fonts[e];const t=C._context;t.font=e;const s=t.measureText(C.METRICS_STRING+C.BASELINE_SYMBOL),i={ascent:s.actualBoundingBoxAscent,descent:s.actualBoundingBoxDescent,fontSize:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent};return C._fonts[e]=i,i}static clearMetrics(e=""){e?delete C._fonts[e]:C._fonts={}}static get _canvas(){if(!C.__canvas){let e;try{const t=new OffscreenCanvas(0,0),s=t.getContext("2d",kr);if(s!=null&&s.measureText)return C.__canvas=t,t;e=O.get().createCanvas()}catch{e=O.get().createCanvas()}e.width=e.height=10,C.__canvas=e}return C.__canvas}static get _context(){return C.__context||(C.__context=C._canvas.getContext("2d",kr)),C.__context}};Ee.METRICS_STRING="|q";Ee.BASELINE_SYMBOL="M";Ee.BASELINE_MULTIPLIER=1.4;Ee.HEIGHT_MULTIPLIER=2;Ee.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const r=new Intl.Segmenter;return e=>{const t=r.segment(e),s=[];let i=0;for(const n of t)s[i++]=n.segment;return s}}return r=>[...r]})();Ee.experimentalLetterSpacing=!1;Ee._fonts={};Ee._newlines=[10,13];Ee._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Te=Ee;const Qn=[{offset:0,color:"white"},{offset:1,color:"black"}],ki=class ii{constructor(...e){this.uid=X("fillGradient"),this.type="linear",this.colorStops=[];let t=Bd(e);t={...t.type==="radial"?ii.defaultRadialOptions:ii.defaultLinearOptions,...oo(t)},this._textureSize=t.textureSize,this._wrapMode=t.wrapMode,t.type==="radial"?(this.center=t.center,this.outerCenter=t.outerCenter??this.center,this.innerRadius=t.innerRadius,this.outerRadius=t.outerRadius,this.scale=t.scale,this.rotation=t.rotation):(this.start=t.start,this.end=t.end),this.textureSpace=t.textureSpace,this.type=t.type,t.colorStops.forEach(i=>{this.addColorStop(i.offset,i.color)})}addColorStop(e,t){return this.colorStops.push({offset:e,color:V.shared.setValue(t).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:e,y:t}=this.start,{x:s,y:i}=this.end,n=s-e,a=i-t;const o=n<0||a<0;if(this._wrapMode==="clamp-to-edge"){if(n<0){const p=e;e=s,s=p,n*=-1}if(a<0){const p=t;t=i,i=p,a*=-1}}const l=this.colorStops.length?this.colorStops:Qn,h=this._textureSize,{canvas:c,context:u}=ea(h,1),d=o?u.createLinearGradient(this._textureSize,0,0,0):u.createLinearGradient(0,0,this._textureSize,0);Jn(d,l),u.fillStyle=d,u.fillRect(0,0,h,1),this.texture=new k({source:new ct({resource:c,addressMode:this._wrapMode})});const f=Math.sqrt(n*n+a*a),g=Math.atan2(a,n),m=new E;m.scale(f/h,1),m.rotate(g),m.translate(e,t),this.textureSpace==="local"&&m.scale(h,h),this.transform=m}buildGradient(){this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const e=this.colorStops.length?this.colorStops:Qn,t=this._textureSize,{canvas:s,context:i}=ea(t,t),{x:n,y:a}=this.center,{x:o,y:l}=this.outerCenter,h=this.innerRadius,c=this.outerRadius,u=o-c,d=l-c,f=t/(c*2),g=(n-u)*f,m=(a-d)*f,p=i.createRadialGradient(g,m,h*f,(o-u)*f,(l-d)*f,c*f);Jn(p,e),i.fillStyle=e[e.length-1].color,i.fillRect(0,0,t,t),i.fillStyle=p,i.translate(g,m),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-g,-m),i.fillRect(0,0,t,t),this.texture=new k({source:new ct({resource:s,addressMode:this._wrapMode})});const _=new E;_.scale(1/f,1/f),_.translate(u,d),this.textureSpace==="local"&&_.scale(t,t),this.transform=_}get styleKey(){return this.uid}destroy(){var e;(e=this.texture)==null||e.destroy(!0),this.texture=null}};ki.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};ki.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Oe=ki;function Jn(r,e){for(let t=0;t<e.length;t++){const s=e[t];r.addColorStop(s.offset,s.color)}}function ea(r,e){const t=O.get().createCanvas(r,e),s=t.getContext("2d");return{canvas:t,context:s}}function Bd(r){let e=r[0]??{};return(typeof e=="number"||r[1])&&(U("8.5.2","use options object instead"),e={type:"linear",start:{x:r[0],y:r[1]},end:{x:r[2],y:r[3]},textureSpace:r[4],textureSize:r[5]??Oe.defaultLinearOptions.textureSize}),e}const ta={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Qs{constructor(e,t){this.uid=X("fillPattern"),this.transform=new E,this._styleKey=null,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),t&&(e.source.style.addressModeU=ta[t].addressModeU,e.source.style.addressModeV=ta[t].addressModeV)}setTransform(e){const t=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/t.frame.width,1/t.frame.height),this._styleKey=null}get styleKey(){return this._styleKey?this._styleKey:(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`,this._styleKey)}}var Cr,sa;function Rd(){if(sa)return Cr;sa=1,Cr=t;var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function t(n){var a=[];return n.replace(e,function(o,l,h){var c=l.toLowerCase();for(h=i(h),c=="m"&&h.length>2&&(a.push([l].concat(h.splice(0,2))),c="l",l=l=="m"?"l":"L");;){if(h.length==r[c])return h.unshift(l),a.push(h);if(h.length<r[c])throw new Error("malformed path data");a.push([l].concat(h.splice(0,r[c])))}}),a}var s=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function i(n){var a=n.match(s);return a?a.map(Number):[]}return Cr}var Id=Rd();const Gd=io(Id);function Dd(r,e){const t=Gd(r),s=[];let i=null,n=0,a=0;for(let o=0;o<t.length;o++){const l=t[o],h=l[0],c=l;switch(h){case"M":n=c[1],a=c[2],e.moveTo(n,a);break;case"m":n+=c[1],a+=c[2],e.moveTo(n,a);break;case"H":n=c[1],e.lineTo(n,a);break;case"h":n+=c[1],e.lineTo(n,a);break;case"V":a=c[1],e.lineTo(n,a);break;case"v":a+=c[1],e.lineTo(n,a);break;case"L":n=c[1],a=c[2],e.lineTo(n,a);break;case"l":n+=c[1],a+=c[2],e.lineTo(n,a);break;case"C":n=c[5],a=c[6],e.bezierCurveTo(c[1],c[2],c[3],c[4],n,a);break;case"c":e.bezierCurveTo(n+c[1],a+c[2],n+c[3],a+c[4],n+c[5],a+c[6]),n+=c[5],a+=c[6];break;case"S":n=c[3],a=c[4],e.bezierCurveToShort(c[1],c[2],n,a);break;case"s":e.bezierCurveToShort(n+c[1],a+c[2],n+c[3],a+c[4]),n+=c[3],a+=c[4];break;case"Q":n=c[3],a=c[4],e.quadraticCurveTo(c[1],c[2],n,a);break;case"q":e.quadraticCurveTo(n+c[1],a+c[2],n+c[3],a+c[4]),n+=c[3],a+=c[4];break;case"T":n=c[1],a=c[2],e.quadraticCurveToShort(n,a);break;case"t":n+=c[1],a+=c[2],e.quadraticCurveToShort(n,a);break;case"A":n=c[6],a=c[7],e.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,a);break;case"a":n+=c[6],a+=c[7],e.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,a);break;case"Z":case"z":e.closePath(),s.length>0&&(i=s.pop(),i?(n=i.startX,a=i.startY):(n=0,a=0)),i=null;break;default:B(`Unknown SVG path command: ${h}`)}h!=="Z"&&h!=="z"&&i===null&&(i={startX:n,startY:a},s.push(i))}return e}class Ci{constructor(e=0,t=0,s=0){this.type="circle",this.x=e,this.y=t,this.radius=s}clone(){return new Ci(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const s=this.radius*this.radius;let i=this.x-e,n=this.y-t;return i*=i,n*=n,i+n<=s}strokeContains(e,t,s,i=.5){if(this.radius===0)return!1;const n=this.x-e,a=this.y-t,o=this.radius,l=(1-i)*s,h=Math.sqrt(n*n+a*a);return h<=o+l&&h>o-(s-l)}getBounds(e){return e||(e=new W),e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=this.radius*2,e.height=this.radius*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Ei{constructor(e=0,t=0,s=0,i=0){this.type="ellipse",this.x=e,this.y=t,this.halfWidth=s,this.halfHeight=i}clone(){return new Ei(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,t){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(e-this.x)/this.halfWidth,i=(t-this.y)/this.halfHeight;return s*=s,i*=i,s+i<=1}strokeContains(e,t,s,i=.5){const{halfWidth:n,halfHeight:a}=this;if(n<=0||a<=0)return!1;const o=s*(1-i),l=s-o,h=n-l,c=a-l,u=n+o,d=a+o,f=e-this.x,g=t-this.y,m=f*f/(h*h)+g*g/(c*c),p=f*f/(u*u)+g*g/(d*d);return m>1&&p<=1}getBounds(e){return e||(e=new W),e.x=this.x-this.halfWidth,e.y=this.y-this.halfHeight,e.width=this.halfWidth*2,e.height=this.halfHeight*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function Ud(r,e,t,s,i,n){const a=r-t,o=e-s,l=i-t,h=n-s,c=a*l+o*h,u=l*l+h*h;let d=-1;u!==0&&(d=c/u);let f,g;d<0?(f=t,g=s):d>1?(f=i,g=n):(f=t+d*l,g=s+d*h);const m=r-f,p=e-g;return m*m+p*p}let Od,Ld;class jt{constructor(...e){this.type="polygon";let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const s=[];for(let i=0,n=t.length;i<n;i++)s.push(t[i].x,t[i].y);t=s}this.points=t,this.closePath=!0}isClockwise(){let e=0;const t=this.points,s=t.length;for(let i=0;i<s;i+=2){const n=t[i],a=t[i+1],o=t[(i+2)%s],l=t[(i+3)%s];e+=(o-n)*(l+a)}return e<0}containsPolygon(e){const t=this.getBounds(Od),s=e.getBounds(Ld);if(!t.containsRect(s))return!1;const i=e.points;for(let n=0;n<i.length;n+=2){const a=i[n],o=i[n+1];if(!this.contains(a,o))return!1}return!0}clone(){const e=this.points.slice(),t=new jt(e);return t.closePath=this.closePath,t}contains(e,t){let s=!1;const i=this.points.length/2;for(let n=0,a=i-1;n<i;a=n++){const o=this.points[n*2],l=this.points[n*2+1],h=this.points[a*2],c=this.points[a*2+1];l>t!=c>t&&e<(h-o)*((t-l)/(c-l))+o&&(s=!s)}return s}strokeContains(e,t,s,i=.5){const n=s*s,a=n*(1-i),o=n-a,{points:l}=this,h=l.length-(this.closePath?0:2);for(let c=0;c<h;c+=2){const u=l[c],d=l[c+1],f=l[(c+2)%l.length],g=l[(c+3)%l.length],m=Ud(e,t,u,d,f,g),p=Math.sign((f-u)*(t-d)-(g-d)*(e-u));if(m<=(p<0?o:a))return!0}return!1}getBounds(e){e||(e=new W);const t=this.points;let s=1/0,i=-1/0,n=1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=2){const h=t[o],c=t[o+1];s=h<s?h:s,i=h>i?h:i,n=c<n?c:n,a=c>a?c:a}return e.x=s,e.width=i-s,e.y=n,e.height=a-n,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((e,t)=>`${e}, ${t}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const Ps=(r,e,t,s,i,n,a)=>{const o=r-t,l=e-s,h=Math.sqrt(o*o+l*l);return h>=i-n&&h<=i+a};class Mi{constructor(e=0,t=0,s=0,i=0,n=20){this.type="roundedRectangle",this.x=e,this.y=t,this.width=s,this.height=i,this.radius=n}getBounds(e){return e||(e=new W),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new Mi(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+s&&t<=this.y+this.height-s||e>=this.x+s&&e<=this.x+this.width-s)return!0;let i=e-(this.x+s),n=t-(this.y+s);const a=s*s;if(i*i+n*n<=a||(i=e-(this.x+this.width-s),i*i+n*n<=a)||(n=t-(this.y+this.height-s),i*i+n*n<=a)||(i=e-(this.x+s),i*i+n*n<=a))return!0}return!1}strokeContains(e,t,s,i=.5){const{x:n,y:a,width:o,height:l,radius:h}=this,c=s*(1-i),u=s-c,d=n+h,f=a+h,g=o-h*2,m=l-h*2,p=n+o,_=a+l;return(e>=n-c&&e<=n+u||e>=p-u&&e<=p+c)&&t>=f&&t<=f+m||(t>=a-c&&t<=a+u||t>=_-u&&t<=_+c)&&e>=d&&e<=d+g?!0:e<d&&t<f&&Ps(e,t,d,f,h,u,c)||e>p-h&&t<f&&Ps(e,t,p-h,f,h,u,c)||e>p-h&&t>_-h&&Ps(e,t,p-h,_-h,h,u,c)||e<d&&t>_-h&&Ps(e,t,d,_-h,h,u,c)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const al={};function Fi(r,e,t){let s=2166136261;for(let i=0;i<e;i++)s^=r[i].uid,s=Math.imul(s,16777619),s>>>=0;return al[s]||Nd(r,e,s,t)}function Nd(r,e,t,s){const i={};let n=0;for(let o=0;o<s;o++){const l=o<e?r[o]:k.EMPTY.source;i[n++]=l.source,i[n++]=l.style}const a=new Ge(i);return al[t]=a,a}class yt{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}function ni(r,e){const t=r.byteLength/8|0,s=new Float64Array(r,0,t);new Float64Array(e,0,t).set(s);const n=r.byteLength-t*8;if(n>0){const a=new Uint8Array(r,t*8,n);new Uint8Array(e,t*8,n).set(a)}}const Hd={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var Q=(r=>(r[r.DISABLED=0]="DISABLED",r[r.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",r[r.MASK_ACTIVE=2]="MASK_ACTIVE",r[r.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",r[r.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",r[r.NONE=5]="NONE",r))(Q||{});function ss(r,e){return e.alphaMode==="no-premultiply-alpha"&&Hd[r]||r}const Wd=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Vd(r){let e="";for(let t=0;t<r;++t)t>0&&(e+=`
else `),t<r-1&&(e+=`if(test == ${t}.0){}`);return e}function ol(r,e){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const s=Wd.replace(/%forloop%/gi,Vd(r));if(e.shaderSource(t,s),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))r=r/2|0;else break}}finally{e.deleteShader(t)}return r}let pt=null;function zd(){var e;if(pt)return pt;const r=Oo();return pt=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),pt=ol(pt,r),(e=r.getExtension("WEBGL_lose_context"))==null||e.loseContext(),pt}class Yd{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){const t=this.textures[e];this.textures[e]=null,this.ids[t.uid]=null}this.count=0}}class jd{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Yd,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const ll=[];let ai=0;function ra(){return ai>0?ll[--ai]:new jd}function ia(r){ll[ai++]=r}let Dt=0;const hl=class cl{constructor(e){this.uid=X("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],e={...cl.defaultOptions,...e},e.maxTextures||(U("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),e.maxTextures=zd());const{maxTextures:t,attributesInitialSize:s,indicesInitialSize:i}=e;this.attributeBuffer=new yt(s*4),this.indexBuffer=new Uint16Array(i),this.maxTextures=t}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++)ia(this.batches[e]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e._indexStart=this.indexSize,e._attributeStart=this.attributeSize,e._batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.attributeSize*this.vertexSize}checkAndUpdateTexture(e,t){const s=e._batch.textures.ids[t._source.uid];return!s&&s!==0?!1:(e._textureId=s,e.texture=t,!0)}updateElement(e){this.dirty=!0;const t=this.attributeBuffer;e.packAsQuad?this.packQuadAttributes(e,t.float32View,t.uint32View,e._attributeStart,e._textureId):this.packAttributes(e,t.float32View,t.uint32View,e._attributeStart,e._textureId)}break(e){const t=this._elements;if(!t[this.elementStart])return;let s=ra(),i=s.textures;i.clear();const n=t[this.elementStart];let a=ss(n.blendMode,n.texture._source),o=n.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,h=this.attributeBuffer.uint32View,c=this.indexBuffer;let u=this._batchIndexSize,d=this._batchIndexStart,f="startBatch";const g=this.maxTextures;for(let m=this.elementStart;m<this.elementSize;++m){const p=t[m];t[m]=null;const x=p.texture._source,b=ss(p.blendMode,x),v=a!==b||o!==p.topology;if(x._batchTick===Dt&&!v){p._textureId=x._textureBindLocation,u+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,h,p._attributeStart,p._textureId),this.packQuadIndex(c,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,h,p._attributeStart,p._textureId),this.packIndex(p,c,p._indexStart,p._attributeStart/this.vertexSize)),p._batch=s;continue}x._batchTick=Dt,(i.count>=g||v)&&(this._finishBatch(s,d,u-d,i,a,o,e,f),f="renderBatch",d=u,a=b,o=p.topology,s=ra(),i=s.textures,i.clear(),++Dt),p._textureId=x._textureBindLocation=i.count,i.ids[x.uid]=i.count,i.textures[i.count++]=x,p._batch=s,u+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,l,h,p._attributeStart,p._textureId),this.packQuadIndex(c,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,l,h,p._attributeStart,p._textureId),this.packIndex(p,c,p._indexStart,p._attributeStart/this.vertexSize))}i.count>0&&(this._finishBatch(s,d,u-d,i,a,o,e,f),d=u,++Dt),this.elementStart=this.elementSize,this._batchIndexStart=d,this._batchIndexSize=u}_finishBatch(e,t,s,i,n,a,o,l){e.gpuBindGroup=null,e.bindGroup=null,e.action=l,e.batcher=this,e.textures=i,e.blendMode=n,e.topology=a,e.start=t,e.size=s,++Dt,this.batches[this.batchIndex++]=e,o.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){e*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(e*4)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){const t=Math.max(e,this.attributeBuffer.size*2),s=new yt(t);ni(this.attributeBuffer.rawBinaryData,s.rawBinaryData),this.attributeBuffer=s}_resizeIndexBuffer(e){const t=this.indexBuffer;let s=Math.max(e,t.length*1.5);s+=s%2;const i=s>65535?new Uint32Array(s):new Uint16Array(s);if(i.BYTES_PER_ELEMENT!==t.BYTES_PER_ELEMENT)for(let n=0;n<t.length;n++)i[n]=t[n];else ni(t.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(e,t,s){e[t]=s+0,e[t+1]=s+1,e[t+2]=s+2,e[t+3]=s+0,e[t+4]=s+2,e[t+5]=s+3}packIndex(e,t,s,i){const n=e.indices,a=e.indexSize,o=e.indexOffset,l=e.attributeOffset;for(let h=0;h<a;h++)t[s++]=i+n[h+o]-l}destroy(){for(let e=0;e<this.batches.length;e++)ia(this.batches[e]);this.batches=null;for(let e=0;e<this._elements.length;e++)this._elements[e]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};hl.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let $d=hl;var L=(r=>(r[r.MAP_READ=1]="MAP_READ",r[r.MAP_WRITE=2]="MAP_WRITE",r[r.COPY_SRC=4]="COPY_SRC",r[r.COPY_DST=8]="COPY_DST",r[r.INDEX=16]="INDEX",r[r.VERTEX=32]="VERTEX",r[r.UNIFORM=64]="UNIFORM",r[r.STORAGE=128]="STORAGE",r[r.INDIRECT=256]="INDIRECT",r[r.QUERY_RESOLVE=512]="QUERY_RESOLVE",r[r.STATIC=1024]="STATIC",r))(L||{});class fe extends ge{constructor(e){let{data:t,size:s}=e;const{usage:i,label:n,shrinkToFit:a}=e;super(),this.uid=X("buffer"),this._resourceType="buffer",this._resourceId=X("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,t instanceof Array&&(t=new Float32Array(t)),this._data=t,s??(s=t==null?void 0:t.byteLength);const o=!!t;this.descriptor={size:s,usage:i,mappedAtCreation:o,label:n},this.shrinkToFit=a??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&L.STATIC)}set static(e){e?this.descriptor.usage|=L.STATIC:this.descriptor.usage&=~L.STATIC}setDataWithSize(e,t,s){if(this._updateID++,this._updateSize=t*e.BYTES_PER_ELEMENT,this._data===e){s&&this.emit("update",this);return}const i=this._data;if(this._data=e,this._dataInt32=null,!i||i.length!==e.length){!this.shrinkToFit&&i&&e.byteLength<i.byteLength?s&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=X("resource"),this.emit("change",this));return}s&&this.emit("update",this)}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function ul(r,e){if(!(r instanceof fe)){let t=e?L.INDEX:L.VERTEX;r instanceof Array&&(e?(r=new Uint32Array(r),t=L.INDEX|L.COPY_DST):(r=new Float32Array(r),t=L.VERTEX|L.COPY_DST)),r=new fe({data:r,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:t})}return r}function Xd(r,e,t){const s=r.getAttribute(e);if(!s)return t.minX=0,t.minY=0,t.maxX=0,t.maxY=0,t;const i=s.buffer.data;let n=1/0,a=1/0,o=-1/0,l=-1/0;const h=i.BYTES_PER_ELEMENT,c=(s.offset||0)/h,u=(s.stride||2*4)/h;for(let d=c;d<i.length;d+=u){const f=i[d],g=i[d+1];f>o&&(o=f),g>l&&(l=g),f<n&&(n=f),g<a&&(a=g)}return t.minX=n,t.minY=a,t.maxX=o,t.maxY=l,t}function Kd(r){return(r instanceof fe||Array.isArray(r)||r.BYTES_PER_ELEMENT)&&(r={buffer:r}),r.buffer=ul(r.buffer,!1),r}class as extends ge{constructor(e={}){super(),this.uid=X("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new ie,this._boundsDirty=!0;const{attributes:t,indexBuffer:s,topology:i}=e;if(this.buffers=[],this.attributes={},t)for(const n in t)this.addAttribute(n,t[n]);this.instanceCount=e.instanceCount??1,s&&this.addIndex(s),this.topology=i||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(const e in this.attributes){const t=this.attributes[e];return t.buffer.data.length/(t.stride/4||t.size)}return 0}addAttribute(e,t){const s=Kd(t);this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this),s.buffer.on("change",this.onBufferUpdate,this)),this.attributes[e]=s}addIndex(e){this.indexBuffer=ul(e,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,Xd(this,"aPosition",this._bounds)):this._bounds}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(t=>t.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const qd=new Float32Array(1),Zd=new Uint32Array(1);class Qd extends as{constructor(){const t=new fe({data:qd,label:"attribute-batch-buffer",usage:L.VERTEX|L.COPY_DST,shrinkToFit:!1}),s=new fe({data:Zd,label:"index-batch-buffer",usage:L.INDEX|L.COPY_DST,shrinkToFit:!1}),i=6*4;super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:i,offset:0},aUV:{buffer:t,format:"float32x2",stride:i,offset:2*4},aColor:{buffer:t,format:"unorm8x4",stride:i,offset:4*4},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:i,offset:5*4}},indexBuffer:s})}}function na(r,e,t){if(r)for(const s in r){const i=s.toLocaleLowerCase(),n=e[i];if(n){let a=r[s];s==="header"&&(a=a.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),t&&n.push(`//----${t}----//`),n.push(a)}else B(`${s} placement hook does not exist in shader`)}}const Jd=/\{\{(.*?)\}\}/g;function aa(r){var s;const e={};return(((s=r.match(Jd))==null?void 0:s.map(i=>i.replace(/[{()}]/g,"")))??[]).forEach(i=>{e[i]=[]}),e}function oa(r,e){let t;const s=/@in\s+([^;]+);/g;for(;(t=s.exec(r))!==null;)e.push(t[1])}function la(r,e,t=!1){const s=[];oa(e,s),r.forEach(o=>{o.header&&oa(o.header,s)});const i=s;t&&i.sort();const n=i.map((o,l)=>`       @location(${l}) ${o},`).join(`
`);let a=e.replace(/@in\s+[^;]+;\s*/g,"");return a=a.replace("{{in}}",`
${n}
`),a}function ha(r,e){let t;const s=/@out\s+([^;]+);/g;for(;(t=s.exec(r))!==null;)e.push(t[1])}function ef(r){const t=/\b(\w+)\s*:/g.exec(r);return t?t[1]:""}function tf(r){const e=/@.*?\s+/g;return r.replace(e,"")}function sf(r,e){const t=[];ha(e,t),r.forEach(l=>{l.header&&ha(l.header,t)});let s=0;const i=t.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${s++}) ${l}`).join(`,
`),n=t.sort().map(l=>`       var ${tf(l)};`).join(`
`),a=`return VSOutput(
            ${t.sort().map(l=>` ${ef(l)}`).join(`,
`)});`;let o=e.replace(/@out\s+[^;]+;\s*/g,"");return o=o.replace("{{struct}}",`
${i}
`),o=o.replace("{{start}}",`
${n}
`),o=o.replace("{{return}}",`
${a}
`),o}function ca(r,e){let t=r;for(const s in e){const i=e[s];i.join(`
`).length?t=t.replace(`{{${s}}}`,`//-----${s} START-----//
${i.join(`
`)}
//----${s} FINISH----//`):t=t.replace(`{{${s}}}`,"")}return t}const ze=Object.create(null),Er=new Map;let rf=0;function nf({template:r,bits:e}){const t=dl(r,e);if(ze[t])return ze[t];const{vertex:s,fragment:i}=of(r,e);return ze[t]=fl(s,i,e),ze[t]}function af({template:r,bits:e}){const t=dl(r,e);return ze[t]||(ze[t]=fl(r.vertex,r.fragment,e)),ze[t]}function of(r,e){const t=e.map(a=>a.vertex).filter(a=>!!a),s=e.map(a=>a.fragment).filter(a=>!!a);let i=la(t,r.vertex,!0);i=sf(t,i);const n=la(s,r.fragment,!0);return{vertex:i,fragment:n}}function dl(r,e){return e.map(t=>(Er.has(t)||Er.set(t,rf++),Er.get(t))).sort((t,s)=>t-s).join("-")+r.vertex+r.fragment}function fl(r,e,t){const s=aa(r),i=aa(e);return t.forEach(n=>{na(n.vertex,s,n.name),na(n.fragment,i,n.name)}),{vertex:ca(r,s),fragment:ca(e,i)}}const lf=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,hf=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,cf=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,uf=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,df={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},ff={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function os({bits:r,name:e}){const t=nf({template:{fragment:hf,vertex:lf},bits:[df,...r]});return dt.from({name:e,vertex:{source:t.vertex,entryPoint:"main"},fragment:{source:t.fragment,entryPoint:"main"}})}function ls({bits:r,name:e}){return new kt({name:e,...af({template:{vertex:cf,fragment:uf},bits:[ff,...r]})})}const Bi={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Ri={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},Mr={};function gf(r){const e=[];if(r===1)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let t=0;for(let s=0;s<r;s++)e.push(`@group(1) @binding(${t++}) var textureSource${s+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${t++}) var textureSampler${s+1}: sampler;`)}return e.join(`
`)}function pf(r){const e=[];if(r===1)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let t=0;t<r;t++)t===r-1?e.push("  default:{"):e.push(`  case ${t}:{`),e.push(`      outColor = textureSampleGrad(textureSource${t+1}, textureSampler${t+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join(`
`)}function Ii(r){return Mr[r]||(Mr[r]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${gf(r)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${pf(r)}
            `}}),Mr[r]}const Fr={};function mf(r){const e=[];for(let t=0;t<r;t++)t>0&&e.push("else"),t<r-1&&e.push(`if(vTextureId < ${t}.5)`),e.push("{"),e.push(`	outColor = texture(uTextures[${t}], vUV);`),e.push("}");return e.join(`
`)}function Gi(r){return Fr[r]||(Fr[r]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${r}];

            `,main:`

                ${mf(r)}
            `}}),Fr[r]}const hs={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},cs={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},ua={};function Di(r){let e=ua[r];if(e)return e;const t=new Int32Array(r);for(let s=0;s<r;s++)t[s]=s;return e=ua[r]=new oe({uTextures:{value:t,type:"i32",size:r}},{isStatic:!0}),e}class _f extends xe{constructor(e){const t=ls({name:"batch",bits:[Ri,Gi(e),cs]}),s=os({name:"batch",bits:[Bi,Ii(e),hs]});super({glProgram:t,gpuProgram:s,resources:{batchSamplers:Di(e)}})}}let Br=null;const gl=class pl extends $d{constructor(e){super(e),this.geometry=new Qd,this.name=pl.extension.name,this.vertexSize=6,Br??(Br=new _f(e.maxTextures)),this.shader=Br}packAttributes(e,t,s,i,n){const a=n<<16|e.roundPixels&65535,o=e.transform,l=o.a,h=o.b,c=o.c,u=o.d,d=o.tx,f=o.ty,{positions:g,uvs:m}=e,p=e.color,_=e.attributeOffset,x=_+e.attributeSize;for(let b=_;b<x;b++){const v=b*2,S=g[v],T=g[v+1];t[i++]=l*S+c*T+d,t[i++]=u*T+h*S+f,t[i++]=m[v],t[i++]=m[v+1],s[i++]=p,s[i++]=a}}packQuadAttributes(e,t,s,i,n){const a=e.texture,o=e.transform,l=o.a,h=o.b,c=o.c,u=o.d,d=o.tx,f=o.ty,g=e.bounds,m=g.maxX,p=g.minX,_=g.maxY,x=g.minY,b=a.uvs,v=e.color,S=n<<16|e.roundPixels&65535;t[i+0]=l*p+c*x+d,t[i+1]=u*x+h*p+f,t[i+2]=b.x0,t[i+3]=b.y0,s[i+4]=v,s[i+5]=S,t[i+6]=l*m+c*x+d,t[i+7]=u*x+h*m+f,t[i+8]=b.x1,t[i+9]=b.y1,s[i+10]=v,s[i+11]=S,t[i+12]=l*m+c*_+d,t[i+13]=u*_+h*m+f,t[i+14]=b.x2,t[i+15]=b.y2,s[i+16]=v,s[i+17]=S,t[i+18]=l*p+c*_+d,t[i+19]=u*_+h*p+f,t[i+20]=b.x3,t[i+21]=b.y3,s[i+22]=v,s[i+23]=S}};gl.extension={type:[y.Batcher],name:"default"};let Ui=gl;function yf(r,e,t,s,i,n,a,o=null){let l=0;t*=e,i*=n;const h=o.a,c=o.b,u=o.c,d=o.d,f=o.tx,g=o.ty;for(;l<a;){const m=r[t],p=r[t+1];s[i]=h*m+u*p+f,s[i+1]=c*m+d*p+g,i+=n,t+=e,l++}}function xf(r,e,t,s){let i=0;for(e*=t;i<s;)r[e]=0,r[e+1]=0,e+=t,i++}function ml(r,e,t,s,i){const n=e.a,a=e.b,o=e.c,l=e.d,h=e.tx,c=e.ty;t||(t=0),s||(s=2),i||(i=r.length/s-t);let u=t*s;for(let d=0;d<i;d++){const f=r[u],g=r[u+1];r[u]=n*f+o*g+h,r[u+1]=a*f+l*g+c,u+=s}}const bf=new E;class Oi{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const e=this.baseColor,t=e>>16|e&65280|(e&255)<<16,s=this.renderable;return s?bo(t,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):t+(this.alpha*255<<24)}get transform(){var e;return((e=this.renderable)==null?void 0:e.groupTransform)||bf}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.attributeOffset=this.attributeOffset,e.attributeSize=this.attributeSize,e.baseColor=this.baseColor,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData,e.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const rs={extension:{type:y.ShapeBuilder,name:"circle"},build(r,e){let t,s,i,n,a,o;if(r.type==="circle"){const v=r;if(a=o=v.radius,a<=0)return!1;t=v.x,s=v.y,i=n=0}else if(r.type==="ellipse"){const v=r;if(a=v.halfWidth,o=v.halfHeight,a<=0||o<=0)return!1;t=v.x,s=v.y,i=n=0}else{const v=r,S=v.width/2,T=v.height/2;t=v.x+S,s=v.y+T,a=o=Math.max(0,Math.min(v.radius,Math.min(S,T))),i=S-a,n=T-o}if(i<0||n<0)return!1;const l=Math.ceil(2.3*Math.sqrt(a+o)),h=l*8+(i?4:0)+(n?4:0);if(h===0)return!1;if(l===0)return e[0]=e[6]=t+i,e[1]=e[3]=s+n,e[2]=e[4]=t-i,e[5]=e[7]=s-n,!0;let c=0,u=l*4+(i?2:0)+2,d=u,f=h,g=i+a,m=n,p=t+g,_=t-g,x=s+m;if(e[c++]=p,e[c++]=x,e[--u]=x,e[--u]=_,n){const v=s-m;e[d++]=_,e[d++]=v,e[--f]=v,e[--f]=p}for(let v=1;v<l;v++){const S=Math.PI/2*(v/l),T=i+Math.cos(S)*a,w=n+Math.sin(S)*o,I=t+T,R=t-T,P=s+w,A=s-w;e[c++]=I,e[c++]=P,e[--u]=P,e[--u]=R,e[d++]=R,e[d++]=A,e[--f]=A,e[--f]=I}g=i,m=n+o,p=t+g,_=t-g,x=s+m;const b=s-m;return e[c++]=p,e[c++]=x,e[--f]=b,e[--f]=p,i&&(e[c++]=_,e[c++]=x,e[--f]=b,e[--f]=_),!0},triangulate(r,e,t,s,i,n){if(r.length===0)return;let a=0,o=0;for(let c=0;c<r.length;c+=2)a+=r[c],o+=r[c+1];a/=r.length/2,o/=r.length/2;let l=s;e[l*t]=a,e[l*t+1]=o;const h=l++;for(let c=0;c<r.length;c+=2)e[l*t]=r[c],e[l*t+1]=r[c+1],c>0&&(i[n++]=l,i[n++]=h,i[n++]=l-1),l++;i[n++]=h+1,i[n++]=h,i[n++]=l-1}},vf={...rs,extension:{...rs.extension,name:"ellipse"}},wf={...rs,extension:{...rs.extension,name:"roundedRectangle"}},_l=1e-4,da=1e-4;function Tf(r){const e=r.length;if(e<6)return 1;let t=0;for(let s=0,i=r[e-2],n=r[e-1];s<e;s+=2){const a=r[s],o=r[s+1];t+=(a-i)*(o+n),i=a,n=o}return t<0?-1:1}function fa(r,e,t,s,i,n,a,o){const l=r-t*i,h=e-s*i,c=r+t*n,u=e+s*n;let d,f;a?(d=s,f=-t):(d=-s,f=t);const g=l+d,m=h+f,p=c+d,_=u+f;return o.push(g,m),o.push(p,_),2}function tt(r,e,t,s,i,n,a,o){const l=t-r,h=s-e;let c=Math.atan2(l,h),u=Math.atan2(i-r,n-e);o&&c<u?c+=Math.PI*2:!o&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,g=Math.abs(f),m=Math.sqrt(l*l+h*h),p=(15*g*Math.sqrt(m)/Math.PI>>0)+1,_=f/p;if(d+=_,o){a.push(r,e),a.push(t,s);for(let x=1,b=d;x<p;x++,b+=_)a.push(r,e),a.push(r+Math.sin(b)*m,e+Math.cos(b)*m);a.push(r,e),a.push(i,n)}else{a.push(t,s),a.push(r,e);for(let x=1,b=d;x<p;x++,b+=_)a.push(r+Math.sin(b)*m,e+Math.cos(b)*m),a.push(r,e);a.push(i,n),a.push(r,e)}return p*2}function Sf(r,e,t,s,i,n){const a=_l;if(r.length===0)return;const o=e;let l=o.alignment;if(e.alignment!==.5){let j=Tf(r);l=(l-.5)*j+.5}const h=new Y(r[0],r[1]),c=new Y(r[r.length-2],r[r.length-1]),u=s,d=Math.abs(h.x-c.x)<a&&Math.abs(h.y-c.y)<a;if(u){r=r.slice(),d&&(r.pop(),r.pop(),c.set(r[r.length-2],r[r.length-1]));const j=(h.x+c.x)*.5,Ne=(c.y+h.y)*.5;r.unshift(j,Ne),r.push(j,Ne)}const f=i,g=r.length/2;let m=r.length;const p=f.length/2,_=o.width/2,x=_*_,b=o.miterLimit*o.miterLimit;let v=r[0],S=r[1],T=r[2],w=r[3],I=0,R=0,P=-(S-w),A=v-T,z=0,D=0,se=Math.sqrt(P*P+A*A);P/=se,A/=se,P*=_,A*=_;const qe=l,F=(1-qe)*2,G=qe*2;u||(o.cap==="round"?m+=tt(v-P*(F-G)*.5,S-A*(F-G)*.5,v-P*F,S-A*F,v+P*G,S+A*G,f,!0)+2:o.cap==="square"&&(m+=fa(v,S,P,A,F,G,!0,f))),f.push(v-P*F,S-A*F),f.push(v+P*G,S+A*G);for(let j=1;j<g-1;++j){v=r[(j-1)*2],S=r[(j-1)*2+1],T=r[j*2],w=r[j*2+1],I=r[(j+1)*2],R=r[(j+1)*2+1],P=-(S-w),A=v-T,se=Math.sqrt(P*P+A*A),P/=se,A/=se,P*=_,A*=_,z=-(w-R),D=T-I,se=Math.sqrt(z*z+D*D),z/=se,D/=se,z*=_,D*=_;const Ne=T-v,Mt=S-w,Ft=T-I,Bt=R-w,dn=Ne*Ft+Mt*Bt,ds=Mt*Ft-Bt*Ne,Rt=ds<0;if(Math.abs(ds)<.001*Math.abs(dn)){f.push(T-P*F,w-A*F),f.push(T+P*G,w+A*G),dn>=0&&(o.join==="round"?m+=tt(T,w,T-P*F,w-A*F,T-z*F,w-D*F,f,!1)+4:m+=2,f.push(T-z*G,w-D*G),f.push(T+z*F,w+D*F));continue}const fn=(-P+v)*(-A+w)-(-P+T)*(-A+S),gn=(-z+I)*(-D+w)-(-z+T)*(-D+R),fs=(Ne*gn-Ft*fn)/ds,gs=(Bt*fn-Mt*gn)/ds,tr=(fs-T)*(fs-T)+(gs-w)*(gs-w),Ze=T+(fs-T)*F,Qe=w+(gs-w)*F,Je=T-(fs-T)*G,et=w-(gs-w)*G,Ec=Math.min(Ne*Ne+Mt*Mt,Ft*Ft+Bt*Bt),pn=Rt?F:G,Mc=Ec+pn*pn*x;tr<=Mc?o.join==="bevel"||tr/x>b?(Rt?(f.push(Ze,Qe),f.push(T+P*G,w+A*G),f.push(Ze,Qe),f.push(T+z*G,w+D*G)):(f.push(T-P*F,w-A*F),f.push(Je,et),f.push(T-z*F,w-D*F),f.push(Je,et)),m+=2):o.join==="round"?Rt?(f.push(Ze,Qe),f.push(T+P*G,w+A*G),m+=tt(T,w,T+P*G,w+A*G,T+z*G,w+D*G,f,!0)+4,f.push(Ze,Qe),f.push(T+z*G,w+D*G)):(f.push(T-P*F,w-A*F),f.push(Je,et),m+=tt(T,w,T-P*F,w-A*F,T-z*F,w-D*F,f,!1)+4,f.push(T-z*F,w-D*F),f.push(Je,et)):(f.push(Ze,Qe),f.push(Je,et)):(f.push(T-P*F,w-A*F),f.push(T+P*G,w+A*G),o.join==="round"?Rt?m+=tt(T,w,T+P*G,w+A*G,T+z*G,w+D*G,f,!0)+2:m+=tt(T,w,T-P*F,w-A*F,T-z*F,w-D*F,f,!1)+2:o.join==="miter"&&tr/x<=b&&(Rt?(f.push(Je,et),f.push(Je,et)):(f.push(Ze,Qe),f.push(Ze,Qe)),m+=2),f.push(T-z*F,w-D*F),f.push(T+z*G,w+D*G),m+=2)}v=r[(g-2)*2],S=r[(g-2)*2+1],T=r[(g-1)*2],w=r[(g-1)*2+1],P=-(S-w),A=v-T,se=Math.sqrt(P*P+A*A),P/=se,A/=se,P*=_,A*=_,f.push(T-P*F,w-A*F),f.push(T+P*G,w+A*G),u||(o.cap==="round"?m+=tt(T-P*(F-G)*.5,w-A*(F-G)*.5,T-P*F,w-A*F,T+P*G,w+A*G,f,!1)+2:o.cap==="square"&&(m+=fa(T,w,P,A,F,G,!1,f)));const Cc=da*da;for(let j=p;j<m+p-2;++j)v=f[j*2],S=f[j*2+1],T=f[(j+1)*2],w=f[(j+1)*2+1],I=f[(j+2)*2],R=f[(j+2)*2+1],!(Math.abs(v*(w-R)+T*(R-S)+I*(S-w))<Cc)&&n.push(j,j+1,j+2)}function Af(r,e,t,s){const i=_l;if(r.length===0)return;const n=r[0],a=r[1],o=r[r.length-2],l=r[r.length-1],h=e||Math.abs(n-o)<i&&Math.abs(a-l)<i,c=t,u=r.length/2,d=c.length/2;for(let f=0;f<u;f++)c.push(r[f*2]),c.push(r[f*2+1]);for(let f=0;f<u-1;f++)s.push(d+f,d+f+1);h&&s.push(d+u-1,d)}function yl(r,e,t,s,i,n,a){const o=cd(r,e,2);if(!o)return;for(let h=0;h<o.length;h+=3)n[a++]=o[h]+i,n[a++]=o[h+1]+i,n[a++]=o[h+2]+i;let l=i*s;for(let h=0;h<r.length;h+=2)t[l]=r[h],t[l+1]=r[h+1],l+=s}const Pf=[],kf={extension:{type:y.ShapeBuilder,name:"polygon"},build(r,e){for(let t=0;t<r.points.length;t++)e[t]=r.points[t];return!0},triangulate(r,e,t,s,i,n){yl(r,Pf,e,t,s,i,n)}},Cf={extension:{type:y.ShapeBuilder,name:"rectangle"},build(r,e){const t=r,s=t.x,i=t.y,n=t.width,a=t.height;return n>0&&a>0?(e[0]=s,e[1]=i,e[2]=s+n,e[3]=i,e[4]=s+n,e[5]=i+a,e[6]=s,e[7]=i+a,!0):!1},triangulate(r,e,t,s,i,n){let a=0;s*=t,e[s+a]=r[0],e[s+a+1]=r[1],a+=t,e[s+a]=r[2],e[s+a+1]=r[3],a+=t,e[s+a]=r[6],e[s+a+1]=r[7],a+=t,e[s+a]=r[4],e[s+a+1]=r[5],a+=t;const o=s/t;i[n++]=o,i[n++]=o+1,i[n++]=o+2,i[n++]=o+1,i[n++]=o+3,i[n++]=o+2}},Ef={extension:{type:y.ShapeBuilder,name:"triangle"},build(r,e){return e[0]=r.x,e[1]=r.y,e[2]=r.x2,e[3]=r.y2,e[4]=r.x3,e[5]=r.y3,!0},triangulate(r,e,t,s,i,n){let a=0;s*=t,e[s+a]=r[0],e[s+a+1]=r[1],a+=t,e[s+a]=r[2],e[s+a+1]=r[3],a+=t,e[s+a]=r[4],e[s+a+1]=r[5];const o=s/t;i[n++]=o,i[n++]=o+1,i[n++]=o+2}},Mf=new E,Ff=new W;function Bf(r,e,t,s){const i=e.matrix?r.copyFrom(e.matrix).invert():r.identity();if(e.textureSpace==="local"){const a=t.getBounds(Ff);e.width&&a.pad(e.width);const{x:o,y:l}=a,h=1/a.width,c=1/a.height,u=-o*h,d=-l*c,f=i.a,g=i.b,m=i.c,p=i.d;i.a*=h,i.b*=h,i.c*=c,i.d*=c,i.tx=u*f+d*m+i.tx,i.ty=u*g+d*p+i.ty}else i.translate(e.texture.frame.x,e.texture.frame.y),i.scale(1/e.texture.source.width,1/e.texture.source.height);const n=e.texture.source.style;return!(e.fill instanceof Oe)&&n.addressMode==="clamp-to-edge"&&(n.addressMode="repeat",n.update()),s&&i.append(Mf.copyFrom(s).invert()),i}const Js={};M.handleByMap(y.ShapeBuilder,Js);M.add(Cf,kf,Ef,rs,vf,wf);const Rf=new W,If=new E;function Gf(r,e){const{geometryData:t,batches:s}=e;s.length=0,t.indices.length=0,t.vertices.length=0,t.uvs.length=0;for(let i=0;i<r.instructions.length;i++){const n=r.instructions[i];if(n.action==="texture")Df(n.data,s,t);else if(n.action==="fill"||n.action==="stroke"){const a=n.action==="stroke",o=n.data.path.shapePath,l=n.data.style,h=n.data.hole;a&&h&&ga(h.shapePath,l,!0,s,t),h&&(o.shapePrimitives[o.shapePrimitives.length-1].holes=h.shapePath.shapePrimitives),ga(o,l,a,s,t)}}}function Df(r,e,t){const s=[],i=Js.rectangle,n=Rf;n.x=r.dx,n.y=r.dy,n.width=r.dw,n.height=r.dh;const a=r.transform;if(!i.build(n,s))return;const{vertices:o,uvs:l,indices:h}=t,c=h.length,u=o.length/2;a&&ml(s,a),i.triangulate(s,o,2,u,h,c);const d=r.image,f=d.uvs;l.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const g=te.get(Oi);g.indexOffset=c,g.indexSize=h.length-c,g.attributeOffset=u,g.attributeSize=o.length/2-u,g.baseColor=r.style,g.alpha=r.alpha,g.texture=d,g.geometryData=t,e.push(g)}function ga(r,e,t,s,i){const{vertices:n,uvs:a,indices:o}=i;r.shapePrimitives.forEach(({shape:l,transform:h,holes:c})=>{const u=[],d=Js[l.type];if(!d.build(l,u))return;const f=o.length,g=n.length/2;let m="triangle-list";if(h&&ml(u,h),t){const b=l.closePath??!0,v=e;v.pixelLine?(Af(u,b,n,o),m="line-list"):Sf(u,v,!1,b,n,o)}else if(c){const b=[],v=u.slice();Uf(c).forEach(T=>{b.push(v.length/2),v.push(...T)}),yl(v,b,n,2,g,o,f)}else d.triangulate(u,n,2,g,o,f);const p=a.length/2,_=e.texture;if(_!==k.WHITE){const b=Bf(If,e,l,h);yf(n,2,g,a,p,2,n.length/2-g,b)}else xf(a,p,2,n.length/2-g);const x=te.get(Oi);x.indexOffset=f,x.indexSize=o.length-f,x.attributeOffset=g,x.attributeSize=n.length/2-g,x.baseColor=e.color,x.alpha=e.alpha,x.texture=_,x.geometryData=i,x.topology=m,s.push(x)})}function Uf(r){const e=[];for(let t=0;t<r.length;t++){const s=r[t].shape,i=[];Js[s.type].build(s,i)&&e.push(i)}return e}class Of{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Lf{constructor(){this.instructions=new To}init(e){this.batcher=new Ui({maxTextures:e}),this.instructions.reset()}get geometry(){return U(Yc,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const Li=class oi{constructor(e){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=e,e.renderableGC.addManagedHash(this,"_gpuContextHash"),e.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){oi.defaultOptions.bezierSmoothness=(e==null?void 0:e.bezierSmoothness)??oi.defaultOptions.bezierSmoothness}getContextRenderData(e){return this._graphicsDataContextHash[e.uid]||this._initContextRenderData(e)}updateGpuContext(e){let t=this._gpuContextHash[e.uid]||this._initContext(e);if(e.dirty){t?this._cleanGraphicsContextData(e):t=this._initContext(e),Gf(e,t);const s=e.batchMode;e.customShader||s==="no-batch"?t.isBatchable=!1:s==="auto"?t.isBatchable=t.geometryData.vertices.length<400:t.isBatchable=!0,e.dirty=!1}return t}getGpuContext(e){return this._gpuContextHash[e.uid]||this._initContext(e)}_initContextRenderData(e){const t=te.get(Lf,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:s,geometryData:i}=this._gpuContextHash[e.uid],n=i.vertices.length,a=i.indices.length;for(let c=0;c<s.length;c++)s[c].applyTransform=!1;const o=t.batcher;o.ensureAttributeBuffer(n),o.ensureIndexBuffer(a),o.begin();for(let c=0;c<s.length;c++){const u=s[c];o.add(u)}o.finish(t.instructions);const l=o.geometry;l.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),l.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const h=o.batches;for(let c=0;c<h.length;c++){const u=h[c];u.bindGroup=Fi(u.textures.textures,u.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[e.uid]=t,t}_initContext(e){const t=new Of;return t.context=e,this._gpuContextHash[e.uid]=t,e.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]}onGraphicsContextDestroy(e){this._cleanGraphicsContextData(e),e.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]=null}_cleanGraphicsContextData(e){const t=this._gpuContextHash[e.uid];t.isBatchable||this._graphicsDataContextHash[e.uid]&&(te.return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),t.batches&&t.batches.forEach(s=>{te.return(s)})}destroy(){for(const e in this._gpuContextHash)this._gpuContextHash[e]&&this.onGraphicsContextDestroy(this._gpuContextHash[e].context)}};Li.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"graphicsContext"};Li.defaultOptions={bezierSmoothness:.5};let Ni=Li;const Nf=8,ks=11920929e-14,Hf=1;function xl(r,e,t,s,i,n,a,o,l,h){const u=Math.min(.99,Math.max(0,h??Ni.defaultOptions.bezierSmoothness));let d=(Hf-u)/1;return d*=d,Wf(e,t,s,i,n,a,o,l,r,d),r}function Wf(r,e,t,s,i,n,a,o,l,h){li(r,e,t,s,i,n,a,o,l,h,0),l.push(a,o)}function li(r,e,t,s,i,n,a,o,l,h,c){if(c>Nf)return;const u=(r+t)/2,d=(e+s)/2,f=(t+i)/2,g=(s+n)/2,m=(i+a)/2,p=(n+o)/2,_=(u+f)/2,x=(d+g)/2,b=(f+m)/2,v=(g+p)/2,S=(_+b)/2,T=(x+v)/2;if(c>0){let w=a-r,I=o-e;const R=Math.abs((t-a)*I-(s-o)*w),P=Math.abs((i-a)*I-(n-o)*w);if(R>ks&&P>ks){if((R+P)*(R+P)<=h*(w*w+I*I)){l.push(S,T);return}}else if(R>ks){if(R*R<=h*(w*w+I*I)){l.push(S,T);return}}else if(P>ks){if(P*P<=h*(w*w+I*I)){l.push(S,T);return}}else if(w=S-(r+a)/2,I=T-(e+o)/2,w*w+I*I<=h){l.push(S,T);return}}li(r,e,u,d,_,x,S,T,l,h,c+1),li(S,T,b,v,m,p,a,o,l,h,c+1)}const Vf=8,zf=11920929e-14,Yf=1;function jf(r,e,t,s,i,n,a,o){const h=Math.min(.99,Math.max(0,o??Ni.defaultOptions.bezierSmoothness));let c=(Yf-h)/1;return c*=c,$f(e,t,s,i,n,a,r,c),r}function $f(r,e,t,s,i,n,a,o){hi(a,r,e,t,s,i,n,o,0),a.push(i,n)}function hi(r,e,t,s,i,n,a,o,l){if(l>Vf)return;const h=(e+s)/2,c=(t+i)/2,u=(s+n)/2,d=(i+a)/2,f=(h+u)/2,g=(c+d)/2;let m=n-e,p=a-t;const _=Math.abs((s-n)*p-(i-a)*m);if(_>zf){if(_*_<=o*(m*m+p*p)){r.push(f,g);return}}else if(m=f-(e+n)/2,p=g-(t+a)/2,m*m+p*p<=o){r.push(f,g);return}hi(r,e,t,h,c,f,g,o,l+1),hi(r,f,g,u,d,n,a,o,l+1)}function bl(r,e,t,s,i,n,a,o){let l=Math.abs(i-n);(!a&&i>n||a&&n>i)&&(l=2*Math.PI-l),o||(o=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(l/Math.PI)))),o=Math.max(o,3);let h=l/o,c=i;h*=a?-1:1;for(let u=0;u<o+1;u++){const d=Math.cos(c),f=Math.sin(c),g=e+d*s,m=t+f*s;r.push(g,m),c+=h}}function Xf(r,e,t,s,i,n){const a=r[r.length-2],l=r[r.length-1]-t,h=a-e,c=i-t,u=s-e,d=Math.abs(l*u-h*c);if(d<1e-8||n===0){(r[r.length-2]!==e||r[r.length-1]!==t)&&r.push(e,t);return}const f=l*l+h*h,g=c*c+u*u,m=l*c+h*u,p=n*Math.sqrt(f)/d,_=n*Math.sqrt(g)/d,x=p*m/f,b=_*m/g,v=p*u+_*h,S=p*c+_*l,T=h*(_+x),w=l*(_+x),I=u*(p+b),R=c*(p+b),P=Math.atan2(w-S,T-v),A=Math.atan2(R-S,I-v);bl(r,v+e,S+t,n,P,A,h*c>u*l)}const $t=Math.PI*2,Rr={centerX:0,centerY:0,ang1:0,ang2:0},Ir=({x:r,y:e},t,s,i,n,a,o,l)=>{r*=t,e*=s;const h=i*r-n*e,c=n*r+i*e;return l.x=h+a,l.y=c+o,l};function Kf(r,e){const t=e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),s=e===1.5707963267948966?.551915024494:t,i=Math.cos(r),n=Math.sin(r),a=Math.cos(r+e),o=Math.sin(r+e);return[{x:i-n*s,y:n+i*s},{x:a+o*s,y:o-a*s},{x:a,y:o}]}const pa=(r,e,t,s)=>{const i=r*s-e*t<0?-1:1;let n=r*t+e*s;return n>1&&(n=1),n<-1&&(n=-1),i*Math.acos(n)},qf=(r,e,t,s,i,n,a,o,l,h,c,u,d)=>{const f=Math.pow(i,2),g=Math.pow(n,2),m=Math.pow(c,2),p=Math.pow(u,2);let _=f*g-f*p-g*m;_<0&&(_=0),_/=f*p+g*m,_=Math.sqrt(_)*(a===o?-1:1);const x=_*i/n*u,b=_*-n/i*c,v=h*x-l*b+(r+t)/2,S=l*x+h*b+(e+s)/2,T=(c-x)/i,w=(u-b)/n,I=(-c-x)/i,R=(-u-b)/n,P=pa(1,0,T,w);let A=pa(T,w,I,R);o===0&&A>0&&(A-=$t),o===1&&A<0&&(A+=$t),d.centerX=v,d.centerY=S,d.ang1=P,d.ang2=A};function Zf(r,e,t,s,i,n,a,o=0,l=0,h=0){if(n===0||a===0)return;const c=Math.sin(o*$t/360),u=Math.cos(o*$t/360),d=u*(e-s)/2+c*(t-i)/2,f=-c*(e-s)/2+u*(t-i)/2;if(d===0&&f===0)return;n=Math.abs(n),a=Math.abs(a);const g=Math.pow(d,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(a,2);g>1&&(n*=Math.sqrt(g),a*=Math.sqrt(g)),qf(e,t,s,i,n,a,l,h,c,u,d,f,Rr);let{ang1:m,ang2:p}=Rr;const{centerX:_,centerY:x}=Rr;let b=Math.abs(p)/($t/4);Math.abs(1-b)<1e-7&&(b=1);const v=Math.max(Math.ceil(b),1);p/=v;let S=r[r.length-2],T=r[r.length-1];const w={x:0,y:0};for(let I=0;I<v;I++){const R=Kf(m,p),{x:P,y:A}=Ir(R[0],n,a,u,c,_,x,w),{x:z,y:D}=Ir(R[1],n,a,u,c,_,x,w),{x:se,y:qe}=Ir(R[2],n,a,u,c,_,x,w);xl(r,S,T,P,A,z,D,se,qe),S=se,T=qe,m+=p}}function Qf(r,e,t){const s=(a,o)=>{const l=o.x-a.x,h=o.y-a.y,c=Math.sqrt(l*l+h*h),u=l/c,d=h/c;return{len:c,nx:u,ny:d}},i=(a,o)=>{a===0?r.moveTo(o.x,o.y):r.lineTo(o.x,o.y)};let n=e[e.length-1];for(let a=0;a<e.length;a++){const o=e[a%e.length],l=o.radius??t;if(l<=0){i(a,o),n=o;continue}const h=e[(a+1)%e.length],c=s(o,n),u=s(o,h);if(c.len<1e-4||u.len<1e-4){i(a,o),n=o;continue}let d=Math.asin(c.nx*u.ny-c.ny*u.nx),f=1,g=!1;c.nx*u.nx-c.ny*-u.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,f=-1,g=!0):d>0&&(f=-1,g=!0);const m=d/2;let p,_=Math.abs(Math.cos(m)*l/Math.sin(m));_>Math.min(c.len/2,u.len/2)?(_=Math.min(c.len/2,u.len/2),p=Math.abs(_*Math.sin(m)/Math.cos(m))):p=l;const x=o.x+u.nx*_+-u.ny*p*f,b=o.y+u.ny*_+u.nx*p*f,v=Math.atan2(c.ny,c.nx)+Math.PI/2*f,S=Math.atan2(u.ny,u.nx)-Math.PI/2*f;a===0&&r.moveTo(x+Math.cos(v)*p,b+Math.sin(v)*p),r.arc(x,b,p,v,S,g),n=o}}function Jf(r,e,t,s){const i=(o,l)=>Math.sqrt((o.x-l.x)**2+(o.y-l.y)**2),n=(o,l,h)=>({x:o.x+(l.x-o.x)*h,y:o.y+(l.y-o.y)*h}),a=e.length;for(let o=0;o<a;o++){const l=e[(o+1)%a],h=l.radius??t;if(h<=0){o===0?r.moveTo(l.x,l.y):r.lineTo(l.x,l.y);continue}const c=e[o],u=e[(o+2)%a],d=i(c,l);let f;if(d<1e-4)f=l;else{const p=Math.min(d/2,h);f=n(l,c,p/d)}const g=i(u,l);let m;if(g<1e-4)m=l;else{const p=Math.min(g/2,h);m=n(l,u,p/g)}o===0?r.moveTo(f.x,f.y):r.lineTo(f.x,f.y),r.quadraticCurveTo(l.x,l.y,m.x,m.y,s)}}const eg=new W;class tg{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new ie,this._graphicsPath2D=e,this.signed=e.checkForHoles}moveTo(e,t){return this.startPoly(e,t),this}lineTo(e,t){this._ensurePoly();const s=this._currentPoly.points,i=s[s.length-2],n=s[s.length-1];return(i!==e||n!==t)&&s.push(e,t),this}arc(e,t,s,i,n,a){this._ensurePoly(!1);const o=this._currentPoly.points;return bl(o,e,t,s,i,n,a),this}arcTo(e,t,s,i,n){this._ensurePoly();const a=this._currentPoly.points;return Xf(a,e,t,s,i,n),this}arcToSvg(e,t,s,i,n,a,o){const l=this._currentPoly.points;return Zf(l,this._currentPoly.lastX,this._currentPoly.lastY,a,o,e,t,s,i,n),this}bezierCurveTo(e,t,s,i,n,a,o){this._ensurePoly();const l=this._currentPoly;return xl(this._currentPoly.points,l.lastX,l.lastY,e,t,s,i,n,a,o),this}quadraticCurveTo(e,t,s,i,n){this._ensurePoly();const a=this._currentPoly;return jf(this._currentPoly.points,a.lastX,a.lastY,e,t,s,i,n),this}closePath(){return this.endPoly(!0),this}addPath(e,t){this.endPoly(),t&&!t.isIdentity()&&(e=e.clone(!0),e.transform(t));const s=this.shapePrimitives,i=s.length;for(let n=0;n<e.instructions.length;n++){const a=e.instructions[n];this[a.action](...a.data)}if(e.checkForHoles&&s.length-i>1){let n=null;for(let a=i;a<s.length;a++){const o=s[a];if(o.shape.type==="polygon"){const l=o.shape,h=n==null?void 0:n.shape;h&&h.containsPolygon(l)?(n.holes||(n.holes=[]),n.holes.push(o),s.copyWithin(a,a+1),s.length--,a--):n=o}}}return this}finish(e=!1){this.endPoly(e)}rect(e,t,s,i,n){return this.drawShape(new W(e,t,s,i),n),this}circle(e,t,s,i){return this.drawShape(new Ci(e,t,s),i),this}poly(e,t,s){const i=new jt(e);return i.closePath=t,this.drawShape(i,s),this}regularPoly(e,t,s,i,n=0,a){i=Math.max(i|0,3);const o=-1*Math.PI/2+n,l=Math.PI*2/i,h=[];for(let c=0;c<i;c++){const u=o-c*l;h.push(e+s*Math.cos(u),t+s*Math.sin(u))}return this.poly(h,!0,a),this}roundPoly(e,t,s,i,n,a=0,o){if(i=Math.max(i|0,3),n<=0)return this.regularPoly(e,t,s,i,a);const l=s*Math.sin(Math.PI/i)-.001;n=Math.min(n,l);const h=-1*Math.PI/2+a,c=Math.PI*2/i,u=(i-2)*Math.PI/i/2;for(let d=0;d<i;d++){const f=d*c+h,g=e+s*Math.cos(f),m=t+s*Math.sin(f),p=f+Math.PI+u,_=f-Math.PI-u,x=g+n*Math.cos(p),b=m+n*Math.sin(p),v=g+n*Math.cos(_),S=m+n*Math.sin(_);d===0?this.moveTo(x,b):this.lineTo(x,b),this.quadraticCurveTo(g,m,v,S,o)}return this.closePath()}roundShape(e,t,s=!1,i){return e.length<3?this:(s?Jf(this,e,t,i):Qf(this,e,t),this.closePath())}filletRect(e,t,s,i,n){if(n===0)return this.rect(e,t,s,i);const a=Math.min(s,i)/2,o=Math.min(a,Math.max(-a,n)),l=e+s,h=t+i,c=o<0?-o:0,u=Math.abs(o);return this.moveTo(e,t+u).arcTo(e+c,t+c,e+u,t,u).lineTo(l-u,t).arcTo(l-c,t+c,l,t+u,u).lineTo(l,h-u).arcTo(l-c,h-c,e+s-u,h,u).lineTo(e+u,h).arcTo(e+c,h-c,e,h-u,u).closePath()}chamferRect(e,t,s,i,n,a){if(n<=0)return this.rect(e,t,s,i);const o=Math.min(n,Math.min(s,i)/2),l=e+s,h=t+i,c=[e+o,t,l-o,t,l,t+o,l,h-o,l-o,h,e+o,h,e,h-o,e,t+o];for(let u=c.length-1;u>=2;u-=2)c[u]===c[u-2]&&c[u-1]===c[u-3]&&c.splice(u-1,2);return this.poly(c,!0,a)}ellipse(e,t,s,i,n){return this.drawShape(new Ei(e,t,s,i),n),this}roundRect(e,t,s,i,n,a){return this.drawShape(new Mi(e,t,s,i,n),a),this}drawShape(e,t){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:t}),this}startPoly(e,t){let s=this._currentPoly;return s&&this.endPoly(),s=new jt,s.points.push(e,t),this._currentPoly=s,this}endPoly(e=!1){const t=this._currentPoly;return t&&t.points.length>2&&(t.closePath=e,this.shapePrimitives.push({shape:t})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new jt,e)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let s=t.shape.x,i=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const n=t.transform,a=s;s=n.a*s+n.c*i+n.tx,i=n.b*a+n.d*i+n.ty}this._currentPoly.points.push(s,i)}else this._currentPoly.points.push(0,0)}}buildPath(){const e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let t=0;t<e.instructions.length;t++){const s=e.instructions[t];this[s.action](...s.data)}this.finish()}get bounds(){const e=this._bounds;e.clear();const t=this.shapePrimitives;for(let s=0;s<t.length;s++){const i=t[s],n=i.shape.getBounds(eg);i.transform?e.addRect(n,i.transform):e.addRect(n)}return e}}class St{constructor(e,t=!1){this.instructions=[],this.uid=X("graphicsPath"),this._dirty=!0,this.checkForHoles=t,typeof e=="string"?Dd(e,this):this.instructions=(e==null?void 0:e.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new tg(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,t){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,t]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,t,s,i,n){const a=this.instructions[this.instructions.length-1],o=this.getLastPoint(Y.shared);let l=0,h=0;if(!a||a.action!=="bezierCurveTo")l=o.x,h=o.y;else{l=a.data[2],h=a.data[3];const c=o.x,u=o.y;l=c+(c-l),h=u+(u-h)}return this.instructions.push({action:"bezierCurveTo",data:[l,h,e,t,s,i,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,t,s){const i=this.instructions[this.instructions.length-1],n=this.getLastPoint(Y.shared);let a=0,o=0;if(!i||i.action!=="quadraticCurveTo")a=n.x,o=n.y;else{a=i.data[0],o=i.data[1];const l=n.x,h=n.y;a=l+(l-a),o=h+(h-o)}return this.instructions.push({action:"quadraticCurveTo",data:[a,o,e,t,s]}),this._dirty=!0,this}rect(e,t,s,i,n){return this.instructions.push({action:"rect",data:[e,t,s,i,n]}),this._dirty=!0,this}circle(e,t,s,i){return this.instructions.push({action:"circle",data:[e,t,s,i]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,t,s,i,n,a,o){n||(n=i/2);const l=-1*Math.PI/2+a,h=s*2,c=Math.PI*2/h,u=[];for(let d=0;d<h;d++){const f=d%2?n:i,g=d*c+l;u.push(e+f*Math.cos(g),t+f*Math.sin(g))}return this.poly(u,!0,o),this}clone(e=!1){const t=new St;if(t.checkForHoles=this.checkForHoles,!e)t.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const i=this.instructions[s];t.instructions.push({action:i.action,data:i.data.slice()})}return t}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;const t=e.a,s=e.b,i=e.c,n=e.d,a=e.tx,o=e.ty;let l=0,h=0,c=0,u=0,d=0,f=0,g=0,m=0;for(let p=0;p<this.instructions.length;p++){const _=this.instructions[p],x=_.data;switch(_.action){case"moveTo":case"lineTo":l=x[0],h=x[1],x[0]=t*l+i*h+a,x[1]=s*l+n*h+o;break;case"bezierCurveTo":c=x[0],u=x[1],d=x[2],f=x[3],l=x[4],h=x[5],x[0]=t*c+i*u+a,x[1]=s*c+n*u+o,x[2]=t*d+i*f+a,x[3]=s*d+n*f+o,x[4]=t*l+i*h+a,x[5]=s*l+n*h+o;break;case"quadraticCurveTo":c=x[0],u=x[1],l=x[2],h=x[3],x[0]=t*c+i*u+a,x[1]=s*c+n*u+o,x[2]=t*l+i*h+a,x[3]=s*l+n*h+o;break;case"arcToSvg":l=x[5],h=x[6],g=x[0],m=x[1],x[0]=t*g+i*m,x[1]=s*g+n*m,x[5]=t*l+i*h+a,x[6]=s*l+n*h+o;break;case"circle":x[4]=Ut(x[3],e);break;case"rect":x[4]=Ut(x[4],e);break;case"ellipse":x[8]=Ut(x[8],e);break;case"roundRect":x[5]=Ut(x[5],e);break;case"addPath":x[0].transform(e);break;case"poly":x[2]=Ut(x[2],e);break;default:B("unknown transform action",_.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let t=this.instructions.length-1,s=this.instructions[t];if(!s)return e.x=0,e.y=0,e;for(;s.action==="closePath";){if(t--,t<0)return e.x=0,e.y=0,e;s=this.instructions[t]}switch(s.action){case"moveTo":case"lineTo":e.x=s.data[0],e.y=s.data[1];break;case"quadraticCurveTo":e.x=s.data[2],e.y=s.data[3];break;case"bezierCurveTo":e.x=s.data[4],e.y=s.data[5];break;case"arc":case"arcToSvg":e.x=s.data[5],e.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(e);break}return e}}function Ut(r,e){return r?r.prepend(e):e.clone()}function Z(r,e,t){const s=r.getAttribute(e);return s?Number(s):t}function sg(r,e){const t=r.querySelectorAll("defs");for(let s=0;s<t.length;s++){const i=t[s];for(let n=0;n<i.children.length;n++){const a=i.children[n];switch(a.nodeName.toLowerCase()){case"lineargradient":e.defs[a.id]=rg(a);break;case"radialgradient":e.defs[a.id]=ig();break}}}}function rg(r){const e=Z(r,"x1",0),t=Z(r,"y1",0),s=Z(r,"x2",1),i=Z(r,"y2",0),n=r.getAttribute("gradientUnits")||"objectBoundingBox",a=new Oe(e,t,s,i,n==="objectBoundingBox"?"local":"global");for(let o=0;o<r.children.length;o++){const l=r.children[o],h=Z(l,"offset",0),c=V.shared.setValue(l.getAttribute("stop-color")).toNumber();a.addColorStop(h,c)}return a}function ig(r){return B("[SVG Parser] Radial gradients are not yet supported"),new Oe(0,0,1,0)}function ma(r){const e=r.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const _a={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function vl(r,e){const t=r.getAttribute("style"),s={},i={},n={strokeStyle:s,fillStyle:i,useFill:!1,useStroke:!1};for(const a in _a){const o=r.getAttribute(a);o&&ya(e,n,a,o.trim())}if(t){const a=t.split(";");for(let o=0;o<a.length;o++){const l=a[o].trim(),[h,c]=l.split(":");_a[h]&&ya(e,n,h,c.trim())}}return{strokeStyle:n.useStroke?s:null,fillStyle:n.useFill?i:null,useFill:n.useFill,useStroke:n.useStroke}}function ya(r,e,t,s){switch(t){case"stroke":if(s!=="none"){if(s.startsWith("url(")){const i=ma(s);e.strokeStyle.fill=r.defs[i]}else e.strokeStyle.color=V.shared.setValue(s).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(s);break;case"fill":if(s!=="none"){if(s.startsWith("url(")){const i=ma(s);e.fillStyle.fill=r.defs[i]}else e.fillStyle.color=V.shared.setValue(s).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(s);break;case"stroke-opacity":e.strokeStyle.alpha=Number(s);break;case"opacity":e.fillStyle.alpha=Number(s),e.strokeStyle.alpha=Number(s);break}}function ng(r,e){if(typeof r=="string"){const a=document.createElement("div");a.innerHTML=r.trim(),r=a.querySelector("svg")}const t={context:e,defs:{},path:new St};sg(r,t);const s=r.children,{fillStyle:i,strokeStyle:n}=vl(r,t);for(let a=0;a<s.length;a++){const o=s[a];o.nodeName.toLowerCase()!=="defs"&&wl(o,t,i,n)}return e}function wl(r,e,t,s){const i=r.children,{fillStyle:n,strokeStyle:a}=vl(r,e);n&&t?t={...t,...n}:n&&(t=n),a&&s?s={...s,...a}:a&&(s=a);const o=!t&&!s;o&&(t={color:0});let l,h,c,u,d,f,g,m,p,_,x,b,v,S,T,w,I;switch(r.nodeName.toLowerCase()){case"path":S=r.getAttribute("d"),r.getAttribute("fill-rule")==="evenodd"&&B("SVG Evenodd fill rule not supported, your svg may render incorrectly"),T=new St(S,!0),e.context.path(T),t&&e.context.fill(t),s&&e.context.stroke(s);break;case"circle":g=Z(r,"cx",0),m=Z(r,"cy",0),p=Z(r,"r",0),e.context.ellipse(g,m,p,p),t&&e.context.fill(t),s&&e.context.stroke(s);break;case"rect":l=Z(r,"x",0),h=Z(r,"y",0),w=Z(r,"width",0),I=Z(r,"height",0),_=Z(r,"rx",0),x=Z(r,"ry",0),_||x?e.context.roundRect(l,h,w,I,_||x):e.context.rect(l,h,w,I),t&&e.context.fill(t),s&&e.context.stroke(s);break;case"ellipse":g=Z(r,"cx",0),m=Z(r,"cy",0),_=Z(r,"rx",0),x=Z(r,"ry",0),e.context.beginPath(),e.context.ellipse(g,m,_,x),t&&e.context.fill(t),s&&e.context.stroke(s);break;case"line":c=Z(r,"x1",0),u=Z(r,"y1",0),d=Z(r,"x2",0),f=Z(r,"y2",0),e.context.beginPath(),e.context.moveTo(c,u),e.context.lineTo(d,f),s&&e.context.stroke(s);break;case"polygon":v=r.getAttribute("points"),b=v.match(/\d+/g).map(R=>parseInt(R,10)),e.context.poly(b,!0),t&&e.context.fill(t),s&&e.context.stroke(s);break;case"polyline":v=r.getAttribute("points"),b=v.match(/\d+/g).map(R=>parseInt(R,10)),e.context.poly(b,!1),s&&e.context.stroke(s);break;case"g":case"svg":break;default:{B(`[SVG parser] <${r.nodeName}> elements unsupported`);break}}o&&(t=null);for(let R=0;R<i.length;R++)wl(i[R],e,t,s)}function ag(r){return V.isColorLike(r)}function xa(r){return r instanceof Qs}function ba(r){return r instanceof Oe}function og(r){return r instanceof k}function lg(r,e,t){const s=V.shared.setValue(e??0);return r.color=s.toNumber(),r.alpha=s.alpha===1?t.alpha:s.alpha,r.texture=k.WHITE,{...t,...r}}function hg(r,e,t){return r.texture=e,{...t,...r}}function va(r,e,t){return r.fill=e,r.color=16777215,r.texture=e.texture,r.matrix=e.transform,{...t,...r}}function wa(r,e,t){return e.buildGradient(),r.fill=e,r.color=16777215,r.texture=e.texture,r.matrix=e.transform,r.textureSpace=e.textureSpace,{...t,...r}}function cg(r,e){const t={...e,...r},s=V.shared.setValue(t.color);return t.alpha*=s.alpha,t.color=s.toNumber(),t}function ot(r,e){if(r==null)return null;const t={},s=r;return ag(r)?lg(t,r,e):og(r)?hg(t,r,e):xa(r)?va(t,r,e):ba(r)?wa(t,r,e):s.fill&&xa(s.fill)?va(s,s.fill,e):s.fill&&ba(s.fill)?wa(s,s.fill,e):cg(s,e)}function js(r,e){const{width:t,alignment:s,miterLimit:i,cap:n,join:a,pixelLine:o,...l}=e,h=ot(r,l);return h?{width:t,alignment:s,miterLimit:i,cap:n,join:a,pixelLine:o,...h}:null}const ug=new Y,Ta=new E,Hi=class ke extends ge{constructor(){super(...arguments),this.uid=X("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new St,this._transform=new E,this._fillStyle={...ke.defaultFillStyle},this._strokeStyle={...ke.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new ie,this._boundsDirty=!0}clone(){const e=new ke;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=ot(e,ke.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=js(e,ke.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=ot(e,ke.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=ot(e,ke.defaultStrokeStyle),this}texture(e,t,s,i,n,a){return this.instructions.push({action:"texture",data:{image:e,dx:s||0,dy:i||0,dw:n||e.frame.width,dh:a||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:t?V.shared.setValue(t).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new St,this}fill(e,t){let s;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i&&i.action==="stroke"?s=i.data.path:s=this._activePath.clone(),s?(e!=null&&(t!==void 0&&typeof e=="number"&&(U(H,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:t}),this._fillStyle=ot(e,ke.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:e,y:t}=this._activePath.getLastPoint(Y.shared);this._activePath.clear(),this._activePath.moveTo(e,t)}stroke(e){let t;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s&&s.action==="fill"?t=s.data.path:t=this._activePath.clone(),t?(e!=null&&(this._strokeStyle=js(e,ke.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:t}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let e=0;e<2;e++){const t=this.instructions[this.instructions.length-1-e],s=this._activePath.clone();if(t&&(t.action==="stroke"||t.action==="fill"))if(t.data.hole)t.data.hole.addPath(s);else{t.data.hole=s;break}}return this._initNextPathLocation(),this}arc(e,t,s,i,n,a){this._tick++;const o=this._transform;return this._activePath.arc(o.a*e+o.c*t+o.tx,o.b*e+o.d*t+o.ty,s,i,n,a),this}arcTo(e,t,s,i,n){this._tick++;const a=this._transform;return this._activePath.arcTo(a.a*e+a.c*t+a.tx,a.b*e+a.d*t+a.ty,a.a*s+a.c*i+a.tx,a.b*s+a.d*i+a.ty,n),this}arcToSvg(e,t,s,i,n,a,o){this._tick++;const l=this._transform;return this._activePath.arcToSvg(e,t,s,i,n,l.a*a+l.c*o+l.tx,l.b*a+l.d*o+l.ty),this}bezierCurveTo(e,t,s,i,n,a,o){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*e+l.c*t+l.tx,l.b*e+l.d*t+l.ty,l.a*s+l.c*i+l.tx,l.b*s+l.d*i+l.ty,l.a*n+l.c*a+l.tx,l.b*n+l.d*a+l.ty,o),this}closePath(){var e;return this._tick++,(e=this._activePath)==null||e.closePath(),this}ellipse(e,t,s,i){return this._tick++,this._activePath.ellipse(e,t,s,i,this._transform.clone()),this}circle(e,t,s){return this._tick++,this._activePath.circle(e,t,s,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,t){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*e+s.c*t+s.tx,s.b*e+s.d*t+s.ty),this}moveTo(e,t){this._tick++;const s=this._transform,i=this._activePath.instructions,n=s.a*e+s.c*t+s.tx,a=s.b*e+s.d*t+s.ty;return i.length===1&&i[0].action==="moveTo"?(i[0].data[0]=n,i[0].data[1]=a,this):(this._activePath.moveTo(n,a),this)}quadraticCurveTo(e,t,s,i,n){this._tick++;const a=this._transform;return this._activePath.quadraticCurveTo(a.a*e+a.c*t+a.tx,a.b*e+a.d*t+a.ty,a.a*s+a.c*i+a.tx,a.b*s+a.d*i+a.ty,n),this}rect(e,t,s,i){return this._tick++,this._activePath.rect(e,t,s,i,this._transform.clone()),this}roundRect(e,t,s,i,n){return this._tick++,this._activePath.roundRect(e,t,s,i,n,this._transform.clone()),this}poly(e,t){return this._tick++,this._activePath.poly(e,t,this._transform.clone()),this}regularPoly(e,t,s,i,n=0,a){return this._tick++,this._activePath.regularPoly(e,t,s,i,n,a),this}roundPoly(e,t,s,i,n,a){return this._tick++,this._activePath.roundPoly(e,t,s,i,n,a),this}roundShape(e,t,s,i){return this._tick++,this._activePath.roundShape(e,t,s,i),this}filletRect(e,t,s,i,n){return this._tick++,this._activePath.filletRect(e,t,s,i,n),this}chamferRect(e,t,s,i,n,a){return this._tick++,this._activePath.chamferRect(e,t,s,i,n,a),this}star(e,t,s,i,n=0,a=0){return this._tick++,this._activePath.star(e,t,s,i,n,a,this._transform.clone()),this}svg(e){return this._tick++,ng(e,this),this}restore(){const e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,t=e){return this._transform.scale(e,t),this}setTransform(e,t,s,i,n,a){return e instanceof E?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,t,s,i,n,a),this)}transform(e,t,s,i,n,a){return e instanceof E?(this._transform.append(e),this):(Ta.set(e,t,s,i,n,a),this._transform.append(Ta),this)}translate(e,t=e){return this._transform.translate(e,t),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const e=this._bounds;e.clear();for(let t=0;t<this.instructions.length;t++){const s=this.instructions[t],i=s.action;if(i==="fill"){const n=s.data;e.addBounds(n.path.bounds)}else if(i==="texture"){const n=s.data;e.addFrame(n.dx,n.dy,n.dx+n.dw,n.dy+n.dh,n.transform)}if(i==="stroke"){const n=s.data,a=n.style.alignment,o=n.style.width*(1-a),l=n.path.bounds;e.addFrame(l.minX-o,l.minY-o,l.maxX+o,l.maxY+o)}}return e}containsPoint(e){var i;if(!this.bounds.containsPoint(e.x,e.y))return!1;const t=this.instructions;let s=!1;for(let n=0;n<t.length;n++){const a=t[n],o=a.data,l=o.path;if(!a.action||!l)continue;const h=o.style,c=l.shapePath.shapePrimitives;for(let u=0;u<c.length;u++){const d=c[u].shape;if(!h||!d)continue;const f=c[u].transform,g=f?f.applyInverse(e,ug):e;if(a.action==="fill")s=d.contains(g.x,g.y);else{const p=h;s=d.strokeContains(g.x,g.y,p.width,p.alignment)}const m=o.hole;if(m){const p=(i=m.shapePath)==null?void 0:i.shapePrimitives;if(p)for(let _=0;_<p.length;_++)p[_].shape.contains(g.x,g.y)&&(s=!1)}if(s)return!0}}return s}destroy(e=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof e=="boolean"?e:e==null?void 0:e.texture){const s=typeof e=="boolean"?e:e==null?void 0:e.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(s),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(s)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Hi.defaultFillStyle={color:16777215,alpha:1,texture:k.WHITE,matrix:null,fill:null,textureSpace:"local"};Hi.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:k.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let _e=Hi;const Sa=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function dg(r){const e=[];let t=0;for(let s=0;s<Sa.length;s++){const i=`_${Sa[s]}`;e[t++]=r[i]}return t=Tl(r._fill,e,t),t=gg(r._stroke,e,t),t=pg(r.dropShadow,e,t),t=fg(r.filters,e,t),e.join("-")}function fg(r,e,t){if(!r)return t;for(const s of r)e[t++]=s.uid;return t}function Tl(r,e,t){var s;return r&&(e[t++]=r.color,e[t++]=r.alpha,e[t++]=(s=r.fill)==null?void 0:s.styleKey),t}function gg(r,e,t){return r&&(t=Tl(r,e,t),e[t++]=r.width,e[t++]=r.alignment,e[t++]=r.cap,e[t++]=r.join,e[t++]=r.miterLimit),t}function pg(r,e,t){return r&&(e[t++]=r.alpha,e[t++]=r.angle,e[t++]=r.blur,e[t++]=r.distance,e[t++]=V.shared.setValue(r.color).toNumber()),t}const Wi=class _t extends ge{constructor(e={}){super(),mg(e);const t={..._t.defaultTextStyle,...e};for(const s in t){const i=s;this[i]=t[s]}this.update()}get align(){return this._align}set align(e){this._align=e,this.update()}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords=e,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){e!==null&&typeof e=="object"?this._dropShadow=this._createProxy({..._t.defaultDropShadow,...e}):this._dropShadow=e?this._createProxy({..._t.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily=e,this.update()}get fontSize(){return this._fontSize}set fontSize(e){typeof e=="string"?this._fontSize=parseInt(e,10):this._fontSize=e,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle=e.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant=e,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e,this.update()}get leading(){return this._leading}set leading(e){this._leading=e,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing=e,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight=e,this.update()}get padding(){return this._padding}set padding(e){this._padding=e,this.update()}get filters(){return this._filters}set filters(e){this._filters=e,this.update()}get trim(){return this._trim}set trim(e){this._trim=e,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace=e,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap=e,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth=e,this.update()}get fill(){return this._originalFill}set fill(e){e!==this._originalFill&&(this._originalFill=e,this._isFillStyle(e)&&(this._originalFill=this._createProxy({..._e.defaultFillStyle,...e},()=>{this._fill=ot({...this._originalFill},_e.defaultFillStyle)})),this._fill=ot(e===0?"black":e,_e.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(e){e!==this._originalStroke&&(this._originalStroke=e,this._isFillStyle(e)&&(this._originalStroke=this._createProxy({..._e.defaultStrokeStyle,...e},()=>{this._stroke=js({...this._originalStroke},_e.defaultStrokeStyle)})),this._stroke=js(e,_e.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=dg(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=_t.defaultTextStyle;for(const t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new _t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let e=0;if(this._filters)for(let t=0;t<this._filters.length;t++)e+=this._filters[t].padding;return Math.max(this._padding,e)}destroy(e=!1){var s,i,n,a;if(this.removeAllListeners(),typeof e=="boolean"?e:e==null?void 0:e.texture){const o=typeof e=="boolean"?e:e==null?void 0:e.textureSource;(s=this._fill)!=null&&s.texture&&this._fill.texture.destroy(o),(i=this._originalFill)!=null&&i.texture&&this._originalFill.texture.destroy(o),(n=this._stroke)!=null&&n.texture&&this._stroke.texture.destroy(o),(a=this._originalStroke)!=null&&a.texture&&this._originalStroke.texture.destroy(o)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(e,t){return new Proxy(e,{set:(s,i,n)=>(s[i]=n,t==null||t(i,n),this.update(),!0)})}_isFillStyle(e){return(e??null)!==null&&!(V.isColorLike(e)||e instanceof Oe||e instanceof Qs)}};Wi.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};Wi.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Le=Wi;function mg(r){const e=r;if(typeof e.dropShadow=="boolean"&&e.dropShadow){const t=Le.defaultDropShadow;r.dropShadow={alpha:e.dropShadowAlpha??t.alpha,angle:e.dropShadowAngle??t.angle,blur:e.dropShadowBlur??t.blur,color:e.dropShadowColor??t.color,distance:e.dropShadowDistance??t.distance}}if(e.strokeThickness!==void 0){U(H,"strokeThickness is now a part of stroke");const t=e.stroke;let s={};if(V.isColorLike(t))s.color=t;else if(t instanceof Oe||t instanceof Qs)s.fill=t;else if(Object.hasOwnProperty.call(t,"color")||Object.hasOwnProperty.call(t,"fill"))s=t;else throw new Error("Invalid stroke value.");r.stroke={...s,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){U(H,"gradient fill is now a fill pattern: `new FillGradient(...)`");let t;r.fontSize==null?r.fontSize=Le.defaultTextStyle.fontSize:typeof r.fontSize=="string"?t=parseInt(r.fontSize,10):t=r.fontSize;const s=new Oe({start:{x:0,y:0},end:{x:0,y:(t||0)*1.7}}),i=e.fillGradientStops.map(n=>V.shared.setValue(n).toNumber());i.forEach((n,a)=>{const o=a/(i.length-1);s.addColorStop(o,n)}),r.fill={fill:s}}}class _g{constructor(e){this._canvasPool=Object.create(null),this.canvasOptions=e||{},this.enableFullScreen=!1}_createCanvasAndContext(e,t){const s=O.get().createCanvas();s.width=e,s.height=t;const i=s.getContext("2d");return{canvas:s,context:i}}getOptimalCanvasAndContext(e,t,s=1){e=Math.ceil(e*s-1e-6),t=Math.ceil(t*s-1e-6),e=vt(e),t=vt(t);const i=(e<<17)+(t<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let n=this._canvasPool[i].pop();return n||(n=this._createCanvasAndContext(e,t)),n}returnCanvasAndContext(e){const t=e.canvas,{width:s,height:i}=t,n=(s<<17)+(i<<1);e.context.clearRect(0,0,s,i),this._canvasPool[n].push(e)}clear(){this._canvasPool={}}}const $e=new _g,Aa=1e5;function $s(r,e,t,s=0){if(r.texture===k.WHITE&&!r.fill)return V.shared.setValue(r.color).setAlpha(r.alpha??1).toHexa();if(r.fill){if(r.fill instanceof Qs){const i=r.fill,n=e.createPattern(i.texture.source.resource,"repeat"),a=i.transform.copyTo(E.shared);return a.scale(i.texture.frame.width,i.texture.frame.height),n.setTransform(a),n}else if(r.fill instanceof Oe){const i=r.fill,n=i.type==="linear",a=i.textureSpace==="local";let o=1,l=1;a&&t&&(o=t.width+s,l=t.height+s);let h,c=!1;if(n){const{start:u,end:d}=i;h=e.createLinearGradient(u.x*o,u.y*l,d.x*o,d.y*l),c=Math.abs(d.x-u.x)<Math.abs((d.y-u.y)*.1)}else{const{center:u,innerRadius:d,outerCenter:f,outerRadius:g}=i;h=e.createRadialGradient(u.x*o,u.y*l,d*o,f.x*o,f.y*l,g*o)}if(c&&a&&t){const u=t.lineHeight/l;for(let d=0;d<t.lines.length;d++){const f=(d*t.lineHeight+s/2)/l;i.colorStops.forEach(g=>{const m=f+g.offset*u;h.addColorStop(Math.floor(m*Aa)/Aa,V.shared.setValue(g.color).toHex())})}}else i.colorStops.forEach(u=>{h.addColorStop(u.offset,V.shared.setValue(u.color).toHex())});return h}}else{const i=e.createPattern(r.texture.source.resource,"repeat"),n=r.matrix.copyTo(E.shared);return n.scale(r.texture.frame.width,r.texture.frame.height),i.setTransform(n),i}return B("FillStyle not recognised",r),"red"}const Sl=class Al extends nl{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const t={...Al.defaultOptions,...e};this._textureSize=t.textureSize,this._mipmap=t.mipmap;const s=t.style.clone();t.overrideFill&&(s._fill.color=16777215,s._fill.alpha=1,s._fill.texture=k.WHITE,s._fill.fill=null),this.applyFillAsTint=t.overrideFill;const i=s.fontSize;s.fontSize=this.baseMeasurementFontSize;const n=Ys(s);t.overrideSize?s._stroke&&(s._stroke.width*=this.baseRenderedFontSize/i):s.fontSize=this.baseRenderedFontSize=i,this._style=s,this._skipKerning=t.skipKerning??!1,this.resolution=t.resolution??1,this._padding=t.padding??4,t.textureStyle&&(this._textureStyle=t.textureStyle instanceof De?t.textureStyle:new De(t.textureStyle)),this.fontMetrics=Te.measureFont(n),this.lineHeight=s.lineHeight||this.fontMetrics.fontSize||s.fontSize}ensureCharacters(e){var p,_;const t=Te.graphemeSegmenter(e).filter(x=>!this._currentChars.includes(x)).filter((x,b,v)=>v.indexOf(x)===b);if(!t.length)return;this._currentChars=[...this._currentChars,...t];let s;this._currentPageIndex===-1?s=this._nextPage():s=this.pages[this._currentPageIndex];let{canvas:i,context:n}=s.canvasAndContext,a=s.texture.source;const o=this._style;let l=this._currentX,h=this._currentY,c=this._currentMaxCharHeight;const u=this.baseRenderedFontSize/this.baseMeasurementFontSize,d=this._padding*u;let f=!1;const g=i.width/this.resolution,m=i.height/this.resolution;for(let x=0;x<t.length;x++){const b=t[x],v=Te.measureText(b,o,i,!1);v.lineHeight=v.height;const S=v.width*u,T=Math.ceil((o.fontStyle==="italic"?2:1)*S),w=v.height*u,I=T+d*2,R=w+d*2;if(f=!1,b!==`
`&&b!=="\r"&&b!=="	"&&b!==" "&&(f=!0,c=Math.ceil(Math.max(R,c))),l+I>g&&(h+=c,c=R,l=0,h+c>m)){a.update();const A=this._nextPage();i=A.canvasAndContext.canvas,n=A.canvasAndContext.context,a=A.texture.source,l=0,h=0,c=0}const P=S/u-(((p=o.dropShadow)==null?void 0:p.distance)??0)-(((_=o._stroke)==null?void 0:_.width)??0);if(this.chars[b]={id:b.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:P,kerning:{}},f){this._drawGlyph(n,v,l+d,h+d,u,o);const A=a.width*u,z=a.height*u,D=new W(l/A*a.width,h/z*a.height,I/A*a.width,R/z*a.height);this.chars[b].texture=new k({source:a,frame:D}),l+=Math.ceil(I)}}a.update(),this._currentX=l,this._currentY=h,this._currentMaxCharHeight=c,this._skipKerning&&this._applyKerning(t,n)}get pageTextures(){return U(H,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(e,t){const s=this._measureCache;for(let i=0;i<e.length;i++){const n=e[i];for(let a=0;a<this._currentChars.length;a++){const o=this._currentChars[a];let l=s[n];l||(l=s[n]=t.measureText(n).width);let h=s[o];h||(h=s[o]=t.measureText(o).width);let c=t.measureText(n+o).width,u=c-(l+h);u&&(this.chars[n].kerning[o]=u),c=t.measureText(n+o).width,u=c-(l+h),u&&(this.chars[o].kerning[n]=u)}}}_nextPage(){this._currentPageIndex++;const e=this.resolution,t=$e.getOptimalCanvasAndContext(this._textureSize,this._textureSize,e);this._setupContext(t.context,this._style,e);const s=e*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new k({source:new ct({resource:t.canvas,resolution:s,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(i.source.style=this._textureStyle);const n={canvasAndContext:t,texture:i};return this.pages[this._currentPageIndex]=n,n}_setupContext(e,t,s){t.fontSize=this.baseRenderedFontSize,e.scale(s,s),e.font=Ys(t),t.fontSize=this.baseMeasurementFontSize,e.textBaseline=t.textBaseline;const i=t._stroke,n=(i==null?void 0:i.width)??0;if(i&&(e.lineWidth=n,e.lineJoin=i.join,e.miterLimit=i.miterLimit,e.strokeStyle=$s(i,e)),t._fill&&(e.fillStyle=$s(t._fill,e)),t.dropShadow){const a=t.dropShadow,o=V.shared.setValue(a.color).toArray(),l=a.blur*s,h=a.distance*s;e.shadowColor=`rgba(${o[0]*255},${o[1]*255},${o[2]*255},${a.alpha})`,e.shadowBlur=l,e.shadowOffsetX=Math.cos(a.angle)*h,e.shadowOffsetY=Math.sin(a.angle)*h}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}_drawGlyph(e,t,s,i,n,a){const o=t.text,l=t.fontProperties,h=a._stroke,c=((h==null?void 0:h.width)??0)*n,u=s+c/2,d=i-c/2,f=l.descent*n,g=t.lineHeight*n;a.stroke&&c&&e.strokeText(o,u,d+g-f),a._fill&&e.fillText(o,u,d+g-f)}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{canvasAndContext:t,texture:s}=this.pages[e];$e.returnCanvasAndContext(t),s.destroy(!0)}this.pages=null}};Sl.defaultOptions={textureSize:512,style:new Le,mipmap:!0};let Pa=Sl;function Pl(r,e,t,s){const i={width:0,height:0,offsetY:0,scale:e.fontSize/t.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};i.offsetY=t.baseLineOffset;let n=i.lines[0],a=null,o=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},h=g=>{const m=n.width;for(let p=0;p<l.index;p++){const _=g.positions[p];n.chars.push(g.chars[p]),n.charPositions.push(_+m)}n.width+=g.width,o=!1,l.width=0,l.index=0,l.chars.length=0},c=()=>{let g=n.chars.length-1;if(s){let m=n.chars[g];for(;m===" ";)n.width-=t.chars[m].xAdvance,m=n.chars[--g]}i.width=Math.max(i.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,i.lines.push(n),i.height+=t.lineHeight},u=t.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*u,f=e.wordWrapWidth*u;for(let g=0;g<r.length+1;g++){let m;const p=g===r.length;p||(m=r[g]);const _=t.chars[m]||t.chars[" "];if(/(?:\s)/.test(m)||m==="\r"||m===`
`||p){if(!o&&e.wordWrap&&n.width+l.width-d>f?(c(),h(l),p||n.charPositions.push(0)):(l.start=n.width,h(l),p||n.charPositions.push(0)),m==="\r"||m===`
`)n.width!==0&&c();else if(!p){const S=_.xAdvance+(_.kerning[a]||0)+d;n.width+=S,n.spaceWidth=S,n.spacesIndex.push(n.charPositions.length),n.chars.push(m)}}else{const v=_.kerning[a]||0,S=_.xAdvance+v+d;l.positions[l.index++]=l.width+v,l.chars.push(m),l.width+=S}a=m}return c(),e.align==="center"?yg(i):e.align==="right"?xg(i):e.align==="justify"&&bg(i),i}function yg(r){for(let e=0;e<r.lines.length;e++){const t=r.lines[e],s=r.width/2-t.width/2;for(let i=0;i<t.charPositions.length;i++)t.charPositions[i]+=s}}function xg(r){for(let e=0;e<r.lines.length;e++){const t=r.lines[e],s=r.width-t.width;for(let i=0;i<t.charPositions.length;i++)t.charPositions[i]+=s}}function bg(r){const e=r.width;for(let t=0;t<r.lines.length;t++){const s=r.lines[t];let i=0,n=s.spacesIndex[i++],a=0;const o=s.spacesIndex.length,h=(e-s.width)/o;for(let c=0;c<s.charPositions.length;c++)c===n&&(n=s.spacesIndex[i++],a+=h),s.charPositions[c]+=a}}function vg(r){if(r==="")return[];typeof r=="string"&&(r=[r]);const e=[];for(let t=0,s=r.length;t<s;t++){const i=r[t];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(i[0].length===0||i[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const n=i[0].charCodeAt(0),a=i[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let o=n,l=a;o<=l;o++)e.push(String.fromCharCode(o))}else e.push(...Array.from(i))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}let Cs=0;class wg{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null}}getFont(e,t){var a;let s=`${t.fontFamily}-bitmap`,i=!0;if(t._fill.fill&&!t._stroke)s+=t._fill.fill.styleKey,i=!1;else if(t._stroke||t.dropShadow){let o=t.styleKey;o=o.substring(0,o.lastIndexOf("-")),s=`${o}-bitmap`,i=!1}if(!$.has(s)){const o=new Pa({style:t,overrideFill:i,overrideSize:!0,...this.defaultOptions});Cs++,Cs>50&&B("BitmapText",`You have dynamically created ${Cs} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),o.once("destroy",()=>{Cs--,$.remove(s)}),$.set(s,o)}const n=$.get(s);return(a=n.ensureCharacters)==null||a.call(n,e),n}getLayout(e,t,s=!0){const i=this.getFont(e,t),n=Te.graphemeSegmenter(e);return Pl(n,t,i,s)}measureText(e,t,s=!0){return this.getLayout(e,t,s)}install(...e){var h,c,u,d;let t=e[0];typeof t=="string"&&(t={name:t,style:e[1],chars:(h=e[2])==null?void 0:h.chars,resolution:(c=e[2])==null?void 0:c.resolution,padding:(u=e[2])==null?void 0:u.padding,skipKerning:(d=e[2])==null?void 0:d.skipKerning},U(H,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const s=t==null?void 0:t.name;if(!s)throw new Error("[BitmapFontManager] Property `name` is required.");t={...this.defaultOptions,...t};const i=t.style,n=i instanceof Le?i:new Le(i),a=n._fill.fill!==null&&n._fill.fill!==void 0,o=new Pa({style:n,overrideFill:a,skipKerning:t.skipKerning,padding:t.padding,resolution:t.resolution,overrideSize:!1,textureStyle:t.textureStyle}),l=vg(t.chars);return o.ensureCharacters(l.join("")),$.set(`${s}-bitmap`,o),o.once("destroy",()=>$.remove(`${s}-bitmap`)),o}uninstall(e){const t=`${e}-bitmap`,s=$.get(t);s&&s.destroy()}}const ci=new wg;class kl extends nl{constructor(e,t){super();const{textures:s,data:i}=e;Object.keys(i.pages).forEach(n=>{const a=i.pages[parseInt(n,10)],o=s[a.id];this.pages.push({texture:o})}),Object.keys(i.chars).forEach(n=>{const a=i.chars[n],{frame:o,source:l}=s[a.page],h=new W(a.x+o.x,a.y+o.y,a.width,a.height),c=new k({source:l,frame:h});this.chars[n]={id:n.codePointAt(0),xOffset:a.xOffset,yOffset:a.yOffset,xAdvance:a.xAdvance,kerning:a.kerning??{},texture:c}}),this.baseRenderedFontSize=i.fontSize,this.baseMeasurementFontSize=i.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},this.baseLineOffset=i.baseLineOffset,this.lineHeight=i.lineHeight,this.fontFamily=i.fontFamily,this.distanceField=i.distanceField??{type:"none",range:0},this.url=t}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{texture:t}=this.pages[e];t.destroy(!0)}this.pages=null}static install(e){ci.install(e)}static uninstall(e){ci.uninstall(e)}}const Gr={test(r){return typeof r=="string"&&r.startsWith("info face=")},parse(r){const e=r.match(/^[a-z]+\s+.+$/gm),t={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in e){const d=e[u].match(/^[a-z]+/gm)[0],f=e[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),g={};for(const m in f){const p=f[m].split("="),_=p[0],x=p[1].replace(/"/gm,""),b=parseFloat(x),v=isNaN(b)?x:b;g[_]=v}t[d].push(g)}const s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[i]=t.info,[n]=t.common,[a]=t.distanceField??[];a&&(s.distanceField={range:parseInt(a.distanceRange,10),type:a.fieldType}),s.fontSize=parseInt(i.size,10),s.fontFamily=i.face,s.lineHeight=parseInt(n.lineHeight,10);const o=t.page;for(let u=0;u<o.length;u++)s.pages.push({id:parseInt(o[u].id,10)||0,file:o[u].file});const l={};s.baseLineOffset=s.lineHeight-parseInt(n.base,10);const h=t.char;for(let u=0;u<h.length;u++){const d=h[u],f=parseInt(d.id,10);let g=d.letter??d.char??String.fromCharCode(f);g==="space"&&(g=" "),l[f]=g,s.chars[g]={id:f,page:parseInt(d.page,10)||0,x:parseInt(d.x,10),y:parseInt(d.y,10),width:parseInt(d.width,10),height:parseInt(d.height,10),xOffset:parseInt(d.xoffset,10),yOffset:parseInt(d.yoffset,10),xAdvance:parseInt(d.xadvance,10),kerning:{}}}const c=t.kerning||[];for(let u=0;u<c.length;u++){const d=parseInt(c[u].first,10),f=parseInt(c[u].second,10),g=parseInt(c[u].amount,10);s.chars[l[f]].kerning[l[d]]=g}return s}},ka={test(r){const e=r;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(r){const e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},t=r.getElementsByTagName("info")[0],s=r.getElementsByTagName("common")[0],i=r.getElementsByTagName("distanceField")[0];i&&(e.distanceField={type:i.getAttribute("fieldType"),range:parseInt(i.getAttribute("distanceRange"),10)});const n=r.getElementsByTagName("page"),a=r.getElementsByTagName("char"),o=r.getElementsByTagName("kerning");e.fontSize=parseInt(t.getAttribute("size"),10),e.fontFamily=t.getAttribute("face"),e.lineHeight=parseInt(s.getAttribute("lineHeight"),10);for(let h=0;h<n.length;h++)e.pages.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});const l={};e.baseLineOffset=e.lineHeight-parseInt(s.getAttribute("base"),10);for(let h=0;h<a.length;h++){const c=a[h],u=parseInt(c.getAttribute("id"),10);let d=c.getAttribute("letter")??c.getAttribute("char")??String.fromCharCode(u);d==="space"&&(d=" "),l[u]=d,e.chars[d]={id:u,page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xOffset:parseInt(c.getAttribute("xoffset"),10),yOffset:parseInt(c.getAttribute("yoffset"),10),xAdvance:parseInt(c.getAttribute("xadvance"),10),kerning:{}}}for(let h=0;h<o.length;h++){const c=parseInt(o[h].getAttribute("first"),10),u=parseInt(o[h].getAttribute("second"),10),d=parseInt(o[h].getAttribute("amount"),10);e.chars[l[u]].kerning[l[c]]=d}return e}},Ca={test(r){return typeof r=="string"&&r.includes("<font>")?ka.test(O.get().parseXML(r)):!1},parse(r){return ka.parse(O.get().parseXML(r))}},Tg=[".xml",".fnt"],Sg={extension:{type:y.CacheParser,name:"cacheBitmapFont"},test:r=>r instanceof kl,getCacheableAssets(r,e){const t={};return r.forEach(s=>{t[s]=e,t[`${s}-bitmap`]=e}),t[`${e.fontFamily}-bitmap`]=e,t}},Ag={extension:{type:y.LoadParser,priority:Xe.Normal},name:"loadBitmapFont",test(r){return Tg.includes(de.extname(r).toLowerCase())},async testParse(r){return Gr.test(r)||Ca.test(r)},async parse(r,e,t){const s=Gr.test(r)?Gr.parse(r):Ca.parse(r),{src:i}=e,{pages:n}=s,a=[],o=s.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let u=0;u<n.length;++u){const d=n[u].file;let f=de.join(de.dirname(i),d);f=qr(f,i),a.push({src:f,data:o})}const l=await t.load(a),h=a.map(u=>l[u.src]);return new kl({data:s,textures:h},i)},async load(r,e){return await(await O.get().fetch(r)).text()},async unload(r,e,t){await Promise.all(r.pages.map(s=>t.unload(s.texture.source._sourceOrigin))),r.destroy()}};class Pg{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<t;s++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const kg={extension:{type:y.CacheParser,name:"cacheTextureArray"},test:r=>Array.isArray(r)&&r.every(e=>e instanceof k),getCacheableAssets:(r,e)=>{const t={};return r.forEach(s=>{e.forEach((i,n)=>{t[s+(n===0?"":n+1)]=i})}),t}};async function Cl(r){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(r)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const Cg={extension:{type:y.DetectionParser,priority:1},test:async()=>Cl("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(e=>e!=="avif")},Ea=["png","jpg","jpeg"],Eg={extension:{type:y.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...Ea],remove:async r=>r.filter(e=>!Ea.includes(e))},Mg="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Vi(r){return Mg?!1:document.createElement("video").canPlayType(r)!==""}const Fg={extension:{type:y.DetectionParser,priority:0},test:async()=>Vi("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(e=>e!=="mp4"&&e!=="m4v")},Bg={extension:{type:y.DetectionParser,priority:0},test:async()=>Vi("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(e=>e!=="ogv")},Rg={extension:{type:y.DetectionParser,priority:0},test:async()=>Vi("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(e=>e!=="webm")},Ig={extension:{type:y.DetectionParser,priority:0},test:async()=>Cl("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(e=>e!=="webp")};class Gg{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,s)=>(this._parsersValidated=!1,e[t]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const s={promise:null,parser:null};return s.promise=(async()=>{var a,o;let i=null,n=null;if(t.loadParser&&(n=this._parserHash[t.loadParser],n||B(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!n){for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];if(h.load&&((a=h.test)!=null&&a.call(h,e,t,this))){n=h;break}}if(!n)return B(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await n.load(e,t,this),s.parser=n;for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];h.parse&&h.parse&&await((o=h.testParse)==null?void 0:o.call(h,i,t,this))&&(i=await h.parse(i,t,this)||i,s.parser=h)}return i})(),s}async load(e,t){this._parsersValidated||this._validateParsers();let s=0;const i={},n=Vs(e),a=we(e,h=>({alias:[h],src:h,data:{}})),o=a.length,l=a.map(async h=>{const c=de.toAbsolute(h.src);if(!i[h.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,h)),i[h.src]=await this.promiseCache[c].promise,t&&t(++s/o)}catch(u){throw delete this.promiseCache[c],delete i[h.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(l),n?i[a[0].src]:i}async unload(e){const s=we(e,i=>({alias:[i],src:i})).map(async i=>{var o,l;const n=de.toAbsolute(i.src),a=this.promiseCache[n];if(a){const h=await a.promise;delete this.promiseCache[n],await((l=(o=a.parser)==null?void 0:o.unload)==null?void 0:l.call(o,h,i,this))}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(t.name?e[t.name]&&B(`[Assets] loadParser name conflict "${t.name}"`):B("[Assets] loadParser should have a name"),{...e,[t.name]:t}),{})}}function Ct(r,e){if(Array.isArray(e)){for(const t of e)if(r.startsWith(`data:${t}`))return!0;return!1}return r.startsWith(`data:${e}`)}function Et(r,e){const t=r.split("?")[0],s=de.extname(t).toLowerCase();return Array.isArray(e)?e.includes(s):s===e}const Dg=".json",Ug="application/json",Og={extension:{type:y.LoadParser,priority:Xe.Low},name:"loadJson",test(r){return Ct(r,Ug)||Et(r,Dg)},async load(r){return await(await O.get().fetch(r)).json()}},Lg=".txt",Ng="text/plain",Hg={name:"loadTxt",extension:{type:y.LoadParser,priority:Xe.Low,name:"loadTxt"},test(r){return Ct(r,Ng)||Et(r,Lg)},async load(r){return await(await O.get().fetch(r)).text()}},Wg=["normal","bold","100","200","300","400","500","600","700","800","900"],Vg=[".ttf",".otf",".woff",".woff2"],zg=["font/ttf","font/otf","font/woff","font/woff2"],Yg=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function jg(r){const e=de.extname(r),i=de.basename(r,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1));let n=i.length>0;for(const o of i)if(!o.match(Yg)){n=!1;break}let a=i.join(" ");return n||(a=`"${a.replace(/[\\"]/g,"\\$&")}"`),a}const $g=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Xg(r){return $g.test(r)?r:encodeURI(r)}const Kg={extension:{type:y.LoadParser,priority:Xe.Low},name:"loadWebFont",test(r){return Ct(r,zg)||Et(r,Vg)},async load(r,e){var s,i,n;const t=O.get().getFontFaceSet();if(t){const a=[],o=((s=e.data)==null?void 0:s.family)??jg(r),l=((n=(i=e.data)==null?void 0:i.weights)==null?void 0:n.filter(c=>Wg.includes(c)))??["normal"],h=e.data??{};for(let c=0;c<l.length;c++){const u=l[c],d=new FontFace(o,`url(${Xg(r)})`,{...h,weight:u});await d.load(),t.add(d),a.push(d)}return $.set(`${o}-and-url`,{url:r,fontFaces:a}),a.length===1?a[0]:a}return B("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(e=>{$.remove(`${e.family}-and-url`),O.get().getFontFaceSet().delete(e)})}};function zi(r,e=1){var s;const t=(s=Pt.RETINA_PREFIX)==null?void 0:s.exec(r);return t?parseFloat(t[1]):e}function Yi(r,e,t){r.label=t,r._sourceOrigin=t;const s=new k({source:r,label:t}),i=()=>{delete e.promiseCache[t],$.has(t)&&$.remove(t)};return s.source.once("destroy",()=>{e.promiseCache[t]&&(B("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),i())}),s.once("destroy",()=>{r.destroyed||(B("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),i())}),s}const qg=".svg",Zg="image/svg+xml",Qg={extension:{type:y.LoadParser,priority:Xe.Low,name:"loadSVG"},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(r){return Ct(r,Zg)||Et(r,qg)},async load(r,e,t){var s;return((s=e.data)==null?void 0:s.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?ep(r):Jg(r,e,t,this.config.crossOrigin)},unload(r){r.destroy(!0)}};async function Jg(r,e,t,s){var p,_,x;const n=await(await O.get().fetch(r)).blob(),a=URL.createObjectURL(n),o=new Image;o.src=a,o.crossOrigin=s,await o.decode(),URL.revokeObjectURL(a);const l=document.createElement("canvas"),h=l.getContext("2d"),c=((p=e.data)==null?void 0:p.resolution)||zi(r),u=((_=e.data)==null?void 0:_.width)??o.width,d=((x=e.data)==null?void 0:x.height)??o.height;l.width=u*c,l.height=d*c,h.drawImage(o,0,0,u*c,d*c);const{parseAsGraphicsContext:f,...g}=e.data??{},m=new ct({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:c,...g});return Yi(m,t,r)}async function ep(r){const t=await(await O.get().fetch(r)).text(),s=new _e;return s.svg(t),s}const tp=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let xt=null,ui=class{constructor(){xt||(xt=URL.createObjectURL(new Blob([tp],{type:"application/javascript"}))),this.worker=new Worker(xt)}};ui.revokeObjectURL=function(){xt&&(URL.revokeObjectURL(xt),xt=null)};const sp=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let bt=null;class El{constructor(){bt||(bt=URL.createObjectURL(new Blob([sp],{type:"application/javascript"}))),this.worker=new Worker(bt)}}El.revokeObjectURL=function(){bt&&(URL.revokeObjectURL(bt),bt=null)};let Ma=0,Dr;class rp{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new ui;t.addEventListener("message",s=>{t.terminate(),ui.revokeObjectURL(),e(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e,t){var s;return this._run("loadImageBitmap",[e,(s=t==null?void 0:t.data)==null?void 0:s.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){Dr===void 0&&(Dr=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<Dr&&(this._createdWorkers++,e=new El().worker,e.addEventListener("message",t=>{this._complete(t.data),this._returnWorker(t.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const s=new Promise((i,n)=>{this._queue.push({id:e,arguments:t,resolve:i,reject:n})});return this._next(),s}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const t=this._queue.pop(),s=t.id;this._resolveHash[Ma]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:Ma++,id:s})}}const Fa=new rp,ip=[".jpeg",".jpg",".png",".webp",".avif"],np=["image/jpeg","image/png","image/webp","image/avif"];async function ap(r,e){var i;const t=await O.get().fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);const s=await t.blob();return((i=e==null?void 0:e.data)==null?void 0:i.alphaMode)==="premultiplied-alpha"?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}const Ml={name:"loadTextures",extension:{type:y.LoadParser,priority:Xe.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return Ct(r,np)||Et(r,ip)},async load(r,e,t){var n;let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Fa.isImageBitmapSupported()?s=await Fa.loadImageBitmap(r,e):s=await ap(r,e):s=await new Promise((a,o)=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=r,s.complete?a(s):(s.onload=()=>{a(s)},s.onerror=o)});const i=new ct({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:((n=e.data)==null?void 0:n.resolution)||zi(r),...e.data});return Yi(i,t,r)},unload(r){r.destroy(!0)}},Fl=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],op=Fl.map(r=>`video/${r.substring(1)}`);function lp(r,e,t){t===void 0&&!e.startsWith("data:")?r.crossOrigin=cp(e):t!==!1&&(r.crossOrigin=typeof t=="string"?t:"anonymous")}function hp(r){return new Promise((e,t)=>{r.addEventListener("canplaythrough",s),r.addEventListener("error",i),r.load();function s(){n(),e()}function i(a){n(),t(a)}function n(){r.removeEventListener("canplaythrough",s),r.removeEventListener("error",i)}})}function cp(r,e=globalThis.location){if(r.startsWith("data:"))return"";e||(e=globalThis.location);const t=new URL(r,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}const up={name:"loadVideo",extension:{type:y.LoadParser,name:"loadVideo"},test(r){const e=Ct(r,op),t=Et(r,Fl);return e||t},async load(r,e,t){var l,h;const s={...Gs.defaultOptions,resolution:((l=e.data)==null?void 0:l.resolution)||zi(r),alphaMode:((h=e.data)==null?void 0:h.alphaMode)||await Fo(),...e.data},i=document.createElement("video"),n={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(n).forEach(c=>{const u=n[c];u!==void 0&&i.setAttribute(c,u)}),s.muted===!0&&(i.muted=!0),lp(i,r,s.crossorigin);const a=document.createElement("source");let o;if(r.startsWith("data:"))o=r.slice(5,r.indexOf(";"));else if(!r.startsWith("blob:")){const c=r.split("?")[0].slice(r.lastIndexOf(".")+1).toLowerCase();o=Gs.MIME_TYPES[c]||`video/${c}`}return a.src=r,o&&(a.type=o),new Promise(c=>{const u=async()=>{const d=new Gs({...s,resource:i});i.removeEventListener("canplay",u),e.data.preload&&await hp(i),c(Yi(d,t,r))};s.preload&&!s.autoPlay&&i.load(),i.addEventListener("canplay",u),i.appendChild(a)})},unload(r){r.destroy(!0)}},Bl={extension:{type:y.ResolveParser,name:"resolveTexture"},test:Ml.test,parse:r=>{var e;return{resolution:parseFloat(((e=Pt.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:r.split(".").pop(),src:r}}},dp={extension:{type:y.ResolveParser,priority:-2,name:"resolveJson"},test:r=>Pt.RETINA_PREFIX.test(r)&&r.endsWith(".json"),parse:Bl.parse};class fp{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Pt,this.loader=new Gg,this.cache=$,this._backgroundLoader=new Pg(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var n,a;if(this._initialized){B("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let o=e.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}const t=((n=e.texturePreference)==null?void 0:n.resolution)??1,s=typeof t=="number"?[t]:t,i=await this._detectFormats({preferredFormats:(a=e.texturePreference)==null?void 0:a.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:s}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,t){this._initialized||await this.init();const s=Vs(e),i=we(e).map(o=>{if(typeof o!="string"){const l=this.resolver.getAlias(o);return l.some(h=>!this.resolver.hasKey(h))&&this.add(o),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),n=this.resolver.resolve(i),a=await this._mapLoadToResolve(n,t);return s?a[i[0]]:a}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let s=!1;typeof e=="string"&&(s=!0,e=[e]);const i=this.resolver.resolveBundle(e),n={},a=Object.keys(i);let o=0,l=0;const h=()=>{t==null||t(++o/l)},c=a.map(u=>{const d=i[u];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(f=>{n[u]=f})});return await Promise.all(c),s?n[e[0]]:n}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return $.get(e);const t={};for(let s=0;s<e.length;s++)t[s]=$.get(e[s]);return t}async _mapLoadToResolve(e,t){const s=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;const i=await this.loader.load(s,t);this._backgroundLoader.active=!0;const n={};return s.forEach(a=>{const o=i[a.src],l=[a.src];a.alias&&l.push(...a.alias),l.forEach(h=>{n[h]=o}),$.set(l,o)}),n}async unload(e){this._initialized||await this.init();const t=we(e).map(i=>typeof i!="string"?i.src:i),s=this.resolver.resolve(t);await this._unloadFromResolved(s)}async unloadBundle(e){this._initialized||await this.init(),e=we(e);const t=this.resolver.resolveBundle(e),s=Object.keys(t).map(i=>this._unloadFromResolved(t[i]));await Promise.all(s)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(s=>{$.remove(s.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const s of e.detections)e.skipDetections||await s.test()?t=await s.add(t):e.skipDetections||(t=await s.remove(t));return t=t.filter((s,i)=>t.indexOf(s)===i),t}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(s=>s in e).forEach(s=>{t.config[s]=e[s]})})}}const lt=new fp;M.handleByList(y.LoadParser,lt.loader.parsers).handleByList(y.ResolveParser,lt.resolver.parsers).handleByList(y.CacheParser,lt.cache.parsers).handleByList(y.DetectionParser,lt.detections);M.add(kg,Eg,Cg,Ig,Fg,Bg,Rg,Og,Hg,Kg,Qg,Ml,up,Ag,Sg,Bl,dp);const Ba={loader:y.LoadParser,resolver:y.ResolveParser,cache:y.CacheParser,detection:y.DetectionParser};M.handle(y.Asset,r=>{const e=r.ref;Object.entries(Ba).filter(([t])=>!!e[t]).forEach(([t,s])=>M.add(Object.assign(e[t],{extension:e[t].extension??s})))},r=>{const e=r.ref;Object.keys(Ba).filter(t=>!!e[t]).forEach(t=>M.remove(e[t]))});class Rl{constructor(e){this._attachedDomElements=[],this._renderer=e,this._renderer.runners.postrender.add(this),this._domElement=document.createElement("div"),this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.left="0",this._domElement.style.pointerEvents="none",this._domElement.style.zIndex="1000"}addRenderable(e,t){this._attachedDomElements.includes(e)||this._attachedDomElements.push(e)}updateRenderable(e){}validateRenderable(e){return!0}postrender(){var n;const e=this._attachedDomElements;if(e.length===0){this._domElement.remove();return}const t=this._renderer.view.canvas;this._domElement.parentNode!==t.parentNode&&((n=t.parentNode)==null||n.appendChild(this._domElement));const s=parseFloat(t.style.width)/t.width*this._renderer.resolution,i=parseFloat(t.style.height)/t.height*this._renderer.resolution;this._domElement.style.transform=`translate(${t.offsetLeft}px, ${t.offsetTop}px) scale(${s}, ${i})`;for(let a=0;a<e.length;a++){const o=e[a],l=o.element;if(!o.parent||o.globalDisplayStatus<7)l==null||l.remove(),e.splice(a,1),a--;else{this._domElement.contains(l)||(l.style.position="absolute",l.style.pointerEvents="auto",this._domElement.appendChild(l));const h=o.worldTransform,c=o._anchor,u=o.width*c.x,d=o.height*c.y;l.style.transformOrigin=`${u}px ${d}px`,l.style.transform=`matrix(${h.a}, ${h.b}, ${h.c}, ${h.d}, ${h.tx-u}, ${h.ty-d})`,l.style.opacity=o.groupAlpha.toString()}}}destroy(){var e;this._renderer.runners.postrender.remove(this);for(let t=0;t<this._attachedDomElements.length;t++)(e=this._attachedDomElements[t].element)==null||e.remove();this._attachedDomElements.length=0,this._domElement.remove(),this._renderer=null}}Rl.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"dom"};class gp{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this._tickerAdded||!this.domElement||(Ce.system.add(this._tickerUpdate,this,Zt.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(Ce.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events._rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(this.events.supportsPointerEvents?new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,pointerId:e.pointerId}):new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY}))}_tickerUpdate(e){this._deltaTime+=e.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this._update())}}const Ve=new gp;class Xs extends ns{constructor(){super(...arguments),this.client=new Y,this.movement=new Y,this.offset=new Y,this.global=new Y,this.screen=new Y}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,s){return e.worldTransform.applyInverse(s||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,s,i,n,a,o,l,h,c,u,d,f,g,m){throw new Error("Method not implemented.")}}class ve extends Xs{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class At extends Xs{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}At.DOM_DELTA_PIXEL=0;At.DOM_DELTA_LINE=1;At.DOM_DELTA_PAGE=2;const pp=2048,mp=new Y,Ot=new Y;class _p{constructor(e){this.dispatch=new ge,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((s,i)=>s.priority-i.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let s=0,i=t.length;s<i;s++)t[s].fn(e);else B(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Ve.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[i](this.rootTarget,this.rootTarget.eventMode,mp.set(e,t),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(e,t){if(!e.target)return;const s=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let i=0,n=s.length-1;i<n;i++)if(e.currentTarget=s[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let i=s.length-2;i>=0;i--)if(e.currentTarget=s[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,s=this._allInteractiveElements){if(s.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const i=Array.isArray(t)?t:[t];for(let n=s.length-1;n>=0;n--)i.forEach(a=>{e.currentTarget=s[n],this.notifyTarget(e,a)})}propagationPath(e){const t=[e];for(let s=0;s<pp&&e!==this.rootTarget&&e.parent;s++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,s,i,n,a=!1){let o=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Ve.pauseUpdate=!1),e.interactiveChildren&&e.children){const c=e.children;for(let u=c.length-1;u>=0;u--){const d=c[u],f=this.hitTestMoveRecursive(d,this._isInteractive(t)?t:d.eventMode,s,i,n,a||n(e,s));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const g=e.isInteractive();(f.length>0||g)&&(g&&this._allInteractiveElements.push(e),f.push(e)),this._hitElements.length===0&&(this._hitElements=f),o=!0}}}const l=this._isInteractive(t),h=e.isInteractive();return h&&h&&this._allInteractiveElements.push(e),a||this._hitElements.length>0?null:o?this._hitElements:l&&!n(e,s)&&i(e,s)?h?[e]:[]:null}hitTestRecursive(e,t,s,i,n){if(this._interactivePrune(e)||n(e,s))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Ve.pauseUpdate=!1),e.interactiveChildren&&e.children){const l=e.children,h=s;for(let c=l.length-1;c>=0;c--){const u=l[c],d=this.hitTestRecursive(u,this._isInteractive(t)?t:u.eventMode,h,i,n);if(d){if(d.length>0&&!d[d.length-1].parent)continue;const f=e.isInteractive();return(d.length>0||f)&&d.push(e),d}}}const a=this._isInteractive(t),o=e.isInteractive();return a&&i(e,s)?o?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!e||!e.visible||!e.renderable||!e.measurable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,Ot),!e.hitArea.contains(Ot.x,Ot.y)))return!0;if(e.effects&&e.effects.length)for(let s=0;s<e.effects.length;s++){const i=e.effects[s];if(i.containsPoint&&!i.containsPoint(t,this.hitTestFn))return!0}return!1}hitTestFn(e,t){return e.hitArea?!0:e!=null&&e.containsPoint?(e.worldTransform.applyInverse(t,Ot),e.containsPoint(Ot)):!1}notifyTarget(e,t){var n,a;if(!e.currentTarget.isInteractive())return;t??(t=e.type);const s=`on${t}`;(a=(n=e.currentTarget)[s])==null||a.call(n,e);const i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this._notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this._notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof ve)){B("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const i=t.button===2;this.dispatchEvent(t,i?"rightdown":"mousedown")}const s=this.trackingData(e.pointerId);s.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var l,h;if(!(e instanceof ve)){B("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const s=t.pointerType==="mouse"||t.pointerType==="pen",i=this.trackingData(e.pointerId),n=this.findMountedTarget(i.overTargets);if(((l=i.overTargets)==null?void 0:l.length)>0&&n!==t.target){const c=e.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(e,c,n);if(this.dispatchEvent(u,"pointerout"),s&&this.dispatchEvent(u,"mouseout"),!t.composedPath().includes(n)){const d=this.createPointerEvent(e,"pointerleave",n);for(d.eventPhase=d.AT_TARGET;d.target&&!t.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),s&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(n!==t.target){const c=e.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(t,c);this.dispatchEvent(u,"pointerover"),s&&this.dispatchEvent(u,"mouseover");let d=n==null?void 0:n.parent;for(;d&&d!==this.rootTarget.parent&&d!==t.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const g=this.clonePointerEvent(t,"pointerenter");for(g.eventPhase=g.AT_TARGET;g.target&&g.target!==n&&g.target!==this.rootTarget.parent;)g.currentTarget=g.target,this.notifyTarget(g),s&&this.notifyTarget(g,"mouseenter"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(u)}const a=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(t,"pointermove"),o&&a.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),o&&a.push("globaltouchmove")),s&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),o&&a.push("globalmousemove"),this.cursor=(h=t.target)==null?void 0:h.cursor),a.length>0&&this.all(t,a),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){var a;if(!(e instanceof ve)){B("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),s=this.createPointerEvent(e),i=s.pointerType==="mouse"||s.pointerType==="pen";this.dispatchEvent(s,"pointerover"),i&&this.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(this.cursor=(a=s.target)==null?void 0:a.cursor);const n=this.clonePointerEvent(s,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;t.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof ve)){B("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const s=e.pointerType==="mouse"||e.pointerType==="pen",i=this.findMountedTarget(t.overTargets),n=this.createPointerEvent(e,"pointerout",i);this.dispatchEvent(n),s&&this.dispatchEvent(n,"mouseout");const a=this.createPointerEvent(e,"pointerleave",i);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),s&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;t.overTargets=null,this.freeEvent(n),this.freeEvent(a)}this.cursor=null}mapPointerUp(e){if(!(e instanceof ve)){B("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),s=this.createPointerEvent(e);if(this.dispatchEvent(s,"pointerup"),s.pointerType==="touch")this.dispatchEvent(s,"touchend");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const o=s.button===2;this.dispatchEvent(s,o?"rightup":"mouseup")}const i=this.trackingData(e.pointerId),n=this.findMountedTarget(i.pressTargetsByButton[e.button]);let a=n;if(n&&!s.composedPath().includes(n)){let o=n;for(;o&&!s.composedPath().includes(o);){if(s.currentTarget=o,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch")this.notifyTarget(s,"touchendoutside");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const l=s.button===2;this.notifyTarget(s,l?"rightupoutside":"mouseupoutside")}o=o.parent}delete i.pressTargetsByButton[e.button],a=o}if(a){const o=this.clonePointerEvent(s,"click");o.target=a,o.path=null,i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:o.target,timeStamp:t});const l=i.clicksByButton[e.button];if(l.target===o.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=o.target,l.timeStamp=t,o.detail=l.clickCount,o.pointerType==="mouse"){const h=o.button===2;this.dispatchEvent(o,h?"rightclick":"click")}else o.pointerType==="touch"&&this.dispatchEvent(o,"tap");this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(s)}mapPointerUpOutside(e){if(!(e instanceof ve)){B("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),s=this.findMountedTarget(t.pressTargetsByButton[e.button]),i=this.createPointerEvent(e);if(s){let n=s;for(;n;)i.currentTarget=n,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(i)}mapWheel(e){if(!(e instanceof At)){B("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let s=1;s<e.length&&e[s].parent===t;s++)t=e[s];return t}createPointerEvent(e,t,s){const i=this.allocateEvent(ve);return this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=s??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],typeof t=="string"&&(i.type=t),i}createWheelEvent(e){const t=this.allocateEvent(At);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const s=this.allocateEvent(ve);return s.nativeEvent=e.nativeEvent,s.originalEvent=e.originalEvent,this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.target=e.target,s.path=e.composedPath().slice(),s.type=t??s.type,s}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof ve&&t instanceof ve&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Xs&&t instanceof Xs&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.defaultPrevented=!1,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}_notifyListeners(e,t){const s=e.currentTarget._events[t];if(s)if("fn"in s)s.once&&e.currentTarget.removeListener(t,s.fn,void 0,!0),s.fn.call(s.context,e);else for(let i=0,n=s.length;i<n&&!e.propagationImmediatelyStopped;i++)s[i].once&&e.currentTarget.removeListener(t,s[i].fn,void 0,!0),s[i].fn.call(s[i].context,e)}}const yp=1,xp={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ji=class di{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new _p(null),Ve.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new ve(null),this._rootWheelEvent=new At(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...di.defaultEventFeatures},{set:(t,s,i)=>(s==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),t[s]=i,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{canvas:t,resolution:s}=this.renderer;this.setTargetElement(t),this.resolution=s,di._defaultEventMode=e.eventMode??"passive",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(e){e||(e="default");let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this._currentCursor===e)return;this._currentCursor=e;const s=this.cursorStyles[e];if(s)switch(typeof s){case"string":t&&(this.domElement.style.cursor=s);break;case"function":s(e);break;case"object":t&&Object.assign(this.domElement.style,s);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this._rootPointerEvent}_onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this._normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let s=0,i=t.length;s<i;s++){const n=t[s],a=this._bootstrapEvent(this._rootPointerEvent,n);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Ve.pointerMoved();const t=this._normalizeToPointerData(e);for(let s=0,i=t.length;s<i;s++){const n=this._bootstrapEvent(this._rootPointerEvent,t[s]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const s=t!==this.domElement?"outside":"",i=this._normalizeToPointerData(e);for(let n=0,a=i.length;n<a;n++){const o=this._bootstrapEvent(this._rootPointerEvent,i[n]);o.type+=s,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this._normalizeToPointerData(e);for(let s=0,i=t.length;s<i;s++){const n=this._bootstrapEvent(this._rootPointerEvent,t[s]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this._removeEvents(),this.domElement=e,Ve.domElement=e,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;Ve.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;Ve.removeTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(e,t,s){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*n,e.y=(s-i.top)*(this.domElement.height/i.height)*n}_normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let s=0,i=e.changedTouches.length;s<i;s++){const n=e.changedTouches[s];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const s=e;typeof s.isPrimary>"u"&&(s.isPrimary=!0),typeof s.width>"u"&&(s.width=1),typeof s.height>"u"&&(s.height=1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="mouse"),typeof s.pointerId>"u"&&(s.pointerId=yp),typeof s.pressure>"u"&&(s.pressure=.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),s.isNormalized=!0,t.push(s)}else t.push(e);return t}normalizeWheelEvent(e){const t=this._rootWheelEvent;return this._transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}_bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this._transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=xp[e.type]||e.type),e}_transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};ji.extension={name:"events",type:[y.WebGLSystem,y.CanvasSystem,y.WebGPUSystem],priority:-1};ji.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Il=ji;const bp={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(r){this.eventMode=r?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Il.defaultEventMode},set eventMode(r){this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,e,t){const s=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,i=typeof t=="object"?t.signal:void 0,n=typeof t=="object"?t.once===!0:!1,a=typeof e=="function"?void 0:e;r=s?`${r}capture`:r;const o=typeof e=="function"?e:e.handleEvent,l=this;i&&i.addEventListener("abort",()=>{l.off(r,o,a)}),n?l.once(r,o,a):l.on(r,o,a)},removeEventListener(r,e,t){const s=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,i=typeof e=="function"?void 0:e;r=s?`${r}capture`:r,e=typeof e=="function"?e:e.handleEvent,this.off(r,e,i)},dispatchEvent(r){if(!(r instanceof ns))throw new Error("Container cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};class Gl{constructor(e){this._renderer=e}push(e,t,s){this._renderer.renderPipes.batch.break(s),s.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:t,filterEffect:e})}pop(e,t,s){this._renderer.renderPipes.batch.break(s),s.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(e){e.action==="pushFilter"?this._renderer.filter.push(e):e.action==="popFilter"&&this._renderer.filter.pop()}destroy(){this._renderer=null}}Gl.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"filter"};function vp(r,e){e.clear();const t=e.matrix;for(let s=0;s<r.length;s++){const i=r[s];i.globalDisplayStatus<7||(e.matrix=i.worldTransform,e.addBounds(i.bounds))}return e.matrix=t,e}const wp=new as({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:2*4,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class Tp{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new ie,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.outputOffset={x:0,y:0},this.globalFrame={x:0,y:0,width:0,height:0}}}class Dl{constructor(e){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new oe({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new Ge({}),this.renderer=e}get activeBackTexture(){var e;return(e=this._activeFilterData)==null?void 0:e.backTexture}push(e){const t=this.renderer,s=e.filterEffect.filters,i=this._pushFilterData();i.skip=!1,i.filters=s,i.container=e.container,i.outputRenderSurface=t.renderTarget.renderSurface;const n=t.renderTarget.renderTarget.colorTexture.source,a=n.resolution,o=n.antialias;if(s.length===0){i.skip=!0;return}const l=i.bounds;if(e.renderables?vp(e.renderables,l):e.filterEffect.filterArea?(l.clear(),l.addRect(e.filterEffect.filterArea),l.applyMatrix(e.container.worldTransform)):e.container.getFastGlobalBounds(!0,l),e.container){const m=(e.container.renderGroup||e.container.parentRenderGroup).cacheToLocalTransform;m&&l.applyMatrix(m)}if(this._calculateFilterBounds(i,t.renderTarget.rootViewPort,o,a,1),i.skip)return;const h=this._getPreviousFilterData();let c=a,u=0,d=0;h&&(u=h.bounds.minX,d=h.bounds.minY,c=h.inputTexture.source._resolution),i.outputOffset.x=l.minX-u,i.outputOffset.y=l.minY-d;const f=i.globalFrame;if(f.x=u*c,f.y=d*c,f.width=n.width*c,f.height=n.height*c,i.backTexture=k.EMPTY,i.blendRequired){t.renderTarget.finishRenderPass();const g=t.renderTarget.getRenderTarget(i.outputRenderSurface);i.backTexture=this.getBackTexture(g,l,h==null?void 0:h.bounds)}i.inputTexture=re.getOptimalTexture(l.width,l.height,i.resolution,i.antialias),t.renderTarget.bind(i.inputTexture,!0),t.globalUniforms.push({offset:l})}generateFilteredTexture({texture:e,filters:t}){const s=this._pushFilterData();this._activeFilterData=s,s.skip=!1,s.filters=t;const i=e.source,n=i.resolution,a=i.antialias;if(t.length===0)return s.skip=!0,e;const o=s.bounds;if(o.addRect(e.frame),this._calculateFilterBounds(s,o.rectangle,a,n,0),s.skip)return e;const l=n,h=0,c=0;s.outputOffset.x=-o.minX,s.outputOffset.y=-o.minY;const u=s.globalFrame;u.x=h*l,u.y=c*l,u.width=i.width*l,u.height=i.height*l,s.outputRenderSurface=re.getOptimalTexture(o.width,o.height,s.resolution,s.antialias),s.backTexture=k.EMPTY,s.inputTexture=e,this.renderer.renderTarget.finishRenderPass(),this._applyFiltersToTexture(s,!0);const f=s.outputRenderSurface;return f.source.alphaMode="premultiplied-alpha",f}pop(){const e=this.renderer,t=this._popFilterData();t.skip||(e.globalUniforms.pop(),e.renderTarget.finishRenderPass(),this._activeFilterData=t,this._applyFiltersToTexture(t,!1),t.blendRequired&&re.returnTexture(t.backTexture),re.returnTexture(t.inputTexture))}getBackTexture(e,t,s){const i=e.colorTexture.source._resolution,n=re.getOptimalTexture(t.width,t.height,i,!1);let a=t.minX,o=t.minY;s&&(a-=s.minX,o-=s.minY),a=Math.floor(a*i),o=Math.floor(o*i);const l=Math.ceil(t.width*i),h=Math.ceil(t.height*i);return this.renderer.renderTarget.copyToTexture(e,n,{x:a,y:o},{width:l,height:h},{x:0,y:0}),n}applyFilter(e,t,s,i){const n=this.renderer,a=this._activeFilterData,o=a.outputRenderSurface,l=this._filterGlobalUniforms,h=l.uniforms,c=h.uOutputFrame,u=h.uInputSize,d=h.uInputPixel,f=h.uInputClamp,g=h.uGlobalFrame,m=h.uOutputTexture;o===s?(c[0]=a.outputOffset.x,c[1]=a.outputOffset.y):(c[0]=0,c[1]=0),c[2]=t.frame.width,c[3]=t.frame.height,u[0]=t.source.width,u[1]=t.source.height,u[2]=1/u[0],u[3]=1/u[1],d[0]=t.source.pixelWidth,d[1]=t.source.pixelHeight,d[2]=1/d[0],d[3]=1/d[1],f[0]=.5*d[2],f[1]=.5*d[3],f[2]=t.frame.width*u[2]-.5*d[2],f[3]=t.frame.height*u[3]-.5*d[3],g[0]=a.globalFrame.x,g[1]=a.globalFrame.y,g[2]=a.globalFrame.width,g[3]=a.globalFrame.height,s instanceof k&&(s.source.resource=null);const p=this.renderer.renderTarget.getRenderTarget(s);if(n.renderTarget.bind(s,!!i),s instanceof k?(m[0]=s.frame.width,m[1]=s.frame.height):(m[0]=p.width,m[1]=p.height),m[2]=p.isRoot?-1:1,l.update(),n.renderPipes.uniformBatch){const _=n.renderPipes.uniformBatch.getUboResource(l);this._globalFilterBindGroup.setResource(_,0)}else this._globalFilterBindGroup.setResource(l,0);this._globalFilterBindGroup.setResource(t.source,1),this._globalFilterBindGroup.setResource(t.source.style,2),e.groups[0]=this._globalFilterBindGroup,n.encoder.draw({geometry:wp,shader:e,state:e._state,topology:"triangle-list"}),n.type===Se.WEBGL&&n.renderTarget.finishRenderPass()}calculateSpriteMatrix(e,t){const s=this._activeFilterData,i=e.set(s.inputTexture._source.width,0,0,s.inputTexture._source.height,s.bounds.minX,s.bounds.minY),n=t.worldTransform.copyTo(E.shared),a=t.renderGroup||t.parentRenderGroup;return a&&a.cacheToLocalTransform&&n.prepend(a.cacheToLocalTransform),n.invert(),i.prepend(n),i.scale(1/t.texture.frame.width,1/t.texture.frame.height),i.translate(t.anchor.x,t.anchor.y),i}destroy(){}_applyFiltersToTexture(e,t){const s=e.inputTexture,i=e.bounds,n=e.filters;if(this._globalFilterBindGroup.setResource(s.source.style,2),this._globalFilterBindGroup.setResource(e.backTexture.source,3),n.length===1)n[0].apply(this,s,e.outputRenderSurface,t);else{let a=e.inputTexture;const o=re.getOptimalTexture(i.width,i.height,a.source._resolution,!1);let l=o,h=0;for(h=0;h<n.length-1;++h){n[h].apply(this,a,l,!0);const u=a;a=l,l=u}n[h].apply(this,a,e.outputRenderSurface,t),re.returnTexture(o)}}_calculateFilterBounds(e,t,s,i,n){var m;const a=this.renderer,o=e.bounds,l=e.filters;let h=1/0,c=0,u=!0,d=!1,f=!1,g=!0;for(let p=0;p<l.length;p++){const _=l[p];if(h=Math.min(h,_.resolution==="inherit"?i:_.resolution),c+=_.padding,_.antialias==="off"?u=!1:_.antialias==="inherit"&&u&&(u=s),_.clipToViewport||(g=!1),!!!(_.compatibleRenderers&a.type)){f=!1;break}if(_.blendRequired&&!(((m=a.backBuffer)==null?void 0:m.useBackBuffer)??!0)){B("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),f=!1;break}f=_.enabled||f,d||(d=_.blendRequired)}if(!f){e.skip=!0;return}if(g&&o.fitBounds(0,t.width/i,0,t.height/i),o.scale(h).ceil().scale(1/h).pad((c|0)*n),!o.isPositive){e.skip=!0;return}e.antialias=u,e.resolution=h,e.blendRequired=d}_popFilterData(){return this._filterStackIndex--,this._filterStack[this._filterStackIndex]}_getPreviousFilterData(){let e,t=this._filterStackIndex-1;for(;t>1&&(t--,e=this._filterStack[t],!!e.skip););return e}_pushFilterData(){let e=this._filterStack[this._filterStackIndex];return e||(e=this._filterStack[this._filterStackIndex]=new Tp),this._filterStackIndex++,e}}Dl.extension={type:[y.WebGLSystem,y.WebGPUSystem],name:"filter"};var Sp=`in vec2 vMaskCoord;
in vec2 vTextureCoord;

uniform sampler2D uTexture;
uniform sampler2D uMaskTexture;

uniform float uAlpha;
uniform vec4 uMaskClamp;
uniform float uInverse;

out vec4 finalColor;

void main(void)
{
    float clip = step(3.5,
        step(uMaskClamp.x, vMaskCoord.x) +
        step(uMaskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, uMaskClamp.z) +
        step(vMaskCoord.y, uMaskClamp.w));

    // TODO look into why this is needed
    float npmAlpha = uAlpha;
    vec4 original = texture(uTexture, vTextureCoord);
    vec4 masky = texture(uMaskTexture, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    float a = alphaMul * masky.r * npmAlpha * clip;

    if (uInverse == 1.0) {
        a = 1.0 - a;
    }

    finalColor = original * a;
}
`,Ap=`in vec2 aPosition;

out vec2 vTextureCoord;
out vec2 vMaskCoord;


uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;
uniform mat3 uFilterMatrix;

vec4 filterVertexPosition(  vec2 aPosition )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
       
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord(  vec2 aPosition )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

vec2 getFilterCoord( vec2 aPosition )
{
    return  ( uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}   

void main(void)
{
    gl_Position = filterVertexPosition(aPosition);
    vTextureCoord = filterTextureCoord(aPosition);
    vMaskCoord = getFilterCoord(aPosition);
}
`,Ra=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct MaskUniforms {
  uFilterMatrix:mat3x3<f32>,
  uMaskClamp:vec4<f32>,
  uAlpha:f32,
  uInverse:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;
@group(1) @binding(1) var uMaskTexture: texture_2d<f32>;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) filterUv : vec2<f32>,
};

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);
}

fn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>
{
  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>,
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   getFilterCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) filterUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var maskClamp = filterUniforms.uMaskClamp;
    var uAlpha = filterUniforms.uAlpha;

    var clip = step(3.5,
      step(maskClamp.x, filterUv.x) +
      step(maskClamp.y, filterUv.y) +
      step(filterUv.x, maskClamp.z) +
      step(filterUv.y, maskClamp.w));

    var mask = textureSample(uMaskTexture, uSampler, filterUv);
    var source = textureSample(uTexture, uSampler, uv);
    var alphaMul = 1.0 - uAlpha * (1.0 - mask.a);

    var a: f32 = alphaMul * mask.r * uAlpha * clip;

    if (filterUniforms.uInverse == 1.0) {
        a = 1.0 - a;
    }

    return source * a;
}
`;class Pp extends ld{constructor(e){const{sprite:t,...s}=e,i=new fo(t.texture),n=new oe({uFilterMatrix:{value:new E,type:"mat3x3<f32>"},uMaskClamp:{value:i.uClampFrame,type:"vec4<f32>"},uAlpha:{value:1,type:"f32"},uInverse:{value:e.inverse?1:0,type:"f32"}}),a=dt.from({vertex:{source:Ra,entryPoint:"mainVertex"},fragment:{source:Ra,entryPoint:"mainFragment"}}),o=kt.from({vertex:Ap,fragment:Sp,name:"mask-filter"});super({...s,gpuProgram:a,glProgram:o,resources:{filterUniforms:n,uMaskTexture:t.texture.source}}),this.sprite=t,this._textureMatrix=i}set inverse(e){this.resources.filterUniforms.uniforms.uInverse=e?1:0}get inverse(){return this.resources.filterUniforms.uniforms.uInverse===1}apply(e,t,s,i){this._textureMatrix.texture=this.sprite.texture,e.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.uFilterMatrix,this.sprite).prepend(this._textureMatrix.mapCoord),this.resources.uMaskTexture=this.sprite.texture.source,e.applyFilter(this,t,s,i)}}class is extends Ai{constructor(e){e instanceof _e&&(e={context:e});const{context:t,roundPixels:s,...i}=e||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",t?this._context=t:this._context=this._ownedContext=new _e,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=s??!1}set context(e){e!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=e,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(e){return this._context.containsPoint(e)}destroy(e){this._ownedContext&&!e?this._ownedContext.destroy(e):(e===!0||(e==null?void 0:e.context)===!0)&&this._context.destroy(e),this._ownedContext=null,this._context=null,super.destroy(e)}_callContextMethod(e,t){return this.context[e](...t),this}setFillStyle(...e){return this._callContextMethod("setFillStyle",e)}setStrokeStyle(...e){return this._callContextMethod("setStrokeStyle",e)}fill(...e){return this._callContextMethod("fill",e)}stroke(...e){return this._callContextMethod("stroke",e)}texture(...e){return this._callContextMethod("texture",e)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...e){return this._callContextMethod("arc",e)}arcTo(...e){return this._callContextMethod("arcTo",e)}arcToSvg(...e){return this._callContextMethod("arcToSvg",e)}bezierCurveTo(...e){return this._callContextMethod("bezierCurveTo",e)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...e){return this._callContextMethod("ellipse",e)}circle(...e){return this._callContextMethod("circle",e)}path(...e){return this._callContextMethod("path",e)}lineTo(...e){return this._callContextMethod("lineTo",e)}moveTo(...e){return this._callContextMethod("moveTo",e)}quadraticCurveTo(...e){return this._callContextMethod("quadraticCurveTo",e)}rect(...e){return this._callContextMethod("rect",e)}roundRect(...e){return this._callContextMethod("roundRect",e)}poly(...e){return this._callContextMethod("poly",e)}regularPoly(...e){return this._callContextMethod("regularPoly",e)}roundPoly(...e){return this._callContextMethod("roundPoly",e)}roundShape(...e){return this._callContextMethod("roundShape",e)}filletRect(...e){return this._callContextMethod("filletRect",e)}chamferRect(...e){return this._callContextMethod("chamferRect",e)}star(...e){return this._callContextMethod("star",e)}svg(...e){return this._callContextMethod("svg",e)}restore(...e){return this._callContextMethod("restore",e)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...e){return this._callContextMethod("rotate",e)}scaleTransform(...e){return this._callContextMethod("scale",e)}setTransform(...e){return this._callContextMethod("setTransform",e)}transform(...e){return this._callContextMethod("transform",e)}translateTransform(...e){return this._callContextMethod("translate",e)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(e){this._context.fillStyle=e}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(e){this._context.strokeStyle=e}clone(e=!1){return e?new is(this._context.clone()):(this._ownedContext=null,new is(this._context))}lineStyle(e,t,s){U(H,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return e&&(i.width=e),t&&(i.color=t),s&&(i.alpha=s),this.context.strokeStyle=i,this}beginFill(e,t){U(H,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return e!==void 0&&(s.color=e),t!==void 0&&(s.alpha=t),this.context.fillStyle=s,this}endFill(){U(H,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const e=this.context.strokeStyle;return(e.width!==_e.defaultStrokeStyle.width||e.color!==_e.defaultStrokeStyle.color||e.alpha!==_e.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...e){return U(H,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return U(H,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return U(H,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return U(H,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return U(H,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return U(H,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}}const Ul=class Ol extends as{constructor(...e){let t=e[0]??{};t instanceof Float32Array&&(U(H,"use new MeshGeometry({ positions, uvs, indices }) instead"),t={positions:t,uvs:e[1],indices:e[2]}),t={...Ol.defaultOptions,...t};const s=t.positions||new Float32Array([0,0,1,0,1,1,0,1]);let i=t.uvs;i||(t.positions?i=new Float32Array(s.length):i=new Float32Array([0,0,1,0,1,1,0,1]));const n=t.indices||new Uint32Array([0,1,2,0,2,3]),a=t.shrinkBuffersToFit,o=new fe({data:s,label:"attribute-mesh-positions",shrinkToFit:a,usage:L.VERTEX|L.COPY_DST}),l=new fe({data:i,label:"attribute-mesh-uvs",shrinkToFit:a,usage:L.VERTEX|L.COPY_DST}),h=new fe({data:n,label:"index-mesh-buffer",shrinkToFit:a,usage:L.INDEX|L.COPY_DST});super({attributes:{aPosition:{buffer:o,format:"float32x2",stride:2*4,offset:0},aUV:{buffer:l,format:"float32x2",stride:2*4,offset:0}},indexBuffer:h,topology:t.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(e){this.attributes.aPosition.buffer.data=e}get uvs(){return this.attributes.aUV.buffer.data}set uvs(e){this.attributes.aUV.buffer.data=e}get indices(){return this.indexBuffer.data}set indices(e){this.indexBuffer.data=e}};Ul.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let $i=Ul;class kp extends Ai{constructor(e,t){const{text:s,resolution:i,style:n,anchor:a,width:o,height:l,roundPixels:h,...c}=e;super({...c}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=t,this.text=s??"",this.style=n,this.resolution=i??null,this.allowChildren=!1,this._anchor=new le({_onUpdate:()=>{this.onViewUpdate()}}),a&&(this.anchor=a),this.roundPixels=h??!1,o!==void 0&&(this.width=o),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){var t;e||(e={}),(t=this._style)==null||t.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,t){typeof e=="object"?(t=e.height??e.width,e=e.width):t??(t=e),e!==void 0&&this._setWidth(e,this.bounds.width),t!==void 0&&this._setHeight(t,this.bounds.height)}containsPoint(e){const t=this.bounds.width,s=this.bounds.height,i=-t*this.anchor.x;let n=0;return e.x>=i&&e.x<=i+t&&(n=-s*this.anchor.y,e.y>=n&&e.y<=n+s)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e!=null&&e.style)&&this._style.destroy(e),this._style=null,this._text=null}}function Cp(r,e){let t=r[0]??{};return(typeof t=="string"||r[1])&&(U(H,`use new ${e}({ text: "hi!", style }) instead`),t={text:t,style:r[1]}),t}let st=null,Be=null;function Ep(r,e){st||(st=O.get().createCanvas(256,128),Be=st.getContext("2d",{willReadFrequently:!0}),Be.globalCompositeOperation="copy",Be.globalAlpha=1),(st.width<r||st.height<e)&&(st.width=vt(r),st.height=vt(e))}function Ia(r,e,t){for(let s=0,i=4*t*e;s<e;++s,i+=4)if(r[i+3]!==0)return!1;return!0}function Ga(r,e,t,s,i){const n=4*e;for(let a=s,o=s*n+4*t;a<=i;++a,o+=n)if(r[o+3]!==0)return!1;return!0}function Mp(...r){let e=r[0];e.canvas||(e={canvas:r[0],resolution:r[1]});const{canvas:t}=e,s=Math.min(e.resolution??1,1),i=e.width??t.width,n=e.height??t.height;let a=e.output;if(Ep(i,n),!Be)throw new TypeError("Failed to get canvas 2D context");Be.drawImage(t,0,0,i,n,0,0,i*s,n*s);const l=Be.getImageData(0,0,i,n).data;let h=0,c=0,u=i-1,d=n-1;for(;c<n&&Ia(l,i,c);)++c;if(c===n)return W.EMPTY;for(;Ia(l,i,d);)--d;for(;Ga(l,i,h,c,d);)++h;for(;Ga(l,i,u,c,d);)--u;return++u,++d,Be.globalCompositeOperation="source-over",Be.strokeRect(h,c,u-h,d-c),Be.globalCompositeOperation="copy",a??(a=new W),a.set(h/s,c/s,(u-h)/s,(d-c)/s),a}const Da=new W;class Fp{getCanvasAndContext(e){const{text:t,style:s,resolution:i=1}=e,n=s._getFinalPadding(),a=Te.measureText(t||" ",s),o=Math.ceil(Math.ceil(Math.max(1,a.width)+n*2)*i),l=Math.ceil(Math.ceil(Math.max(1,a.height)+n*2)*i),h=$e.getOptimalCanvasAndContext(o,l);this._renderTextToCanvas(t,s,n,i,h);const c=s.trim?Mp({canvas:h.canvas,width:o,height:l,resolution:1,output:Da}):Da.set(0,0,o,l);return{canvasAndContext:h,frame:c}}returnCanvasAndContext(e){$e.returnCanvasAndContext(e)}_renderTextToCanvas(e,t,s,i,n){var b,v,S,T;const{canvas:a,context:o}=n,l=Ys(t),h=Te.measureText(e||" ",t),c=h.lines,u=h.lineHeight,d=h.lineWidths,f=h.maxLineWidth,g=h.fontProperties,m=a.height;if(o.resetTransform(),o.scale(i,i),o.textBaseline=t.textBaseline,(b=t._stroke)!=null&&b.width){const w=t._stroke;o.lineWidth=w.width,o.miterLimit=w.miterLimit,o.lineJoin=w.join,o.lineCap=w.cap}o.font=l;let p,_;const x=t.dropShadow?2:1;for(let w=0;w<x;++w){const I=t.dropShadow&&w===0,R=I?Math.ceil(Math.max(1,m)+s*2):0,P=R*i;if(I){o.fillStyle="black",o.strokeStyle="black";const D=t.dropShadow,se=D.color,qe=D.alpha;o.shadowColor=V.shared.setValue(se).setAlpha(qe).toRgbaString();const F=D.blur*i,G=D.distance*i;o.shadowBlur=F,o.shadowOffsetX=Math.cos(D.angle)*G,o.shadowOffsetY=Math.sin(D.angle)*G+P}else{if(o.fillStyle=t._fill?$s(t._fill,o,h):null,(v=t._stroke)!=null&&v.width){const D=t._stroke.width*t._stroke.alignment;o.strokeStyle=$s(t._stroke,o,h,D)}o.shadowColor="black"}let A=(u-g.fontSize)/2;u-g.fontSize<0&&(A=0);const z=((S=t._stroke)==null?void 0:S.width)??0;for(let D=0;D<c.length;D++)p=z/2,_=z/2+D*u+g.ascent+A,t.align==="right"?p+=f-d[D]:t.align==="center"&&(p+=(f-d[D])/2),(T=t._stroke)!=null&&T.width&&this._drawLetterSpacing(c[D],t,n,p+s,_+s-R,!0),t._fill!==void 0&&this._drawLetterSpacing(c[D],t,n,p+s,_+s-R)}}_drawLetterSpacing(e,t,s,i,n,a=!1){const{context:o}=s,l=t.letterSpacing;let h=!1;if(Te.experimentalLetterSpacingSupported&&(Te.experimentalLetterSpacing?(o.letterSpacing=`${l}px`,o.textLetterSpacing=`${l}px`,h=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),l===0||h){a?o.strokeText(e,i,n):o.fillText(e,i,n);return}let c=i;const u=Te.graphemeSegmenter(e);let d=o.measureText(e).width,f=0;for(let g=0;g<u.length;++g){const m=u[g];a?o.strokeText(m,c,n):o.fillText(m,c,n);let p="";for(let _=g+1;_<u.length;++_)p+=u[_];f=o.measureText(p).width,c+=d-f+l,d=f}}}const Xt=new Fp;class Bp extends kp{constructor(...e){const t=Cp(e,"Text");super(t,Le),this.renderPipeId="text",t.textureStyle&&(this.textureStyle=t.textureStyle instanceof De?t.textureStyle:new De(t.textureStyle))}updateBounds(){const e=this._bounds,t=this._anchor;let s=0,i=0;if(this._style.trim){const{frame:n,canvasAndContext:a}=Xt.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Xt.returnCanvasAndContext(a),s=n.width,i=n.height}else{const n=Te.measureText(this._text,this._style);s=n.width,i=n.height}e.minX=-t._x*s,e.maxX=e.minX+s,e.minY=-t._y*i,e.maxY=e.minY+i}}function Rp(r){const e=r._stroke,t=r._fill,i=[`div { ${[`color: ${V.shared.setValue(t.color).toHex()}`,`font-size: ${r.fontSize}px`,`font-family: ${r.fontFamily}`,`font-weight: ${r.fontWeight}`,`font-style: ${r.fontStyle}`,`font-variant: ${r.fontVariant}`,`letter-spacing: ${r.letterSpacing}px`,`text-align: ${r.align}`,`padding: ${r.padding}px`,`white-space: ${r.whiteSpace==="pre"&&r.wordWrap?"pre-wrap":r.whiteSpace}`,...r.lineHeight?[`line-height: ${r.lineHeight}px`]:[],...r.wordWrap?[`word-wrap: ${r.breakWords?"break-all":"break-word"}`,`max-width: ${r.wordWrapWidth}px`]:[],...e?[Nl(e)]:[],...r.dropShadow?[Ll(r.dropShadow)]:[],...r.cssOverrides].join(";")} }`];return Ip(r.tagStyles,i),i.join(" ")}function Ll(r){const e=V.shared.setValue(r.color).setAlpha(r.alpha).toHexa(),t=Math.round(Math.cos(r.angle)*r.distance),s=Math.round(Math.sin(r.angle)*r.distance),i=`${t}px ${s}px`;return r.blur>0?`text-shadow: ${i} ${r.blur}px ${e}`:`text-shadow: ${i} ${e}`}function Nl(r){return[`-webkit-text-stroke-width: ${r.width}px`,`-webkit-text-stroke-color: ${V.shared.setValue(r.color).toHex()}`,`text-stroke-width: ${r.width}px`,`text-stroke-color: ${V.shared.setValue(r.color).toHex()}`,"paint-order: stroke"].join(";")}const Ua={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},Oa={fill:r=>`color: ${V.shared.setValue(r).toHex()}`,breakWords:r=>`word-wrap: ${r?"break-all":"break-word"}`,stroke:Nl,dropShadow:Ll};function Ip(r,e){for(const t in r){const s=r[t],i=[];for(const n in s)Oa[n]?i.push(Oa[n](s[n])):Ua[n]&&i.push(Ua[n].replace("{{VALUE}}",s[n]));e.push(`${t} { ${i.join(";")} }`)}}class Xi extends Le{constructor(e={}){super(e),this._cssOverrides=[],this.cssOverrides=e.cssOverrides??[],this.tagStyles=e.tagStyles??{}}set cssOverrides(e){this._cssOverrides=e instanceof Array?e:[e],this.update()}get cssOverrides(){return this._cssOverrides}update(){this._cssStyle=null,super.update()}clone(){return new Xi({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides,tagStyles:{...this.tagStyles}})}get cssStyle(){return this._cssStyle||(this._cssStyle=Rp(this)),this._cssStyle}addOverride(...e){const t=e.filter(s=>!this.cssOverrides.includes(s));t.length>0&&(this.cssOverrides.push(...t),this.update())}removeOverride(...e){const t=e.filter(s=>this.cssOverrides.includes(s));t.length>0&&(this.cssOverrides=this.cssOverrides.filter(s=>!t.includes(s)),this.update())}set fill(e){typeof e!="string"&&typeof e!="number"&&B("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=e}set stroke(e){e&&typeof e!="string"&&typeof e!="number"&&B("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=e}}const La="http://www.w3.org/2000/svg",Na="http://www.w3.org/1999/xhtml";class Hl{constructor(){this.svgRoot=document.createElementNS(La,"svg"),this.foreignObject=document.createElementNS(La,"foreignObject"),this.domElement=document.createElementNS(Na,"div"),this.styleElement=document.createElementNS(Na,"style"),this.image=new Image;const{foreignObject:e,svgRoot:t,styleElement:s,domElement:i}=this;e.setAttribute("width","10000"),e.setAttribute("height","10000"),e.style.overflow="hidden",t.appendChild(e),e.appendChild(s),e.appendChild(i)}}let Ha;function Gp(r,e,t,s){s||(s=Ha||(Ha=new Hl));const{domElement:i,styleElement:n,svgRoot:a}=s;i.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${r}</div>`,i.setAttribute("style","transform-origin: top left; display: inline-block"),t&&(n.textContent=t),document.body.appendChild(a);const o=i.getBoundingClientRect();a.remove();const l=e.padding*2;return{width:o.width-l,height:o.height-l}}class Wl{constructor(){this._tempState=Ae.for2d(),this._didUploadHash={}}init(e){e.renderer.runners.contextChange.add(this)}contextChange(){this._didUploadHash={}}start(e,t,s){const i=e.renderer,n=this._didUploadHash[s.uid];i.shader.bind(s,n),n||(this._didUploadHash[s.uid]=!0),i.shader.updateUniformGroup(i.globalUniforms.uniformGroup),i.geometry.bind(t,s.glProgram)}execute(e,t){const s=e.renderer;this._tempState.blendMode=t.blendMode,s.state.set(this._tempState);const i=t.textures.textures;for(let n=0;n<t.textures.count;n++)s.texture.bind(i[n],n);s.geometry.draw(t.topology,t.size,t.start)}}Wl.extension={type:[y.WebGLPipesAdaptor],name:"batch"};const Es=Ae.for2d();class Vl{start(e,t,s){const i=e.renderer,n=i.encoder,a=s.gpuProgram;this._shader=s,this._geometry=t,n.setGeometry(t,a),Es.blendMode="normal",i.pipeline.getPipeline(t,a,Es);const o=i.globalUniforms.bindGroup;n.resetBindGroup(1),n.setBindGroup(0,o,a)}execute(e,t){const s=this._shader.gpuProgram,i=e.renderer,n=i.encoder;if(!t.bindGroup){const l=t.textures;t.bindGroup=Fi(l.textures,l.count,i.limits.maxBatchableTextures)}Es.blendMode=t.blendMode;const a=i.bindGroup.getBindGroup(t.bindGroup,s,1),o=i.pipeline.getPipeline(this._geometry,s,Es,t.topology);t.bindGroup._touch(i.textureGC.count),n.setPipeline(o),n.renderPassEncoder.setBindGroup(1,a),n.renderPassEncoder.drawIndexed(t.size,1,t.start)}}Vl.extension={type:[y.WebGPUPipesAdaptor],name:"batch"};const Ki=class zl{constructor(e,t){var s,i;this.state=Ae.for2d(),this._batchersByInstructionSet=Object.create(null),this._activeBatches=Object.create(null),this.renderer=e,this._adaptor=t,(i=(s=this._adaptor).init)==null||i.call(s,this)}static getBatcher(e){return new this._availableBatchers[e]}buildStart(e){let t=this._batchersByInstructionSet[e.uid];t||(t=this._batchersByInstructionSet[e.uid]=Object.create(null),t.default||(t.default=new Ui({maxTextures:this.renderer.limits.maxBatchableTextures}))),this._activeBatches=t,this._activeBatch=this._activeBatches.default;for(const s in this._activeBatches)this._activeBatches[s].begin()}addToBatch(e,t){if(this._activeBatch.name!==e.batcherName){this._activeBatch.break(t);let s=this._activeBatches[e.batcherName];s||(s=this._activeBatches[e.batcherName]=zl.getBatcher(e.batcherName),s.begin()),this._activeBatch=s}this._activeBatch.add(e)}break(e){this._activeBatch.break(e)}buildEnd(e){this._activeBatch.break(e);const t=this._activeBatches;for(const s in t){const i=t[s],n=i.geometry;n.indexBuffer.setDataWithSize(i.indexBuffer,i.indexSize,!0),n.buffers[0].setDataWithSize(i.attributeBuffer.float32View,i.attributeSize,!1)}}upload(e){const t=this._batchersByInstructionSet[e.uid];for(const s in t){const i=t[s],n=i.geometry;i.dirty&&(i.dirty=!1,n.buffers[0].update(i.attributeSize*4))}}execute(e){if(e.action==="startBatch"){const t=e.batcher,s=t.geometry,i=t.shader;this._adaptor.start(this,s,i)}this._adaptor.execute(this,e)}destroy(){this.state=null,this.renderer=null,this._adaptor=null;for(const e in this._activeBatches)this._activeBatches[e].destroy();this._activeBatches=null}};Ki.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"batch"};Ki._availableBatchers=Object.create(null);let Yl=Ki;M.handleByMap(y.Batcher,Yl._availableBatchers);M.add(Ui);const Kt={name:"local-uniform-bit",vertex:{header:`

            struct LocalUniforms {
                uTransformMatrix:mat3x3<f32>,
                uColor:vec4<f32>,
                uRound:f32,
            }

            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `}},Dp={...Kt,vertex:{...Kt.vertex,header:Kt.vertex.header.replace("group(1)","group(2)")}},qi={name:"local-uniform-bit",vertex:{header:`

            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix = uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `}},Up={name:"texture-bit",vertex:{header:`

        struct TextureUniforms {
            uTextureMatrix:mat3x3<f32>,
        }

        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;
        `,main:`
            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;
        `},fragment:{header:`
            @group(2) @binding(0) var uTexture: texture_2d<f32>;
            @group(2) @binding(1) var uSampler: sampler;


        `,main:`
            outColor = textureSample(uTexture, uSampler, vUV);
        `}},Op={name:"texture-bit",vertex:{header:`
            uniform mat3 uTextureMatrix;
        `,main:`
            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;
        `},fragment:{header:`
        uniform sampler2D uTexture;


        `,main:`
            outColor = texture(uTexture, vUV);
        `}},Lp=new ie;class Np extends Ns{constructor(){super(),this.filters=[new Pp({sprite:new Ue(k.EMPTY),inverse:!1,resolution:"inherit",antialias:"inherit"})]}get sprite(){return this.filters[0].sprite}set sprite(e){this.filters[0].sprite=e}get inverse(){return this.filters[0].inverse}set inverse(e){this.filters[0].inverse=e}}class jl{constructor(e){this._activeMaskStage=[],this._renderer=e}push(e,t,s){const i=this._renderer;if(i.renderPipes.batch.break(s),s.add({renderPipeId:"alphaMask",action:"pushMaskBegin",mask:e,inverse:t._maskOptions.inverse,canBundle:!1,maskedContainer:t}),e.inverse=t._maskOptions.inverse,e.renderMaskToTexture){const n=e.mask;n.includeInBuild=!0,n.collectRenderables(s,i,null),n.includeInBuild=!1}i.renderPipes.batch.break(s),s.add({renderPipeId:"alphaMask",action:"pushMaskEnd",mask:e,maskedContainer:t,inverse:t._maskOptions.inverse,canBundle:!1})}pop(e,t,s){this._renderer.renderPipes.batch.break(s),s.add({renderPipeId:"alphaMask",action:"popMaskEnd",mask:e,inverse:t._maskOptions.inverse,canBundle:!1})}execute(e){const t=this._renderer,s=e.mask.renderMaskToTexture;if(e.action==="pushMaskBegin"){const i=te.get(Np);if(i.inverse=e.inverse,s){e.mask.mask.measurable=!0;const n=vi(e.mask.mask,!0,Lp);e.mask.mask.measurable=!1,n.ceil();const a=t.renderTarget.renderTarget.colorTexture.source,o=re.getOptimalTexture(n.width,n.height,a._resolution,a.antialias);t.renderTarget.push(o,!0),t.globalUniforms.push({offset:n,worldColor:4294967295});const l=i.sprite;l.texture=o,l.worldTransform.tx=n.minX,l.worldTransform.ty=n.minY,this._activeMaskStage.push({filterEffect:i,maskedContainer:e.maskedContainer,filterTexture:o})}else i.sprite=e.mask.mask,this._activeMaskStage.push({filterEffect:i,maskedContainer:e.maskedContainer})}else if(e.action==="pushMaskEnd"){const i=this._activeMaskStage[this._activeMaskStage.length-1];s&&(t.type===Se.WEBGL&&t.renderTarget.finishRenderPass(),t.renderTarget.pop(),t.globalUniforms.pop()),t.filter.push({renderPipeId:"filter",action:"pushFilter",container:i.maskedContainer,filterEffect:i.filterEffect,canBundle:!1})}else if(e.action==="popMaskEnd"){t.filter.pop();const i=this._activeMaskStage.pop();s&&re.returnTexture(i.filterTexture),te.return(i.filterEffect)}}destroy(){this._renderer=null,this._activeMaskStage=null}}jl.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"alphaMask"};class $l{constructor(e){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=e}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(e,t,s){this._renderer.renderPipes.batch.break(s);const n=this._colorStack;n[this._colorStackIndex]=n[this._colorStackIndex-1]&e.mask;const a=this._colorStack[this._colorStackIndex];a!==this._currentColor&&(this._currentColor=a,s.add({renderPipeId:"colorMask",colorMask:a,canBundle:!1})),this._colorStackIndex++}pop(e,t,s){this._renderer.renderPipes.batch.break(s);const n=this._colorStack;this._colorStackIndex--;const a=n[this._colorStackIndex-1];a!==this._currentColor&&(this._currentColor=a,s.add({renderPipeId:"colorMask",colorMask:a,canBundle:!1}))}execute(e){this._renderer.colorMask.setMask(e.colorMask)}destroy(){this._colorStack=null}}$l.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"colorMask"};class Xl{constructor(e){this._maskStackHash={},this._maskHash=new WeakMap,this._renderer=e}push(e,t,s){var i;const n=e,a=this._renderer;a.renderPipes.batch.break(s),a.renderPipes.blendMode.setBlendMode(n.mask,"none",s),s.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:e,inverse:t._maskOptions.inverse,canBundle:!1});const o=n.mask;o.includeInBuild=!0,this._maskHash.has(n)||this._maskHash.set(n,{instructionsStart:0,instructionsLength:0});const l=this._maskHash.get(n);l.instructionsStart=s.instructionSize,o.collectRenderables(s,a,null),o.includeInBuild=!1,a.renderPipes.batch.break(s),s.add({renderPipeId:"stencilMask",action:"pushMaskEnd",mask:e,inverse:t._maskOptions.inverse,canBundle:!1});const h=s.instructionSize-l.instructionsStart-1;l.instructionsLength=h;const c=a.renderTarget.renderTarget.uid;(i=this._maskStackHash)[c]??(i[c]=0)}pop(e,t,s){const i=e,n=this._renderer;n.renderPipes.batch.break(s),n.renderPipes.blendMode.setBlendMode(i.mask,"none",s),s.add({renderPipeId:"stencilMask",action:"popMaskBegin",inverse:t._maskOptions.inverse,canBundle:!1});const a=this._maskHash.get(e);for(let o=0;o<a.instructionsLength;o++)s.instructions[s.instructionSize++]=s.instructions[a.instructionsStart++];s.add({renderPipeId:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(e){var t;const s=this._renderer,i=s.renderTarget.renderTarget.uid;let n=(t=this._maskStackHash)[i]??(t[i]=0);e.action==="pushMaskBegin"?(s.renderTarget.ensureDepthStencil(),s.stencil.setStencilMode(Q.RENDERING_MASK_ADD,n),n++,s.colorMask.setMask(0)):e.action==="pushMaskEnd"?(e.inverse?s.stencil.setStencilMode(Q.INVERSE_MASK_ACTIVE,n):s.stencil.setStencilMode(Q.MASK_ACTIVE,n),s.colorMask.setMask(15)):e.action==="popMaskBegin"?(s.colorMask.setMask(0),n!==0?s.stencil.setStencilMode(Q.RENDERING_MASK_REMOVE,n):(s.renderTarget.clear(null,ue.STENCIL),s.stencil.setStencilMode(Q.DISABLED,n)),n--):e.action==="popMaskEnd"&&(e.inverse?s.stencil.setStencilMode(Q.INVERSE_MASK_ACTIVE,n):s.stencil.setStencilMode(Q.MASK_ACTIVE,n),s.colorMask.setMask(15)),this._maskStackHash[i]=n}destroy(){this._renderer=null,this._maskStackHash=null,this._maskHash=null}}Xl.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"stencilMask"};var Ds=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(Ds||{});class Hp{constructor(e,t){this._lastBindBaseLocation=-1,this._lastBindCallId=-1,this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.type=t}}class Kl{constructor(e){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._minBaseLocation=0,this._nextBindBaseIndex=this._minBaseLocation,this._bindCallId=0,this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){this._gl=this._renderer.gl,this._gpuBuffers=Object.create(null),this._maxBindings=this._renderer.limits.maxUniformBindings}getGlBuffer(e){return this._gpuBuffers[e.uid]||this.createGLBuffer(e)}bind(e){const{_gl:t}=this,s=this.getGlBuffer(e);t.bindBuffer(s.type,s.buffer)}bindBufferBase(e,t){const{_gl:s}=this;this._boundBufferBases[t]!==e&&(this._boundBufferBases[t]=e,e._lastBindBaseLocation=t,s.bindBufferBase(s.UNIFORM_BUFFER,t,e.buffer))}nextBindBase(e){this._bindCallId++,this._minBaseLocation=0,e&&(this._boundBufferBases[0]=null,this._minBaseLocation=1,this._nextBindBaseIndex<1&&(this._nextBindBaseIndex=1))}freeLocationForBufferBase(e){let t=this.getLastBindBaseLocation(e);if(t>=this._minBaseLocation)return e._lastBindCallId=this._bindCallId,t;let s=0,i=this._nextBindBaseIndex;for(;s<2;){i>=this._maxBindings&&(i=this._minBaseLocation,s++);const n=this._boundBufferBases[i];if(n&&n._lastBindCallId===this._bindCallId){i++;continue}break}return t=i,this._nextBindBaseIndex=i+1,s>=2?-1:(e._lastBindCallId=this._bindCallId,this._boundBufferBases[t]=null,t)}getLastBindBaseLocation(e){const t=e._lastBindBaseLocation;return this._boundBufferBases[t]===e?t:-1}bindBufferRange(e,t,s,i){const{_gl:n}=this;s||(s=0),t||(t=0),this._boundBufferBases[t]=null,n.bindBufferRange(n.UNIFORM_BUFFER,t||0,e.buffer,s*256,i||256)}updateBuffer(e){const{_gl:t}=this,s=this.getGlBuffer(e);if(e._updateID===s.updateID)return s;s.updateID=e._updateID,t.bindBuffer(s.type,s.buffer);const i=e.data,n=e.descriptor.usage&L.STATIC?t.STATIC_DRAW:t.DYNAMIC_DRAW;return i?s.byteLength>=i.byteLength?t.bufferSubData(s.type,0,i,0,e._updateSize/i.BYTES_PER_ELEMENT):(s.byteLength=i.byteLength,t.bufferData(s.type,i,n)):(s.byteLength=e.descriptor.size,t.bufferData(s.type,s.byteLength,n)),s}destroyAll(){const e=this._gl;for(const t in this._gpuBuffers)e.deleteBuffer(this._gpuBuffers[t].buffer);this._gpuBuffers=Object.create(null)}onBufferDestroy(e,t){const s=this._gpuBuffers[e.uid],i=this._gl;t||i.deleteBuffer(s.buffer),this._gpuBuffers[e.uid]=null}createGLBuffer(e){const{_gl:t}=this;let s=Ds.ARRAY_BUFFER;e.descriptor.usage&L.INDEX?s=Ds.ELEMENT_ARRAY_BUFFER:e.descriptor.usage&L.UNIFORM&&(s=Ds.UNIFORM_BUFFER);const i=new Hp(t.createBuffer(),s);return this._gpuBuffers[e.uid]=i,e.on("destroy",this.onBufferDestroy,this),i}resetState(){this._boundBufferBases=Object.create(null)}}Kl.extension={type:[y.WebGLSystem],name:"buffer"};const Zi=class ql{constructor(e){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=e,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this._renderer.gl=e}init(e){e={...ql.defaultOptions,...e};let t=this.multiView=e.multiView;if(e.context&&t&&(B("Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together."),t=!1),t?this.canvas=O.get().createCanvas(this._renderer.canvas.width,this._renderer.canvas.height):this.canvas=this._renderer.view.canvas,e.context)this.initFromContext(e.context);else{const s=this._renderer.background.alpha<1,i=e.premultipliedAlpha??!0,n=e.antialias&&!this._renderer.backBuffer.useBackBuffer;this.createContext(e.preferWebGLVersion,{alpha:s,premultipliedAlpha:i,antialias:n,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference??"default"})}}ensureCanvasSize(e){if(!this.multiView){e!==this.canvas&&B("multiView is disabled, but targetCanvas is not the main canvas");return}const{canvas:t}=this;(t.width<e.width||t.height<e.height)&&(t.width=Math.max(e.width,e.width),t.height=Math.max(e.height,e.height))}initFromContext(e){this.gl=e,this.webGLVersion=e instanceof O.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(e),this._renderer.runners.contextChange.emit(e);const t=this._renderer.view.canvas;t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(e,t){let s;const i=this.canvas;if(e===2&&(s=i.getContext("webgl2",t)),!s&&(s=i.getContext("webgl",t),!s))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=s,this.initFromContext(this.gl)}getExtensions(){const{gl:e}=this,t={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc"),rgtc:e.getExtension("EXT_texture_compression_rgtc"),loseContext:e.getExtension("WEBGL_lose_context")};if(this.webGLVersion===1)this.extensions={...t,drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:e.getExtension("ANGLE_instanced_arrays"),srgb:e.getExtension("EXT_sRGB")};else{this.extensions={...t,colorBufferFloat:e.getExtension("EXT_color_buffer_float")};const s=e.getExtension("WEBGL_provoking_vertex");s&&s.provokingVertexWEBGL(s.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(e){e.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout(()=>{var t;this.gl.isContextLost()&&((t=this.extensions.loseContext)==null||t.restoreContext())},0))}handleContextRestored(){this.getExtensions(),this._renderer.runners.contextChange.emit(this.gl)}destroy(){var t;const e=this._renderer.view.canvas;this._renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),(t=this.extensions.loseContext)==null||t.loseContext()}forceContextLoss(){var e;(e=this.extensions.loseContext)==null||e.loseContext(),this._contextLossForced=!0}validateContext(e){const t=e.getContextAttributes();t&&!t.stencil&&B("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=this.supports,i=this.webGLVersion===2,n=this.extensions;s.uint32Indices=i||!!n.uint32ElementIndex,s.uniformBufferObject=i,s.vertexArrayObject=i||!!n.vertexArrayObject,s.srgbTextures=i||!!n.srgb,s.nonPowOf2wrapping=i,s.nonPowOf2mipmaps=i,s.msaa=i,s.uint32Indices||B("Provided WebGL context does not support 32 index buffer, large scenes may not render correctly")}};Zi.extension={type:[y.WebGLSystem],name:"context"};Zi.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};let Wp=Zi;function Zl(r,e){for(const t in r.attributes){const s=r.attributes[t],i=e[t];i?(s.format??(s.format=i.format),s.offset??(s.offset=i.offset),s.instance??(s.instance=i.instance)):B(`Attribute ${t} is not present in the shader, but is present in the geometry. Unable to infer attribute details.`)}Vp(r)}function Vp(r){const{buffers:e,attributes:t}=r,s={},i={};for(const n in e){const a=e[n];s[a.uid]=0,i[a.uid]=0}for(const n in t){const a=t[n];s[a.buffer.uid]+=je(a.format).stride}for(const n in t){const a=t[n];a.stride??(a.stride=s[a.buffer.uid]),a.start??(a.start=i[a.buffer.uid]),i[a.buffer.uid]+=je(a.format).stride}}var fi=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(fi||{}),Ql=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(Ql||{}),N=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(N||{});const Wa={uint8x2:N.UNSIGNED_BYTE,uint8x4:N.UNSIGNED_BYTE,sint8x2:N.BYTE,sint8x4:N.BYTE,unorm8x2:N.UNSIGNED_BYTE,unorm8x4:N.UNSIGNED_BYTE,snorm8x2:N.BYTE,snorm8x4:N.BYTE,uint16x2:N.UNSIGNED_SHORT,uint16x4:N.UNSIGNED_SHORT,sint16x2:N.SHORT,sint16x4:N.SHORT,unorm16x2:N.UNSIGNED_SHORT,unorm16x4:N.UNSIGNED_SHORT,snorm16x2:N.SHORT,snorm16x4:N.SHORT,float16x2:N.HALF_FLOAT,float16x4:N.HALF_FLOAT,float32:N.FLOAT,float32x2:N.FLOAT,float32x3:N.FLOAT,float32x4:N.FLOAT,uint32:N.UNSIGNED_INT,uint32x2:N.UNSIGNED_INT,uint32x3:N.UNSIGNED_INT,uint32x4:N.UNSIGNED_INT,sint32:N.INT,sint32x2:N.INT,sint32x3:N.INT,sint32x4:N.INT};function zp(r){return Wa[r]??Wa.float32}const Yp={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class Jl{constructor(e){this._geometryVaoHash=Object.create(null),this._renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this._renderer.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){const e=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const t=this._renderer.context.extensions.vertexArrayObject;t&&(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=i=>t.bindVertexArrayOES(i),e.deleteVertexArray=i=>t.deleteVertexArrayOES(i));const s=this._renderer.context.extensions.vertexAttribDivisorANGLE;s&&(e.drawArraysInstanced=(i,n,a,o)=>{s.drawArraysInstancedANGLE(i,n,a,o)},e.drawElementsInstanced=(i,n,a,o,l)=>{s.drawElementsInstancedANGLE(i,n,a,o,l)},e.vertexAttribDivisor=(i,n)=>s.vertexAttribDivisorANGLE(i,n)),this._activeGeometry=null,this._activeVao=null,this._geometryVaoHash=Object.create(null)}bind(e,t){const s=this.gl;this._activeGeometry=e;const i=this.getVao(e,t);this._activeVao!==i&&(this._activeVao=i,s.bindVertexArray(i)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this._renderer.buffer;for(let s=0;s<e.buffers.length;s++){const i=e.buffers[s];t.updateBuffer(i)}}checkCompatibility(e,t){const s=e.attributes,i=t._attributeData;for(const n in i)if(!s[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,t){const s=e.attributes,i=t._attributeData,n=["g",e.uid];for(const a in s)i[a]&&n.push(a,i[a].location);return n.join("-")}getVao(e,t){var s;return((s=this._geometryVaoHash[e.uid])==null?void 0:s[t._key])||this.initGeometryVao(e,t)}initGeometryVao(e,t,s=!0){const i=this._renderer.gl,n=this._renderer.buffer;this._renderer.shader._getProgramData(t),this.checkCompatibility(e,t);const a=this.getSignature(e,t);this._geometryVaoHash[e.uid]||(this._geometryVaoHash[e.uid]=Object.create(null),e.on("destroy",this.onGeometryDestroy,this));const o=this._geometryVaoHash[e.uid];let l=o[a];if(l)return o[t._key]=l,l;Zl(e,t._attributeData);const h=e.buffers;l=i.createVertexArray(),i.bindVertexArray(l);for(let c=0;c<h.length;c++){const u=h[c];n.bind(u)}return this.activateVao(e,t),o[t._key]=l,o[a]=l,i.bindVertexArray(null),l}onGeometryDestroy(e,t){const s=this._geometryVaoHash[e.uid],i=this.gl;if(s){if(t)for(const n in s)this._activeVao!==s[n]&&this.unbind(),i.deleteVertexArray(s[n]);this._geometryVaoHash[e.uid]=null}}destroyAll(e=!1){const t=this.gl;for(const s in this._geometryVaoHash){if(e)for(const i in this._geometryVaoHash[s]){const n=this._geometryVaoHash[s];this._activeVao!==n&&this.unbind(),t.deleteVertexArray(n[i])}this._geometryVaoHash[s]=null}}activateVao(e,t){var o;const s=this._renderer.gl,i=this._renderer.buffer,n=e.attributes;e.indexBuffer&&i.bind(e.indexBuffer);let a=null;for(const l in n){const h=n[l],c=h.buffer,u=i.getGlBuffer(c),d=t._attributeData[l];if(d){a!==u&&(i.bind(c),a=u);const f=d.location;s.enableVertexAttribArray(f);const g=je(h.format),m=zp(h.format);if(((o=d.format)==null?void 0:o.substring(1,4))==="int"?s.vertexAttribIPointer(f,g.size,m,h.stride,h.offset):s.vertexAttribPointer(f,g.size,m,g.normalised,h.stride,h.offset),h.instance)if(this.hasInstance){const p=h.divisor??1;s.vertexAttribDivisor(f,p)}else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,s,i){const{gl:n}=this._renderer,a=this._activeGeometry,o=Yp[e||a.topology];if(i??(i=a.instanceCount),a.indexBuffer){const l=a.indexBuffer.data.BYTES_PER_ELEMENT,h=l===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;i>1?n.drawElementsInstanced(o,t||a.indexBuffer.data.length,h,(s||0)*l,i):n.drawElements(o,t||a.indexBuffer.data.length,h,(s||0)*l)}else i>1?n.drawArraysInstanced(o,s||0,t||a.getSize(),i):n.drawArrays(o,s||0,t||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}Jl.extension={type:[y.WebGLSystem],name:"geometry"};const jp=new as({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),Qi=class eh{constructor(e){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=e}init(e={}){const{useBackBuffer:t,antialias:s}={...eh.defaultOptions,...e};this.useBackBuffer=t,this._antialias=s,this._renderer.context.supports.msaa||(B("antialiasing, is not supported on when using the back buffer"),this._antialias=!1),this._state=Ae.for2d();const i=new kt({vertex:`
                attribute vec2 aPosition;
                out vec2 vUv;

                void main() {
                    gl_Position = vec4(aPosition, 0.0, 1.0);

                    vUv = (aPosition + 1.0) / 2.0;

                    // flip dem UVs
                    vUv.y = 1.0 - vUv.y;
                }`,fragment:`
                in vec2 vUv;
                out vec4 finalColor;

                uniform sampler2D uTexture;

                void main() {
                    finalColor = texture(uTexture, vUv);
                }`,name:"big-triangle"});this._bigTriangleShader=new xe({glProgram:i,resources:{uTexture:k.WHITE.source}})}renderStart(e){const t=this._renderer.renderTarget.getRenderTarget(e.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!t.isRoot,this._useBackBufferThisRender){const s=this._renderer.renderTarget.getRenderTarget(e.target);this._targetTexture=s.colorTexture,e.target=this._getBackBufferTexture(s.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){const e=this._renderer;e.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(e.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,e.encoder.draw({geometry:jp,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(e){return this._backBufferTexture=this._backBufferTexture||new k({source:new J({width:e.width,height:e.height,resolution:e._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(e.width,e.height,e._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};Qi.extension={type:[y.WebGLSystem],name:"backBuffer",priority:1};Qi.defaultOptions={useBackBuffer:!1};let $p=Qi;class th{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.gl.colorMask(!!(e&8),!!(e&4),!!(e&2),!!(e&1)))}}th.extension={type:[y.WebGLSystem],name:"colorMask"};class sh{constructor(e){this.commandFinished=Promise.resolve(),this._renderer=e}setGeometry(e,t){this._renderer.geometry.bind(e,t.glProgram)}finishRenderPass(){}draw(e){const t=this._renderer,{geometry:s,shader:i,state:n,skipSync:a,topology:o,size:l,start:h,instanceCount:c}=e;t.shader.bind(i,a),t.geometry.bind(s,t.shader._activeProgram),n&&t.state.set(n),t.geometry.draw(o,l,h,c??s.instanceCount)}destroy(){this._renderer=null}}sh.extension={type:[y.WebGLSystem],name:"encoder"};class rh{constructor(e){this._renderer=e}contextChange(){const e=this._renderer.gl;this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxBatchableTextures=ol(this.maxTextures,e),this.maxUniformBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS)}destroy(){}}rh.extension={type:[y.WebGLSystem],name:"limits"};class Xp{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}const Ke=[];Ke[Q.NONE]=void 0;Ke[Q.DISABLED]={stencilWriteMask:0,stencilReadMask:0};Ke[Q.RENDERING_MASK_ADD]={stencilFront:{compare:"equal",passOp:"increment-clamp"},stencilBack:{compare:"equal",passOp:"increment-clamp"}};Ke[Q.RENDERING_MASK_REMOVE]={stencilFront:{compare:"equal",passOp:"decrement-clamp"},stencilBack:{compare:"equal",passOp:"decrement-clamp"}};Ke[Q.MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"equal",passOp:"keep"},stencilBack:{compare:"equal",passOp:"keep"}};Ke[Q.INVERSE_MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"not-equal",passOp:"keep"},stencilBack:{compare:"not-equal",passOp:"keep"}};class ih{constructor(e){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:Q.NONE},this._renderTargetStencilState=Object.create(null),e.renderTarget.onRenderTargetChange.add(this)}contextChange(e){this._gl=e,this._comparisonFuncMapping={always:e.ALWAYS,never:e.NEVER,equal:e.EQUAL,"not-equal":e.NOTEQUAL,less:e.LESS,"less-equal":e.LEQUAL,greater:e.GREATER,"greater-equal":e.GEQUAL},this._stencilOpsMapping={keep:e.KEEP,zero:e.ZERO,replace:e.REPLACE,invert:e.INVERT,"increment-clamp":e.INCR,"decrement-clamp":e.DECR,"increment-wrap":e.INCR_WRAP,"decrement-wrap":e.DECR_WRAP},this.resetState()}onRenderTargetChange(e){if(this._activeRenderTarget===e)return;this._activeRenderTarget=e;let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:Q.DISABLED,stencilReference:0}),this.setStencilMode(t.stencilMode,t.stencilReference)}resetState(){this._stencilCache.enabled=!1,this._stencilCache.stencilMode=Q.NONE,this._stencilCache.stencilReference=0}setStencilMode(e,t){const s=this._renderTargetStencilState[this._activeRenderTarget.uid],i=this._gl,n=Ke[e],a=this._stencilCache;if(s.stencilMode=e,s.stencilReference=t,e===Q.DISABLED){this._stencilCache.enabled&&(this._stencilCache.enabled=!1,i.disable(i.STENCIL_TEST));return}this._stencilCache.enabled||(this._stencilCache.enabled=!0,i.enable(i.STENCIL_TEST)),(e!==a.stencilMode||a.stencilReference!==t)&&(a.stencilMode=e,a.stencilReference=t,i.stencilFunc(this._comparisonFuncMapping[n.stencilBack.compare],t,255),i.stencilOp(i.KEEP,i.KEEP,this._stencilOpsMapping[n.stencilBack.passOp]))}}ih.extension={type:[y.WebGLSystem],name:"stencil"};class nh{constructor(e){this._syncFunctionHash=Object.create(null),this._adaptor=e,this._systemCheck()}_systemCheck(){if(!Yo())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}ensureUniformGroup(e){const t=this.getUniformGroupData(e);e.buffer||(e.buffer=new fe({data:new Float32Array(t.layout.size/4),usage:L.UNIFORM|L.COPY_DST}))}getUniformGroupData(e){return this._syncFunctionHash[e._signature]||this._initUniformGroup(e)}_initUniformGroup(e){const t=e._signature;let s=this._syncFunctionHash[t];if(!s){const i=Object.keys(e.uniformStructures).map(o=>e.uniformStructures[o]),n=this._adaptor.createUboElements(i),a=this._generateUboSync(n.uboElements);s=this._syncFunctionHash[t]={layout:n,syncFunction:a}}return this._syncFunctionHash[t]}_generateUboSync(e){return this._adaptor.generateUboSync(e)}syncUniformGroup(e,t,s){const i=this.getUniformGroupData(e);e.buffer||(e.buffer=new fe({data:new Float32Array(i.layout.size/4),usage:L.UNIFORM|L.COPY_DST}));let n=null;return t||(t=e.buffer.data,n=e.buffer.dataInt32),s||(s=0),i.syncFunction(e.uniforms,t,n,s),!0}updateUniformGroup(e){if(e.isStatic&&!e._dirtyId)return!1;e._dirtyId=0;const t=this.syncUniformGroup(e);return e.buffer.update(),t}destroy(){this._syncFunctionHash=null}}const ah={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":16*2,"mat3x3<f32>":16*3,"mat4x4<f32>":16*4};function Kp(r){const e=r.map(n=>({data:n,offset:0,size:0})),t=16;let s=0,i=0;for(let n=0;n<e.length;n++){const a=e[n];if(s=ah[a.data.type],!s)throw new Error(`Unknown type ${a.data.type}`);a.data.size>1&&(s=Math.max(s,t)*a.data.size);const o=s===12?16:s;a.size=s;const l=i%t;l>0&&t-l<o?i+=(t-l)%16:i+=(s-l%s)%s,a.offset=i,i+=s}return i=Math.ceil(i/16)*16,{uboElements:e,size:i}}const ht=[{type:"mat3x3<f32>",test:r=>r.value.a!==void 0,ubo:`
            var matrix = uv[name].toArray(true);
            data[offset] = matrix[0];
            data[offset + 1] = matrix[1];
            data[offset + 2] = matrix[2];
            data[offset + 4] = matrix[3];
            data[offset + 5] = matrix[4];
            data[offset + 6] = matrix[5];
            data[offset + 8] = matrix[6];
            data[offset + 9] = matrix[7];
            data[offset + 10] = matrix[8];
        `,uniform:`
            gl.uniformMatrix3fv(ud[name].location, false, uv[name].toArray(true));
        `},{type:"vec4<f32>",test:r=>r.type==="vec4<f32>"&&r.size===1&&r.value.width!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.x;
            data[offset + 1] = v.y;
            data[offset + 2] = v.width;
            data[offset + 3] = v.height;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height) {
                cv[0] = v.x;
                cv[1] = v.y;
                cv[2] = v.width;
                cv[3] = v.height;
                gl.uniform4f(ud[name].location, v.x, v.y, v.width, v.height);
            }
        `},{type:"vec2<f32>",test:r=>r.type==="vec2<f32>"&&r.size===1&&r.value.x!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.x;
            data[offset + 1] = v.y;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.x || cv[1] !== v.y) {
                cv[0] = v.x;
                cv[1] = v.y;
                gl.uniform2f(ud[name].location, v.x, v.y);
            }
        `},{type:"vec4<f32>",test:r=>r.type==="vec4<f32>"&&r.size===1&&r.value.red!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.red;
            data[offset + 1] = v.green;
            data[offset + 2] = v.blue;
            data[offset + 3] = v.alpha;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha) {
                cv[0] = v.red;
                cv[1] = v.green;
                cv[2] = v.blue;
                cv[3] = v.alpha;
                gl.uniform4f(ud[name].location, v.red, v.green, v.blue, v.alpha);
            }
        `},{type:"vec3<f32>",test:r=>r.type==="vec3<f32>"&&r.size===1&&r.value.red!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.red;
            data[offset + 1] = v.green;
            data[offset + 2] = v.blue;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue) {
                cv[0] = v.red;
                cv[1] = v.green;
                cv[2] = v.blue;
                gl.uniform3f(ud[name].location, v.red, v.green, v.blue);
            }
        `}];function oh(r,e,t,s){const i=[`
        var v = null;
        var v2 = null;
        var t = 0;
        var index = 0;
        var name = null;
        var arrayOffset = null;
    `];let n=0;for(let o=0;o<r.length;o++){const l=r[o],h=l.data.name;let c=!1,u=0;for(let d=0;d<ht.length;d++)if(ht[d].test(l.data)){u=l.offset/4,i.push(`name = "${h}";`,`offset += ${u-n};`,ht[d][e]||ht[d].ubo),c=!0;break}if(!c)if(l.data.size>1)u=l.offset/4,i.push(t(l,u-n));else{const d=s[l.data.type];u=l.offset/4,i.push(`
                    v = uv.${h};
                    offset += ${u-n};
                    ${d};
                `)}n=u}const a=i.join(`
`);return new Function("uv","data","dataInt32","offset",a)}function mt(r,e){return`
        for (let i = 0; i < ${r*e}; i++) {
            data[offset + (((i / ${r})|0) * 4) + (i % ${r})] = v[i];
        }
    `}const lh={f32:`
        data[offset] = v;`,i32:`
        dataInt32[offset] = v;`,"vec2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];`,"vec3<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];`,"vec4<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 3] = v[3];`,"vec2<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];`,"vec3<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];
        dataInt32[offset + 2] = v[2];`,"vec4<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];
        dataInt32[offset + 2] = v[2];
        dataInt32[offset + 3] = v[3];`,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 4] = v[2];
        data[offset + 5] = v[3];`,"mat3x3<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];
        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];`,"mat4x4<f32>":`
        for (let i = 0; i < 16; i++) {
            data[offset + i] = v[i];
        }`,"mat3x2<f32>":mt(3,2),"mat4x2<f32>":mt(4,2),"mat2x3<f32>":mt(2,3),"mat4x3<f32>":mt(4,3),"mat2x4<f32>":mt(2,4),"mat3x4<f32>":mt(3,4)},qp={...lh,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 3] = v[3];
    `};function Zp(r,e){const t=Math.max(ah[r.data.type]/16,1),s=r.data.value.length/r.data.size,i=(4-s%4)%4,n=r.data.type.indexOf("i32")>=0?"dataInt32":"data";return`
        v = uv.${r.data.name};
        offset += ${e};

        arrayOffset = offset;

        t = 0;

        for(var i=0; i < ${r.data.size*t}; i++)
        {
            for(var j = 0; j < ${s}; j++)
            {
                ${n}[arrayOffset++] = v[t++];
            }
            ${i!==0?`arrayOffset += ${i};`:""}
        }
    `}function Qp(r){return oh(r,"uboStd40",Zp,lh)}class hh extends nh{constructor(){super({createUboElements:Kp,generateUboSync:Qp})}}hh.extension={type:[y.WebGLSystem],name:"ubo"};class Jp{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new W}init(e,t){this._renderer=e,this._renderTargetSystem=t,e.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new W}copyToTexture(e,t,s,i,n){const a=this._renderTargetSystem,o=this._renderer,l=a.getGpuRenderTarget(e),h=o.gl;return this.finishRenderPass(e),h.bindFramebuffer(h.FRAMEBUFFER,l.resolveTargetFramebuffer),o.texture.bind(t,0),h.copyTexSubImage2D(h.TEXTURE_2D,0,n.x,n.y,s.x,s.y,i.width,i.height),t}startRenderPass(e,t=!0,s,i){const n=this._renderTargetSystem,a=e.colorTexture,o=n.getGpuRenderTarget(e);let l=i.y;e.isRoot&&(l=a.pixelHeight-i.height),e.colorTextures.forEach(u=>{this._renderer.texture.unbind(u)});const h=this._renderer.gl;h.bindFramebuffer(h.FRAMEBUFFER,o.framebuffer);const c=this._viewPortCache;(c.x!==i.x||c.y!==l||c.width!==i.width||c.height!==i.height)&&(c.x=i.x,c.y=l,c.width=i.width,c.height=i.height,h.viewport(i.x,l,i.width,i.height)),!o.depthStencilRenderBuffer&&(e.stencil||e.depth)&&this._initStencil(o),this.clear(e,t,s)}finishRenderPass(e){const s=this._renderTargetSystem.getGpuRenderTarget(e);if(!s.msaa)return;const i=this._renderer.gl;i.bindFramebuffer(i.FRAMEBUFFER,s.resolveTargetFramebuffer),i.bindFramebuffer(i.READ_FRAMEBUFFER,s.framebuffer),i.blitFramebuffer(0,0,s.width,s.height,0,0,s.width,s.height,i.COLOR_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,s.framebuffer)}initGpuRenderTarget(e){const s=this._renderer.gl,i=new Xp;return e.colorTexture instanceof Ie?(this._renderer.context.ensureCanvasSize(e.colorTexture.resource),i.framebuffer=null,i):(this._initColor(e,i),s.bindFramebuffer(s.FRAMEBUFFER,null),i)}destroyGpuRenderTarget(e){const t=this._renderer.gl;e.framebuffer&&(t.deleteFramebuffer(e.framebuffer),e.framebuffer=null),e.resolveTargetFramebuffer&&(t.deleteFramebuffer(e.resolveTargetFramebuffer),e.resolveTargetFramebuffer=null),e.depthStencilRenderBuffer&&(t.deleteRenderbuffer(e.depthStencilRenderBuffer),e.depthStencilRenderBuffer=null),e.msaaRenderBuffer.forEach(s=>{t.deleteRenderbuffer(s)}),e.msaaRenderBuffer=null}clear(e,t,s){if(!t)return;const i=this._renderTargetSystem;typeof t=="boolean"&&(t=t?ue.ALL:ue.NONE);const n=this._renderer.gl;if(t&ue.COLOR){s??(s=i.defaultClearColor);const a=this._clearColorCache,o=s;(a[0]!==o[0]||a[1]!==o[1]||a[2]!==o[2]||a[3]!==o[3])&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],n.clearColor(o[0],o[1],o[2],o[3]))}n.clear(t)}resizeGpuRenderTarget(e){if(e.isRoot)return;const s=this._renderTargetSystem.getGpuRenderTarget(e);this._resizeColor(e,s),(e.stencil||e.depth)&&this._resizeStencil(s)}_initColor(e,t){const s=this._renderer,i=s.gl,n=i.createFramebuffer();if(t.resolveTargetFramebuffer=n,i.bindFramebuffer(i.FRAMEBUFFER,n),t.width=e.colorTexture.source.pixelWidth,t.height=e.colorTexture.source.pixelHeight,e.colorTextures.forEach((a,o)=>{const l=a.source;l.antialias&&(s.context.supports.msaa?t.msaa=!0:B("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),s.texture.bindSource(l,0);const c=s.texture.getGlSource(l).texture;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,3553,c,0)}),t.msaa){const a=i.createFramebuffer();t.framebuffer=a,i.bindFramebuffer(i.FRAMEBUFFER,a),e.colorTextures.forEach((o,l)=>{const h=i.createRenderbuffer();t.msaaRenderBuffer[l]=h})}else t.framebuffer=n;this._resizeColor(e,t)}_resizeColor(e,t){const s=e.colorTexture.source;if(t.width=s.pixelWidth,t.height=s.pixelHeight,e.colorTextures.forEach((i,n)=>{n!==0&&i.source.resize(s.width,s.height,s._resolution)}),t.msaa){const i=this._renderer,n=i.gl,a=t.framebuffer;n.bindFramebuffer(n.FRAMEBUFFER,a),e.colorTextures.forEach((o,l)=>{const h=o.source;i.texture.bindSource(h,0);const u=i.texture.getGlSource(h).internalFormat,d=t.msaaRenderBuffer[l];n.bindRenderbuffer(n.RENDERBUFFER,d),n.renderbufferStorageMultisample(n.RENDERBUFFER,4,u,h.pixelWidth,h.pixelHeight),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+l,n.RENDERBUFFER,d)})}}_initStencil(e){if(e.framebuffer===null)return;const t=this._renderer.gl,s=t.createRenderbuffer();e.depthStencilRenderBuffer=s,t.bindRenderbuffer(t.RENDERBUFFER,s),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,s),this._resizeStencil(e)}_resizeStencil(e){const t=this._renderer.gl;t.bindRenderbuffer(t.RENDERBUFFER,e.depthStencilRenderBuffer),e.msaa?t.renderbufferStorageMultisample(t.RENDERBUFFER,4,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,this._renderer.context.webGLVersion===2?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL,e.width,e.height)}prerender(e){const t=e.colorTexture.resource;this._renderer.context.multiView&&Ie.test(t)&&this._renderer.context.ensureCanvasSize(t)}postrender(e){if(this._renderer.context.multiView&&Ie.test(e.colorTexture.resource)){const t=this._renderer.context.canvas,s=e.colorTexture;s.context2D.drawImage(t,0,s.pixelHeight-t.height)}}}function em(r,e,t,s,i,n){const a=n?1:-1;return r.identity(),r.a=1/s*2,r.d=a*(1/i*2),r.tx=-1-e*r.a,r.ty=-a-t*r.d,r}const Lt=new Map;function ch(r,e){if(!Lt.has(r)){const t=new k({source:new Ie({resource:r,...e})}),s=()=>{Lt.get(r)===t&&Lt.delete(r)};t.once("destroy",s),t.source.once("destroy",s),Lt.set(r,t)}return Lt.get(r)}function tm(r){const e=r.colorTexture.source.resource;return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement&&document.body.contains(e)}const uh=class dh{constructor(e={}){if(this.uid=X("renderTarget"),this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this._size=new Float32Array(2),this._managedColorTextures=!1,e={...dh.defaultOptions,...e},this.stencil=e.stencil,this.depth=e.depth,this.isRoot=e.isRoot,typeof e.colorTextures=="number"){this._managedColorTextures=!0;for(let t=0;t<e.colorTextures;t++)this.colorTextures.push(new J({width:e.width,height:e.height,resolution:e.resolution,antialias:e.antialias}))}else{this.colorTextures=[...e.colorTextures.map(s=>s.source)];const t=this.colorTexture.source;this.resize(t.width,t.height,t._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),(e.depthStencilTexture||this.stencil)&&(e.depthStencilTexture instanceof k||e.depthStencilTexture instanceof J?this.depthStencilTexture=e.depthStencilTexture.source:this.ensureDepthStencilTexture())}get size(){const e=this._size;return e[0]=this.pixelWidth,e[1]=this.pixelHeight,e}get width(){return this.colorTexture.source.width}get height(){return this.colorTexture.source.height}get pixelWidth(){return this.colorTexture.source.pixelWidth}get pixelHeight(){return this.colorTexture.source.pixelHeight}get resolution(){return this.colorTexture.source._resolution}get colorTexture(){return this.colorTextures[0]}onSourceResize(e){this.resize(e.width,e.height,e._resolution,!0)}ensureDepthStencilTexture(){this.depthStencilTexture||(this.depthStencilTexture=new J({width:this.width,height:this.height,resolution:this.resolution,format:"depth24plus-stencil8",autoGenerateMipmaps:!1,antialias:!1,mipLevelCount:1}))}resize(e,t,s=this.resolution,i=!1){this.dirtyId++,this.colorTextures.forEach((n,a)=>{i&&a===0||n.source.resize(e,t,s)}),this.depthStencilTexture&&this.depthStencilTexture.source.resize(e,t,s)}destroy(){this.colorTexture.source.off("resize",this.onSourceResize,this),this._managedColorTextures&&this.colorTextures.forEach(e=>{e.destroy()}),this.depthStencilTexture&&(this.depthStencilTexture.destroy(),delete this.depthStencilTexture)}};uh.defaultOptions={width:0,height:0,resolution:1,colorTextures:1,stencil:!1,depth:!1,antialias:!1,isRoot:!1};let gi=uh;class fh{constructor(e){this.rootViewPort=new W,this.viewport=new W,this.onRenderTargetChange=new qo("onRenderTargetChange"),this.projectionMatrix=new E,this.defaultClearColor=[0,0,0,0],this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._renderer=e,e.renderableGC.addManagedHash(this,"_gpuRenderTargetHash")}finishRenderPass(){this.adaptor.finishRenderPass(this.renderTarget)}renderStart({target:e,clear:t,clearColor:s,frame:i}){var n,a;this._renderTargetStack.length=0,this.push(e,t,s,i),this.rootViewPort.copyFrom(this.viewport),this.rootRenderTarget=this.renderTarget,this.renderingToScreen=tm(this.rootRenderTarget),(a=(n=this.adaptor).prerender)==null||a.call(n,this.rootRenderTarget)}postrender(){var e,t;(t=(e=this.adaptor).postrender)==null||t.call(e,this.rootRenderTarget)}bind(e,t=!0,s,i){const n=this.getRenderTarget(e),a=this.renderTarget!==n;this.renderTarget=n,this.renderSurface=e;const o=this.getGpuRenderTarget(n);(n.pixelWidth!==o.width||n.pixelHeight!==o.height)&&(this.adaptor.resizeGpuRenderTarget(n),o.width=n.pixelWidth,o.height=n.pixelHeight);const l=n.colorTexture,h=this.viewport,c=l.pixelWidth,u=l.pixelHeight;if(!i&&e instanceof k&&(i=e.frame),i){const d=l._resolution;h.x=i.x*d+.5|0,h.y=i.y*d+.5|0,h.width=i.width*d+.5|0,h.height=i.height*d+.5|0}else h.x=0,h.y=0,h.width=c,h.height=u;return em(this.projectionMatrix,0,0,h.width/l.resolution,h.height/l.resolution,!n.isRoot),this.adaptor.startRenderPass(n,t,s,h),a&&this.onRenderTargetChange.emit(n),n}clear(e,t=ue.ALL,s){t&&(e&&(e=this.getRenderTarget(e)),this.adaptor.clear(e||this.renderTarget,t,s,this.viewport))}contextChange(){this._gpuRenderTargetHash=Object.create(null)}push(e,t=ue.ALL,s,i){const n=this.bind(e,t,s,i);return this._renderTargetStack.push({renderTarget:n,frame:i}),n}pop(){this._renderTargetStack.pop();const e=this._renderTargetStack[this._renderTargetStack.length-1];this.bind(e.renderTarget,!1,null,e.frame)}getRenderTarget(e){return e.isTexture&&(e=e.source),this._renderSurfaceToRenderTargetHash.get(e)??this._initRenderTarget(e)}copyToTexture(e,t,s,i,n){s.x<0&&(i.width+=s.x,n.x-=s.x,s.x=0),s.y<0&&(i.height+=s.y,n.y-=s.y,s.y=0);const{pixelWidth:a,pixelHeight:o}=e;return i.width=Math.min(i.width,a-s.x),i.height=Math.min(i.height,o-s.y),this.adaptor.copyToTexture(e,t,s,i,n)}ensureDepthStencil(){this.renderTarget.stencil||(this.renderTarget.stencil=!0,this.adaptor.startRenderPass(this.renderTarget,!1,null,this.viewport))}destroy(){this._renderer=null,this._renderSurfaceToRenderTargetHash.forEach((e,t)=>{e!==t&&e.destroy()}),this._renderSurfaceToRenderTargetHash.clear(),this._gpuRenderTargetHash=Object.create(null)}_initRenderTarget(e){let t=null;return Ie.test(e)&&(e=ch(e).source),e instanceof gi?t=e:e instanceof J&&(t=new gi({colorTextures:[e]}),e.source instanceof Ie&&(t.isRoot=!0),e.once("destroy",()=>{t.destroy(),this._renderSurfaceToRenderTargetHash.delete(e);const s=this._gpuRenderTargetHash[t.uid];s&&(this._gpuRenderTargetHash[t.uid]=null,this.adaptor.destroyGpuRenderTarget(s))})),this._renderSurfaceToRenderTargetHash.set(e,t),t}getGpuRenderTarget(e){return this._gpuRenderTargetHash[e.uid]||(this._gpuRenderTargetHash[e.uid]=this.adaptor.initGpuRenderTarget(e))}resetState(){this.renderTarget=null,this.renderSurface=null}}class gh extends fh{constructor(e){super(e),this.adaptor=new Jp,this.adaptor.init(e,this)}}gh.extension={type:[y.WebGLSystem],name:"renderTarget"};class Ji extends ge{constructor({buffer:e,offset:t,size:s}){super(),this.uid=X("buffer"),this._resourceType="bufferResource",this._touched=0,this._resourceId=X("resource"),this._bufferResource=!0,this.destroyed=!1,this.buffer=e,this.offset=t|0,this.size=s,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this._resourceId=X("resource"),this.emit("change",this)}destroy(e=!1){this.destroyed=!0,e&&this.buffer.destroy(),this.emit("change",this),this.buffer=null}}function sm(r,e){const t=[],s=[`
        var g = s.groups;
        var sS = r.shader;
        var p = s.glProgram;
        var ugS = r.uniformGroup;
        var resources;
    `];let i=!1,n=0;const a=e._getProgramData(r.glProgram);for(const l in r.groups){const h=r.groups[l];t.push(`
            resources = g[${l}].resources;
        `);for(const c in h.resources){const u=h.resources[c];if(u instanceof oe)if(u.ubo){const d=r._uniformBindMap[l][Number(c)];t.push(`
                        sS.bindUniformBlock(
                            resources[${c}],
                            '${d}',
                            ${r.glProgram._uniformBlockData[d].index}
                        );
                    `)}else t.push(`
                        ugS.updateUniformGroup(resources[${c}], p, sD);
                    `);else if(u instanceof Ji){const d=r._uniformBindMap[l][Number(c)];t.push(`
                    sS.bindUniformBlock(
                        resources[${c}],
                        '${d}',
                        ${r.glProgram._uniformBlockData[d].index}
                    );
                `)}else if(u instanceof J){const d=r._uniformBindMap[l][c],f=a.uniformData[d];f&&(i||(i=!0,s.push(`
                        var tS = r.texture;
                        `)),e._gl.uniform1i(f.location,n),t.push(`
                        tS.bind(resources[${c}], ${n});
                    `),n++)}}}const o=[...s,...t].join(`
`);return new Function("r","s","sD",o)}class rm{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function Va(r,e,t){const s=r.createShader(e);return r.shaderSource(s,t),r.compileShader(s),s}function Ur(r){const e=new Array(r);for(let t=0;t<e.length;t++)e[t]=!1;return e}function ph(r,e){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Ur(2*e);case"bvec3":return Ur(3*e);case"bvec4":return Ur(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let Ms=null;const za={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},im={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function mh(r,e){if(!Ms){const t=Object.keys(za);Ms={};for(let s=0;s<t.length;++s){const i=t[s];Ms[r[i]]=za[i]}}return Ms[e]}function nm(r,e){const t=mh(r,e);return im[t]||"float32"}function am(r,e,t=!1){const s={},i=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(let a=0;a<i;a++){const o=e.getActiveAttrib(r,a);if(o.name.startsWith("gl_"))continue;const l=nm(e,o.type);s[o.name]={location:0,format:l,stride:je(l).stride,offset:0,instance:!1,start:0}}const n=Object.keys(s);if(t){n.sort((a,o)=>a>o?1:-1);for(let a=0;a<n.length;a++)s[n[a]].location=a,e.bindAttribLocation(r,a,n[a]);e.linkProgram(r)}else for(let a=0;a<n.length;a++)s[n[a]].location=e.getAttribLocation(r,n[a]);return s}function om(r,e){if(!e.ACTIVE_UNIFORM_BLOCKS)return{};const t={},s=e.getProgramParameter(r,e.ACTIVE_UNIFORM_BLOCKS);for(let i=0;i<s;i++){const n=e.getActiveUniformBlockName(r,i),a=e.getUniformBlockIndex(r,n),o=e.getActiveUniformBlockParameter(r,i,e.UNIFORM_BLOCK_DATA_SIZE);t[n]={name:n,index:a,size:o}}return t}function lm(r,e){const t={},s=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(let i=0;i<s;i++){const n=e.getActiveUniform(r,i),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),l=mh(e,n.type);t[a]={name:a,index:i,type:l,size:n.size,isArray:o,value:ph(l,n.size)}}return t}function Ya(r,e){const t=r.getShaderSource(e).split(`
`).map((h,c)=>`${c}: ${h}`),s=r.getShaderInfoLog(e),i=s.split(`
`),n={},a=i.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!n[h]?(n[h]=!0,!0):!1),o=[""];a.forEach(h=>{t[h-1]=`%c${t[h-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=t.join(`
`);o[0]=l,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function hm(r,e,t,s){r.getProgramParameter(e,r.LINK_STATUS)||(r.getShaderParameter(t,r.COMPILE_STATUS)||Ya(r,t),r.getShaderParameter(s,r.COMPILE_STATUS)||Ya(r,s),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(e)))}function cm(r,e){const t=Va(r,r.VERTEX_SHADER,e.vertex),s=Va(r,r.FRAGMENT_SHADER,e.fragment),i=r.createProgram();r.attachShader(i,t),r.attachShader(i,s);const n=e.transformFeedbackVaryings;n&&(typeof r.transformFeedbackVaryings!="function"?B("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(i,n.names,n.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(i),r.getProgramParameter(i,r.LINK_STATUS)||hm(r,i,t,s),e._attributeData=am(i,r,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertex)),e._uniformData=lm(i,r),e._uniformBlockData=om(i,r),r.deleteShader(t),r.deleteShader(s);const a={};for(const l in e._uniformData){const h=e._uniformData[l];a[l]={location:r.getUniformLocation(i,l),value:ph(h.type,h.size)}}return new rm(i,a)}const Fs={textureCount:0,blockIndex:0};class _h{constructor(e){this._activeProgram=null,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(e){this._gl=e,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._activeProgram=null}bind(e,t){if(this._setProgram(e.glProgram),t)return;Fs.textureCount=0,Fs.blockIndex=0;let s=this._shaderSyncFunctions[e.glProgram._key];s||(s=this._shaderSyncFunctions[e.glProgram._key]=this._generateShaderSync(e,this)),this._renderer.buffer.nextBindBase(!!e.glProgram.transformFeedbackVaryings),s(this._renderer,e,Fs)}updateUniformGroup(e){this._renderer.uniformGroup.updateUniformGroup(e,this._activeProgram,Fs)}bindUniformBlock(e,t,s=0){const i=this._renderer.buffer,n=this._getProgramData(this._activeProgram),a=e._bufferResource;a||this._renderer.ubo.updateUniformGroup(e);const o=e.buffer,l=i.updateBuffer(o),h=i.freeLocationForBufferBase(l);if(a){const{offset:u,size:d}=e;u===0&&d===o.data.byteLength?i.bindBufferBase(l,h):i.bindBufferRange(l,h,u)}else i.getLastBindBaseLocation(l)!==h&&i.bindBufferBase(l,h);const c=this._activeProgram._uniformBlockData[t].index;n.uniformBlockBindings[s]!==h&&(n.uniformBlockBindings[s]=h,this._renderer.gl.uniformBlockBinding(n.program,c,h))}_setProgram(e){if(this._activeProgram===e)return;this._activeProgram=e;const t=this._getProgramData(e);this._gl.useProgram(t.program)}_getProgramData(e){return this._programDataHash[e._key]||this._createProgramData(e)}_createProgramData(e){const t=e._key;return this._programDataHash[t]=cm(this._gl,e),this._programDataHash[t]}destroy(){for(const e of Object.keys(this._programDataHash))this._programDataHash[e].destroy(),this._programDataHash[e]=null;this._programDataHash=null}_generateShaderSync(e,t){return sm(e,t)}resetState(){this._activeProgram=null}}_h.extension={type:[y.WebGLSystem],name:"shader"};const um={f32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1f(location, v);
        }`,"vec2<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2f(location, v[0], v[1]);
        }`,"vec3<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3f(location, v[0], v[1], v[2]);
        }`,"vec4<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4f(location, v[0], v[1], v[2], v[3]);
        }`,i32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,u32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1ui(location, v);
        }`,"vec2<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2ui(location, v[0], v[1]);
        }`,"vec3<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3ui(location, v[0], v[1], v[2]);
        }`,"vec4<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
        }`,bool:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,"mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},dm={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};function fm(r,e){const t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
        var name = null;
    `];for(const s in r.uniforms){if(!e[s]){r.uniforms[s]instanceof oe?r.uniforms[s].ubo?t.push(`
                        renderer.shader.bindUniformBlock(uv.${s}, "${s}");
                    `):t.push(`
                        renderer.shader.updateUniformGroup(uv.${s});
                    `):r.uniforms[s]instanceof Ji&&t.push(`
                        renderer.shader.bindBufferResource(uv.${s}, "${s}");
                    `);continue}const i=r.uniformStructures[s];let n=!1;for(let a=0;a<ht.length;a++){const o=ht[a];if(i.type===o.type&&o.test(i)){t.push(`name = "${s}";`,ht[a].uniform),n=!0;break}}if(!n){const o=(i.size===1?um:dm)[i.type].replace("location",`ud["${s}"].location`);t.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${o};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}class yh{constructor(e){this._cache={},this._uniformGroupSyncHash={},this._renderer=e,this.gl=null,this._cache={}}contextChange(e){this.gl=e}updateUniformGroup(e,t,s){const i=this._renderer.shader._getProgramData(t);(!e.isStatic||e._dirtyId!==i.uniformDirtyGroups[e.uid])&&(i.uniformDirtyGroups[e.uid]=e._dirtyId,this._getUniformSyncFunction(e,t)(i.uniformData,e.uniforms,this._renderer,s))}_getUniformSyncFunction(e,t){var s;return((s=this._uniformGroupSyncHash[e._signature])==null?void 0:s[t._key])||this._createUniformSyncFunction(e,t)}_createUniformSyncFunction(e,t){const s=this._uniformGroupSyncHash[e._signature]||(this._uniformGroupSyncHash[e._signature]={}),i=this._getSignature(e,t._uniformData,"u");return this._cache[i]||(this._cache[i]=this._generateUniformsSync(e,t._uniformData)),s[t._key]=this._cache[i],s[t._key]}_generateUniformsSync(e,t){return fm(e,t)}_getSignature(e,t,s){const i=e.uniforms,n=[`${s}-`];for(const a in i)n.push(a),t[a]&&n.push(t[a].type);return n.join("-")}destroy(){this._renderer=null,this._cache=null}}yh.extension={type:[y.WebGLSystem],name:"uniformGroup"};function gm(r){const e={};if(e.normal=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e.add=[r.ONE,r.ONE],e.multiply=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e.screen=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e.none=[0,0],e["normal-npm"]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e["add-npm"]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],e["screen-npm"]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e.erase=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],!(r instanceof O.get().getWebGLRenderingContext()))e.min=[r.ONE,r.ONE,r.ONE,r.ONE,r.MIN,r.MIN],e.max=[r.ONE,r.ONE,r.ONE,r.ONE,r.MAX,r.MAX];else{const s=r.getExtension("EXT_blend_minmax");s&&(e.min=[r.ONE,r.ONE,r.ONE,r.ONE,s.MIN_EXT,s.MIN_EXT],e.max=[r.ONE,r.ONE,r.ONE,r.ONE,s.MAX_EXT,s.MAX_EXT])}return e}const pm=0,mm=1,_m=2,ym=3,xm=4,bm=5,xh=class pi{constructor(e){this._invertFrontFace=!1,this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[pm]=this.setBlend,this.map[mm]=this.setOffset,this.map[_m]=this.setCullFace,this.map[ym]=this.setDepthTest,this.map[xm]=this.setFrontFace,this.map[bm]=this.setDepthMask,this.checks=[],this.defaultState=Ae.for2d(),e.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(e){this._invertFrontFace=!e.isRoot,this._cullFace?this.setFrontFace(this._frontFace):this._frontFaceDirty=!0}contextChange(e){this.gl=e,this.blendModesMap=gm(e),this.resetState()}set(e){if(e||(e=this.defaultState),this.stateId!==e.data){let t=this.stateId^e.data,s=0;for(;t;)t&1&&this.map[s].call(this,!!(e.data&1<<s)),t>>=1,s++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e||(e=this.defaultState);for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this._updateCheck(pi._checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this._updateCheck(pi._checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this._cullFace=e,this.gl[e?"enable":"disable"](this.gl.CULL_FACE),this._cullFace&&this._frontFaceDirty&&this.setFrontFace(this._frontFace)}setFrontFace(e){this._frontFace=e,this._frontFaceDirty=!1;const t=this._invertFrontFace?!e:e;this._glFrontFace!==t&&(this._glFrontFace=t,this.gl.frontFace(this.gl[t?"CW":"CCW"]))}setBlendMode(e){if(this.blendModesMap[e]||(e="normal"),e===this.blendMode)return;this.blendMode=e;const t=this.blendModesMap[e],s=this.gl;t.length===2?s.blendFunc(t[0],t[1]):s.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,s.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}resetState(){this._glFrontFace=!1,this._frontFace=!1,this._cullFace=!1,this._frontFaceDirty=!1,this._invertFrontFace=!1,this.gl.frontFace(this.gl.CCW),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(e,t){const s=this.checks.indexOf(e);t&&s===-1?this.checks.push(e):!t&&s!==-1&&this.checks.splice(s,1)}static _checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static _checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};xh.extension={type:[y.WebGLSystem],name:"state"};let vm=xh;class wm{constructor(e){this.target=Ql.TEXTURE_2D,this.texture=e,this.width=-1,this.height=-1,this.type=N.UNSIGNED_BYTE,this.internalFormat=fi.RGBA,this.format=fi.RGBA,this.samplerType=0}}const Tm={id:"buffer",upload(r,e,t){e.width===r.width||e.height===r.height?t.texSubImage2D(t.TEXTURE_2D,0,0,0,r.width,r.height,e.format,e.type,r.resource):t.texImage2D(e.target,0,e.internalFormat,r.width,r.height,0,e.format,e.type,r.resource),e.width=r.width,e.height=r.height}},Sm={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},Am={id:"compressed",upload(r,e,t){t.pixelStorei(t.UNPACK_ALIGNMENT,4);let s=r.pixelWidth,i=r.pixelHeight;const n=!!Sm[r.format];for(let a=0;a<r.resource.length;a++){const o=r.resource[a];n?t.compressedTexImage2D(t.TEXTURE_2D,a,e.internalFormat,s,i,0,o):t.texImage2D(t.TEXTURE_2D,a,e.internalFormat,s,i,0,e.format,e.type,o),s=Math.max(s>>1,1),i=Math.max(i>>1,1)}}},bh={id:"image",upload(r,e,t,s){const i=e.width,n=e.height,a=r.pixelWidth,o=r.pixelHeight,l=r.resourceWidth,h=r.resourceHeight;l<a||h<o?((i!==a||n!==o)&&t.texImage2D(e.target,0,e.internalFormat,a,o,0,e.format,e.type,null),s===2?t.texSubImage2D(t.TEXTURE_2D,0,0,0,l,h,e.format,e.type,r.resource):t.texSubImage2D(t.TEXTURE_2D,0,0,0,e.format,e.type,r.resource)):i===a&&n===o?t.texSubImage2D(t.TEXTURE_2D,0,0,0,e.format,e.type,r.resource):s===2?t.texImage2D(e.target,0,e.internalFormat,a,o,0,e.format,e.type,r.resource):t.texImage2D(e.target,0,e.internalFormat,e.format,e.type,r.resource),e.width=a,e.height=o}},Pm={id:"video",upload(r,e,t,s){if(!r.isValid){t.texImage2D(e.target,0,e.internalFormat,1,1,0,e.format,e.type,null);return}bh.upload(r,e,t,s)}},ja={linear:9729,nearest:9728},km={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},Or={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},Cm={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function $a(r,e,t,s,i,n,a,o){const l=n;if(!o||r.addressModeU!=="repeat"||r.addressModeV!=="repeat"||r.addressModeW!=="repeat"){const h=Or[a?"clamp-to-edge":r.addressModeU],c=Or[a?"clamp-to-edge":r.addressModeV],u=Or[a?"clamp-to-edge":r.addressModeW];e[i](l,e.TEXTURE_WRAP_S,h),e[i](l,e.TEXTURE_WRAP_T,c),e.TEXTURE_WRAP_R&&e[i](l,e.TEXTURE_WRAP_R,u)}if((!o||r.magFilter!=="linear")&&e[i](l,e.TEXTURE_MAG_FILTER,ja[r.magFilter]),t){if(!o||r.mipmapFilter!=="linear"){const h=km[r.minFilter][r.mipmapFilter];e[i](l,e.TEXTURE_MIN_FILTER,h)}}else e[i](l,e.TEXTURE_MIN_FILTER,ja[r.minFilter]);if(s&&r.maxAnisotropy>1){const h=Math.min(r.maxAnisotropy,e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));e[i](l,s.TEXTURE_MAX_ANISOTROPY_EXT,h)}r.compare&&e[i](l,e.TEXTURE_COMPARE_FUNC,Cm[r.compare])}function Em(r){return{r8unorm:r.RED,r8snorm:r.RED,r8uint:r.RED,r8sint:r.RED,r16uint:r.RED,r16sint:r.RED,r16float:r.RED,rg8unorm:r.RG,rg8snorm:r.RG,rg8uint:r.RG,rg8sint:r.RG,r32uint:r.RED,r32sint:r.RED,r32float:r.RED,rg16uint:r.RG,rg16sint:r.RG,rg16float:r.RG,rgba8unorm:r.RGBA,"rgba8unorm-srgb":r.RGBA,rgba8snorm:r.RGBA,rgba8uint:r.RGBA,rgba8sint:r.RGBA,bgra8unorm:r.RGBA,"bgra8unorm-srgb":r.RGBA,rgb9e5ufloat:r.RGB,rgb10a2unorm:r.RGBA,rg11b10ufloat:r.RGB,rg32uint:r.RG,rg32sint:r.RG,rg32float:r.RG,rgba16uint:r.RGBA,rgba16sint:r.RGBA,rgba16float:r.RGBA,rgba32uint:r.RGBA,rgba32sint:r.RGBA,rgba32float:r.RGBA,stencil8:r.STENCIL_INDEX8,depth16unorm:r.DEPTH_COMPONENT,depth24plus:r.DEPTH_COMPONENT,"depth24plus-stencil8":r.DEPTH_STENCIL,depth32float:r.DEPTH_COMPONENT,"depth32float-stencil8":r.DEPTH_STENCIL}}function Mm(r,e){let t={},s=r.RGBA;return r instanceof O.get().getWebGLRenderingContext()?e.srgb&&(t={"rgba8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT}):(t={"rgba8unorm-srgb":r.SRGB8_ALPHA8,"bgra8unorm-srgb":r.SRGB8_ALPHA8},s=r.RGBA8),{r8unorm:r.R8,r8snorm:r.R8_SNORM,r8uint:r.R8UI,r8sint:r.R8I,r16uint:r.R16UI,r16sint:r.R16I,r16float:r.R16F,rg8unorm:r.RG8,rg8snorm:r.RG8_SNORM,rg8uint:r.RG8UI,rg8sint:r.RG8I,r32uint:r.R32UI,r32sint:r.R32I,r32float:r.R32F,rg16uint:r.RG16UI,rg16sint:r.RG16I,rg16float:r.RG16F,rgba8unorm:r.RGBA,...t,rgba8snorm:r.RGBA8_SNORM,rgba8uint:r.RGBA8UI,rgba8sint:r.RGBA8I,bgra8unorm:s,rgb9e5ufloat:r.RGB9_E5,rgb10a2unorm:r.RGB10_A2,rg11b10ufloat:r.R11F_G11F_B10F,rg32uint:r.RG32UI,rg32sint:r.RG32I,rg32float:r.RG32F,rgba16uint:r.RGBA16UI,rgba16sint:r.RGBA16I,rgba16float:r.RGBA16F,rgba32uint:r.RGBA32UI,rgba32sint:r.RGBA32I,rgba32float:r.RGBA32F,stencil8:r.STENCIL_INDEX8,depth16unorm:r.DEPTH_COMPONENT16,depth24plus:r.DEPTH_COMPONENT24,"depth24plus-stencil8":r.DEPTH24_STENCIL8,depth32float:r.DEPTH_COMPONENT32F,"depth32float-stencil8":r.DEPTH32F_STENCIL8,...e.s3tc?{"bc1-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...e.s3tc_sRGB?{"bc1-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...e.rgtc?{"bc4-r-unorm":e.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":e.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":e.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":e.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...e.bptc?{"bc6h-rgb-float":e.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":e.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":e.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":e.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...e.etc?{"etc2-rgb8unorm":e.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":e.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":e.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":e.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":e.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":e.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":e.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":e.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...e.astc?{"astc-4x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}function Fm(r){return{r8unorm:r.UNSIGNED_BYTE,r8snorm:r.BYTE,r8uint:r.UNSIGNED_BYTE,r8sint:r.BYTE,r16uint:r.UNSIGNED_SHORT,r16sint:r.SHORT,r16float:r.HALF_FLOAT,rg8unorm:r.UNSIGNED_BYTE,rg8snorm:r.BYTE,rg8uint:r.UNSIGNED_BYTE,rg8sint:r.BYTE,r32uint:r.UNSIGNED_INT,r32sint:r.INT,r32float:r.FLOAT,rg16uint:r.UNSIGNED_SHORT,rg16sint:r.SHORT,rg16float:r.HALF_FLOAT,rgba8unorm:r.UNSIGNED_BYTE,"rgba8unorm-srgb":r.UNSIGNED_BYTE,rgba8snorm:r.BYTE,rgba8uint:r.UNSIGNED_BYTE,rgba8sint:r.BYTE,bgra8unorm:r.UNSIGNED_BYTE,"bgra8unorm-srgb":r.UNSIGNED_BYTE,rgb9e5ufloat:r.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:r.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:r.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:r.UNSIGNED_INT,rg32sint:r.INT,rg32float:r.FLOAT,rgba16uint:r.UNSIGNED_SHORT,rgba16sint:r.SHORT,rgba16float:r.HALF_FLOAT,rgba32uint:r.UNSIGNED_INT,rgba32sint:r.INT,rgba32float:r.FLOAT,stencil8:r.UNSIGNED_BYTE,depth16unorm:r.UNSIGNED_SHORT,depth24plus:r.UNSIGNED_INT,"depth24plus-stencil8":r.UNSIGNED_INT_24_8,depth32float:r.FLOAT,"depth32float-stencil8":r.FLOAT_32_UNSIGNED_INT_24_8_REV}}const Bm=4;class vh{constructor(e){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:bh,buffer:Tm,video:Pm,compressed:Am},this._premultiplyAlpha=!1,this._useSeparateSamplers=!1,this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_glTextures"),this._renderer.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(e){this._gl=e,this._mapFormatToInternalFormat||(this._mapFormatToInternalFormat=Mm(e,this._renderer.context.extensions),this._mapFormatToType=Fm(e),this._mapFormatToFormat=Em(e)),this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null),this._premultiplyAlpha=!1;for(let t=0;t<16;t++)this.bind(k.EMPTY,t)}initSource(e){this.bind(e)}bind(e,t=0){const s=e.source;e?(this.bindSource(s,t),this._useSeparateSamplers&&this._bindSampler(s.style,t)):(this.bindSource(null,t),this._useSeparateSamplers&&this._bindSampler(null,t))}bindSource(e,t=0){const s=this._gl;if(e._touched=this._renderer.textureGC.count,this._boundTextures[t]!==e){this._boundTextures[t]=e,this._activateLocation(t),e||(e=k.EMPTY.source);const i=this.getGlSource(e);s.bindTexture(i.target,i.texture)}}_bindSampler(e,t=0){const s=this._gl;if(!e){this._boundSamplers[t]=null,s.bindSampler(t,null);return}const i=this._getGlSampler(e);this._boundSamplers[t]!==i&&(this._boundSamplers[t]=i,s.bindSampler(t,i))}unbind(e){const t=e.source,s=this._boundTextures,i=this._gl;for(let n=0;n<s.length;n++)if(s[n]===t){this._activateLocation(n);const a=this.getGlSource(t);i.bindTexture(a.target,null),s[n]=null}}_activateLocation(e){this._activeTextureLocation!==e&&(this._activeTextureLocation=e,this._gl.activeTexture(this._gl.TEXTURE0+e))}_initSource(e){const t=this._gl,s=new wm(t.createTexture());if(s.type=this._mapFormatToType[e.format],s.internalFormat=this._mapFormatToInternalFormat[e.format],s.format=this._mapFormatToFormat[e.format],e.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||e.isPowerOfTwo)){const i=Math.max(e.width,e.height);e.mipLevelCount=Math.floor(Math.log2(i))+1}return this._glTextures[e.uid]=s,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceUpdate,this),e.on("styleChange",this.onStyleChange,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),this.updateStyle(e,!1),s}onStyleChange(e){this.updateStyle(e,!1)}updateStyle(e,t){const s=this._gl,i=this.getGlSource(e);s.bindTexture(s.TEXTURE_2D,i.texture),this._boundTextures[this._activeTextureLocation]=e,$a(e.style,s,e.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",s.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!e.isPowerOfTwo,t)}onSourceUnload(e){const t=this._glTextures[e.uid];t&&(this.unbind(e),this._glTextures[e.uid]=null,this._gl.deleteTexture(t.texture))}onSourceUpdate(e){const t=this._gl,s=this.getGlSource(e);t.bindTexture(t.TEXTURE_2D,s.texture),this._boundTextures[this._activeTextureLocation]=e;const i=e.alphaMode==="premultiply-alpha-on-upload";this._premultiplyAlpha!==i&&(this._premultiplyAlpha=i,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i)),this._uploads[e.uploadMethodId]?this._uploads[e.uploadMethodId].upload(e,s,t,this._renderer.context.webGLVersion):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.pixelWidth,e.pixelHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e,!1)}onUpdateMipmaps(e,t=!0){t&&this.bindSource(e,0);const s=this.getGlSource(e);this._gl.generateMipmap(s.target)}onSourceDestroy(e){e.off("destroy",this.onSourceDestroy,this),e.off("update",this.onSourceUpdate,this),e.off("resize",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("styleChange",this.onStyleChange,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}_initSampler(e){const t=this._gl,s=this._gl.createSampler();return this._glSamplers[e._resourceId]=s,$a(e,t,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",s,!1,!0),this._glSamplers[e._resourceId]}_getGlSampler(e){return this._glSamplers[e._resourceId]||this._initSampler(e)}getGlSource(e){return this._glTextures[e.uid]||this._initSource(e)}generateCanvas(e){const{pixels:t,width:s,height:i}=this.getPixels(e),n=O.get().createCanvas();n.width=s,n.height=i;const a=n.getContext("2d");if(a){const o=a.createImageData(s,i);o.data.set(t),a.putImageData(o,0,0)}return n}getPixels(e){const t=e.source.resolution,s=e.frame,i=Math.max(Math.round(s.width*t),1),n=Math.max(Math.round(s.height*t),1),a=new Uint8Array(Bm*i*n),o=this._renderer,l=o.renderTarget.getRenderTarget(e),h=o.renderTarget.getGpuRenderTarget(l),c=o.gl;return c.bindFramebuffer(c.FRAMEBUFFER,h.resolveTargetFramebuffer),c.readPixels(Math.round(s.x*t),Math.round(s.y*t),i,n,c.RGBA,c.UNSIGNED_BYTE,a),{pixels:new Uint8ClampedArray(a.buffer),width:i,height:n}}destroy(){this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null,this._renderer=null}resetState(){this._activeTextureLocation=-1,this._boundTextures.fill(k.EMPTY.source),this._boundSamplers=Object.create(null);const e=this._gl;this._premultiplyAlpha=!1,e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha)}}vh.extension={type:[y.WebGLSystem],name:"texture"};class wh{contextChange(e){const t=new oe({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new E,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),s=e.limits.maxBatchableTextures,i=ls({name:"graphics",bits:[Ri,Gi(s),qi,cs]});this.shader=new xe({glProgram:i,resources:{localUniforms:t,batchSamplers:Di(s)}})}execute(e,t){const s=t.context,i=s.customShader||this.shader,n=e.renderer,a=n.graphicsContext,{batcher:o,instructions:l}=a.getContextRenderData(s);i.groups[0]=n.globalUniforms.bindGroup,n.state.set(e.state),n.shader.bind(i),n.geometry.bind(o.geometry,i.glProgram);const h=l.instructions;for(let c=0;c<l.instructionSize;c++){const u=h[c];if(u.size){for(let d=0;d<u.textures.count;d++)n.texture.bind(u.textures.textures[d],d);n.geometry.draw(u.topology,u.size,u.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}wh.extension={type:[y.WebGLPipesAdaptor],name:"graphics"};class Th{init(){const e=ls({name:"mesh",bits:[qi,Op,cs]});this._shader=new xe({glProgram:e,resources:{uTexture:k.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new E}}}})}execute(e,t){const s=e.renderer;let i=t._shader;if(i){if(!i.glProgram){B("Mesh shader has no glProgram",t.shader);return}}else{i=this._shader;const n=t.texture,a=n.source;i.resources.uTexture=a,i.resources.uSampler=a.style,i.resources.textureUniforms.uniforms.uTextureMatrix=n.textureMatrix.mapCoord}i.groups[100]=s.globalUniforms.bindGroup,i.groups[101]=e.localUniformsBindGroup,s.encoder.draw({geometry:t._geometry,shader:i,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}}Th.extension={type:[y.WebGLPipesAdaptor],name:"mesh"};class Sh{constructor(e){this._renderer=e}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(e,t){this._renderer.renderPipes.batch.break(t),t.add(e)}execute(e){e.isRenderable&&e.render(this._renderer)}destroy(){this._renderer=null}}Sh.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"customRender"};class er{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}destroy(){}}function mi(r,e){const t=r.instructionSet,s=t.instructions;for(let i=0;i<t.instructionSize;i++){const n=s[i];e[n.renderPipeId].execute(n)}}const Rm=new E;class Ah{constructor(e){this._renderer=e}addRenderGroup(e,t){e.isCachedAsTexture?this._addRenderableCacheAsTexture(e,t):this._addRenderableDirect(e,t)}execute(e){e.isRenderable&&(e.isCachedAsTexture?this._executeCacheAsTexture(e):this._executeDirect(e))}destroy(){this._renderer=null}_addRenderableDirect(e,t){this._renderer.renderPipes.batch.break(t),e._batchableRenderGroup&&(te.return(e._batchableRenderGroup),e._batchableRenderGroup=null),t.add(e)}_addRenderableCacheAsTexture(e,t){const s=e._batchableRenderGroup??(e._batchableRenderGroup=te.get(er));s.renderable=e.root,s.transform=e.root.relativeGroupTransform,s.texture=e.texture,s.bounds=e._textureBounds,t.add(e),this._renderer.renderPipes.batch.addToBatch(s,t)}_executeCacheAsTexture(e){if(e.textureNeedsUpdate){e.textureNeedsUpdate=!1;const t=Rm.identity().translate(-e._textureBounds.x,-e._textureBounds.y);this._renderer.renderTarget.push(e.texture,!0,null,e.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:t,worldColor:4294967295}),mi(e,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}e._batchableRenderGroup._batcher.updateElement(e._batchableRenderGroup),e._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(e){this._renderer.globalUniforms.push({worldTransformMatrix:e.inverseParentTextureTransform,worldColor:e.worldColorAlpha}),mi(e,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}}Ah.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"renderGroup"};function _i(r,e){e||(e=0);for(let t=e;t<r.length&&r[t];t++)r[t]=null}const Im=new ae,Xa=Yt|Ws|Si;function Ph(r,e=!1){Gm(r);const t=r.childrenToUpdate,s=r.updateTick++;for(const i in t){const n=Number(i),a=t[i],o=a.list,l=a.index;for(let h=0;h<l;h++){const c=o[h];c.parentRenderGroup===r&&c.relativeRenderGroupDepth===n&&kh(c,s,0)}_i(o,l),a.index=0}if(e)for(let i=0;i<r.renderGroupChildren.length;i++)Ph(r.renderGroupChildren[i],e)}function Gm(r){const e=r.root;let t;if(r.renderGroupParent){const s=r.renderGroupParent;r.worldTransform.appendFrom(e.relativeGroupTransform,s.worldTransform),r.worldColor=Hs(e.groupColor,s.worldColor),t=e.groupAlpha*s.worldAlpha}else r.worldTransform.copyFrom(e.localTransform),r.worldColor=e.localColor,t=e.localAlpha;t=t<0?0:t>1?1:t,r.worldAlpha=t,r.worldColorAlpha=r.worldColor+((t*255|0)<<24)}function kh(r,e,t){if(e===r.updateTick)return;r.updateTick=e,r.didChange=!1;const s=r.localTransform;r.updateLocalTransform();const i=r.parent;if(i&&!i.renderGroup?(t|=r._updateFlags,r.relativeGroupTransform.appendFrom(s,i.relativeGroupTransform),t&Xa&&Ka(r,i,t)):(t=r._updateFlags,r.relativeGroupTransform.copyFrom(s),t&Xa&&Ka(r,Im,t)),!r.renderGroup){const n=r.children,a=n.length;for(let h=0;h<a;h++)kh(n[h],e,t);const o=r.parentRenderGroup,l=r;l.renderPipeId&&!o.structureDidChange&&o.updateRenderable(l)}}function Ka(r,e,t){if(t&Ws){r.groupColor=Hs(r.localColor,e.groupColor);let s=r.localAlpha*e.groupAlpha;s=s<0?0:s>1?1:s,r.groupAlpha=s,r.groupColorAlpha=r.groupColor+((s*255|0)<<24)}t&Si&&(r.groupBlendMode=r.localBlendMode==="inherit"?e.groupBlendMode:r.localBlendMode),t&Yt&&(r.globalDisplayStatus=r.localDisplayStatus&e.globalDisplayStatus),r._updateFlags=0}function Dm(r,e){const{list:t,index:s}=r.childrenRenderablesToUpdate;let i=!1;for(let n=0;n<s;n++){const a=t[n];if(i=e[a.renderPipeId].validateRenderable(a),i)break}return r.structureDidChange=i,i}const Um=new E;class Ch{constructor(e){this._renderer=e}render({container:e,transform:t}){const s=e.parent,i=e.renderGroup.renderGroupParent;e.parent=null,e.renderGroup.renderGroupParent=null;const n=this._renderer;let a=Um;t&&(a=a.copyFrom(e.renderGroup.localTransform),e.renderGroup.localTransform.copyFrom(t));const o=n.renderPipes;this._updateCachedRenderGroups(e.renderGroup,null),this._updateRenderGroups(e.renderGroup),n.globalUniforms.start({worldTransformMatrix:t?e.renderGroup.localTransform:e.renderGroup.worldTransform,worldColor:e.renderGroup.worldColorAlpha}),mi(e.renderGroup,o),o.uniformBatch&&o.uniformBatch.renderEnd(),t&&e.renderGroup.localTransform.copyFrom(a),e.parent=s,e.renderGroup.renderGroupParent=i}destroy(){this._renderer=null}_updateCachedRenderGroups(e,t){if(e.isCachedAsTexture){if(!e.updateCacheTexture)return;t=e}e._parentCacheAsTextureRenderGroup=t;for(let s=e.renderGroupChildren.length-1;s>=0;s--)this._updateCachedRenderGroups(e.renderGroupChildren[s],t);if(e.invalidateMatrices(),e.isCachedAsTexture){if(e.textureNeedsUpdate){const s=e.root.getLocalBounds();s.ceil();const i=e.texture;e.texture&&re.returnTexture(e.texture);const n=this._renderer,a=e.textureOptions.resolution||n.view.resolution,o=e.textureOptions.antialias??n.view.antialias;e.texture=re.getOptimalTexture(s.width,s.height,a,o),e._textureBounds||(e._textureBounds=new ie),e._textureBounds.copyFrom(s),i!==e.texture&&e.renderGroupParent&&(e.renderGroupParent.structureDidChange=!0)}}else e.texture&&(re.returnTexture(e.texture),e.texture=null)}_updateRenderGroups(e){const t=this._renderer,s=t.renderPipes;if(e.runOnRender(t),e.instructionSet.renderPipes=s,e.structureDidChange?_i(e.childrenRenderablesToUpdate.list,0):Dm(e,s),Ph(e),e.structureDidChange?(e.structureDidChange=!1,this._buildInstructions(e,t)):this._updateRenderables(e),e.childrenRenderablesToUpdate.index=0,t.renderPipes.batch.upload(e.instructionSet),!(e.isCachedAsTexture&&!e.textureNeedsUpdate))for(let i=0;i<e.renderGroupChildren.length;i++)this._updateRenderGroups(e.renderGroupChildren[i])}_updateRenderables(e){const{list:t,index:s}=e.childrenRenderablesToUpdate;for(let i=0;i<s;i++){const n=t[i];n.didViewUpdate&&e.updateRenderable(n)}_i(t,s)}_buildInstructions(e,t){const s=e.root,i=e.instructionSet;i.reset();const n=t.renderPipes?t:t.batch.renderer,a=n.renderPipes;a.batch.buildStart(i),a.blendMode.buildStart(),a.colorMask.buildStart(),s.sortableChildren&&s.sortChildren(),s.collectRenderablesWithEffects(i,n,null),a.batch.buildEnd(i),a.blendMode.buildEnd(i)}}Ch.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"renderGroup"};class Eh{constructor(e){this._renderer=e}addRenderable(e,t){const s=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,s),this._renderer.renderPipes.batch.addToBatch(s,t)}updateRenderable(e){const t=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,t),t._batcher.updateElement(t)}validateRenderable(e){const t=this._getGpuSprite(e);return!t._batcher.checkAndUpdateTexture(t,e._texture)}_updateBatchableSprite(e,t){t.bounds=e.visualBounds,t.texture=e._texture}_getGpuSprite(e){return e._gpuData[this._renderer.uid]||this._initGPUSprite(e)}_initGPUSprite(e){const t=new er;return t.renderable=e,t.transform=e.groupTransform,t.texture=e._texture,t.bounds=e.visualBounds,t.roundPixels=this._renderer._roundPixels|e._roundPixels,e._gpuData[this._renderer.uid]=t,t}destroy(){this._renderer=null}}Eh.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"sprite"};const en=class Mh{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new V(0),this.color=this._backgroundColor,this.alpha=1}init(e){e={...Mh.defaultOptions,...e},this.clearBeforeRender=e.clearBeforeRender,this.color=e.background||e.backgroundColor||this._backgroundColor,this.alpha=e.backgroundAlpha,this._backgroundColor.setAlpha(e.backgroundAlpha)}get color(){return this._backgroundColor}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get colorRgba(){return this._backgroundColor.toArray()}destroy(){}};en.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"background",priority:0};en.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};let Om=en;const qt={};M.handle(y.BlendMode,r=>{if(!r.name)throw new Error("BlendMode extension must have a name property");qt[r.name]=r.ref},r=>{delete qt[r.name]});class Fh{constructor(e){this._isAdvanced=!1,this._filterHash=Object.create(null),this._renderer=e,this._renderer.runners.prerender.add(this)}prerender(){this._activeBlendMode="normal",this._isAdvanced=!1}setBlendMode(e,t,s){if(this._activeBlendMode===t){this._isAdvanced&&this._renderableList.push(e);return}this._activeBlendMode=t,this._isAdvanced&&this._endAdvancedBlendMode(s),this._isAdvanced=!!qt[t],this._isAdvanced&&(this._beginAdvancedBlendMode(s),this._renderableList.push(e))}_beginAdvancedBlendMode(e){this._renderer.renderPipes.batch.break(e);const t=this._activeBlendMode;if(!qt[t]){B(`Unable to assign BlendMode: '${t}'. You may want to include: import 'pixi.js/advanced-blend-modes'`);return}let s=this._filterHash[t];s||(s=this._filterHash[t]=new Ns,s.filters=[new qt[t]]);const i={renderPipeId:"filter",action:"pushFilter",renderables:[],filterEffect:s,canBundle:!1};this._renderableList=i.renderables,e.add(i)}_endAdvancedBlendMode(e){this._renderableList=null,this._renderer.renderPipes.batch.break(e),e.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}buildStart(){this._isAdvanced=!1}buildEnd(e){this._isAdvanced&&this._endAdvancedBlendMode(e)}destroy(){this._renderer=null,this._renderableList=null;for(const e in this._filterHash)this._filterHash[e].destroy();this._filterHash=null}}Fh.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"blendMode"};const Lr={png:"image/png",jpg:"image/jpeg",webp:"image/webp"},tn=class Bh{constructor(e){this._renderer=e}_normalizeOptions(e,t={}){return e instanceof ae||e instanceof k?{target:e,...t}:{...t,...e}}async image(e){const t=new Image;return t.src=await this.base64(e),t}async base64(e){e=this._normalizeOptions(e,Bh.defaultImageOptions);const{format:t,quality:s}=e,i=this.canvas(e);if(i.toBlob!==void 0)return new Promise((n,a)=>{i.toBlob(o=>{if(!o){a(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>n(l.result),l.onerror=a,l.readAsDataURL(o)},Lr[t],s)});if(i.toDataURL!==void 0)return i.toDataURL(Lr[t],s);if(i.convertToBlob!==void 0){const n=await i.convertToBlob({type:Lr[t],quality:s});return new Promise((a,o)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=o,l.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e){e=this._normalizeOptions(e);const t=e.target,s=this._renderer;if(t instanceof k)return s.texture.generateCanvas(t);const i=s.textureGenerator.generateTexture(e),n=s.texture.generateCanvas(i);return i.destroy(!0),n}pixels(e){e=this._normalizeOptions(e);const t=e.target,s=this._renderer,i=t instanceof k?t:s.textureGenerator.generateTexture(e),n=s.texture.getPixels(i);return t instanceof ae&&i.destroy(!0),n}texture(e){return e=this._normalizeOptions(e),e.target instanceof k?e.target:this._renderer.textureGenerator.generateTexture(e)}download(e){e=this._normalizeOptions(e);const t=this.canvas(e),s=document.createElement("a");s.download=e.filename??"image.png",s.href=t.toDataURL("image/png"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}log(e){const t=e.width??200;e=this._normalizeOptions(e);const s=this.canvas(e),i=s.toDataURL();console.log(`[Pixi Texture] ${s.width}px ${s.height}px`);const n=["font-size: 1px;",`padding: ${t}px 300px;`,`background: url(${i}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",n)}destroy(){this._renderer=null}};tn.extension={type:[y.WebGLSystem,y.WebGPUSystem],name:"extract"};tn.defaultImageOptions={format:"png",quality:1};let Lm=tn;class sn extends k{static create(e){return new sn({source:new J(e)})}resize(e,t,s){return this.source.resize(e,t,s),this}}const Nm=new W,Hm=new ie,Wm=[0,0,0,0];class Rh{constructor(e){this._renderer=e}generateTexture(e){var h;e instanceof ae&&(e={target:e,frame:void 0,textureSourceOptions:{},resolution:void 0});const t=e.resolution||this._renderer.resolution,s=e.antialias||this._renderer.view.antialias,i=e.target;let n=e.clearColor;n?n=Array.isArray(n)&&n.length===4?n:V.shared.setValue(n).toArray():n=Wm;const a=((h=e.frame)==null?void 0:h.copyTo(Nm))||Ti(i,Hm).rectangle;a.width=Math.max(a.width,1/t)|0,a.height=Math.max(a.height,1/t)|0;const o=sn.create({...e.textureSourceOptions,width:a.width,height:a.height,resolution:t,antialias:s}),l=E.shared.translate(-a.x,-a.y);return this._renderer.render({container:i,transform:l,target:o,clearColor:n}),o.source.updateMipmaps(),o}destroy(){this._renderer=null}}Rh.extension={type:[y.WebGLSystem,y.WebGPUSystem],name:"textureGenerator"};function us(r,e,t){const s=(r>>24&255)/255;e[t++]=(r&255)/255*s,e[t++]=(r>>8&255)/255*s,e[t++]=(r>>16&255)/255*s,e[t++]=s}class Ih{constructor(e){this._stackIndex=0,this._globalUniformDataStack=[],this._uniformsPool=[],this._activeUniforms=[],this._bindGroupPool=[],this._activeBindGroups=[],this._renderer=e}reset(){this._stackIndex=0;for(let e=0;e<this._activeUniforms.length;e++)this._uniformsPool.push(this._activeUniforms[e]);for(let e=0;e<this._activeBindGroups.length;e++)this._bindGroupPool.push(this._activeBindGroups[e]);this._activeUniforms.length=0,this._activeBindGroups.length=0}start(e){this.reset(),this.push(e)}bind({size:e,projectionMatrix:t,worldTransformMatrix:s,worldColor:i,offset:n}){const a=this._renderer.renderTarget.renderTarget,o=this._stackIndex?this._globalUniformDataStack[this._stackIndex-1]:{worldTransformMatrix:new E,worldColor:4294967295,offset:new Y},l={projectionMatrix:t||this._renderer.renderTarget.projectionMatrix,resolution:e||a.size,worldTransformMatrix:s||o.worldTransformMatrix,worldColor:i||o.worldColor,offset:n||o.offset,bindGroup:null},h=this._uniformsPool.pop()||this._createUniforms();this._activeUniforms.push(h);const c=h.uniforms;c.uProjectionMatrix=l.projectionMatrix,c.uResolution=l.resolution,c.uWorldTransformMatrix.copyFrom(l.worldTransformMatrix),c.uWorldTransformMatrix.tx-=l.offset.x,c.uWorldTransformMatrix.ty-=l.offset.y,us(l.worldColor,c.uWorldColorAlpha,0),h.update();let u;this._renderer.renderPipes.uniformBatch?u=this._renderer.renderPipes.uniformBatch.getUniformBindGroup(h,!1):(u=this._bindGroupPool.pop()||new Ge,this._activeBindGroups.push(u),u.setResource(h,0)),l.bindGroup=u,this._currentGlobalUniformData=l}push(e){this.bind(e),this._globalUniformDataStack[this._stackIndex++]=this._currentGlobalUniformData}pop(){this._currentGlobalUniformData=this._globalUniformDataStack[--this._stackIndex-1],this._renderer.type===Se.WEBGL&&this._currentGlobalUniformData.bindGroup.resources[0].update()}get bindGroup(){return this._currentGlobalUniformData.bindGroup}get globalUniformData(){return this._currentGlobalUniformData}get uniformGroup(){return this._currentGlobalUniformData.bindGroup.resources[0]}_createUniforms(){return new oe({uProjectionMatrix:{value:new E,type:"mat3x3<f32>"},uWorldTransformMatrix:{value:new E,type:"mat3x3<f32>"},uWorldColorAlpha:{value:new Float32Array(4),type:"vec4<f32>"},uResolution:{value:[0,0],type:"vec2<f32>"}},{isStatic:!0})}destroy(){this._renderer=null}}Ih.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"globalUniforms"};let Vm=1;class Gh{constructor(){this._tasks=[],this._offset=0}init(){Ce.system.add(this._update,this)}repeat(e,t,s=!0){const i=Vm++;let n=0;return s&&(this._offset+=1e3,n=this._offset),this._tasks.push({func:e,duration:t,start:performance.now(),offset:n,last:performance.now(),repeat:!0,id:i}),i}cancel(e){for(let t=0;t<this._tasks.length;t++)if(this._tasks[t].id===e){this._tasks.splice(t,1);return}}_update(){const e=performance.now();for(let t=0;t<this._tasks.length;t++){const s=this._tasks[t];if(e-s.offset-s.last>=s.duration){const i=e-s.start;s.func(i),s.last=e}}}destroy(){Ce.system.remove(this._update,this),this._tasks.length=0}}Gh.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"scheduler",priority:0};let qa=!1;function zm(r){if(!qa){if(O.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const e=[`%c  %c  %c  %c  %c PixiJS %c v${zs} (${r}) http://www.pixijs.com/

`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...e)}else globalThis.console&&globalThis.console.log(`PixiJS ${zs} - ${r} - http://www.pixijs.com/`);qa=!0}}class rn{constructor(e){this._renderer=e}init(e){if(e.hello){let t=this._renderer.name;this._renderer.type===Se.WEBGL&&(t+=` ${this._renderer.context.webGLVersion}`),zm(t)}}}rn.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"hello",priority:-2};rn.defaultOptions={hello:!1};function Ym(r){let e=!1;for(const s in r)if(r[s]==null){e=!0;break}if(!e)return r;const t=Object.create(null);for(const s in r){const i=r[s];i&&(t[s]=i)}return t}function jm(r){let e=0;for(let t=0;t<r.length;t++)r[t]==null?e++:r[t-e]=r[t];return r.length-=e,r}let $m=0;const nn=class Dh{constructor(e){this._managedRenderables=[],this._managedHashes=[],this._managedArrays=[],this._renderer=e}init(e){e={...Dh.defaultOptions,...e},this.maxUnusedTime=e.renderableGCMaxUnusedTime,this._frequency=e.renderableGCFrequency,this.enabled=e.renderableGCActive}get enabled(){return!!this._handler}set enabled(e){this.enabled!==e&&(e?(this._handler=this._renderer.scheduler.repeat(()=>this.run(),this._frequency,!1),this._hashHandler=this._renderer.scheduler.repeat(()=>{for(const t of this._managedHashes)t.context[t.hash]=Ym(t.context[t.hash])},this._frequency),this._arrayHandler=this._renderer.scheduler.repeat(()=>{for(const t of this._managedArrays)jm(t.context[t.hash])},this._frequency)):(this._renderer.scheduler.cancel(this._handler),this._renderer.scheduler.cancel(this._hashHandler),this._renderer.scheduler.cancel(this._arrayHandler)))}addManagedHash(e,t){this._managedHashes.push({context:e,hash:t})}addManagedArray(e,t){this._managedArrays.push({context:e,hash:t})}prerender({container:e}){this._now=performance.now(),e.renderGroup.gcTick=$m++,this._updateInstructionGCTick(e.renderGroup,e.renderGroup.gcTick)}addRenderable(e){this.enabled&&(e._lastUsed===-1&&(this._managedRenderables.push(e),e.once("destroyed",this._removeRenderable,this)),e._lastUsed=this._now)}run(){var n;const e=this._now,t=this._managedRenderables,s=this._renderer.renderPipes;let i=0;for(let a=0;a<t.length;a++){const o=t[a];if(o===null){i++;continue}const l=o.renderGroup??o.parentRenderGroup,h=((n=l==null?void 0:l.instructionSet)==null?void 0:n.gcTick)??-1;if(((l==null?void 0:l.gcTick)??0)===h&&(o._lastUsed=e),e-o._lastUsed>this.maxUnusedTime){if(!o.destroyed){const c=s;l&&(l.structureDidChange=!0),c[o.renderPipeId].destroyRenderable(o)}o._lastUsed=-1,i++,o.off("destroyed",this._removeRenderable,this)}else t[a-i]=o}t.length-=i}destroy(){this.enabled=!1,this._renderer=null,this._managedRenderables.length=0,this._managedHashes.length=0,this._managedArrays.length=0}_removeRenderable(e){const t=this._managedRenderables.indexOf(e);t>=0&&(e.off("destroyed",this._removeRenderable,this),this._managedRenderables[t]=null)}_updateInstructionGCTick(e,t){e.instructionSet.gcTick=t;for(const s of e.renderGroupChildren)this._updateInstructionGCTick(s,t)}};nn.extension={type:[y.WebGLSystem,y.WebGPUSystem],name:"renderableGC",priority:0};nn.defaultOptions={renderableGCActive:!0,renderableGCMaxUnusedTime:6e4,renderableGCFrequency:3e4};let Xm=nn;const an=class Uh{constructor(e){this._renderer=e,this.count=0,this.checkCount=0}init(e){e={...Uh.defaultOptions,...e},this.checkCountMax=e.textureGCCheckCountMax,this.maxIdle=e.textureGCAMaxIdle??e.textureGCMaxIdle,this.active=e.textureGCActive}postrender(){this._renderer.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this._renderer.texture.managedTextures;for(let t=0;t<e.length;t++){const s=e[t];s.autoGarbageCollect&&s.resource&&s._touched>-1&&this.count-s._touched>this.maxIdle&&(s._touched=-1,s.unload())}}destroy(){this._renderer=null}};an.extension={type:[y.WebGLSystem,y.WebGPUSystem],name:"textureGC"};an.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:null,textureGCMaxIdle:60*60,textureGCCheckCountMax:600};let Km=an;const on=class Oh{get autoDensity(){return this.texture.source.autoDensity}set autoDensity(e){this.texture.source.autoDensity=e}get resolution(){return this.texture.source._resolution}set resolution(e){this.texture.source.resize(this.texture.source.width,this.texture.source.height,e)}init(e){e={...Oh.defaultOptions,...e},e.view&&(U(H,"ViewSystem.view has been renamed to ViewSystem.canvas"),e.canvas=e.view),this.screen=new W(0,0,e.width,e.height),this.canvas=e.canvas||O.get().createCanvas(),this.antialias=!!e.antialias,this.texture=ch(this.canvas,e),this.renderTarget=new gi({colorTextures:[this.texture],depth:!!e.depth,isRoot:!0}),this.texture.source.transparent=e.backgroundAlpha<1,this.resolution=e.resolution}resize(e,t,s){this.texture.source.resize(e,t,s),this.screen.width=this.texture.frame.width,this.screen.height=this.texture.frame.height}destroy(e=!1){(typeof e=="boolean"?e:!!(e!=null&&e.removeView))&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};on.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"view",priority:0};on.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};let qm=on;const Lh=[Om,Ih,rn,qm,Ch,Km,Rh,Lm,el,Xm,Gh],Nh=[Fh,Yl,Eh,Ah,jl,Xl,$l,Sh],Zm=[...Lh,hh,$p,Wp,rh,Kl,vh,gh,Jl,yh,_h,sh,vm,ih,th],Qm=[...Nh],Jm=[Wl,Th,wh],Hh=[],Wh=[],Vh=[];M.handleByNamedList(y.WebGLSystem,Hh);M.handleByNamedList(y.WebGLPipes,Wh);M.handleByNamedList(y.WebGLPipesAdaptor,Vh);M.add(...Zm,...Qm,...Jm);class e_ extends Zs{constructor(){const e={name:"webgl",type:Se.WEBGL,systems:Hh,renderPipes:Wh,renderPipeAdaptors:Vh};super(e)}}const t_=Object.freeze(Object.defineProperty({__proto__:null,WebGLRenderer:e_},Symbol.toStringTag,{value:"Module"}));class zh{constructor(e){this._hash=Object.create(null),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_hash")}contextChange(e){this._gpu=e}getBindGroup(e,t,s){return e._updateKey(),this._hash[e._key]||this._createBindGroup(e,t,s)}_createBindGroup(e,t,s){const i=this._gpu.device,n=t.layout[s],a=[],o=this._renderer;for(const c in n){const u=e.resources[c]??e.resources[n[c]];let d;if(u._resourceType==="uniformGroup"){const f=u;o.ubo.updateUniformGroup(f);const g=f.buffer;d={buffer:o.buffer.getGPUBuffer(g),offset:0,size:g.descriptor.size}}else if(u._resourceType==="buffer"){const f=u;d={buffer:o.buffer.getGPUBuffer(f),offset:0,size:f.descriptor.size}}else if(u._resourceType==="bufferResource"){const f=u;d={buffer:o.buffer.getGPUBuffer(f.buffer),offset:f.offset,size:f.size}}else if(u._resourceType==="textureSampler"){const f=u;d=o.texture.getGpuSampler(f)}else if(u._resourceType==="textureSource"){const f=u;d=o.texture.getGpuSource(f).createView({})}a.push({binding:n[c],resource:d})}const l=o.shader.getProgramData(t).bindGroups[s],h=i.createBindGroup({layout:l,entries:a});return this._hash[e._key]=h,h}destroy(){for(const e of Object.keys(this._hash))this._hash[e]=null;this._hash=null,this._renderer=null}}zh.extension={type:[y.WebGPUSystem],name:"bindGroup"};class Yh{constructor(e){this._gpuBuffers=Object.create(null),this._managedBuffers=[],e.renderableGC.addManagedHash(this,"_gpuBuffers")}contextChange(e){this._gpu=e}getGPUBuffer(e){return this._gpuBuffers[e.uid]||this.createGPUBuffer(e)}updateBuffer(e){const t=this._gpuBuffers[e.uid]||this.createGPUBuffer(e),s=e.data;return e._updateID&&s&&(e._updateID=0,this._gpu.device.queue.writeBuffer(t,0,s.buffer,0,(e._updateSize||s.byteLength)+3&-4)),t}destroyAll(){for(const e in this._gpuBuffers)this._gpuBuffers[e].destroy();this._gpuBuffers={}}createGPUBuffer(e){this._gpuBuffers[e.uid]||(e.on("update",this.updateBuffer,this),e.on("change",this.onBufferChange,this),e.on("destroy",this.onBufferDestroy,this),this._managedBuffers.push(e));const t=this._gpu.device.createBuffer(e.descriptor);return e._updateID=0,e.data&&(ni(e.data.buffer,t.getMappedRange()),t.unmap()),this._gpuBuffers[e.uid]=t,t}onBufferChange(e){this._gpuBuffers[e.uid].destroy(),e._updateID=0,this._gpuBuffers[e.uid]=this.createGPUBuffer(e)}onBufferDestroy(e){this._managedBuffers.splice(this._managedBuffers.indexOf(e),1),this._destroyBuffer(e)}destroy(){this._managedBuffers.forEach(e=>this._destroyBuffer(e)),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(e){this._gpuBuffers[e.uid].destroy(),e.off("update",this.updateBuffer,this),e.off("change",this.onBufferChange,this),e.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[e.uid]=null}}Yh.extension={type:[y.WebGPUSystem],name:"buffer"};class s_{constructor({minUniformOffsetAlignment:e}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=e,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(e){if(e>this._minUniformOffsetAlignment/4)throw new Error(`UniformBufferBatch: array is too large: ${e*4}`);const t=this.byteIndex;let s=t+e*4;if(s=Math.ceil(s/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,s>this.data.length*4)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=s,t}addGroup(e){const t=this.addEmptyGroup(e.length);for(let s=0;s<e.length;s++)this.data[t/4+s]=e[s];return t}destroy(){this.data=null}}class jh{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.pipeline.setColorMask(e))}destroy(){this._renderer=null,this._colorMaskCache=null}}jh.extension={type:[y.WebGPUSystem],name:"colorMask"};class ln{constructor(e){this._renderer=e}async init(e){return this._initPromise?this._initPromise:(this._initPromise=this._createDeviceAndAdaptor(e).then(t=>{this.gpu=t,this._renderer.runners.contextChange.emit(this.gpu)}),this._initPromise)}contextChange(e){this._renderer.gpu=e}async _createDeviceAndAdaptor(e){const t=await O.get().getNavigator().gpu.requestAdapter({powerPreference:e.powerPreference,forceFallbackAdapter:e.forceFallbackAdapter}),s=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(n=>t.features.has(n)),i=await t.requestDevice({requiredFeatures:s});return{adapter:t,device:i}}destroy(){this.gpu=null,this._renderer=null}}ln.extension={type:[y.WebGPUSystem],name:"device"};ln.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1};class $h{constructor(e){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=e}renderStart(){this.commandFinished=new Promise(e=>{this._resolveCommandFinished=e}),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(e){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(e.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(e){this.renderPassEncoder.setViewport(e.x,e.y,e.width,e.height,0,1)}setPipelineFromGeometryProgramAndState(e,t,s,i){const n=this._renderer.pipeline.getPipeline(e,t,s,i);this.setPipeline(n)}setPipeline(e){this._boundPipeline!==e&&(this._boundPipeline=e,this.renderPassEncoder.setPipeline(e))}_setVertexBuffer(e,t){this._boundVertexBuffer[e]!==t&&(this._boundVertexBuffer[e]=t,this.renderPassEncoder.setVertexBuffer(e,this._renderer.buffer.updateBuffer(t)))}_setIndexBuffer(e){if(this._boundIndexBuffer===e)return;this._boundIndexBuffer=e;const t=e.data.BYTES_PER_ELEMENT===2?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(e),t)}resetBindGroup(e){this._boundBindGroup[e]=null}setBindGroup(e,t,s){if(this._boundBindGroup[e]===t)return;this._boundBindGroup[e]=t,t._touch(this._renderer.textureGC.count);const i=this._renderer.bindGroup.getBindGroup(t,s,e);this.renderPassEncoder.setBindGroup(e,i)}setGeometry(e,t){const s=this._renderer.pipeline.getBufferNamesToBind(e,t);for(const i in s)this._setVertexBuffer(i,e.attributes[s[i]].buffer);e.indexBuffer&&this._setIndexBuffer(e.indexBuffer)}_setShaderBindGroups(e,t){for(const s in e.groups){const i=e.groups[s];t||this._syncBindGroup(i),this.setBindGroup(s,i,e.gpuProgram)}}_syncBindGroup(e){for(const t in e.resources){const s=e.resources[t];s.isUniformGroup&&this._renderer.ubo.updateUniformGroup(s)}}draw(e){const{geometry:t,shader:s,state:i,topology:n,size:a,start:o,instanceCount:l,skipSync:h}=e;this.setPipelineFromGeometryProgramAndState(t,s.gpuProgram,i,n),this.setGeometry(t,s.gpuProgram),this._setShaderBindGroups(s,h),t.indexBuffer?this.renderPassEncoder.drawIndexed(a||t.indexBuffer.data.length,l??t.instanceCount,o||0):this.renderPassEncoder.draw(a||t.getSize(),l??t.instanceCount,o||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){const e=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(e);const t=this._boundPipeline,s={...this._boundVertexBuffer},i=this._boundIndexBuffer,n={...this._boundBindGroup};this._clearCache();const a=this._renderer.renderTarget.viewport;this.renderPassEncoder.setViewport(a.x,a.y,a.width,a.height,0,1),this.setPipeline(t);for(const o in s)this._setVertexBuffer(o,s[o]);for(const o in n)this.setBindGroup(o,n[o],null);this._setIndexBuffer(i)}_clearCache(){for(let e=0;e<16;e++)this._boundBindGroup[e]=null,this._boundVertexBuffer[e]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(e){this._gpu=e}}$h.extension={type:[y.WebGPUSystem],name:"encoder",priority:1};class Xh{constructor(e){this._renderer=e}contextChange(){this.maxTextures=this._renderer.device.gpu.device.limits.maxSampledTexturesPerShaderStage,this.maxBatchableTextures=this.maxTextures}destroy(){}}Xh.extension={type:[y.WebGPUSystem],name:"limits"};class Kh{constructor(e){this._renderTargetStencilState=Object.create(null),this._renderer=e,e.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(e){let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:Q.DISABLED,stencilReference:0}),this._activeRenderTarget=e,this.setStencilMode(t.stencilMode,t.stencilReference)}setStencilMode(e,t){const s=this._renderTargetStencilState[this._activeRenderTarget.uid];s.stencilMode=e,s.stencilReference=t;const i=this._renderer;i.pipeline.setStencilMode(e),i.encoder.renderPassEncoder.setStencilReference(t)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}Kh.extension={type:[y.WebGPUSystem],name:"stencil"};const Us={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function r_(r){const e=r.map(s=>({data:s,offset:0,size:0}));let t=0;for(let s=0;s<e.length;s++){const i=e[s];let n=Us[i.data.type].size;const a=Us[i.data.type].align;if(!Us[i.data.type])throw new Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${i.data.type}`);i.data.size>1&&(n=Math.max(n,a)*i.data.size),t=Math.ceil(t/a)*a,i.size=n,i.offset=t,t+=n}return t=Math.ceil(t/16)*16,{uboElements:e,size:t}}function i_(r,e){const{size:t,align:s}=Us[r.data.type],i=(s-t)/4,n=r.data.type.indexOf("i32")>=0?"dataInt32":"data";return`
         v = uv.${r.data.name};
         ${e!==0?`offset += ${e};`:""}

         arrayOffset = offset;

         t = 0;

         for(var i=0; i < ${r.data.size*(t/4)}; i++)
         {
             for(var j = 0; j < ${t/4}; j++)
             {
                 ${n}[arrayOffset++] = v[t++];
             }
             ${i!==0?`arrayOffset += ${i};`:""}
         }
     `}function n_(r){return oh(r,"uboWgsl",i_,qp)}class qh extends nh{constructor(){super({createUboElements:r_,generateUboSync:n_})}}qh.extension={type:[y.WebGPUSystem],name:"ubo"};const He=128;class Zh{constructor(e){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_bindGroupHash"),this._batchBuffer=new s_({minUniformOffsetAlignment:He});const t=256/He;for(let s=0;s<t;s++){let i=L.UNIFORM|L.COPY_DST;s===0&&(i|=L.COPY_SRC),this._buffers.push(new fe({data:this._batchBuffer.data,usage:i}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(const e in this._bindGroupHash)this._bindGroupHash[e]=null;this._batchBuffer.clear()}getUniformBindGroup(e,t){if(!t&&this._bindGroupHash[e.uid])return this._bindGroupHash[e.uid];this._renderer.ubo.ensureUniformGroup(e);const s=e.buffer.data,i=this._batchBuffer.addEmptyGroup(s.length);return this._renderer.ubo.syncUniformGroup(e,this._batchBuffer.data,i/4),this._bindGroupHash[e.uid]=this._getBindGroup(i/He),this._bindGroupHash[e.uid]}getUboResource(e){this._renderer.ubo.updateUniformGroup(e);const t=e.buffer.data,s=this._batchBuffer.addGroup(t);return this._getBufferResource(s/He)}getArrayBindGroup(e){const t=this._batchBuffer.addGroup(e);return this._getBindGroup(t/He)}getArrayBufferResource(e){const s=this._batchBuffer.addGroup(e)/He;return this._getBufferResource(s)}_getBufferResource(e){if(!this._bufferResources[e]){const t=this._buffers[e%2];this._bufferResources[e]=new Ji({buffer:t,offset:(e/2|0)*256,size:He})}return this._bufferResources[e]}_getBindGroup(e){if(!this._bindGroups[e]){const t=new Ge({0:this._getBufferResource(e)});this._bindGroups[e]=t}return this._bindGroups[e]}_uploadBindGroups(){const e=this._renderer.buffer,t=this._buffers[0];t.update(this._batchBuffer.byteIndex),e.updateBuffer(t);const s=this._renderer.gpu.device.createCommandEncoder();for(let i=1;i<this._buffers.length;i++){const n=this._buffers[i];s.copyBufferToBuffer(e.getGPUBuffer(t),He,e.getGPUBuffer(n),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([s.finish()])}destroy(){for(let e=0;e<this._bindGroups.length;e++)this._bindGroups[e].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers=null;for(let e=0;e<this._bufferResources.length;e++)this._bufferResources[e].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}Zh.extension={type:[y.WebGPUPipes],name:"uniformBatch"};const a_={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};function o_(r,e,t,s,i){return r<<24|e<<16|t<<10|s<<5|i}function l_(r,e,t,s){return t<<6|r<<3|s<<1|e}class Qh{constructor(e){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._bindingNamesCache=Object.create(null),this._pipeCache=Object.create(null),this._pipeStateCaches=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=e}contextChange(e){this._gpu=e,this.setStencilMode(Q.DISABLED),this._updatePipeHash()}setMultisampleCount(e){this._multisampleCount!==e&&(this._multisampleCount=e,this._updatePipeHash())}setRenderTarget(e){this._multisampleCount=e.msaaSamples,this._depthStencilAttachment=e.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(e){this._colorMask!==e&&(this._colorMask=e,this._updatePipeHash())}setStencilMode(e){this._stencilMode!==e&&(this._stencilMode=e,this._stencilState=Ke[e],this._updatePipeHash())}setPipeline(e,t,s,i){const n=this.getPipeline(e,t,s);i.setPipeline(n)}getPipeline(e,t,s,i){e._layoutKey||(Zl(e,t.attributeData),this._generateBufferKey(e)),i||(i=e.topology);const n=o_(e._layoutKey,t._layoutKey,s.data,s._blendModeId,a_[i]);return this._pipeCache[n]?this._pipeCache[n]:(this._pipeCache[n]=this._createPipeline(e,t,s,i),this._pipeCache[n])}_createPipeline(e,t,s,i){const n=this._gpu.device,a=this._createVertexBufferLayouts(e,t),o=this._renderer.state.getColorTargets(s);o[0].writeMask=this._stencilMode===Q.RENDERING_MASK_ADD?0:this._colorMask;const l=this._renderer.shader.getProgramData(t).pipeline,h={vertex:{module:this._getModule(t.vertex.source),entryPoint:t.vertex.entryPoint,buffers:a},fragment:{module:this._getModule(t.fragment.source),entryPoint:t.fragment.entryPoint,targets:o},primitive:{topology:i,cullMode:s.cullMode},layout:l,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};return this._depthStencilAttachment&&(h.depthStencil={...this._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:s.depthTest,depthCompare:s.depthTest?"less":"always"}),n.createRenderPipeline(h)}_getModule(e){return this._moduleCache[e]||this._createModule(e)}_createModule(e){const t=this._gpu.device;return this._moduleCache[e]=t.createShaderModule({code:e}),this._moduleCache[e]}_generateBufferKey(e){const t=[];let s=0;const i=Object.keys(e.attributes).sort();for(let a=0;a<i.length;a++){const o=e.attributes[i[a]];t[s++]=o.offset,t[s++]=o.format,t[s++]=o.stride,t[s++]=o.instance}const n=t.join("|");return e._layoutKey=Qt(n,"geometry"),e._layoutKey}_generateAttributeLocationsKey(e){const t=[];let s=0;const i=Object.keys(e.attributeData).sort();for(let a=0;a<i.length;a++){const o=e.attributeData[i[a]];t[s++]=o.location}const n=t.join("|");return e._attributeLocationsKey=Qt(n,"programAttributes"),e._attributeLocationsKey}getBufferNamesToBind(e,t){const s=e._layoutKey<<16|t._attributeLocationsKey;if(this._bindingNamesCache[s])return this._bindingNamesCache[s];const i=this._createVertexBufferLayouts(e,t),n=Object.create(null),a=t.attributeData;for(let o=0;o<i.length;o++){const h=Object.values(i[o].attributes)[0].shaderLocation;for(const c in a)if(a[c].location===h){n[o]=c;break}}return this._bindingNamesCache[s]=n,n}_createVertexBufferLayouts(e,t){t._attributeLocationsKey||this._generateAttributeLocationsKey(t);const s=e._layoutKey<<16|t._attributeLocationsKey;if(this._bufferLayoutsCache[s])return this._bufferLayoutsCache[s];const i=[];return e.buffers.forEach(n=>{const a={arrayStride:0,stepMode:"vertex",attributes:[]},o=a.attributes;for(const l in t.attributeData){const h=e.attributes[l];(h.divisor??1)!==1&&B(`Attribute ${l} has an invalid divisor value of '${h.divisor}'. WebGPU only supports a divisor value of 1`),h.buffer===n&&(a.arrayStride=h.stride,a.stepMode=h.instance?"instance":"vertex",o.push({shaderLocation:t.attributeData[l].location,offset:h.offset,format:h.format}))}o.length&&i.push(a)}),this._bufferLayoutsCache[s]=i,i}_updatePipeHash(){const e=l_(this._stencilMode,this._multisampleCount,this._colorMask,this._depthStencilAttachment);this._pipeStateCaches[e]||(this._pipeStateCaches[e]=Object.create(null)),this._pipeCache=this._pipeStateCaches[e]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}}Qh.extension={type:[y.WebGPUSystem],name:"pipeline"};class h_{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}class c_{init(e,t){this._renderer=e,this._renderTargetSystem=t}copyToTexture(e,t,s,i,n){const a=this._renderer,o=this._getGpuColorTexture(e),l=a.texture.getGpuSource(t.source);return a.encoder.commandEncoder.copyTextureToTexture({texture:o,origin:s},{texture:l,origin:n},i),t}startRenderPass(e,t=!0,s,i){const a=this._renderTargetSystem.getGpuRenderTarget(e),o=this.getDescriptor(e,t,s);a.descriptor=o,this._renderer.pipeline.setRenderTarget(a),this._renderer.encoder.beginRenderPass(a),this._renderer.encoder.setViewport(i)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);return t.contexts[0]?t.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(e.colorTextures[0].source)}getDescriptor(e,t,s){typeof t=="boolean"&&(t=t?ue.ALL:ue.NONE);const i=this._renderTargetSystem,n=i.getGpuRenderTarget(e),a=e.colorTextures.map((h,c)=>{const u=n.contexts[c];let d,f;u?d=u.getCurrentTexture().createView():d=this._renderer.texture.getGpuSource(h).createView({mipLevelCount:1}),n.msaaTextures[c]&&(f=d,d=this._renderer.texture.getTextureView(n.msaaTextures[c]));const g=t&ue.COLOR?"clear":"load";return s??(s=i.defaultClearColor),{view:d,resolveTarget:f,clearValue:s,storeOp:"store",loadOp:g}});let o;if((e.stencil||e.depth)&&!e.depthStencilTexture&&(e.ensureDepthStencilTexture(),e.depthStencilTexture.source.sampleCount=n.msaa?4:1),e.depthStencilTexture){const h=t&ue.STENCIL?"clear":"load",c=t&ue.DEPTH?"clear":"load";o={view:this._renderer.texture.getGpuSource(e.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:h,depthClearValue:1,depthLoadOp:c,depthStoreOp:"store"}}return{colorAttachments:a,depthStencilAttachment:o}}clear(e,t=!0,s,i){if(!t)return;const{gpu:n,encoder:a}=this._renderer,o=n.device;if(a.commandEncoder===null){const h=o.createCommandEncoder(),c=this.getDescriptor(e,t,s),u=h.beginRenderPass(c);u.setViewport(i.x,i.y,i.width,i.height,0,1),u.end();const d=h.finish();o.queue.submit([d])}else this.startRenderPass(e,t,s,i)}initGpuRenderTarget(e){e.isRoot=!0;const t=new h_;return e.colorTextures.forEach((s,i)=>{if(s instanceof Ie){const n=s.resource.getContext("webgpu"),a=s.transparent?"premultiplied":"opaque";try{n.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:a})}catch(o){console.error(o)}t.contexts[i]=n}if(t.msaa=s.source.antialias,s.source.antialias){const n=new J({width:0,height:0,sampleCount:4});t.msaaTextures[i]=n}}),t.msaa&&(t.msaaSamples=4,e.depthStencilTexture&&(e.depthStencilTexture.source.sampleCount=4)),t}destroyGpuRenderTarget(e){e.contexts.forEach(t=>{t.unconfigure()}),e.msaaTextures.forEach(t=>{t.destroy()}),e.msaaTextures.length=0,e.contexts.length=0}ensureDepthStencilTexture(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);e.depthStencilTexture&&t.msaa&&(e.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(e){const t=this._renderTargetSystem.getGpuRenderTarget(e);t.width=e.width,t.height=e.height,t.msaa&&e.colorTextures.forEach((s,i)=>{const n=t.msaaTextures[i];n==null||n.resize(s.source.width,s.source.height,s.source._resolution)})}}class Jh extends fh{constructor(e){super(e),this.adaptor=new c_,this.adaptor.init(e,this)}}Jh.extension={type:[y.WebGPUSystem],name:"renderTarget"};class ec{constructor(){this._gpuProgramData=Object.create(null)}contextChange(e){this._gpu=e}getProgramData(e){return this._gpuProgramData[e._layoutKey]||this._createGPUProgramData(e)}_createGPUProgramData(e){const t=this._gpu.device,s=e.gpuLayout.map(n=>t.createBindGroupLayout({entries:n})),i={bindGroupLayouts:s};return this._gpuProgramData[e._layoutKey]={bindGroups:s,pipeline:t.createPipelineLayout(i)},this._gpuProgramData[e._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}}ec.extension={type:[y.WebGPUSystem],name:"shader"};const he={};he.normal={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}};he.add={alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}};he.multiply={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}};he.screen={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};he.overlay={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};he.none={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}};he["normal-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}};he["add-npm"]={alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}};he["screen-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}};he.erase={alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}};he.min={alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}};he.max={alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}};class tc{constructor(){this.defaultState=new Ae,this.defaultState.blend=!0}contextChange(e){this.gpu=e}getColorTargets(e){return[{format:"bgra8unorm",writeMask:0,blend:he[e.blendMode]||he.normal}]}destroy(){this.gpu=null}}tc.extension={type:[y.WebGPUSystem],name:"state"};const u_={type:"image",upload(r,e,t){const s=r.resource,i=(r.pixelWidth|0)*(r.pixelHeight|0),n=s.byteLength/i;t.device.queue.writeTexture({texture:e},s,{offset:0,rowsPerImage:r.pixelHeight,bytesPerRow:r.pixelHeight*n},{width:r.pixelWidth,height:r.pixelHeight,depthOrArrayLayers:1})}},sc={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},d_={blockBytes:4,blockWidth:1,blockHeight:1},f_={type:"compressed",upload(r,e,t){let s=r.pixelWidth,i=r.pixelHeight;const n=sc[r.format]||d_;for(let a=0;a<r.resource.length;a++){const o=r.resource[a],l=Math.ceil(s/n.blockWidth)*n.blockBytes;t.device.queue.writeTexture({texture:e,mipLevel:a},o,{offset:0,bytesPerRow:l},{width:Math.ceil(s/n.blockWidth)*n.blockWidth,height:Math.ceil(i/n.blockHeight)*n.blockHeight,depthOrArrayLayers:1}),s=Math.max(s>>1,1),i=Math.max(i>>1,1)}}},rc={type:"image",upload(r,e,t){const s=r.resource;if(!s)return;if(globalThis.HTMLImageElement&&s instanceof HTMLImageElement){const o=O.get().createCanvas(s.width,s.height);o.getContext("2d").drawImage(s,0,0,s.width,s.height),r.resource=o,B("ImageSource: Image element passed, converting to canvas and replacing resource.")}const i=Math.min(e.width,r.resourceWidth||r.pixelWidth),n=Math.min(e.height,r.resourceHeight||r.pixelHeight),a=r.alphaMode==="premultiply-alpha-on-upload";t.device.queue.copyExternalImageToTexture({source:s},{texture:e,premultipliedAlpha:a},{width:i,height:n})}},g_={type:"video",upload(r,e,t){rc.upload(r,e,t)}};class p_{constructor(e){this.device=e,this.sampler=e.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(e){let t=this.pipelines[e];return t||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:`
                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(
                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));

                        struct VertexOutput {
                        @builtin(position) position : vec4<f32>,
                        @location(0) texCoord : vec2<f32>,
                        };

                        @vertex
                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
                        var output : VertexOutput;
                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);
                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);
                        return output;
                        }

                        @group(0) @binding(0) var imgSampler : sampler;
                        @group(0) @binding(1) var img : texture_2d<f32>;

                        @fragment
                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {
                        return textureSample(img, imgSampler, texCoord);
                        }
                    `})),t=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:e}]}}),this.pipelines[e]=t),t}generateMipmap(e){const t=this._getMipmapPipeline(e.format);if(e.dimension==="3d"||e.dimension==="1d")throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let s=e;const i=e.depthOrArrayLayers||1,n=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!n){const l={size:{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};s=this.device.createTexture(l)}const a=this.device.createCommandEncoder({}),o=t.getBindGroupLayout(0);for(let l=0;l<i;++l){let h=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:l,arrayLayerCount:1}),c=n?1:0;for(let u=1;u<e.mipLevelCount;++u){const d=s.createView({baseMipLevel:c++,mipLevelCount:1,dimension:"2d",baseArrayLayer:l,arrayLayerCount:1}),f=a.beginRenderPass({colorAttachments:[{view:d,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),g=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.sampler},{binding:1,resource:h}]});f.setPipeline(t),f.setBindGroup(0,g),f.draw(3,1,0,0),f.end(),h=d}}if(!n){const l={width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i};for(let h=1;h<e.mipLevelCount;++h)a.copyTextureToTexture({texture:s,mipLevel:h-1},{texture:e,mipLevel:h},l),l.width=Math.ceil(l.width/2),l.height=Math.ceil(l.height/2)}return this.device.queue.submit([a.finish()]),n||s.destroy(),e}}class ic{constructor(e){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:rc,buffer:u_,video:g_,compressed:f_},this._renderer=e,e.renderableGC.addManagedHash(this,"_gpuSources"),e.renderableGC.addManagedHash(this,"_gpuSamplers"),e.renderableGC.addManagedHash(this,"_bindGroupHash"),e.renderableGC.addManagedHash(this,"_textureViewHash")}contextChange(e){this._gpu=e}initSource(e){if(e.autoGenerateMipmaps){const l=Math.max(e.pixelWidth,e.pixelHeight);e.mipLevelCount=Math.floor(Math.log2(l))+1}let t=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;e.uploadMethodId!=="compressed"&&(t|=GPUTextureUsage.RENDER_ATTACHMENT,t|=GPUTextureUsage.COPY_SRC);const s=sc[e.format]||{blockWidth:1,blockHeight:1},i=Math.ceil(e.pixelWidth/s.blockWidth)*s.blockWidth,n=Math.ceil(e.pixelHeight/s.blockHeight)*s.blockHeight,a={label:e.label,size:{width:i,height:n},format:e.format,sampleCount:e.sampleCount,mipLevelCount:e.mipLevelCount,dimension:e.dimension,usage:t},o=this._gpu.device.createTexture(a);return this._gpuSources[e.uid]=o,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceResize,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),o}onSourceUpdate(e){const t=this.getGpuSource(e);t&&(this._uploads[e.uploadMethodId]&&this._uploads[e.uploadMethodId].upload(e,t,this._gpu),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e))}onSourceUnload(e){const t=this._gpuSources[e.uid];t&&(this._gpuSources[e.uid]=null,t.destroy())}onUpdateMipmaps(e){this._mipmapGenerator||(this._mipmapGenerator=new p_(this._gpu.device));const t=this.getGpuSource(e);this._mipmapGenerator.generateMipmap(t)}onSourceDestroy(e){e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("destroy",this.onSourceDestroy,this),e.off("resize",this.onSourceResize,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}onSourceResize(e){const t=this._gpuSources[e.uid];t?(t.width!==e.pixelWidth||t.height!==e.pixelHeight)&&(this._textureViewHash[e.uid]=null,this._bindGroupHash[e.uid]=null,this.onSourceUnload(e),this.initSource(e)):this.initSource(e)}_initSampler(e){return this._gpuSamplers[e._resourceId]=this._gpu.device.createSampler(e),this._gpuSamplers[e._resourceId]}getGpuSampler(e){return this._gpuSamplers[e._resourceId]||this._initSampler(e)}getGpuSource(e){return this._gpuSources[e.uid]||this.initSource(e)}getTextureBindGroup(e){return this._bindGroupHash[e.uid]??this._createTextureBindGroup(e)}_createTextureBindGroup(e){const t=e.source;return this._bindGroupHash[e.uid]=new Ge({0:t,1:t.style,2:new oe({uTextureMatrix:{type:"mat3x3<f32>",value:e.textureMatrix.mapCoord}})}),this._bindGroupHash[e.uid]}getTextureView(e){const t=e.source;return this._textureViewHash[t.uid]??this._createTextureView(t)}_createTextureView(e){return this._textureViewHash[e.uid]=this.getGpuSource(e).createView(),this._textureViewHash[e.uid]}generateCanvas(e){const t=this._renderer,s=t.gpu.device.createCommandEncoder(),i=O.get().createCanvas();i.width=e.source.pixelWidth,i.height=e.source.pixelHeight;const n=i.getContext("webgpu");return n.configure({device:t.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:O.get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),s.copyTextureToTexture({texture:t.texture.getGpuSource(e.source),origin:{x:0,y:0}},{texture:n.getCurrentTexture()},{width:i.width,height:i.height}),t.gpu.device.queue.submit([s.finish()]),i}getPixels(e){const t=this.generateCanvas(e),s=$e.getOptimalCanvasAndContext(t.width,t.height),i=s.context;i.drawImage(t,0,0);const{width:n,height:a}=t,o=i.getImageData(0,0,n,a),l=new Uint8ClampedArray(o.data.buffer);return $e.returnCanvasAndContext(s),{pixels:l,width:n,height:a}}destroy(){this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null;for(const e of Object.keys(this._bindGroupHash)){const t=Number(e),s=this._bindGroupHash[t];s==null||s.destroy(),this._bindGroupHash[t]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}ic.extension={type:[y.WebGPUSystem],name:"texture"};class nc{constructor(){this._maxTextures=0}contextChange(e){const t=new oe({uTransformMatrix:{value:new E,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}});this._maxTextures=e.limits.maxBatchableTextures;const s=os({name:"graphics",bits:[Bi,Ii(this._maxTextures),Dp,hs]});this.shader=new xe({gpuProgram:s,resources:{localUniforms:t}})}execute(e,t){const s=t.context,i=s.customShader||this.shader,n=e.renderer,a=n.graphicsContext,{batcher:o,instructions:l}=a.getContextRenderData(s),h=n.encoder;h.setGeometry(o.geometry,i.gpuProgram);const c=n.globalUniforms.bindGroup;h.setBindGroup(0,c,i.gpuProgram);const u=n.renderPipes.uniformBatch.getUniformBindGroup(i.resources.localUniforms,!0);h.setBindGroup(2,u,i.gpuProgram);const d=l.instructions;let f=null;for(let g=0;g<l.instructionSize;g++){const m=d[g];if(m.topology!==f&&(f=m.topology,h.setPipelineFromGeometryProgramAndState(o.geometry,i.gpuProgram,e.state,m.topology)),i.groups[1]=m.bindGroup,!m.gpuBindGroup){const p=m.textures;m.bindGroup=Fi(p.textures,p.count,this._maxTextures),m.gpuBindGroup=n.bindGroup.getBindGroup(m.bindGroup,i.gpuProgram,1)}h.setBindGroup(1,m.bindGroup,i.gpuProgram),h.renderPassEncoder.drawIndexed(m.size,1,m.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}nc.extension={type:[y.WebGPUPipesAdaptor],name:"graphics"};class ac{init(){const e=os({name:"mesh",bits:[Kt,Up,hs]});this._shader=new xe({gpuProgram:e,resources:{uTexture:k.EMPTY._source,uSampler:k.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new E}}}})}execute(e,t){const s=e.renderer;let i=t._shader;if(!i)i=this._shader,i.groups[2]=s.texture.getTextureBindGroup(t.texture);else if(!i.gpuProgram){B("Mesh shader has no gpuProgram",t.shader);return}const n=i.gpuProgram;if(n.autoAssignGlobalUniforms&&(i.groups[0]=s.globalUniforms.bindGroup),n.autoAssignLocalUniforms){const a=e.localUniforms;i.groups[1]=s.renderPipes.uniformBatch.getUniformBindGroup(a,!0)}s.encoder.draw({geometry:t._geometry,shader:i,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}}ac.extension={type:[y.WebGPUPipesAdaptor],name:"mesh"};const m_=[...Lh,qh,$h,ln,Xh,Yh,ic,Jh,ec,tc,Qh,jh,Kh,zh],__=[...Nh,Zh],y_=[Vl,ac,nc],oc=[],lc=[],hc=[];M.handleByNamedList(y.WebGPUSystem,oc);M.handleByNamedList(y.WebGPUPipes,lc);M.handleByNamedList(y.WebGPUPipesAdaptor,hc);M.add(...m_,...__,...y_);class x_ extends Zs{constructor(){const e={name:"webgpu",type:Se.WEBGPU,systems:oc,renderPipes:lc,renderPipeAdaptors:hc};super(e)}}const b_=Object.freeze(Object.defineProperty({__proto__:null,WebGPURenderer:x_},Symbol.toStringTag,{value:"Module"}));class v_{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(e=>{te.return(e)}),this.batches.length=0}}class cc{constructor(e,t){this.state=Ae.for2d(),this.renderer=e,this._adaptor=t,this.renderer.runners.contextChange.add(this)}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(e){const t=e.context,s=!!e._gpuData,i=this.renderer.graphicsContext.updateGpuContext(t);return!!(i.isBatchable||s!==i.isBatchable)}addRenderable(e,t){const s=this.renderer.graphicsContext.updateGpuContext(e.context);e.didViewUpdate&&this._rebuild(e),s.isBatchable?this._addToBatcher(e,t):(this.renderer.renderPipes.batch.break(t),t.add(e))}updateRenderable(e){const s=this._getGpuDataForRenderable(e).batches;for(let i=0;i<s.length;i++){const n=s[i];n._batcher.updateElement(n)}}execute(e){if(!e.isRenderable)return;const t=this.renderer,s=e.context;if(!t.graphicsContext.getGpuContext(s).batches.length)return;const n=s.customShader||this._adaptor.shader;this.state.blendMode=e.groupBlendMode;const a=n.resources.localUniforms.uniforms;a.uTransformMatrix=e.groupTransform,a.uRound=t._roundPixels|e._roundPixels,us(e.groupColorAlpha,a.uColor,0),this._adaptor.execute(this,e)}_rebuild(e){const t=this._getGpuDataForRenderable(e),s=this.renderer.graphicsContext.updateGpuContext(e.context);t.destroy(),s.isBatchable&&this._updateBatchesForRenderable(e,t)}_addToBatcher(e,t){const s=this.renderer.renderPipes.batch,i=this._getGpuDataForRenderable(e).batches;for(let n=0;n<i.length;n++){const a=i[n];s.addToBatch(a,t)}}_getGpuDataForRenderable(e){return e._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(e)}_initGpuDataForRenderable(e){const t=new v_;return e._gpuData[this.renderer.uid]=t,t}_updateBatchesForRenderable(e,t){const s=e.context,i=this.renderer.graphicsContext.getGpuContext(s),n=this.renderer._roundPixels|e._roundPixels;t.batches=i.batches.map(a=>{const o=te.get(Oi);return a.copyTo(o),o.renderable=e,o.roundPixels=n,o})}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}cc.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"graphics"};const uc=class dc extends $i{constructor(...e){super({});let t=e[0]??{};typeof t=="number"&&(U(H,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),t={width:t,height:e[1],verticesX:e[2],verticesY:e[3]}),this.build(t)}build(e){e={...dc.defaultOptions,...e},this.verticesX=this.verticesX??e.verticesX,this.verticesY=this.verticesY??e.verticesY,this.width=this.width??e.width,this.height=this.height??e.height;const t=this.verticesX*this.verticesY,s=[],i=[],n=[],a=this.verticesX-1,o=this.verticesY-1,l=this.width/a,h=this.height/o;for(let u=0;u<t;u++){const d=u%this.verticesX,f=u/this.verticesX|0;s.push(d*l,f*h),i.push(d/a,f/o)}const c=a*o;for(let u=0;u<c;u++){const d=u%a,f=u/a|0,g=f*this.verticesX+d,m=f*this.verticesX+d+1,p=(f+1)*this.verticesX+d,_=(f+1)*this.verticesX+d+1;n.push(g,m,p,m,_,p)}this.buffers[0].data=new Float32Array(s),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint32Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};uc.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let w_=uc;class hn{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(e){this._topology=e}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(e){this.texture!==e&&(this.texture=e,this._textureMatrixUpdateId=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),s=t.data;let i=s;const n=this.texture.textureMatrix;return n.isSimple||(i=this._transformedUvs,(this._textureMatrixUpdateId!==n._updateID||this._uvUpdateId!==t._updateID)&&((!i||i.length<s.length)&&(i=this._transformedUvs=new Float32Array(s.length)),this._textureMatrixUpdateId=n._updateID,this._uvUpdateId=t._updateID,n.multiplyUvs(s,i))),i}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class Za{destroy(){}}class fc{constructor(e,t){this.localUniforms=new oe({uTransformMatrix:{value:new E,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new Ge({0:this.localUniforms}),this.renderer=e,this._adaptor=t,this._adaptor.init()}validateRenderable(e){const t=this._getMeshData(e),s=t.batched,i=e.batched;if(t.batched=i,s!==i)return!0;if(i){const n=e._geometry;if(n.indices.length!==t.indexSize||n.positions.length!==t.vertexSize)return t.indexSize=n.indices.length,t.vertexSize=n.positions.length,!0;const a=this._getBatchableMesh(e);return a.texture.uid!==e._texture.uid&&(a._textureMatrixUpdateId=-1),!a._batcher.checkAndUpdateTexture(a,e._texture)}return!1}addRenderable(e,t){const s=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(e);if(i){const n=this._getBatchableMesh(e);n.setTexture(e._texture),n.geometry=e._geometry,s.addToBatch(n,t)}else s.break(t),t.add(e)}updateRenderable(e){if(e.batched){const t=this._getBatchableMesh(e);t.setTexture(e._texture),t.geometry=e._geometry,t._batcher.updateElement(t)}}execute(e){if(!e.isRenderable)return;e.state.blendMode=ss(e.groupBlendMode,e.texture._source);const t=this.localUniforms;t.uniforms.uTransformMatrix=e.groupTransform,t.uniforms.uRound=this.renderer._roundPixels|e._roundPixels,t.update(),us(e.groupColorAlpha,t.uniforms.uColor,0),this._adaptor.execute(this,e)}_getMeshData(e){var t,s;return(t=e._gpuData)[s=this.renderer.uid]||(t[s]=new Za),e._gpuData[this.renderer.uid].meshData||this._initMeshData(e)}_initMeshData(e){var t,s;return e._gpuData[this.renderer.uid].meshData={batched:e.batched,indexSize:(t=e._geometry.indices)==null?void 0:t.length,vertexSize:(s=e._geometry.positions)==null?void 0:s.length},e._gpuData[this.renderer.uid].meshData}_getBatchableMesh(e){var t,s;return(t=e._gpuData)[s=this.renderer.uid]||(t[s]=new Za),e._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(e)}_initBatchableMesh(e){const t=new hn;return t.renderable=e,t.setTexture(e._texture),t.transform=e.groupTransform,t.roundPixels=this.renderer._roundPixels|e._roundPixels,e._gpuData[this.renderer.uid].batchableMesh=t,t}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}fc.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"mesh"};class T_{execute(e,t){const s=e.state,i=e.renderer,n=t.shader||e.defaultShader;n.resources.uTexture=t.texture._source,n.resources.uniforms=e.localUniforms;const a=i.gl,o=e.getBuffers(t);i.shader.bind(n),i.state.set(s),i.geometry.bind(o.geometry,n.glProgram);const h=o.geometry.indexBuffer.data.BYTES_PER_ELEMENT===2?a.UNSIGNED_SHORT:a.UNSIGNED_INT;a.drawElements(a.TRIANGLES,t.particleChildren.length*6,h,0)}}class S_{execute(e,t){const s=e.renderer,i=t.shader||e.defaultShader;i.groups[0]=s.renderPipes.uniformBatch.getUniformBindGroup(e.localUniforms,!0),i.groups[1]=s.texture.getTextureBindGroup(t.texture);const n=e.state,a=e.getBuffers(t);s.encoder.draw({geometry:a.geometry,shader:t.shader||e.defaultShader,state:n,size:t.particleChildren.length*6})}}function Qa(r,e=null){const t=r*6;if(t>65535?e||(e=new Uint32Array(t)):e||(e=new Uint16Array(t)),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let s=0,i=0;s<t;s+=6,i+=4)e[s+0]=i+0,e[s+1]=i+1,e[s+2]=i+2,e[s+3]=i+0,e[s+4]=i+2,e[s+5]=i+3;return e}function A_(r){return{dynamicUpdate:Ja(r,!0),staticUpdate:Ja(r,!1)}}function Ja(r,e){const t=[];t.push(`

        var index = 0;

        for (let i = 0; i < ps.length; ++i)
        {
            const p = ps[i];

            `);let s=0;for(const n in r){const a=r[n];if(e!==a.dynamic)continue;t.push(`offset = index + ${s}`),t.push(a.code);const o=je(a.format);s+=o.stride/4}t.push(`
            index += stride * 4;
        }
    `),t.unshift(`
        var stride = ${s};
    `);const i=t.join(`
`);return new Function("ps","f32v","u32v",i)}class P_{constructor(e){this._size=0,this._generateParticleUpdateCache={};const t=this._size=e.size??1e3,s=e.properties;let i=0,n=0;for(const c in s){const u=s[c],d=je(u.format);u.dynamic?n+=d.stride:i+=d.stride}this._dynamicStride=n/4,this._staticStride=i/4,this.staticAttributeBuffer=new yt(t*4*i),this.dynamicAttributeBuffer=new yt(t*4*n),this.indexBuffer=Qa(t);const a=new as;let o=0,l=0;this._staticBuffer=new fe({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:L.VERTEX|L.COPY_DST}),this._dynamicBuffer=new fe({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:L.VERTEX|L.COPY_DST});for(const c in s){const u=s[c],d=je(u.format);u.dynamic?(a.addAttribute(u.attributeName,{buffer:this._dynamicBuffer,stride:this._dynamicStride*4,offset:o*4,format:u.format}),o+=d.size):(a.addAttribute(u.attributeName,{buffer:this._staticBuffer,stride:this._staticStride*4,offset:l*4,format:u.format}),l+=d.size)}a.addIndex(this.indexBuffer);const h=this.getParticleUpdate(s);this._dynamicUpload=h.dynamicUpdate,this._staticUpload=h.staticUpdate,this.geometry=a}getParticleUpdate(e){const t=k_(e);return this._generateParticleUpdateCache[t]?this._generateParticleUpdateCache[t]:(this._generateParticleUpdateCache[t]=this.generateParticleUpdate(e),this._generateParticleUpdateCache[t])}generateParticleUpdate(e){return A_(e)}update(e,t){e.length>this._size&&(t=!0,this._size=Math.max(e.length,this._size*1.5|0),this.staticAttributeBuffer=new yt(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new yt(this._size*this._dynamicStride*4*4),this.indexBuffer=Qa(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const s=this.dynamicAttributeBuffer;if(this._dynamicUpload(e,s.float32View,s.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,e.length*this._dynamicStride*4,!0),t){const i=this.staticAttributeBuffer;this._staticUpload(e,i.float32View,i.uint32View),this._staticBuffer.setDataWithSize(i.float32View,e.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}function k_(r){const e=[];for(const t in r){const s=r[t];e.push(t,s.code,s.dynamic?"d":"s")}return e.join("_")}var C_=`varying vec2 vUV;
varying vec4 vColor;

uniform sampler2D uTexture;

void main(void){
    vec4 color = texture2D(uTexture, vUV) * vColor;
    gl_FragColor = color;
}`,E_=`attribute vec2 aVertex;
attribute vec2 aUV;
attribute vec4 aColor;

attribute vec2 aPosition;
attribute float aRotation;

uniform mat3 uTranslationMatrix;
uniform float uRound;
uniform vec2 uResolution;
uniform vec4 uColor;

varying vec2 vUV;
varying vec4 vColor;

vec2 roundPixels(vec2 position, vec2 targetSize)
{       
    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
}

void main(void){
    float cosRotation = cos(aRotation);
    float sinRotation = sin(aRotation);
    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;
    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;

    vec2 v = vec2(x, y);
    v = v + aPosition;

    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    if(uRound == 1.0)
    {
        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
    }

    vUV = aUV;
    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;
}
`,eo=`
struct ParticleUniforms {
  uProjectionMatrix:mat3x3<f32>,
  uColor:vec4<f32>,
  uResolution:vec2<f32>,
  uRoundPixels:f32,
};

@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;

@group(1) @binding(0) var uTexture: texture_2d<f32>;
@group(1) @binding(1) var uSampler : sampler;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
  };
@vertex
fn mainVertex(
  @location(0) aVertex: vec2<f32>,
  @location(1) aPosition: vec2<f32>,
  @location(2) aUV: vec2<f32>,
  @location(3) aColor: vec4<f32>,
  @location(4) aRotation: f32,
) -> VSOutput {
  
   let v = vec2(
       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),
       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)
   ) + aPosition;

   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;

  return VSOutput(
   position,
   aUV,
   vColor,
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color: vec4<f32>,
  @builtin(position) position: vec4<f32>,
) -> @location(0) vec4<f32> {

    var sample = textureSample(uTexture, uSampler, uv) * color;
   
    return sample;
}`;class M_ extends xe{constructor(){const e=kt.from({vertex:E_,fragment:C_}),t=dt.from({fragment:{source:eo,entryPoint:"mainFragment"},vertex:{source:eo,entryPoint:"mainVertex"}});super({glProgram:e,gpuProgram:t,resources:{uTexture:k.WHITE.source,uSampler:new De({}),uniforms:{uTranslationMatrix:{value:new E,type:"mat3x3<f32>"},uColor:{value:new V(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class gc{constructor(e,t){this.state=Ae.for2d(),this.localUniforms=new oe({uTranslationMatrix:{value:new E,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=e,this.adaptor=t,this.defaultShader=new M_,this.state=Ae.for2d()}validateRenderable(e){return!1}addRenderable(e,t){this.renderer.renderPipes.batch.break(t),t.add(e)}getBuffers(e){return e._gpuData[this.renderer.uid]||this._initBuffer(e)}_initBuffer(e){return e._gpuData[this.renderer.uid]=new P_({size:e.particleChildren.length,properties:e._properties}),e._gpuData[this.renderer.uid]}updateRenderable(e){}execute(e){const t=e.particleChildren;if(t.length===0)return;const s=this.renderer,i=this.getBuffers(e);e.texture||(e.texture=t[0].texture);const n=this.state;i.update(t,e._childrenDirty),e._childrenDirty=!1,n.blendMode=ss(e.blendMode,e.texture._source);const a=this.localUniforms.uniforms,o=a.uTranslationMatrix;e.worldTransform.copyTo(o),o.prepend(s.globalUniforms.globalUniformData.projectionMatrix),a.uResolution=s.globalUniforms.globalUniformData.resolution,a.uRound=s._roundPixels|e._roundPixels,us(e.groupColorAlpha,a.uColor,0),this.adaptor.execute(this,e)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class pc extends gc{constructor(e){super(e,new T_)}}pc.extension={type:[y.WebGLPipes],name:"particle"};class mc extends gc{constructor(e){super(e,new S_)}}mc.extension={type:[y.WebGPUPipes],name:"particle"};const _c=class yc extends w_{constructor(e={}){e={...yc.defaultOptions,...e},super({width:e.width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(e){var t,s;this.width=e.width??this.width,this.height=e.height??this.height,this._originalWidth=e.originalWidth??this._originalWidth,this._originalHeight=e.originalHeight??this._originalHeight,this._leftWidth=e.leftWidth??this._leftWidth,this._rightWidth=e.rightWidth??this._rightWidth,this._topHeight=e.topHeight??this._topHeight,this._bottomHeight=e.bottomHeight??this._bottomHeight,this._anchorX=(t=e.anchor)==null?void 0:t.x,this._anchorY=(s=e.anchor)==null?void 0:s.y,this.updateUvs(),this.updatePositions()}updatePositions(){const e=this.positions,{width:t,height:s,_leftWidth:i,_rightWidth:n,_topHeight:a,_bottomHeight:o,_anchorX:l,_anchorY:h}=this,c=i+n,u=t>c?1:t/c,d=a+o,f=s>d?1:s/d,g=Math.min(u,f),m=l*t,p=h*s;e[0]=e[8]=e[16]=e[24]=-m,e[2]=e[10]=e[18]=e[26]=i*g-m,e[4]=e[12]=e[20]=e[28]=t-n*g-m,e[6]=e[14]=e[22]=e[30]=t-m,e[1]=e[3]=e[5]=e[7]=-p,e[9]=e[11]=e[13]=e[15]=a*g-p,e[17]=e[19]=e[21]=e[23]=s-o*g-p,e[25]=e[27]=e[29]=e[31]=s-p,this.getBuffer("aPosition").update()}updateUvs(){const e=this.uvs;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1;const t=1/this._originalWidth,s=1/this._originalHeight;e[2]=e[10]=e[18]=e[26]=t*this._leftWidth,e[9]=e[11]=e[13]=e[15]=s*this._topHeight,e[4]=e[12]=e[20]=e[28]=1-t*this._rightWidth,e[17]=e[19]=e[21]=e[23]=1-s*this._bottomHeight,this.getBuffer("aUV").update()}};_c.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let F_=_c;class B_ extends hn{constructor(){super(),this.geometry=new F_}destroy(){this.geometry.destroy()}}class xc{constructor(e){this._renderer=e}addRenderable(e,t){const s=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,s),this._renderer.renderPipes.batch.addToBatch(s,t)}updateRenderable(e){const t=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,t),t._batcher.updateElement(t)}validateRenderable(e){const t=this._getGpuSprite(e);return!t._batcher.checkAndUpdateTexture(t,e._texture)}_updateBatchableSprite(e,t){t.geometry.update(e),t.setTexture(e._texture)}_getGpuSprite(e){return e._gpuData[this._renderer.uid]||this._initGPUSprite(e)}_initGPUSprite(e){const t=e._gpuData[this._renderer.uid]=new B_,s=t;return s.renderable=e,s.transform=e.groupTransform,s.texture=e._texture,s.roundPixels=this._renderer._roundPixels|e._roundPixels,e.didViewUpdate||this._updateBatchableSprite(e,s),t}destroy(){this._renderer=null}}xc.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"nineSliceSprite"};const R_={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            }

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},I_={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;

        `,main:`
            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0

        `}};let Nr,Hr;class G_ extends xe{constructor(){Nr??(Nr=os({name:"tiling-sprite-shader",bits:[Kt,R_,hs]})),Hr??(Hr=ls({name:"tiling-sprite-shader",bits:[qi,I_,cs]}));const e=new oe({uMapCoord:{value:new E,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new E,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:Hr,gpuProgram:Nr,resources:{localUniforms:new oe({uTransformMatrix:{value:new E,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:e,uTexture:k.EMPTY.source,uSampler:k.EMPTY.source.style}})}updateUniforms(e,t,s,i,n,a){const o=this.resources.tilingUniforms,l=a.width,h=a.height,c=a.textureMatrix,u=o.uniforms.uTextureTransform;u.set(s.a*l/e,s.b*l/t,s.c*h/e,s.d*h/t,s.tx/e,s.ty/t),u.invert(),o.uniforms.uMapCoord=c.mapCoord,o.uniforms.uClampFrame=c.uClampFrame,o.uniforms.uClampOffset=c.uClampOffset,o.uniforms.uTextureTransform=u,o.uniforms.uSizeAnchor[0]=e,o.uniforms.uSizeAnchor[1]=t,o.uniforms.uSizeAnchor[2]=i,o.uniforms.uSizeAnchor[3]=n,a&&(this.resources.uTexture=a.source,this.resources.uSampler=a.source.style)}}class D_ extends $i{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}function U_(r,e){const t=r.anchor.x,s=r.anchor.y;e[0]=-t*r.width,e[1]=-s*r.height,e[2]=(1-t)*r.width,e[3]=-s*r.height,e[4]=(1-t)*r.width,e[5]=(1-s)*r.height,e[6]=-t*r.width,e[7]=(1-s)*r.height}function O_(r,e,t,s){let i=0;const n=r.length/e,a=s.a,o=s.b,l=s.c,h=s.d,c=s.tx,u=s.ty;for(t*=e;i<n;){const d=r[t],f=r[t+1];r[t]=a*d+l*f+c,r[t+1]=o*d+h*f+u,t+=e,i++}}function L_(r,e){const t=r.texture,s=t.frame.width,i=t.frame.height;let n=0,a=0;r.applyAnchorToTexture&&(n=r.anchor.x,a=r.anchor.y),e[0]=e[6]=-n,e[2]=e[4]=1-n,e[1]=e[3]=-a,e[5]=e[7]=1-a;const o=E.shared;o.copyFrom(r._tileTransform.matrix),o.tx/=r.width,o.ty/=r.height,o.invert(),o.scale(r.width/s,r.height/i),O_(e,2,0,o)}const Os=new D_;class N_{constructor(){this.canBatch=!0,this.geometry=new $i({indices:Os.indices.slice(),positions:Os.positions.slice(),uvs:Os.uvs.slice()})}destroy(){var e;this.geometry.destroy(),(e=this.shader)==null||e.destroy()}}class bc{constructor(e){this._state=Ae.default2d,this._renderer=e}validateRenderable(e){const t=this._getTilingSpriteData(e),s=t.canBatch;this._updateCanBatch(e);const i=t.canBatch;if(i&&i===s){const{batchableMesh:n}=t;return!n._batcher.checkAndUpdateTexture(n,e.texture)}return s!==i}addRenderable(e,t){const s=this._renderer.renderPipes.batch;this._updateCanBatch(e);const i=this._getTilingSpriteData(e),{geometry:n,canBatch:a}=i;if(a){i.batchableMesh||(i.batchableMesh=new hn);const o=i.batchableMesh;e.didViewUpdate&&(this._updateBatchableMesh(e),o.geometry=n,o.renderable=e,o.transform=e.groupTransform,o.setTexture(e._texture)),o.roundPixels=this._renderer._roundPixels|e._roundPixels,s.addToBatch(o,t)}else s.break(t),i.shader||(i.shader=new G_),this.updateRenderable(e),t.add(e)}execute(e){const{shader:t}=this._getTilingSpriteData(e);t.groups[0]=this._renderer.globalUniforms.bindGroup;const s=t.resources.localUniforms.uniforms;s.uTransformMatrix=e.groupTransform,s.uRound=this._renderer._roundPixels|e._roundPixels,us(e.groupColorAlpha,s.uColor,0),this._state.blendMode=ss(e.groupBlendMode,e.texture._source),this._renderer.encoder.draw({geometry:Os,shader:t,state:this._state})}updateRenderable(e){const t=this._getTilingSpriteData(e),{canBatch:s}=t;if(s){const{batchableMesh:i}=t;e.didViewUpdate&&this._updateBatchableMesh(e),i._batcher.updateElement(i)}else if(e.didViewUpdate){const{shader:i}=t;i.updateUniforms(e.width,e.height,e._tileTransform.matrix,e.anchor.x,e.anchor.y,e.texture)}}_getTilingSpriteData(e){return e._gpuData[this._renderer.uid]||this._initTilingSpriteData(e)}_initTilingSpriteData(e){const t=new N_;return t.renderable=e,e._gpuData[this._renderer.uid]=t,t}_updateBatchableMesh(e){const t=this._getTilingSpriteData(e),{geometry:s}=t,i=e.texture.source.style;i.addressMode!=="repeat"&&(i.addressMode="repeat",i.update()),L_(e,s.uvs),U_(e,s.positions)}destroy(){this._renderer=null}_updateCanBatch(e){const t=this._getTilingSpriteData(e),s=e.texture;let i=!0;return this._renderer.type===Se.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),t.canBatch=s.textureMatrix.isSimple&&(i||s.source.isPowerOfTwo),t.canBatch}}bc.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"tilingSprite"};const H_={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:`
            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));
        `}},W_={name:"local-uniform-msdf-bit",vertex:{header:`
            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix *= uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `},fragment:{header:`
            uniform float uDistance;
         `,main:`
            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));
        `}},V_={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {

                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));
                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);
                var coverage: f32 = pow(shapeColor.a * alpha, gamma);

                return coverage;

            }
        `}},z_={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {

                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);

                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));
                float gamma = mix(1.0, 1.0 / 2.2, luma);
                float coverage = pow(shapeColor.a * alpha, gamma);

                return coverage;
            }
        `}};let Wr,Vr;class Y_ extends xe{constructor(e){const t=new oe({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new E,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});Wr??(Wr=os({name:"sdf-shader",bits:[Bi,Ii(e),H_,V_,hs]})),Vr??(Vr=ls({name:"sdf-shader",bits:[Ri,Gi(e),W_,z_,cs]})),super({glProgram:Vr,gpuProgram:Wr,resources:{localUniforms:t,batchSamplers:Di(e)}})}}class j_ extends is{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class vc{constructor(e){this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(e){const t=this._getGpuBitmapText(e);return e._didTextUpdate&&(e._didTextUpdate=!1,this._updateContext(e,t)),this._renderer.renderPipes.graphics.validateRenderable(t)}addRenderable(e,t){const s=this._getGpuBitmapText(e);to(e,s),e._didTextUpdate&&(e._didTextUpdate=!1,this._updateContext(e,s)),this._renderer.renderPipes.graphics.addRenderable(s,t),s.context.customShader&&this._updateDistanceField(e)}updateRenderable(e){const t=this._getGpuBitmapText(e);to(e,t),this._renderer.renderPipes.graphics.updateRenderable(t),t.context.customShader&&this._updateDistanceField(e)}_updateContext(e,t){const{context:s}=t,i=ci.getFont(e.text,e._style);s.clear(),i.distanceField.type!=="none"&&(s.customShader||(s.customShader=new Y_(this._renderer.limits.maxBatchableTextures)));const n=Te.graphemeSegmenter(e.text),a=e._style;let o=i.baseLineOffset;const l=Pl(n,a,i,!0);let h=0;const c=a.padding,u=l.scale;let d=l.width,f=l.height+l.offsetY;a._stroke&&(d+=a._stroke.width/u,f+=a._stroke.width/u),s.translate(-e._anchor._x*d-c,-e._anchor._y*f-c).scale(u,u);const g=i.applyFillAsTint?a._fill.color:16777215;for(let m=0;m<l.lines.length;m++){const p=l.lines[m];for(let _=0;_<p.charPositions.length;_++){const x=n[h++],b=i.chars[x];b!=null&&b.texture&&s.texture(b.texture,g||"black",Math.round(p.charPositions[_]+b.xOffset),Math.round(o+b.yOffset))}o+=i.lineHeight}}_getGpuBitmapText(e){return e._gpuData[this._renderer.uid]||this.initGpuText(e)}initGpuText(e){const t=new j_;return e._gpuData[this._renderer.uid]=t,this._updateContext(e,t),t}_updateDistanceField(e){const t=this._getGpuBitmapText(e).context,s=e._style.fontFamily,i=$.get(`${s}-bitmap`),{a:n,b:a,c:o,d:l}=e.groupTransform,h=Math.sqrt(n*n+a*a),c=Math.sqrt(o*o+l*l),u=(Math.abs(h)+Math.abs(c))/2,d=i.baseRenderedFontSize/e._style.fontSize,f=u*i.distanceField.range*(1/d);t.customShader.resources.localUniforms.uniforms.uDistance=f}destroy(){this._renderer=null}}vc.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"bitmapText"};function to(r,e){e.groupTransform=r.groupTransform,e.groupColorAlpha=r.groupColorAlpha,e.groupColor=r.groupColor,e.groupBlendMode=r.groupBlendMode,e.globalDisplayStatus=r.globalDisplayStatus,e.groupTransform=r.groupTransform,e.localDisplayStatus=r.localDisplayStatus,e.groupAlpha=r.groupAlpha,e._roundPixels=r._roundPixels}class $_ extends er{constructor(e){super(),this.generatingTexture=!1,this._renderer=e,e.runners.resolutionChange.add(this)}resolutionChange(){const e=this.renderable;e._autoResolution&&e.onViewUpdate()}destroy(){this._renderer.htmlText.returnTexturePromise(this.texturePromise),this.texturePromise=null,this._renderer=null}}function yi(r,e){const{texture:t,bounds:s}=r;go(s,e._anchor,t);const i=e._style._getFinalPadding();s.minX-=i,s.minY-=i,s.maxX-=i,s.maxY-=i}class wc{constructor(e){this._renderer=e}validateRenderable(e){return e._didTextUpdate}addRenderable(e,t){const s=this._getGpuText(e);e._didTextUpdate&&(this._updateGpuText(e).catch(i=>{console.error(i)}),e._didTextUpdate=!1,yi(s,e)),this._renderer.renderPipes.batch.addToBatch(s,t)}updateRenderable(e){const t=this._getGpuText(e);t._batcher.updateElement(t)}async _updateGpuText(e){e._didTextUpdate=!1;const t=this._getGpuText(e);if(t.generatingTexture)return;t.texturePromise&&(this._renderer.htmlText.returnTexturePromise(t.texturePromise),t.texturePromise=null),t.generatingTexture=!0,e._resolution=e._autoResolution?this._renderer.resolution:e.resolution;const s=this._renderer.htmlText.getTexturePromise(e);t.texturePromise=s,t.texture=await s;const i=e.renderGroup||e.parentRenderGroup;i&&(i.structureDidChange=!0),t.generatingTexture=!1,yi(t,e)}_getGpuText(e){return e._gpuData[this._renderer.uid]||this.initGpuText(e)}initGpuText(e){const t=new $_(this._renderer);return t.renderable=e,t.transform=e.groupTransform,t.texture=k.EMPTY,t.bounds={minX:0,maxX:1,minY:0,maxY:0},t.roundPixels=this._renderer._roundPixels|e._roundPixels,e._resolution=e._autoResolution?this._renderer.resolution:e.resolution,e._gpuData[this._renderer.uid]=t,t}destroy(){this._renderer=null}}wc.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"htmlText"};function X_(){const{userAgent:r}=O.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(r)}const K_=new ie;function Tc(r,e,t,s){const i=K_;i.minX=0,i.minY=0,i.maxX=r.width/s|0,i.maxY=r.height/s|0;const n=re.getOptimalTexture(i.width,i.height,s,!1);return n.source.uploadMethodId="image",n.source.resource=r,n.source.alphaMode="premultiply-alpha-on-upload",n.frame.width=e/s,n.frame.height=t/s,n.source.emit("update",n.source),n.updateUvs(),n}function q_(r,e){const t=e.fontFamily,s=[],i={},n=/font-family:([^;"\s]+)/g,a=r.match(n);function o(l){i[l]||(s.push(l),i[l]=!0)}if(Array.isArray(t))for(let l=0;l<t.length;l++)o(t[l]);else o(t);a&&a.forEach(l=>{const h=l.split(":")[1].trim();o(h)});for(const l in e.tagStyles){const h=e.tagStyles[l].fontFamily;o(h)}return s}async function Z_(r){const t=await(await O.get().fetch(r)).blob(),s=new FileReader;return await new Promise((n,a)=>{s.onloadend=()=>n(s.result),s.onerror=a,s.readAsDataURL(t)})}async function so(r,e){const t=await Z_(e);return`@font-face {
        font-family: "${r.fontFamily}";
        src: url('${t}');
        font-weight: ${r.fontWeight};
        font-style: ${r.fontStyle};
    }`}const Bs=new Map;async function Q_(r,e,t){const s=r.filter(i=>$.has(`${i}-and-url`)).map((i,n)=>{if(!Bs.has(i)){const{url:a}=$.get(`${i}-and-url`);n===0?Bs.set(i,so({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:i},a)):Bs.set(i,so({fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:i},a))}return Bs.get(i)});return(await Promise.all(s)).join(`
`)}function J_(r,e,t,s,i){const{domElement:n,styleElement:a,svgRoot:o}=i;n.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${r}</div>`,n.setAttribute("style",`transform: scale(${t});transform-origin: top left; display: inline-block`),a.textContent=s;const{width:l,height:h}=i.image;return o.setAttribute("width",l.toString()),o.setAttribute("height",h.toString()),new XMLSerializer().serializeToString(o)}function e0(r,e){const t=$e.getOptimalCanvasAndContext(r.width,r.height,e),{context:s}=t;return s.clearRect(0,0,r.width,r.height),s.drawImage(r,0,0),t}function t0(r,e,t){return new Promise(async s=>{t&&await new Promise(i=>setTimeout(i,100)),r.onload=()=>{s()},r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,r.crossOrigin="anonymous"})}class Sc{constructor(e){this._renderer=e,this._createCanvas=e.type===Se.WEBGPU}getTexture(e){return this.getTexturePromise(e)}getTexturePromise(e){return this._buildTexturePromise(e)}async _buildTexturePromise(e){const{text:t,style:s,resolution:i,textureStyle:n}=e,a=te.get(Hl),o=q_(t,s),l=await Q_(o,s,Xi.defaultTextStyle),h=Gp(t,s,l,a),c=Math.ceil(Math.ceil(Math.max(1,h.width)+s.padding*2)*i),u=Math.ceil(Math.ceil(Math.max(1,h.height)+s.padding*2)*i),d=a.image,f=2;d.width=(c|0)+f,d.height=(u|0)+f;const g=J_(t,s,i,l,a);await t0(d,g,X_()&&o.length>0);const m=d;let p;this._createCanvas&&(p=e0(d,i));const _=Tc(p?p.canvas:m,d.width-f,d.height-f,i);return n&&(_.source.style=n),this._createCanvas&&(this._renderer.texture.initSource(_.source),$e.returnCanvasAndContext(p)),te.return(a),_}returnTexturePromise(e){e.then(t=>{this._cleanUp(t)}).catch(()=>{B("HTMLTextSystem: Failed to clean texture")})}_cleanUp(e){re.returnTexture(e,!0),e.source.resource=null,e.source.uploadMethodId="unknown"}destroy(){this._renderer=null}}Sc.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"htmlText"};class s0 extends er{constructor(e){super(),this._renderer=e,e.runners.resolutionChange.add(this)}resolutionChange(){const e=this.renderable;e._autoResolution&&e.onViewUpdate()}destroy(){this._renderer.canvasText.returnTexture(this.texture),this._renderer=null}}class Ac{constructor(e){this._renderer=e}validateRenderable(e){return e._didTextUpdate}addRenderable(e,t){const s=this._getGpuText(e);e._didTextUpdate&&(this._updateGpuText(e),e._didTextUpdate=!1),this._renderer.renderPipes.batch.addToBatch(s,t)}updateRenderable(e){const t=this._getGpuText(e);t._batcher.updateElement(t)}_updateGpuText(e){const t=this._getGpuText(e);t.texture&&this._renderer.canvasText.returnTexture(t.texture),e._resolution=e._autoResolution?this._renderer.resolution:e.resolution,t.texture=t.texture=this._renderer.canvasText.getTexture(e),yi(t,e)}_getGpuText(e){return e._gpuData[this._renderer.uid]||this.initGpuText(e)}initGpuText(e){const t=new s0(this._renderer);return t.renderable=e,t.transform=e.groupTransform,t.bounds={minX:0,maxX:1,minY:0,maxY:0},t.roundPixels=this._renderer._roundPixels|e._roundPixels,e._gpuData[this._renderer.uid]=t,t}destroy(){this._renderer=null}}Ac.extension={type:[y.WebGLPipes,y.WebGPUPipes,y.CanvasPipes],name:"text"};class Pc{constructor(e){this._renderer=e}getTexture(e,t,s,i){typeof e=="string"&&(U("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),e={text:e,style:s,resolution:t}),e.style instanceof Le||(e.style=new Le(e.style)),e.textureStyle instanceof De||(e.textureStyle=new De(e.textureStyle)),typeof e.text!="string"&&(e.text=e.text.toString());const{text:n,style:a,textureStyle:o}=e,l=e.resolution??this._renderer.resolution,{frame:h,canvasAndContext:c}=Xt.getCanvasAndContext({text:n,style:a,resolution:l}),u=Tc(c.canvas,h.width,h.height,l);if(o&&(u.source.style=o),a.trim&&(h.pad(a.padding),u.frame.copyFrom(h),u.updateUvs()),a.filters){const d=this._applyFilters(u,a.filters);return this.returnTexture(u),Xt.returnCanvasAndContext(c),d}return this._renderer.texture.initSource(u._source),Xt.returnCanvasAndContext(c),u}returnTexture(e){const t=e.source;t.resource=null,t.uploadMethodId="unknown",t.alphaMode="no-premultiply-alpha",re.returnTexture(e,!0)}renderTextToCanvas(){U("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}_applyFilters(e,t){const s=this._renderer.renderTarget.renderTarget,i=this._renderer.filter.generateFilteredTexture({texture:e,filters:t});return this._renderer.renderTarget.bind(s,!1),i}destroy(){this._renderer=null}}Pc.extension={type:[y.WebGLSystem,y.WebGPUSystem,y.CanvasSystem],name:"canvasText"};M.add(Gc,Dc);const r0={bg:{shop:"bg/shop.png"}},i0=new URLSearchParams(window.location.search),n0=i0.get("freeze")!==null;n0&&(document.addEventListener("keydown",r=>{r.key}),document.addEventListener("keyup",r=>{r.key}));class Ye{static union(e,t){return[...e,...t]}static unnegate(e){return e===""?"":e.charAt(0)==="!"?e.substring(1):e}static isNegative(e){return e!==""&&e.charAt(0)==="!"}static matches(e=[],t=[]){for(const s of e){const i=Ye.isNegative(s),n=Ye.unnegate(s);if(i===t.includes(n))return!1}return!0}static collapse(e){return[...new Set(e.map(Ye.unnegate))]}}class a0{static empty(){return{dest:void 0,label:"Option"}}static getFlagsUsed(e){return e.needsFlags??[]}static visible(e,t){return t.dest===void 0?(console.log(`Hiding "${t.label}" because of undefined destination`),!1):Ye.matches(t.needsFlags??[],e)}}class ro{static empty(){return{bg:r0.bg.shop,actors:[]}}static getAllFlags(e){var t=[];for(const s of e.actors)t=[...t,...s.needsFlags??[]];return t}}class cn{static newId(){return`${Math.floor(1e5*Math.random())}`}static empty(){return{id:cn.newId(),label:"Empty Screen",text:"lorem ipsum dolor sit amet and so on and so forth...",scene:ro.empty(),actions:[]}}static getIncomingScreens(e,t){const s=[];for(const n of Object.values(t))for(var i=0;i<n.actions.length;i++)n.actions[i].dest===e.id&&s.push(n.id);return s}static getAllFlags(e){var t=ro.getAllFlags(e.scene);for(const s of e.actions)t=[...t,...a0.getFlagsUsed(s)];for(const s of e.textVariants??[])t=[...t,...s.flags];return t}static getText(e,t){for(const s of e.textVariants??[])if(Ye.matches(s.flags,t))return s.text;return e.text}}const We=(r,e)=>(Date.now()%r<r/2?-.5:.5)*e,me=class me extends Ue{constructor(t,s,i){super(s);pe(this,"app");pe(this,"actor");this.app=t,this.actor=i,this.anchor.set(.5),this.setPosition(i.x,i.y),this.setScale(i.scale,i.flipped??!1)}static setViewport({x:t,y:s,w:i,h:n}){this.centerX=t,this.centerY=s,this.sceneWidth=i,this.sceneHeight=n}static async create(t,s){const i=await lt.load(`images/${s.img}`);return new me(t,new k(i),s)}setPosition(t,s){const i=me.centerX,n=me.centerY,a=me.sceneWidth,o=me.sceneHeight;this.position.set(i-a/2+a*t,n-o/2+o*s)}setScale(t,s){const i=me.sceneHeight;this.scale=t*i/this.texture.source.pixelHeight,this.scale.x=(s?-1:1)*Math.abs(this.scale.x)}setAngle(t){this.angle=t*360/6.283}onTick(t){switch(this.actor.animation){case void 0:this.setAngle((this.actor.angle??0)+We(500,.1));break;case"wobble_fast":this.setAngle((this.actor.angle??0)+We(159,.1));break;case"hop_slow":this.setPosition(this.actor.x,this.actor.y+We(497,.02));break;case"hop_fast":this.setPosition(this.actor.x,this.actor.y+We(157,.05));break;case"shake_slow":this.setPosition(this.actor.x+We(510,.02),this.actor.y);break;case"shake_fast":return this.setPosition(this.actor.x+We(160,.02),this.actor.y);case"zoom_slow":this.setScale(this.actor.scale*(1+We(510,.03)),this.actor.flipped??!1);break;case"zoom_fast":this.setScale(this.actor.scale*(1+We(160,.03)),this.actor.flipped??!1);break;case"spin_fast":this.setAngle(9*Date.now()/1e3%6.283);break;case"spin_slow":this.setAngle(1*Date.now()/1e3%6.283)}}};pe(me,"centerX",0),pe(me,"centerY",0),pe(me,"sceneWidth",0),pe(me,"sceneHeight",0);let Ks=me;const kc={0:{actions:[{dest:"71284",label:"Let's go!",needsFlags:[]}],id:0,label:"Beginning of Game",scene:{actors:[{angle:0,img:"text/title/a.png",scale:.5,x:.2,y:.35},{angle:0,img:"text/title/parrot.png",scale:.5,x:.65,y:.25},{angle:0,img:"text/title/story.png",scale:.65,x:.45,y:.8}],bg:"bg/canopy.png"},text:"This is the story of a parrot and its egg."},1826:{actions:[{dest:"85550",label:"leave the dachshund for now",needsFlags:[]}],addsFlags:[],id:"1826",label:"Dachshund rejects martini",scene:{actors:[{angle:0,animation:"still",img:"character/dachshund/gifted.png",scale:.65,x:.4,y:.75},{angle:0,img:"prop/martini.png",scale:.5,x:.8,y:.75}],bg:"bg/dogPark.png"},text:`The dachshund looks sad and confused. "I'm a dog, I don't drink." You feel a little awkward.`},2739:{actions:[{dest:"14923",label:"Continue talking to koala",needsFlags:[]},{dest:"20907",label:"Return to animals to get away from this conversation",needsFlags:[]}],addsFlags:["talkedToKoala2","canThrowRocks"],id:"2739",label:"Koala Cult Talk 2",scene:{actors:[{angle:0,animation:"spin_slow",img:"character/koala/surprised.png",scale:.8,x:.4920037464042546,y:.7}],bg:"bg/jungle.png"},text:`The koala continues, "Well you see, it rules over everything! You will be in its favor if you perform our sacred ritual. Go to the volcano, and throw rocks into it as an offering." You don't know what to make of this, but this animal seems a bit crazed.`},2839:{actions:[{dest:"38201",label:"Next",needsFlags:[]}],addsFlags:[],id:"2839",label:"Egg Hatching 3",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/egg/hatch3.png",scale:.7,x:.5,y:.55}],bg:"bg/shop.png"},text:"The shell begins to open, and you can see part of a small creature."},4219:{actions:[{dest:"93644",label:"Next",needsFlags:[]}],id:"4219",label:"Dunnot talking 2",scene:{actors:[{angle:0,img:"character/dunnock/dunnock_talking.png",scale:1.005,x:.505,y:.565}],bg:"bg/kavaBar.png"},text:'"If you really think about this universe, in its boundless wisdom, you can use your inner instrument to look closely at your own personal solipsistic viewpoint." '},4443:{actions:[{dest:"49884",label:"...",needsFlags:[]}],addsFlags:[],id:"4443",label:"Hotel Egg Hatching 1",scene:{actors:[{angle:0,animation:"shake_slow",img:"character/egg/hatch1.png",scale:1,x:.5,y:.55}],bg:"bg/shop.png"},text:"The egg started shaking!"},5565:{actions:[{dest:"40581",label:"Next",needsFlags:[]}],addsFlags:["askForPossumName"],id:"5565",label:"Possum Offended",scene:{actors:[{angle:0,flipped:!0,img:"character/possum/talking.png",scale:.45,x:.73,y:.71},{angle:0,flipped:!1,img:"character/parrot/blush.png",needsFlags:["!drunk"],scale:.5,x:.215,y:.7},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.19,x:.235,y:.3},{angle:0,animation:"spin_slow",img:"character/parrot/blush.png",needsFlags:["drunk"],scale:.5,x:.23,y:.7}],bg:"bg/flower-shop.png"},text:`The possum comes over to you and spreads its mouth in offense. "No, I'm Pat! Why does everyone keep calling me Jen?" Your face feels hot. You aren't sure what you were thinking.`,textVariants:[{flags:["drunk"],text:`The possum comes over to you and spreads its mouth in offense. "No, I'm Pat! Why does everyone keep calling me Jen?" Your face feels hot. Managing all these social interactions is very confusing and draining.`}]},5936:{actions:[],endgame:"lose",id:"5936",label:"Egg breaks on fountain",scene:{actors:[{angle:0,animation:"still",img:"setting/city_fountain.png",scale:2,x:.08,y:.5606425359088512},{angle:0,animation:"still",img:"character/parrot/sad.png",scale:.24,x:.54,y:.5420089620335692},{angle:0,animation:"still",img:"character/egg/soup.png",scale:.1,x:.74,y:.7},{angle:0,animation:"still",img:"character/egg/brokenShellRight.png",scale:.105,x:.885,y:.6},{angle:0,animation:"still",img:"character/egg/brokenShellLeft.png",scale:.1,x:.565,y:.7784893917831026}],bg:"bg/citySquare.png"},text:"Your egg splatters across the fountain. You're devastated."},7769:{actions:[{dest:"69799",label:"Next",needsFlags:[]}],addsFlags:[],id:"7769",label:"Rat Leader 1",scene:{actors:[{angle:0,img:"character/rat/leader_talking.png",scale:1.055,x:.555,y:.575}],bg:"bg/insideSewer.png"},text:`"My dear brothers and sisters," the leader rat begins, "we are coming up on an unprecedented time in the universe. The fifth dimension is here. It's upon us. Our minds are open to the secrets of the universe, filling us with warmth and happiness. Happiness is all there is." `},9403:{actions:[{dest:"28035",label:"Inspect drink",needsFlags:[]},{dest:"16163",label:"Thank him",needsFlags:[]}],addsFlags:["haveCosmo"],id:"9403",label:"bear pours cosmo",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.35,x:.1,y:.8},{angle:0,animation:"still",img:"setting/barCounter.png",scale:.6,x:.55,y:.7},{angle:0,img:"character/bear/fillingCosmoDrink.png",scale:.2,x:.75,y:.45},{angle:0,img:"character/bear/fillingCosmo.png",scale:.4,x:.65,y:.25}],bg:"bg/bar.png"},text:'The strange panda pours the cosmopolitan drink carefully. "Hope your friend enjoys!"'},9785:{actions:[{dest:"87223",label:"Follow the rats through the hole",needsFlags:[]},{dest:"18822",label:"Leave the Bathroom",needsFlags:[]}],addsFlags:[],id:"9785",label:"Discover hole",scene:{actors:[{angle:0,img:"setting/hole_in_wall.png",scale:.58,x:.525,y:.79},{angle:-.55,img:"character/rat/rat_2.png",scale:.5,x:.77,y:.99},{angle:0,flipped:!0,img:"character/rat/rat_1.png",scale:.36,x:.265,y:.955}],bg:"bg/bathroom_tiling.png"},text:"The rats lead you to the corner of the bathroom where there's a hole in the wall! It's just big enough for you to fit through!"},10255:{actions:[{dest:"13631",label:"Wander the city again",needsFlags:[]},{dest:"11989",label:"Dig through the fountain",needsFlags:[]},{dest:"94275",label:"Climb on the fountain",needsFlags:["!hasClimbedFountain","!drunk"]},{dest:"94275",label:"Push your luck and climb the fountain again",needsFlags:["hasClimbedFountain"]},{dest:"94275",label:"Climb fountain while tipsy",needsFlags:["drunk"]}],addsFlags:["sawFountain"],id:"10255",label:"Fountain Hub",scene:{actors:[{angle:0,animation:"still",img:"setting/city_fountain.png",scale:1.05,x:.505,y:.5},{angle:0,animation:"shake_slow",img:"character/parrot/bindle.png",scale:.245,x:.105,y:.815},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.16,y:.65}],bg:"bg/citySquare.png"},text:"You arrive to the fountain! You love the smell of the water.",textVariants:[{flags:["sawFountain"],text:"The city fountain stares back at you. What do you do next?"},{flags:["!sawFountain","drunk"],text:"You arrive to the fountain. The water smells nice but you're still woozy."}]},11635:{actions:[{dest:"13849",label:"Next",needsFlags:[]}],addsFlags:[],id:"11635",label:"Doberman attack",scene:{actors:[{angle:0,animation:"shake_fast",img:"character/doberman/attack.png",scale:1,x:.55,y:.5}],bg:"bg/dogPark.png"},text:"Oh no! The doberman lunges at you, takes your egg from your beak, and breaks it between his teeth! "},11989:{actions:[{dest:"18632",label:"Next",needsFlags:[]}],addsFlags:[],id:"11989",label:"Digging through fountain",scene:{actors:[{angle:0,animation:"still",img:"setting/city_fountain.png",scale:1.05,x:.505,y:.5},{angle:0,img:"character/parrot/splashing.png",scale:.315,x:.255,y:.48},{angle:-.76,img:"prop/splash_1.png",scale:.1,x:.325,y:.31563327580077283},{angle:0,img:"prop/splash_2.png",scale:.1,x:.39,y:.47144549762423216},{angle:.545,img:"prop/splash_3.png",scale:.1,x:.39,y:.545},{angle:2.04,img:"prop/splash_4.png",scale:.1,x:.205,y:.42},{angle:2.71,img:"prop/splash_5.png",scale:.1,x:.245,y:.325},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.125,x:.35,y:.385}],bg:"bg/citySquare.png"},text:"You dig through the fountain!"},12073:{actions:[{dest:"78527",label:"Accept request",needsFlags:["!haveDogBone"]},{dest:"62947",label:'"No thanks"',needsFlags:["!beagleRejected","!haveDogBone"]},{dest:"62947",label:"Refuse offer again",needsFlags:["beagleRejected","!haveDogBone"]},{dest:"63647",label:`Say "You're welcome!"`,needsFlags:["haveDogBone"]}],addsFlags:["talkedToBeagle"],id:"12073",label:"Beagle asks for favor",scene:{actors:[{angle:0,img:"character/beagle/gifted.png",scale:.8,x:.55,y:.7}],bg:"bg/dogPark.png"},text:`The beagle turns to you. "It's so nice to meet you! Playing was a blast!" You smile at him. "By the way, I know this is short notice, but can you bring my girlfriend a gift for me? She works at the hotel near here. It would be a great chance for you to see more of the city."`,textVariants:[{flags:["beagleRejected"],text:`The beagle turns to you again. "Hey, I know you said you didn't want to bring my gf a gift, but would you be willing to reconsider? It would really make her day!"`},{flags:["haveDogBone"],text:'The beagle turns to you again. "Thanks so much for agreeing to bring my girlfriend a gift. She really is the sweetest."'}]},13097:{actions:[{dest:"13631",label:"Wander the city",needsFlags:[]},{dest:"40581",label:"Go in!",needsFlags:[]}],addsFlags:["haveSeenFlowerShop"],id:"13097",label:"Flower shop exterior",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.25,x:.05,y:.8},{angle:0,animation:"still",img:"setting/flowerShop.png",scale:1.05,x:.5,y:.55},{angle:0,img:"prop/sunflowers.png",scale:.2,x:.9,y:.7},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.12,x:.11532884775633567,y:.615},{angle:-.63,img:"character/rat/rat_3.png",needsFlags:["drunk","haveRatVision"],scale:.1,x:.41962877191528813,y:.9414897753894047},{angle:-.755,img:"character/rat/rat_3.png",needsFlags:["drunk","haveRatVision"],scale:.1,x:.42,y:.1},{angle:0,img:"character/rat/rat_1.png",needsFlags:["haveRatVision"],scale:.115,x:.66,y:.81}],bg:"bg/city.png"},text:"You arrive to the flower shop! It seems welcoming.",textVariants:[{flags:["haveSeenFlowerShop"],text:"You're back at the flower shop!"}]},13631:{actions:[{dest:"27595",label:"Go to hotel",needsFlags:[]},{dest:"85550",label:"Go to dog park",needsFlags:[]},{dest:"61921",label:"Go to bar",needsFlags:[]},{dest:"13097",label:"Go to flower shop",needsFlags:[]},{dest:"10255",label:"Visit city fountain",needsFlags:[]},{dest:"99585",label:"Visit therapy mouse",needsFlags:["haveMetTherapyMouse"]}],addsFlags:["haveSeenCity"],id:"13631",label:"City Hub",scene:{actors:[],bg:"bg/city.png"},text:"You wander the city and wonder what you should do. There are really only a few options...",textVariants:[{flags:["haveSeenCity"],text:"You wander the city again and think about what you should do next. "}]},13817:{actions:[{dest:"23991",label:"Inspect Keycard",needsFlags:[]},{dest:"56699",label:'Say "Thanks!"',needsFlags:[]}],addsFlags:["haveKeycard"],id:"13817",label:"Receive Hamster Gift",scene:{actors:[{angle:0,animation:"hop_slow",flipped:!1,img:"character/hamster/neutral.png",scale:.78,x:.49,y:.725},{angle:1.21,animation:"hop_slow",img:"prop/hotelKeyCard.png",scale:.5,x:.64,y:.9}],bg:"bg/hotelLobby.png"},text:`"It's a keycard to our pool area!" she says. "Please enjoy a free swim in our hot tub."`},13849:{actions:[{dest:"51350",label:"Next",needsFlags:[]}],addsFlags:[],id:"13849",label:"Shock",scene:{actors:[{angle:0,animation:"spin_slow",img:"character/parrot/shocked.png",scale:.5,x:.55,y:.5}],bg:"bg/dogPark.png"},text:"You feel shock and horror!"},14923:{actions:[{dest:"20907",label:"Back to the animals",needsFlags:[]}],addsFlags:["talkedToKoala3","talkedToKoala3"],id:"14923",label:"Koala Cult Talk 3 ",scene:{actors:[{angle:0,animation:"spin_fast",img:"character/koala/talking.png",scale:1.15,x:.5,y:.5744793845602532}],bg:"bg/jungle.png"},text:`He continues, with increased pitch and fervor: 
"Out in the mindless void the daemon bore me
Past the bright clusters of dimensioned space,
Till neither time nor matter stretched before me,
But only Chaos, without form or place."
You decide it's time to leave.`},16163:{actions:[{dest:"18822",label:"Next",needsFlags:[]}],addsFlags:["meetBear"],id:"16163",label:"Parrot says thanks to bear",scene:{actors:[{angle:0,img:"character/parrot/backWingsSpread.png",needsFlags:["!drunk"],scale:.86,x:.515,y:.52},{angle:0,img:"character/parrot/back.png",needsFlags:["drunk"],scale:.785,x:.4724080673554427,y:.5935892429645868},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.225,x:.4475303429860865,y:.16100141979995175}],bg:"bg/bar.png"},text:`"Thanks so much!" you squawk at him. "You're welcome!" the panda says.`,textVariants:[{flags:["drunk"],text:'"Thanks so much," you manage to squawk at him.'}]},17556:{actions:[{dest:"20907",label:"Return to other animals",needsFlags:[]}],addsFlags:[],id:"17556",label:"Koala Follow Up",scene:{actors:[{angle:0,img:"character/koala/talking.png",scale:.445,x:.74,y:.815},{angle:0,img:"character/parrot/back.png",scale:.5,x:.155,y:.875}],bg:"bg/jungle.png"},text:`You are terrified of this koala but something possesses you to reinitiate a conversation. He sounds different now, with a smooth, silky voice. "Hey, what's up?" You are at a loss for words.`},18632:{actions:[{dest:"10255",label:"Next",needsFlags:[]}],addsFlags:["haveGlasses"],id:"18632",label:"Fountain Dig Result",scene:{actors:[{angle:0,animation:"still",img:"setting/city_fountain.png",scale:1.05,x:.505,y:.5},{angle:0,img:"character/parrot/shocked.png",needsFlags:["haveGlasses"],scale:.14,x:.285,y:.435},{angle:0,img:"character/parrot/cool.png",needsFlags:["!haveGlasses"],scale:.27,x:.25,y:.66},{angle:0,img:"text/soCool.png",needsFlags:["!haveGlasses","!drunk"],scale:.16,x:.375,y:.695},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.17,x:.31,y:.38}],bg:"bg/citySquare.png"},text:"You found a cool pair of sunglasses! You put them on briefly and then put them away in your plumage.",textVariants:[{flags:["haveGlasses"],text:"You get soaked and don't end up finding anything."}]},18822:{actions:[{dest:"82006",label:"Wander the city again",needsFlags:["!haveMetTherapyMouse"]},{dest:"13631",label:"Wander the city again",needsFlags:["haveMetTherapyMouse"]},{dest:"65138",label:"Ask for a drink",needsFlags:["!hasDrink"]},{dest:"65138",label:"Ask for another drink",needsFlags:["hasDrink"]},{dest:"47626",label:"Use their bathroom",needsFlags:[]}],addsFlags:["meetBear"],id:"18822",label:"Bar Hub",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.35,x:.1,y:.8},{angle:0,img:"character/bear/neutral.png",scale:.5,x:.75,y:.25},{angle:0,animation:"still",img:"setting/barCounter.png",needsFlags:["!drunk"],scale:.6,x:.6,y:.65},{angle:0,animation:"hop_slow",img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.14,y:.575},{angle:0,img:"setting/barCounter.png",needsFlags:["drunk"],scale:.62,x:.62,y:.71}],bg:"bg/bar.png"},text:"You go inside and encounter some sort of weird panda. ",textVariants:[{flags:["drunk","meetBear"],text:"The panda looks at you and wonders if you'd like anything else. He looks mildly concerned for you."},{flags:["meetBear"],text:"The panda looks at you and wonders if you'd like anything else."},{flags:["!meetBear","drunk"],text:"You go inside and encounter some sort of weird panda. You feel like things are moving more than they should."}]},18968:{actions:[{dest:"47389",label:"Next. No other options.",needsFlags:[]}],addsFlags:[],id:"18968",label:"Volcano gets rocks",scene:{actors:[{angle:0,animation:"shake_slow",img:"setting/volcano/opening.png",scale:1,x:.55,y:.5},{angle:0,img:"character/parrot/throwing.png",scale:.25,x:.1,y:.6021070859995121},{angle:0,img:"prop/jungleRocks.png",scale:.1,x:.25,y:.4923805290438986}],bg:"bg/volcano.png"},text:"You launch the rocks into the volcano! They land into the lava and the ground begins to shake!"},19418:{actions:[{dest:"9785",label:"Follow the rats",needsFlags:[]},{dest:"18822",label:"Leave the Bathroom",needsFlags:[]}],addsFlags:["haveRatVision"],id:"19418",label:"rat vision discovered",scene:{actors:[{angle:0,animation:"still",flipped:!0,img:"prop/toilet.png",scale:.69,x:.26,y:.5146708692031643},{angle:0,img:"character/parrot/cool.png",scale:.33,x:.28,y:.39606551592520745},{angle:0,animation:"still",img:"setting/bathroom_counter.png",scale:.795,x:.72,y:.375},{angle:0,img:"character/rat/rat_1.png",scale:.17,x:.875,y:.64},{angle:-.62,animation:"hop_slow",img:"character/rat/rat_3.png",scale:.2,x:.4,y:.84}],bg:"bg/bathroom_tiling.png"},text:"You put on the glasses. Your mind feels like it has opened up! You suddenly see multiple rats! Guess you now have rat vision."},20169:{actions:[{dest:"79292",label:"Next",needsFlags:[]}],addsFlags:["haveWatchedDrumRoutine"],id:"20169",label:"Drum Circle 2",scene:{actors:[{angle:-1.535,img:"prop/poisonBottle.png",scale:.1,x:.945,y:.9},{angle:1.715,img:"prop/poisonBottle.png",scale:.1,x:.05,y:.935},{angle:0,animation:"still",img:"prop/drum_lower_left.png",needsFlags:[],scale:.25,x:.37,y:.85},{angle:0,img:"character/rat/drum_cirlce_rat_lowerLeft.png",needsFlags:[],scale:.29,x:.305,y:.855},{angle:0,animation:"hop_slow",img:"character/rat/rat_hands.png",needsFlags:[],scale:.14,x:.36,y:.825},{angle:0,animation:"hop_slow",img:"character/rat/drum_circle_rat_upperLeft.png",needsFlags:[],scale:.275,x:.385,y:.6},{angle:0,animation:"still",img:"prop/drum_lower_right.png",needsFlags:[],scale:.255,x:.68,y:.8503258298768752},{angle:0,img:"text/music_notes_2.png",needsFlags:[],scale:.23,x:.53,y:.24},{angle:0,animation:"hop_slow",flipped:!0,img:"character/rat/rat_hands.png",needsFlags:[],scale:.135,x:.69,y:.785},{angle:0,img:"character/rat/drum_circle_rat_lowerRight.png",needsFlags:[],scale:.31,x:.745,y:.815},{angle:.2,animation:"still",img:"prop/drum_upper_right.png",needsFlags:[],scale:.205,x:.62,y:.62},{angle:0,animation:"hop_slow",img:"character/rat/drum_circle_rat_upperRight.png",needsFlags:[],scale:.23,x:.685,y:.555},{angle:0,img:"text/music_notes_crescendo.png",scale:.16,x:.47,y:.38}],bg:"bg/backAlley.png"},text:"The rats start to drum a bit faster and grow louder.",textVariants:[]},20907:{actions:[{dest:"87811",label:"Play with the jaguar",needsFlags:["!playedWithJaguar"]},{dest:"78752",label:"Play with the small man",needsFlags:[]},{dest:"48268",label:"Play with the koala",needsFlags:["!playedWithKoala"]},{dest:"64647",label:"Talk to the koala",needsFlags:["!talkedToKoala"]},{dest:"2739",label:"Talk to the koala again",needsFlags:["talkedToKoala","!talkedToKoala2"]},{dest:"14923",label:"Talk to the koala again",needsFlags:["talkedToKoala2","!talkedToKoala3"]},{dest:"17556",label:"Talk to the koala again",needsFlags:["talkedToKoala3"]},{dest:"90619",label:"Wander the jungle some more",needsFlags:[]}],addsFlags:[],id:"20907",label:"Jungle animals encounter",scene:{actors:[{angle:.035,animation:"hop_slow",img:"character/parrot/in-transit.png",scale:.235,x:.32,y:.815},{angle:0,animation:"hop_fast",img:"character/monkey/neutral.png",scale:.5,x:.8504803802665324,y:.27},{angle:0,img:"character/koala/neutral.png",needsFlags:["!drunk"],scale:.35,x:.2,y:.33024762083858294},{angle:0,flipped:!0,img:"character/jaguar/neutral.png",needsFlags:["!playedWithJaguar","!drunk"],scale:.35,x:.67,y:.75},{angle:0,img:"character/rat/rat_1.png",needsFlags:["haveRatVision"],scale:.155,x:.43,y:.885},{angle:0,animation:"hop_fast",img:"character/rat/rat_2.png",needsFlags:["haveRatVision"],scale:.145,x:.93,y:.365},{angle:0,animation:"spin_slow",img:"character/koala/neutral.png",needsFlags:["drunk"],scale:.355,x:.23,y:.31},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.165,x:.29,y:.65},{angle:0,flipped:!0,img:"character/jaguar/neutral.png",needsFlags:["drunk","!playedWithJaguar"],scale:.37,x:.655,y:.77},{angle:0,flipped:!0,img:"character/jaguar/neutral.png",needsFlags:["drunk","!playedWithJaguar"],scale:.39,x:.685,y:.74},{angle:0,img:"prop/jungle_plants/philodendron.png",scale:.28,x:.155,y:.86},{angle:0,flipped:!0,img:"prop/jungle_plants/monstera.png",scale:.385,x:.865,y:.835}],bg:"bg/jungle.png"},text:"What will you do with these guys?"},22555:{actions:[{dest:"40581",label:"Next",needsFlags:[]}],addsFlags:["haveLilac","haveFlower"],id:"22555",label:"You take lilac",scene:{actors:[{angle:0,img:"character/parrot/happy2.png",needsFlags:["!drunk"],scale:.5,x:.3,y:.6898671123379214},{angle:0,img:"character/parrot/happy.png",needsFlags:["drunk"],scale:.505,x:.195,y:.685},{angle:.51,img:"prop/lilac.png",scale:.35,x:.25,y:.65},{angle:0,img:"character/possum/neutral.png",scale:.5,x:.75,y:.7},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.225,x:.28,y:.33}],bg:"bg/flower-shop.png"},text:"You take a lilac. It smells wonderful and you feel confident about your selection!",textVariants:[{flags:["drunk"],text:"You take a lilac. It smells wonderful, but the smell is a little hard on your stomach."}]},22841:{actions:[{dest:"59840",label:"Back to Hotel Lobby",needsFlags:[]},{dest:"79680",label:"Go into the pool",needsFlags:[]}],addsFlags:[],id:"22841",label:"Hotel pool",scene:{actors:[{angle:0,animation:"still",img:"setting/hotel/hotTub.png",scale:1,x:.55,y:.45},{angle:0,img:"character/parrot/happy.png",needsFlags:["!drunk"],scale:.2,x:.15,y:.6686595920676749},{angle:0,img:"character/egg/neutral.png",scale:.1,x:.05,y:.7224330936908226},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.25,y:.53},{angle:0,img:"character/parrot/neutral.png",needsFlags:["drunk"],scale:.22,x:.155,y:.665}],bg:"bg/shop.png"},text:"You find a wonderful little hot tub. You feel sleepy."},23253:{actions:[{dest:"37515",label:"Time to leave. You go back to where you came from.",needsFlags:[]}],addsFlags:[],id:"23253",label:"Cult masks on",scene:{actors:[{angle:.035,animation:"still",img:"prop/sconce.png",scale:.25,x:.845,y:.21597782101531282},{angle:0,img:"prop/candle_1.png",scale:.12,x:.785,y:.22},{angle:0,img:"prop/candle_2.png",scale:.11,x:.895,y:.23},{angle:0,animation:"hop_slow",img:"character/rat/leader_neutral.png",scale:.205,x:.525,y:.53},{angle:0,flipped:!1,img:"character/rat/rat_side.png",scale:.24,x:.345,y:.485},{angle:0,flipped:!1,img:"character/rat/rat_side.png",scale:.215,x:.37,y:.655},{angle:-.035,flipped:!1,img:"character/rat/rat_side.png",scale:.22,x:.415,y:.42},{angle:0,img:"character/parrot/in-transit.png",scale:.325,x:.19623846852051263,y:.971976817210723},{angle:0,animation:"still",img:"text/cult_writing.png",scale:.105,x:.535,y:.0806238762464404},{angle:0,animation:"still",img:"text/cult_logo.png",scale:.15,x:.95,y:.125},{angle:0,flipped:!0,img:"character/rat/rat_side.png",scale:.15,x:.625,y:.415},{angle:0,flipped:!0,img:"character/rat/rat_side.png",scale:.2,x:.685,y:.47},{angle:0,flipped:!0,img:"character/rat/rat_side.png",scale:.26,x:.655,y:.585},{angle:0,img:"character/rat/back_1.png",scale:.205,x:.5,y:.72},{angle:0,img:"character/rat/standing.png",scale:.225,x:.525,y:.33},{angle:0,animation:"still",img:"prop/sconce.png",scale:.215,x:.14007765787037174,y:.22},{angle:0,img:"prop/candle_3.png",scale:.115,x:.185,y:.22},{angle:0,img:"prop/candle_1.png",scale:.125,x:.09,y:.21},{angle:0,animation:"hop_slow",img:"prop/mask_1.png",scale:.1,x:.515,y:.5},{angle:0,img:"prop/mask_side.png",scale:.1,x:.375,y:.435},{angle:0,img:"prop/mask_side.png",scale:.1,x:.4,y:.615},{angle:0,img:"prop/mask_side.png",scale:.1,x:.45,y:.375},{angle:0,img:"prop/mask_2.png",scale:.1,x:.525,y:.275},{angle:0,flipped:!0,img:"prop/mask_side.png",scale:.1,x:.665,y:.435},{angle:-.315,flipped:!0,img:"prop/mask_side.png",scale:.1,x:.63,y:.53},{angle:0,flipped:!0,img:"prop/mask_side.png",scale:.1,x:.6,y:.4}],bg:"bg/insideSewer.png"},text:"The rats continue chanting loudly, in the most crazed way possible."},23888:{actions:[{dest:"20907",label:"Next",needsFlags:[]}],addsFlags:["metAnimals"],id:"23888",label:"Meet animals first time",scene:{actors:[{angle:.035,animation:"hop_slow",img:"character/parrot/in-transit.png",scale:.235,x:.33,y:.815},{angle:0,animation:"hop_fast",img:"character/monkey/neutral.png",scale:.5,x:.8504803802665324,y:.27},{angle:0,img:"character/koala/neutral.png",needsFlags:["!drunk"],scale:.35,x:.2,y:.33024762083858294},{angle:0,flipped:!0,img:"character/jaguar/neutral.png",needsFlags:["!drunk"],scale:.35,x:.67,y:.75},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.135,x:.29,y:.69},{angle:0,animation:"spin_slow",img:"character/koala/neutral.png",needsFlags:["drunk"],scale:.345,x:.21,y:.305},{angle:0,flipped:!0,img:"character/jaguar/neutral.png",needsFlags:["drunk"],scale:.335,x:.62,y:.76},{angle:0,flipped:!0,img:"character/jaguar/neutral.png",needsFlags:["drunk"],scale:.34,x:.625,y:.795},{angle:0,img:"prop/jungle_plants/philodendron.png",scale:.405,x:.14,y:.825},{angle:0,flipped:!0,img:"prop/jungle_plants/monstera.png",scale:.375,x:.885,y:.84}],bg:"bg/jungle.png"},text:"You encounter some strange-looking animals! You think they're called a koala, jaguar, and a small man.",textVariants:[{flags:["drunk","!metAnimals"],text:"You encounter some strange-looking animals! You think they're called a koala, jaguar, and a small man but you can't be too sure."}]},23991:{actions:[{dest:"56699",label:'Say "Thanks!"',needsFlags:[]},{dest:"53122",label:"Flip Keycard Over",needsFlags:[]}],addsFlags:[],id:"23991",label:"Keycard front",scene:{actors:[{angle:0,img:"prop/hotelKeyCardFront.png",scale:1,x:.55,y:.5}],bg:"bg/hotelLobby.png"},text:'The front of the keycard says "Welcome, Enjoy the Pool" on it.'},24072:{actions:[{dest:"91404",label:"Next",needsFlags:[]}],id:"24072",label:"Poison Settles",scene:{actors:[{angle:0,img:"character/parrot/drunk.png",needsFlags:[],scale:.985,x:.46,y:.5},{angle:-.715,img:"character/rat/rat_3.png",needsFlags:["haveRatVision"],scale:.185,x:.835,y:.93}],bg:"bg/backAlley.png"},text:"The substance does NOT settle well in your stomach. You regret your life choices."},27438:{actions:[],addsFlags:[],endgame:"lose",id:"27438",label:"Volcano Destruction",scene:{actors:[{angle:0,animation:"shake_slow",img:"setting/volcano/oozing.png",scale:1,x:.55,y:.5}],bg:"bg/volcano.png"},text:"You are covered by magma and ash. There is no escape. Your egg is destroyed along with your hopes and dreams."},27595:{actions:[{dest:"13631",label:"Wander city instead",needsFlags:[]},{dest:"59840",label:"Go inside",needsFlags:[]}],addsFlags:[],id:"27595",label:"Hotel exterior",scene:{actors:[{angle:0,animation:"still",img:"setting/hotel/hotel.png",scale:.82,x:.5,y:.51},{angle:0,img:"character/parrot/bindle.png",scale:.3,x:.2,y:.7437772492394863},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.26,y:.545}],bg:"bg/city.png"},text:"You made it to the hotel!"},28006:{actions:[{dest:"59840",label:"Trail Off",needsFlags:[]}],addsFlags:[],id:"28006",label:"Embarassed",scene:{actors:[{angle:0,animation:"shake_fast",img:"character/parrot/blush.png",scale:.95,x:.5,y:.5000827459901062},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.23,x:.78,y:.08}],bg:"bg/hotelLobby.png"},text:"Poor thing! You seem to have embarassed yourself!"},28035:{actions:[{dest:"18822",label:"Inspection complete",needsFlags:[]}],addsFlags:[],id:"28035",label:"Inspecting Cosmo",scene:{actors:[{angle:0,img:"prop/cosmopolitan.png",scale:1,x:.55,y:.5}],bg:"bg/bar.png"},text:"That's a good-looking cosmo!"},29274:{actions:[],addsFlags:[],id:"29274",label:"Drum Circle 2",scene:{actors:[{angle:-1.535,img:"prop/poisonBottle.png",scale:.1,x:.945,y:.9},{angle:1.715,img:"prop/poisonBottle.png",scale:.1,x:.05,y:.935},{angle:0,animation:"still",img:"prop/drum_lower_left.png",needsFlags:[],scale:.25,x:.37,y:.85},{angle:0,img:"character/rat/drum_cirlce_rat_lowerLeft.png",needsFlags:[],scale:.29,x:.305,y:.855},{angle:0,animation:"hop_slow",img:"character/rat/rat_hands.png",needsFlags:[],scale:.14,x:.36,y:.825},{angle:0,img:"character/rat/drum_circle_rat_upperLeft.png",needsFlags:[],scale:.275,x:.385,y:.6},{angle:0,img:"text/music_notes_1.png",needsFlags:[],scale:.1,x:.54,y:.655},{angle:0,animation:"still",img:"prop/drum_lower_right.png",needsFlags:[],scale:.255,x:.68,y:.8503258298768752},{angle:0,img:"text/music_notes_1.png",needsFlags:[],scale:.23,x:.53,y:.24},{angle:0,animation:"hop_slow",flipped:!0,img:"character/rat/rat_hands.png",needsFlags:[],scale:.135,x:.69,y:.785},{angle:0,img:"character/rat/drum_circle_rat_lowerRight.png",needsFlags:[],scale:.31,x:.745,y:.815},{angle:.2,animation:"still",img:"prop/drum_upper_right.png",needsFlags:[],scale:.205,x:.62,y:.62},{angle:0,img:"character/rat/drum_circle_rat_upperRight.png",needsFlags:[],scale:.23,x:.685,y:.555}],bg:"bg/backAlley.png"},text:"",textVariants:[]},29900:{actions:[{dest:"37515",label:"Go back to the fork in the sewer system",needsFlags:[]},{dest:"23253",label:"Continue watching",needsFlags:[]}],addsFlags:[],id:"29900",label:"Rat Leader 3 (copy)",scene:{actors:[{angle:0,img:"character/rat/leader_happy.png",scale:1.055,x:.555,y:.575},{angle:0,img:"prop/mask_1.png",scale:.47,x:.47,y:.365}],bg:"bg/insideSewer.png"},text:`"Don't we feel so happy? So blessed?" he screeched! The rats erupted in applause and cheers.`},31710:{actions:[{dest:"85550",label:"Next",needsFlags:[]}],addsFlags:["haveMetDachshund"],id:"31710",label:"Play with dachshund",scene:{actors:[{angle:0,img:"character/dachshund/playing.png",scale:.25,x:.55,y:.6},{angle:0,img:"character/parrot/happy2.png",needsFlags:["!drunk"],scale:.25,x:.25,y:.65},{angle:0,img:"character/egg/neutral2.png",scale:.1,x:.25,y:.8802936574460094},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.33,y:.425},{angle:0,img:"character/parrot/happy.png",needsFlags:["drunk"],scale:.25,x:.275,y:.6}],bg:"bg/dogPark.png"},text:"You and the dachshund play together for a few minutes. You're surprised he had it in him- he looked pretty old and confused. Now he's huffing and puffing, so you decide to let him rest.",textVariants:[]},31726:{actions:[{dest:"85940",label:"Oh my gosh!",needsFlags:[]}],addsFlags:[],id:"31726",label:"Egg Hatching 1",scene:{actors:[{angle:0,animation:"shake_slow",img:"character/egg/hatch1.png",scale:1,x:.5,y:.55}],bg:"bg/shop.png"},text:"The small head wrap falls off of your egg and it begins to shake violently! A few cracks begin to form."},33614:{actions:[{dest:"94630",label:"Next",needsFlags:[]}],id:"33614",label:"Therapy Mouse Prompts User to explore",scene:{actors:[{angle:0,img:"character/mouse/hiss.png",scale:.95,x:.41,y:.5}],bg:"bg/backAlley.png"},text:`The mouse seems a little offended. "You need to explore the city more! Once you have sufficiently, we'll have more to talk about!"`},34620:{actions:[{dest:"74372",label:"Back to the volcano",needsFlags:[]},{dest:"35030",label:"Take a bath",needsFlags:[]}],addsFlags:[],id:"34620",label:"Hot Spring Bath",scene:{actors:[{angle:0,img:"setting/hotSpring.png",scale:.9,x:.5,y:.5}],bg:"bg/volcano.png"},text:"You find the hot spring and feel like it's calling to you. You feel very heavy and sleepy."},35030:{actions:[{dest:"31726",label:"What is your egg doing!",needsFlags:[]}],addsFlags:[],id:"35030",label:"Taking a bath",scene:{actors:[{angle:0,img:"character/parrot/bath.png",scale:.5,x:.3,y:.4},{angle:0,img:"prop/bathWater.png",scale:.5,x:.5,y:.75},{angle:0,img:"character/egg/bath.png",scale:.1,x:.45,y:.65}],bg:"bg/volcano.png"},text:"This bath is just what you needed! You feel refreshed!"},35747:{actions:[{dest:"13631",label:"Disembark into the City",needsFlags:[]}],addsFlags:["haveBeenToCity"],id:"35747",label:"City Arrival",scene:{actors:[{angle:0,animation:"shake_slow",flipped:!0,img:"character/rat/rat_1.png",needsFlags:["haveRatVision"],scale:.1,x:.735,y:.69},{angle:0,animation:"shake_slow",flipped:!0,img:"setting/bus.png",scale:.49,x:.47,y:.77}],bg:"bg/city.png"},text:"You finally arrive in the city! The options here are endless. Maybe you can make some friends!",textVariants:[{flags:["sawGiantRat"],text:"You finally arrive in the city after a very long ride with the yelling rat."},{flags:["haveBeenToCity"],text:"You're back to the city!"}]},37515:{actions:[{dest:"75362",label:"Go left",needsFlags:["!discoverCult"]},{dest:"95982",label:"Go right",needsFlags:["!discoverJunglePath"]},{dest:"23253",label:"Visit rat cult",needsFlags:["discoverCult"]},{dest:"95982",label:"Return to jungle",needsFlags:["discoverJunglePath"]}],addsFlags:[],id:"37515",label:"Forked path",scene:{actors:[{angle:0,animation:"still",img:"setting/forked_sewer_tunnel.png",scale:1.29,x:.525,y:.51},{angle:0,img:"character/rat/rat_1.png",scale:.1,x:.485,y:.625},{angle:0,img:"character/rat/rat_2.png",scale:.22,x:.7665477362006303,y:.8663289929383993},{angle:-.535,animation:"still",img:"text/cult_logo.png",scale:.1,x:.435,y:.275},{angle:0,animation:"still",img:"text/cult_writing.png",scale:.1,x:.2105248203674337,y:.175},{angle:-.935,img:"character/rat/rat_3.png",scale:.1,x:.6403344116143335,y:.46},{angle:0,flipped:!0,img:"character/rat/rat_1.png",scale:.145,x:.32,y:.92}],bg:"bg/gray.png"},text:"You follow the sewer system down a ways until you arrive to a fork in your path! You hear faint chanting from the left and jungle sounds to the right."},38201:{actions:[],addsFlags:[],endgame:"win",id:"38201",label:"Egg Hatching 4",scene:{actors:[{angle:0,img:"character/egg/hatch4.png",scale:.5,x:.55,y:.55},{angle:0,img:"character/egg/hatch4lines.png",scale:1,x:.5,y:.45},{angle:1.01,animation:"spin_fast",img:"character/egg/hatch4shell.png",scale:.25,x:.25,y:.25}],bg:"bg/shop.png"},text:"A small yellow bird emerges! It doesn't really look like a baby parrot, so you're confused about that, but you still feel a sense of pride and motherhood."},38916:{actions:[{dest:"35747",label:"Oh god",needsFlags:[]}],addsFlags:["sawGiantRat"],id:"38916",label:"Bus Interior",scene:{actors:[{angle:0,img:"character/rat/busRat_no_tail.png",scale:.485,x:.36,y:.475},{angle:0,animation:"hop_slow",img:"character/rat/busRat_tail.png",scale:.5,x:.56,y:.56}],bg:"bg/bus_interior.png"},text:"You see a horrific, huge rat on the bus, screaming its head off. ",textVariants:[{flags:["sawGiantRat"],text:"That giant rat is still screaming."}]},40581:{actions:[{dest:"5565",label:'Ask the possum "Are you Jen?"',needsFlags:["!askForPossumName"]},{dest:"86146",label:"Ask if you can buy flowers",needsFlags:["!haveFlower"]},{dest:"86146",label:"Ask to purchase more flowers",needsFlags:["haveFlower"]},{dest:"13631",label:"Leave the shop",needsFlags:[]}],addsFlags:["haveBeenInsideFlowerShop"],id:"40581",label:"Flower shop interior",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.39,x:.35,y:.7},{angle:.11,animation:"still",img:"setting/hotel/desk.png",needsFlags:["!drunk"],scale:.5,x:.75,y:.7},{angle:0,animation:"hop_slow",img:"setting/hotel/desk.png",needsFlags:["drunk"],scale:.54,x:.755,y:.7},{angle:0,img:"character/possum/neutral.png",scale:.32,x:.865,y:.495},{angle:0,img:"prop/sunflowers.png",scale:.25,x:.15,y:.3},{angle:0,img:"prop/sunflowers.png",scale:.25,x:.25,y:.3},{angle:0,img:"prop/lilac.png",scale:.3,x:.05,y:.3},{angle:0,img:"character/rat/rat_2.png",needsFlags:["haveRatVision"],scale:.17,x:.595,y:.58},{angle:-.61,img:"character/rat/rat_3.png",needsFlags:["haveRatVision"],scale:.1,x:.73,y:.585},{angle:.23,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.16,x:.42,y:.465}],bg:"bg/flower-shop.png"},text:"You go into the flower store and are met with fragrances of sunflowers, lilacs, roses, lilies, and many more flowers you can't even think to describe. You see a possum running the shop.",textVariants:[{flags:["askForPossumName","haveBeenInsideFlowerShop"],text:"You see Pat, not Jen, on the counter. What will you do next?"},{flags:["haveBeenInsideFlowerShop"],text:"The flower shop is just as beautiful as the first time you were there. What do you do next?"}]},43130:{actions:[],addsFlags:[],endgame:"lose",id:"43130",label:"Egg breaks in flower shop",scene:{actors:[{angle:0,animation:"still",img:"character/parrot/sad.png",scale:.5,x:.25,y:.75},{angle:0,img:"character/egg/soup.png",scale:.1,x:.6,y:.95},{angle:0,img:"character/egg/brokenShellRight.png",scale:.1,x:.7,y:.95},{angle:0,img:"character/egg/brokenShellLeft.png",scale:.1,x:.5,y:.95}],bg:"bg/flower-shop.png"},text:"Your egg smashes against the flower shop floor and breaks! You feel immense sadness."},43914:{actions:[],id:"43914",label:"",scene:{actors:[],bg:"bg/shop.png"},text:"lorem ipsum dolor sit amet and so on and so forth..."},45412:{actions:[{dest:"18822",label:"Inspection Complete"}],addsFlags:[],id:"45412",label:"Inspecting martini",scene:{actors:[{angle:0,img:"prop/martini.png",scale:.85,x:.55,y:.5}],bg:"bg/bar.png"},text:"That's a good-looking martini!"},45463:{actions:[{dest:"35747",label:"Next",needsFlags:[]},{dest:"38916",label:"Who done it?",needsFlags:["haveRatVision"]}],addsFlags:["haveHadFirstBusRide"],id:"45463",label:"Bus ride",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/rat/rat_1.png",needsFlags:["haveRatVision"],scale:.1,x:.26,y:.59},{angle:.06,animation:"hop_fast",img:"setting/bus.png",scale:.48,x:.52,y:.69}],bg:"bg/jungle.png"},text:"You ride the bus through the jungle and think you hear strange animal screams. You aren't sure who was hollerin'.",textVariants:[{flags:["haveHadFirstBusRide"],text:"You take the bus back to the city!"},{flags:["haveRatVision"],text:"You board the bus and hear horrific screaming once more!"}]},46692:{actions:[{dest:"9403",label:"Next",needsFlags:[]}],addsFlags:["hasDrink"],id:"46692",label:"bear shakes cosmopolitan",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/bear/shaking.png",scale:1,x:.6,y:.5}],bg:"bg/bar.png"},text:`"Coming right up!" The weird panda prepares the cosmopolitan faster than you can process what's happening.`},47187:{actions:[{dest:"24072",label:"Uh oh",needsFlags:[]}],addsFlags:["drunk"],id:"47187",label:"Drink Poison",scene:{actors:[{angle:0,img:"character/parrot/drinking.png",scale:.95,x:.495,y:.53},{angle:0,img:"character/rat/rat_1.png",needsFlags:["haveRatVision"],scale:.16,x:.875,y:.92},{angle:0,flipped:!0,img:"character/rat/rat_1.png",needsFlags:["haveRatVision"],scale:.175,x:.09211623800840896,y:.925},{angle:0,img:"character/rat/rat_2.png",needsFlags:["haveRatVision"],scale:.185,x:.69,y:.9}],bg:"bg/backAlley.png"},text:"You don't know what possessed you to do this, but you toss your head back and drink the substance. It tastes bitter and malty."},47389:{actions:[{dest:"27438",label:"Oh no",needsFlags:[]}],addsFlags:[],id:"47389",label:"Volcano Erruption",scene:{actors:[{angle:0,animation:"shake_fast",img:"setting/volcano/eruption.png",scale:1.1,x:.5,y:.5}],bg:"bg/volcano.png"},text:"The volcano erupts with the force of a thousand suns!"},47586:{actions:[],addsFlags:[],endgame:"win",id:"47586",label:"Hotel Egg Hatching 4",scene:{actors:[{angle:0,img:"character/egg/hatch4.png",scale:.5,x:.55,y:.55},{angle:0,img:"character/egg/hatch4lines.png",scale:1,x:.5,y:.45},{angle:1.01,animation:"spin_fast",img:"character/egg/hatch4shell.png",scale:.25,x:.25,y:.25}],bg:"bg/shop.png"},text:"A tiny bird is where the egg was just a second ago!!! The top of the egg shell goes flying and shatters on the hotel pool's tile wall."},47626:{actions:[{dest:"19418",label:"Bored, Put on Sunglasses",needsFlags:["haveGlasses","!haveRatVision"]},{dest:"18822",label:"Finish up and Leave Bathroom",needsFlags:[]},{dest:"87223",label:"Finish up and take the Rat Tunnel",needsFlags:["discoveredHole"]},{dest:"87223",label:"Finish up and follow the rats",needsFlags:["haveRatVision","!discoveredHole"]}],addsFlags:[],id:"47626",label:"Inside bathroom",scene:{actors:[{angle:0,animation:"still",flipped:!0,img:"prop/toilet.png",needsFlags:["!drunk"],scale:.69,x:.26,y:.5146708692031643},{angle:.025,flipped:!0,img:"prop/toilet.png",needsFlags:["drunk"],scale:.695,x:.265,y:.51},{angle:0,img:"character/parrot/neutral.png",scale:.385,x:.28,y:.39606551592520745},{angle:0,animation:"still",img:"setting/bathroom_counter.png",scale:.795,x:.72,y:.375},{angle:0,img:"character/rat/rat_1.png",needsFlags:["haveRatVision"],scale:.18,x:.865,y:.66},{angle:-.665,img:"character/rat/rat_3.png",needsFlags:["haveRatVision"],scale:.16,x:.56,y:.92},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.2,x:.435,y:.155}],bg:"bg/bathroom_tiling.png"},text:"You settle onto the toilet and go about your business.",textVariants:[{flags:["drunk"],text:"You settle onto the toilet and go about your business. You're not feelin so good."}]},47893:{actions:[{dest:"28006",label:"Next",needsFlags:[]}],addsFlags:["triedToBook"],id:"47893",label:"Trying to book",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.5,x:.15,y:.75},{angle:0,img:"character/hamster/neutral.png",scale:.2,x:.8,y:.35},{angle:0,animation:"still",img:"setting/hotel/desk.png",scale:.7,x:.65,y:.6157597293279373},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.185,x:.245,y:.43}],bg:"bg/hotelLobby.png"},text:`You ask the hamster if you can book a room. She looks miffed and says, "You're a parrot! You don't have any money! I can't give you a room!"`,textVariants:[{flags:["drunk"],text:`You ask the hamster if you can book a room. She looks concerned and a little sympathetic, "You don't look so good, but you don't have any money so I can't let you stay here."`}]},48059:{actions:[{dest:"87790",label:"inspection complete"}],addsFlags:["sawEgg"],id:"48059",label:"Egg inspection",scene:{actors:[{angle:0,img:"character/egg/closeup.png",scale:.9,x:.55,y:.5},{angle:0,img:"prop/sparkle2.png",scale:.2,x:.4,y:.5021982593403244},{angle:0,img:"prop/sparkle3.png",scale:.15,x:.65,y:.25},{angle:0,img:"prop/sparkle1.png",scale:.1,x:.55,y:.75}],bg:"bg/canopy.png"},text:"The egg is somewhat large and has a mottled appearance. The shell is thick and sturdy. Should be easy to travel with!"},48268:{actions:[{dest:"20907",label:"Back to the animals",needsFlags:[]}],addsFlags:["playedWithKoala"],id:"48268",label:"Play with koala",scene:{actors:[{angle:0,img:"character/koala/confused.png",scale:.5,x:.65,y:.5},{angle:0,img:"character/parrot/backWingsSpread.png",scale:.3,x:.35,y:.7},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.175,x:.34,y:.5}],bg:"bg/jungle.png"},text:"You approach the koala and try to initiate play. It looks sad and confused. It doesn't know how to play with birds."},48799:{actions:[{dest:"64563",label:"Next",needsFlags:[]}],id:"48799",label:"Therapy Mouse's Day",scene:{actors:[{angle:0,animation:"hop_slow",img:"character/mouse/neutral.png",scale:.735,x:.54,y:.555}],bg:"bg/backAlley.png"},text:`"I'm so glad you asked!" he squeals. "My day has been going well. I've found some really good food in various trash cans around the city." `,textVariants:[{flags:["discoveredHole"],text:`"I'm so glad you asked!" he squeals. "Well I got up around 6 AM to attend to my cult duties. I've been trying to infiltrate a very lively rat cult that's based in the sewers."`}]},49002:{actions:[],addsFlags:[],endgame:"lose",id:"49002",label:"Monkey attack 2",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/monkey/attackWithEgg.png",scale:.75,x:.5,y:.45},{angle:0,img:"character/egg/soup.png",scale:.1,x:.45,y:.9},{angle:0,img:"character/egg/brokenShellRight.png",scale:.1,x:.55,y:.9},{angle:0,img:"character/egg/brokenShellLeft.png",scale:.1,x:.35,y:.9},{angle:.46,animation:"shake_fast",img:"text/crack.png",scale:.3,x:.75,y:.85},{angle:0,animation:"hop_fast",img:"character/parrot/backWingsSpread.png",scale:.25,x:.15,y:.85},{angle:.06,img:"text/exclaim.png",scale:.15,x:.15,y:.65}],bg:"bg/jungle.png"},text:"The small man throws your egg onto the jungle floor as hard as it can, and it shatters, along with your hopes and dreams."},49719:{actions:[{dest:"47586",label:"Oh My!!!",needsFlags:[]}],addsFlags:[],id:"49719",label:"Hotel Egg Hatching 3",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/egg/hatch3.png",scale:.7,x:.5,y:.55}],bg:"bg/shop.png"},text:"What's that???"},49884:{actions:[{dest:"49719",label:"...",needsFlags:[]}],addsFlags:[],id:"49884",label:"Hotel Egg Hatching 2",scene:{actors:[{angle:0,animation:"shake_fast",img:"character/egg/hatch2.png",scale:.95,x:.55,y:.4681562441308301}],bg:"bg/shop.png"},text:"It's really getting up to mischief!!"},51350:{actions:[],addsFlags:[],endgame:"lose",id:"51350",label:"Mourning",scene:{actors:[{angle:0,img:"character/parrot/sad.png",scale:.5,x:.4,y:.45},{angle:0,img:"character/egg/soup.png",scale:.1,x:.75,y:.65},{angle:0,img:"character/egg/brokenShellLeft.png",scale:.15,x:.65,y:.65},{angle:0,img:"character/egg/brokenShellRight.png",scale:.15,x:.85,y:.65}],bg:"bg/dogPark.png"},text:"Your egg is broken forever, and you fear you can't move on."},53122:{actions:[{dest:"56699",label:'Say "Thanks!"',needsFlags:[]},{dest:"23991",label:"Flip Keycard Back Over",needsFlags:[]}],addsFlags:[],id:"53122",label:"Back of keycard",scene:{actors:[{angle:0,img:"prop/hotelKeyCard.png",scale:1,x:.55,y:.5}],bg:"bg/hotelLobby.png"},text:"You flip the keycard over. It has instructions for how to get into the pool area on it."},53381:{actions:[{dest:"85550",label:"Back to Dog Park",needsFlags:[]}],addsFlags:[],id:"53381",label:"Beagle accepts cosmo",scene:{actors:[{angle:0,img:"character/beagle/gifted.png",scale:.75,x:.4,y:.75},{angle:0,img:"prop/cosmopolitan.png",scale:.5,x:.85,y:.75}],bg:"bg/dogPark.png"},text:'"Oh my goodness, thank you so much!" the beagle exclaims as he takes the cosmopolitan from you. You wonder whether dogs actually drink.'},53838:{actions:[{dest:"75494",label:"Next",needsFlags:[]}],id:"53838",label:"Therapy Mouse Travel Advice",scene:{actors:[{angle:-.07,img:"character/mouse/explaining.png",scale:.235,x:.68,y:.51},{angle:0,img:"character/parrot/back.png",scale:.5,x:.235,y:.7},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.17,x:.34,y:.365}],bg:"bg/backAlley.png"},text:'He opens his small mouth again. "Digging through the city fountain always makes me happy. How could you be bored with that option?" He seems a little too simple for you. ',textVariants:[{flags:["haveGlasses","!haveRatVision"],text:'Therapy mouse opens his small mouth to speak again. "I sense you have found sunglasses," he says, having a strange sixth sense. '},{flags:["haveGlasses","haveRatVision"],text:`He opens his mouth to speak. "I sense you have discovered the ways of the rats. I'm surprised you're still bored. You can try looking for the owner of those sunglasses."`}]},55920:{actions:[],id:"55920",label:"",scene:{actors:[],bg:"bg/shop.png"},text:"lorem ipsum dolor sit amet and so on and so forth..."},56065:{actions:[{dest:"40581",label:"Next",needsFlags:[]}],addsFlags:["haveDaffodil","haveFlower"],id:"56065",label:"You take daffodil",scene:{actors:[{angle:0,img:"character/parrot/happy.png",needsFlags:[],scale:.4,x:.25,y:.7},{angle:-.89,img:"prop/daffodil.png",scale:.3,x:.2,y:.7},{angle:0,img:"character/possum/neutral.png",scale:.5,x:.65,y:.65},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.2,x:.335,y:.42}],bg:"bg/flower-shop.png"},text:"You take a daffodil. The daffodil smells amazing and you feel good with your choice.",textVariants:[{flags:["drunk"],text:"You take a daffodil. The daffodil smells nice."}]},56143:{actions:[{dest:"94630",label:"Next",needsFlags:[]}],addsFlags:[],id:"56143",label:"Therapy mouse scolds ",scene:{actors:[{angle:0,img:"character/mouse/explaining.png",scale:.885,x:.5666143813116338,y:.535}],bg:"bg/backAlley.png"},text:`"Oh no, I'm sorry to hear that," the mouse says. "Make sure you're getting plenty of rest and staying social."`,textVariants:[{flags:["drunk"],text:`"It seems you're a bit intoxicated. I suspect you drank something you shouldn't have," the mouse scolds.`}]},56699:{actions:[{dest:"59840",label:"Next",needsFlags:[]}],addsFlags:[],id:"56699",label:"Thanking Hamster",scene:{actors:[{angle:0,img:"character/hamster/happy.png",scale:1.13,x:.58,y:.635}],bg:"bg/hotelLobby.png"},text:'The hamster smiles. "Anytime, buddy!" '},57590:{actions:[{dest:"20907",label:"Back to Animals",needsFlags:[]}],addsFlags:[],id:"57590",label:"Done with Jaguar",scene:{actors:[{angle:0,animation:"shake_slow",img:"character/parrot/throwing.png",scale:.3,x:.28,y:.68},{angle:2.655,img:"character/egg/neutral.png",scale:.15,x:.115,y:.845},{angle:0,animation:"hop_slow",flipped:!1,img:"character/jaguar/neutral.png",scale:.445,x:.795,y:.335},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.175,x:.36,y:.45}],bg:"bg/jungle.png"},text:"The jaguar leaves to go take a nap. You're pooped!"},58101:{actions:[{dest:"18822",label:"Go back into bar",needsFlags:[]},{dest:"13631",label:"Wander city",needsFlags:[]}],addsFlags:[],id:"58101",label:"Rats Still",scene:{actors:[{angle:-1.535,img:"prop/poisonBottle.png",scale:.1,x:.945,y:.9},{angle:1.715,img:"prop/poisonBottle.png",scale:.1,x:.05,y:.935},{angle:0,animation:"still",img:"prop/drum_lower_left.png",needsFlags:[],scale:.25,x:.37,y:.85},{angle:0,img:"character/rat/drum_cirlce_rat_lowerLeft.png",needsFlags:[],scale:.29,x:.305,y:.855},{angle:0,animation:"still",img:"character/rat/rat_hands.png",needsFlags:[],scale:.14,x:.36,y:.825},{angle:0,img:"character/rat/drum_circle_rat_upperLeft.png",needsFlags:[],scale:.275,x:.385,y:.6},{angle:0,animation:"still",img:"prop/drum_lower_right.png",needsFlags:[],scale:.255,x:.68,y:.8503258298768752},{angle:0,img:"text/music_notes_rest.png",needsFlags:[],scale:.23,x:.53,y:.24},{angle:0,animation:"still",flipped:!0,img:"character/rat/rat_hands.png",needsFlags:[],scale:.135,x:.69,y:.785},{angle:0,img:"character/rat/drum_circle_rat_lowerRight.png",needsFlags:[],scale:.31,x:.745,y:.815},{angle:.2,animation:"still",img:"prop/drum_upper_right.png",needsFlags:[],scale:.205,x:.62,y:.62},{angle:0,img:"character/rat/drum_circle_rat_upperRight.png",needsFlags:[],scale:.23,x:.685,y:.555}],bg:"bg/backAlley.png"},text:"The rats seem to stop just as fast as they started. They're waiting for something to appear. Maybe they'll try again later?",textVariants:[]},58259:{actions:[{dest:"45412",label:"Inspect martini",needsFlags:[]},{dest:"16163",label:"Thank him",needsFlags:[]}],addsFlags:["haveMartini"],id:"58259",label:"Bear pours martini",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.4,x:.1,y:.8},{angle:0,img:"setting/barCounter.png",scale:.6,x:.5738327421943588,y:.75},{angle:0,img:"character/bear/fillingMartini.png",scale:.5,x:.55,y:.25},{angle:0,img:"prop/martini.png",scale:.1,x:.65,y:.45},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.08,y:.5937436697826981}],bg:"bg/bar.png"},text:'The strange panda carefully poured the martini into the glass. Gotta be careful when everything is constantly shaking. "There ya go, hope your friend likes it!"'},59840:{actions:[{dest:"47893",label:"Ask to book your stay",needsFlags:["!triedToBook"]},{dest:"82129",label:`Ask her, "Are you the beagle's girlfriend?"`,needsFlags:["talkedToBeagle","!askedGFQuestion"]},{dest:"22841",label:"Go to Hotel Pool",needsFlags:["haveKeycard"]},{dest:"95956",label:"Give her the dog bone from the beagle",needsFlags:["askedGFQuestion","!haveGivenBone","talkedToBeagle","haveDogBone"]},{dest:"13631",label:"Exit Hotel",needsFlags:[]}],addsFlags:["haveSeenHotel"],id:"59840",label:"Inside hotel",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.5,x:.1,y:.75},{angle:0,img:"character/hamster/neutral.png",scale:.105,x:.885,y:.675},{angle:.06,animation:"still",img:"setting/hotel/desk.png",scale:.33,x:.81,y:.78},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.215,x:.22,y:.45}],bg:"bg/hotelLobby.png"},text:"You enter the hotel and find a hamster behind the desk.",textVariants:[{flags:["askedGFQuestion","haveSeenHotel"],text:"You see the beagle's girlfriend behind the desk. What will you do next?"},{flags:["haveSeenHotel"],text:"You see a hamster behind the desk. What will you do next?"}]},61921:{actions:[{dest:"82006",label:"Wander city",needsFlags:[]},{dest:"18822",label:"Go inside",needsFlags:[]},{dest:"91404",label:"Explore back alley",needsFlags:[]}],addsFlags:["haveSeenBar"],id:"61921",label:"Bar Exterior",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.3,x:.05,y:.8},{angle:.06,animation:"still",img:"setting/pub.png",scale:.955,x:.515,y:.41},{angle:0,animation:"hop_slow",img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.045,y:.66}],bg:"bg/city.png"},text:"You arrived to the bar! This place seems a little shady.",textVariants:[{flags:["drunk","haveSeenBar"],text:"You arrived to the bar! This place still seems shady. You also feel woozy."},{flags:["haveSeenBar"],text:"You arrived to the bar! This place still seems shady."}]},62947:{actions:[{dest:"85550",label:"Back to Dog Park",needsFlags:[]}],addsFlags:["beagleRejected"],id:"62947",label:"Rejected Beagle",scene:{actors:[{angle:0,animation:"still",img:"character/beagle/sad.png",scale:.96,x:.59,y:.67}],bg:"bg/dogPark.png"},text:"You decline the beagle's request. He looks a little dejected."},63647:{actions:[{dest:"85550",label:"Back to dog park",needsFlags:[]}],id:"63647",label:"Bird says you're welcome",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/parrot/happy2.png",scale:.38,x:.27,y:.57},{angle:0,img:"character/beagle/neutral.png",scale:.5,x:.705,y:.555}],bg:"bg/dogPark.png"},text:`"You're very welcome!" you say to the beagle.`},64042:{actions:[{dest:"90619",label:"Return to the jungle",needsFlags:[]},{dest:"74823",label:"Eavesdrop on the weird bird",needsFlags:[]}],addsFlags:["haveBeenToKavaBar"],id:"64042",label:"Kava Bar Hub",scene:{actors:[{angle:0,flipped:!0,img:"character/woodpecker.png",scale:.235,x:.855,y:.57},{angle:0,img:"character/flamingo.png",scale:.355,x:.505,y:.575},{angle:0,flipped:!0,img:"character/toucan.png",scale:.185,x:.65,y:.61},{angle:0,img:"prop/kava_juice_cocktail.png",scale:.1,x:.39,y:.485},{angle:0,flipped:!0,img:"character/dunnock/dunnock_talking.png",scale:.5,x:.425,y:.705},{angle:0,img:"prop/kava_juice.png",scale:.1,x:.2,y:.56},{angle:0,img:"prop/kava_juice_cocktail.png",scale:.1,x:.785,y:.525},{angle:0,img:"prop/kava_juice_cocktail.png",scale:.1,x:.735,y:.515}],bg:"bg/kavaBar.png"},text:"You enter the kava bar for the first time. Immediately, your attention is grabbed by a tailless bird with.. well.. a tail! It makes you strangely uncomfortable! ",textVariants:[{flags:["haveBeenToKavaBar"],text:"It's a little loopy but still kinda nice in here. What will you do next?"}]},64563:{actions:[{dest:"94630",label:"Next",needsFlags:[]}],id:"64563",label:"Therapy Mouse's Day 2",scene:{actors:[{angle:-.125,img:"character/mouse/explaining.png",scale:1.52,x:.5737720617455232,y:.76}],bg:"bg/backAlley.png"},text:`"I've also have been noticing a lot of rats around lately. They always know what's up."`,textVariants:[{flags:["discoveredHole"],text:`"t's a difficult task- rats are very attuned to whether you're a mouse or rat." You blink at him. You aren't quite sure if you know the difference between a rat and a mouse.`}]},64647:{actions:[{dest:"2739",label:'Say "Sure, what did you want to tell me?"',needsFlags:[]},{dest:"20907",label:'Say "No Thanks"',needsFlags:[]}],addsFlags:["talkedToKoala"],id:"64647",label:"Koala Cult Talk",scene:{actors:[{angle:0,img:"character/koala/talking.png",scale:.75,x:.5,y:.7}],bg:"bg/jungle.png"},text:`You decide to see what the koala has to say. It opens its mouth and speaks in a high, raspy voice. "Greetings! I haven't seen you around this part of the jungle. Would you care to hear about our savior, Azathoth?" You feel a bit flustered and awkward.`},64950:{actions:[{dest:"90619",label:"Next",needsFlags:[]}],addsFlags:[],id:"64950",label:"Discover jungle path",scene:{actors:[{angle:0,img:"character/parrot/flying.png",scale:.325,x:.455,y:.48}],bg:"bg/jungle.png"},text:"Wow! You've arrived back to the jungle!"},64965:{actions:[{dest:"47187",label:"Drink it",needsFlags:[]},{dest:"91404",label:"But it back down",needsFlags:[]}],addsFlags:[],id:"64965",label:"Bottle of poison",scene:{actors:[{angle:0,img:"prop/poisonBottle.png",scale:1.07,x:.5,y:.51}],bg:"bg/backAlley.png"},text:"You pick up one of the bottles and look at it closely. It appears to maybe be an alcoholic beverage? You're a bird so you can't read."},65138:{actions:[{dest:"94709",label:"Agree to his terms",needsFlags:["!termsAgreedTo"]},{dest:"18822",label:"Refuse his terms",needsFlags:["!termsAgreedTo"]},{dest:"91471",label:"Martini",needsFlags:["termsAgreedTo"]},{dest:"46692",label:"Cosmopolitan",needsFlags:["termsAgreedTo"]}],addsFlags:[],id:"65138",label:"Bear responds to drink request",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.35,x:.15,y:.7819893087087724},{angle:0,animation:"still",img:"setting/barCounter.png",scale:.55,x:.6,y:.65},{angle:0,img:"character/bear/neutral.png",scale:.5,x:.7,y:.2},{angle:.48,animation:"hop_slow",img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.195,y:.555}],bg:"bg/bar.png"},text:`"You're a bird! You're not supposed to drink!" the weird panda says to you. "But I can give you a drink as long as you promise you're giving it to someone else who is of drinking age."`,textVariants:[{flags:["termsAgreedTo"],text:"Sure thing! What can I get you?"}]},68361:{actions:[{dest:"58101",label:"Next",needsFlags:[]}],addsFlags:[],id:"68361",label:"Drum Circle 4",scene:{actors:[{angle:-1.535,img:"prop/poisonBottle.png",scale:.1,x:.945,y:.9},{angle:1.715,img:"prop/poisonBottle.png",scale:.1,x:.05,y:.935},{angle:0,animation:"still",img:"prop/drum_lower_left.png",needsFlags:[],scale:.25,x:.37,y:.85},{angle:0,img:"character/rat/drum_cirlce_rat_lowerLeft.png",needsFlags:[],scale:.29,x:.305,y:.855},{angle:0,animation:"hop_fast",img:"character/rat/rat_hands.png",needsFlags:[],scale:.14,x:.36,y:.825},{angle:0,animation:"hop_fast",img:"character/rat/drum_circle_rat_upperLeft.png",needsFlags:[],scale:.275,x:.385,y:.6},{angle:0,animation:"still",img:"prop/drum_lower_right.png",needsFlags:[],scale:.255,x:.68,y:.8503258298768752},{angle:0,animation:"hop_fast",img:"text/music_notes_4.png",needsFlags:[],scale:.26,x:.495,y:.24},{angle:0,animation:"hop_fast",flipped:!0,img:"character/rat/rat_hands.png",needsFlags:[],scale:.135,x:.69,y:.785},{angle:0,img:"character/rat/drum_circle_rat_lowerRight.png",needsFlags:[],scale:.31,x:.745,y:.815},{angle:.2,animation:"still",img:"prop/drum_upper_right.png",needsFlags:[],scale:.205,x:.62,y:.62},{angle:0,animation:"hop_fast",img:"character/rat/drum_circle_rat_upperRight.png",needsFlags:[],scale:.23,x:.685,y:.555}],bg:"bg/backAlley.png"},text:"Their drumming is ear-splitting! It seems almost like they're trying to summon something.",textVariants:[]},69396:{actions:[{dest:"99585",label:"Next",needsFlags:[]}],addsFlags:["haveMetTherapyMouse"],id:"69396",label:"Meet therapy mouse",scene:{actors:[{angle:0,img:"character/mouse/neutral.png",scale:1.03,x:.535,y:.505}],bg:"bg/backAlley.png"},text:`You look down and behold a small mouse on the ground. "IIIII'm therapy mouse," he starts in a small voice. "I hang  around outside this bar and check on people as they leave because some people really need it."`,textVariants:[{flags:["drunk"],text:`You look down and behold a small mouse on the ground. "IIIII'm therapy mouse," he starts in a small voice. "I hang around outside this bar and check on people as they leave because some people really need it." His eyes narrow. "That includes you too, it seems."`}]},69799:{actions:[{dest:"85914",label:"Next",needsFlags:[]}],addsFlags:[],id:"69799",label:"Rat Leader 2",scene:{actors:[{angle:0,animation:"hop_slow",img:"character/rat/leader_talking.png",scale:1.055,x:.555,y:.575}],bg:"bg/insideSewer.png"},text:'"I have received a download from a great high spirit. It is of greatest importance that we spread the news: We must love others, nurture others, and forgive others." '},71284:{actions:[{dest:"87790",label:"Take a Deep Breath",needsFlags:[]}],addsFlags:[],id:"71284",label:"Nest Opening Scene",scene:{actors:[{angle:.06,img:"character/parrot/happy.png",scale:.4,x:.15,y:.4},{angle:0,img:"character/egg/neutral2.png",scale:.1,x:.3,y:.5},{angle:0,animation:"still",img:"setting/nest.png",scale:.55,x:.5,y:.7}],bg:"bg/canopy.png"},text:"You wake up and it's a bright, beautiful day! You find an egg next to you and you aren't sure where it came from. You must take it on today's journey but be careful! You only get one."},73855:{actions:[{dest:"85550",label:"Back to Dog Park",needsFlags:[]}],addsFlags:[],id:"73855",label:"Beagle accepts martini",scene:{actors:[{angle:0,img:"character/beagle/gifted.png",scale:.75,x:.3,y:.7},{angle:0,img:"prop/martini.png",scale:.5,x:.75,y:.75}],bg:"bg/dogPark.png"},text:'"Oh my goodness, thank you so much!" the beagle exclaims as he takes the martini from you. You wonder whether dogs actually drink.'},74372:{actions:[{dest:"84301",label:"Look for rocks to make a sacrifice",needsFlags:["canThrowRocks"]},{dest:"34620",label:"Cool off in a hot spring",needsFlags:[]},{dest:"90619",label:"Back to the Jungle",needsFlags:[]}],addsFlags:[],id:"74372",label:"Volcano visit",scene:{actors:[{angle:0,img:"setting/volcano/smoking.png",scale:.95,x:.65,y:.5596831039663354},{angle:0,img:"character/parrot/bindle.png",scale:.15,x:.4,y:.75},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.445,y:.63}],bg:"bg/volcano.png"},text:"You've reached the volcano. You can't get the koala's words out of your head and you wonder about the nature of existence.",textVariants:[{flags:["!canThrowRocks"],text:"You've reached the volcano! There isn't much to do here."}]},74823:{actions:[{dest:"4219",label:"What is he saying",needsFlags:[]}],id:"74823",label:"Dunnot talking 1",scene:{actors:[{angle:-.17,flipped:!0,img:"character/dunnock/dunnock_talking.png",scale:1.14,x:.555,y:.535}],bg:"bg/kavaBar.png"},text:'"If you turn this calculation around, you can really consider the infinite consciousness of the cell." Oh no, what did you walk in on?'},75362:{actions:[{dest:"7769",label:"Next",needsFlags:[]}],addsFlags:["discoverCult"],id:"75362",label:"Cult opening scene",scene:{actors:[{angle:.035,animation:"still",img:"prop/sconce.png",scale:.25,x:.845,y:.21597782101531282},{angle:0,img:"prop/candle_1.png",scale:.12,x:.785,y:.22},{angle:0,img:"prop/candle_2.png",scale:.11,x:.895,y:.23},{angle:0,animation:"shake_slow",img:"character/rat/leader_neutral.png",scale:.185,x:.525,y:.53},{angle:0,img:"character/rat/rat_side.png",scale:.2,x:.345,y:.485},{angle:0,img:"character/rat/rat_side.png",scale:.215,x:.37,y:.655},{angle:-.035,img:"character/rat/rat_side.png",scale:.175,x:.415,y:.42},{angle:0,img:"character/parrot/in-transit.png",scale:.325,x:.19623846852051263,y:.971976817210723},{angle:0,animation:"still",img:"text/cult_writing.png",scale:.105,x:.515,y:.0806238762464404},{angle:0,animation:"still",img:"text/cult_logo.png",scale:.155,x:.93,y:.125},{angle:0,flipped:!0,img:"character/rat/rat_side.png",scale:.15,x:.625,y:.415},{angle:0,flipped:!0,img:"character/rat/rat_side.png",scale:.2,x:.685,y:.47},{angle:0,flipped:!0,img:"character/rat/rat_side.png",scale:.25,x:.655,y:.585},{angle:0,img:"character/rat/back_1.png",scale:.215,x:.5,y:.72},{angle:0,img:"character/rat/standing.png",scale:.1,x:.52,y:.365},{angle:0,animation:"still",img:"prop/sconce.png",scale:.215,x:.14007765787037174,y:.22},{angle:0,img:"prop/candle_3.png",scale:.115,x:.185,y:.22},{angle:0,img:"prop/candle_1.png",scale:.125,x:.09,y:.21}],bg:"bg/insideSewer.png"},text:"You arrive to the strangest thing you've seen yet. A small rat, shrouded in a strange scarf, is surrounded by chanting rats. You can't quite make out what they're saying so you get closer."},75494:{actions:[{dest:"94630",label:"Next",needsFlags:["haveGlasses","!haveRatVision"]},{dest:"84892",label:"Next",needsFlags:["haveRatVision","haveGlasses"]},{dest:"94630",label:"Next",needsFlags:["!haveRatVision","!haveGlasses"]}],id:"75494",label:"Therapy Mouse Travel Advice 2",scene:{actors:[{angle:0,img:"character/mouse/explaining.png",scale:.99,x:.6,y:.53}],bg:"bg/backAlley.png"},text:`"Well," he interrupts your thoughts. Perhaps he saw you looking bored and disappointed. "There are also several lively cults around these parts. They're always looking for new members." This comment seems very strange to you.`,textVariants:[{flags:["haveGlasses","!haveRatVision"],text:'"Once you get the opportunity, you should put them on. I promise you will be bored no longer." He seems a little sinister. You have no idea what he means.'},{flags:["haveRatVision","haveGlasses"],text:'"...Whoever it is will have mysteries of the universe to tell you about. They far exceed my simple mouse brain." '}]},75760:{actions:[{dest:"85550",label:"Back to Dog Park",needsFlags:[]}],addsFlags:[],id:"75760",label:"Dachshund rejects cosmo",scene:{actors:[{angle:0,animation:"still",img:"character/dachshund/gifted.png",scale:.65,x:.4,y:.75},{angle:0,img:"prop/cosmopolitan.png",scale:.5,x:.85,y:.75}],bg:"bg/dogPark.png"},text:`The dachshund looks sad and confused. "I'm a dog, I don't drink." You feel a little awkward.`},78527:{actions:[{dest:"85550",label:"Back to Dog Park",needsFlags:[]}],addsFlags:["haveDogBone"],id:"78527",label:"Dog Bone Acquired",scene:{actors:[{angle:0,img:"prop/bonePresent.png",scale:.8,x:.5,y:.55}],bg:"bg/dogPark.png"},text:`The beagle says, "Excellent! Please bring her this dog bone, it's her favorite!" You take the present.`},78752:{actions:[{dest:"49002",label:"Next"}],addsFlags:[],id:"78752",label:"Monkey attack 1",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/monkey/attack.png",scale:.9,x:.6,y:.5},{angle:0,animation:"shake_fast",img:"character/parrot/back.png",scale:.25,x:.15,y:.836200118627116},{angle:0,img:"text/exclaim.png",scale:.2,x:.15,y:.5682415188024507}],bg:"bg/jungle.png"},text:"You wander to the small man and attempt to play with it. It screams out an ear-splitting sound and steals your egg!"},79292:{actions:[{dest:"68361",label:"Next",needsFlags:[]}],addsFlags:[],id:"79292",label:"Drum Circle 3",scene:{actors:[{angle:-1.535,img:"prop/poisonBottle.png",scale:.1,x:.945,y:.9},{angle:1.715,img:"prop/poisonBottle.png",scale:.1,x:.05,y:.935},{angle:0,animation:"still",img:"prop/drum_lower_left.png",needsFlags:[],scale:.25,x:.37,y:.85},{angle:0,img:"character/rat/drum_cirlce_rat_lowerLeft.png",needsFlags:[],scale:.29,x:.305,y:.855},{angle:0,animation:"hop_fast",img:"character/rat/rat_hands.png",needsFlags:[],scale:.14,x:.36,y:.825},{angle:0,img:"character/rat/drum_circle_rat_upperLeft.png",needsFlags:[],scale:.275,x:.385,y:.6},{angle:0,animation:"still",img:"prop/drum_lower_right.png",needsFlags:[],scale:.255,x:.68,y:.8503258298768752},{angle:0,img:"text/music_notes_3.png",needsFlags:[],scale:.32,x:.53,y:.24},{angle:0,animation:"hop_fast",flipped:!0,img:"character/rat/rat_hands.png",needsFlags:[],scale:.135,x:.69,y:.785},{angle:0,img:"character/rat/drum_circle_rat_lowerRight.png",needsFlags:[],scale:.31,x:.745,y:.815},{angle:.2,animation:"still",img:"prop/drum_upper_right.png",needsFlags:[],scale:.205,x:.62,y:.62},{angle:0,img:"character/rat/drum_circle_rat_upperRight.png",needsFlags:[],scale:.23,x:.685,y:.555}],bg:"bg/backAlley.png"},text:"Oh wow, they're really reving up! ",textVariants:[]},79680:{actions:[{dest:"4443",label:"What is your egg doing!",needsFlags:[]}],addsFlags:[],id:"79680",label:"Hotel bath",scene:{actors:[{angle:0,img:"character/parrot/bath.png",scale:.5,x:.3,y:.4},{angle:0,img:"prop/bathWater.png",scale:.5,x:.5,y:.75},{angle:0,img:"character/egg/bath.png",scale:.1,x:.45,y:.65}],bg:"bg/shop.png"},text:"You and your egg sink into the warm water and rest. It feels amazing!"},82006:{actions:[{dest:"69396",label:"Inspect",needsFlags:[]},{dest:"13631",label:"Shrug it off and wander the city",needsFlags:[]}],addsFlags:["!haveMetTherapyMouse"],id:"82006",label:"Kick therapy mouse",scene:{actors:[{angle:0,img:"character/parrot/backWingsSpread.png",scale:.5,x:.315,y:.73},{angle:0,animation:"spin_fast",img:"character/mouse/kicked.png",scale:.1,x:.66,y:.505},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.19,x:.325,y:.395}],bg:"bg/backAlley.png"},text:"You go out the back door of the bar. Oh wow what was that! You kicked something on your way out!",textVariants:[{flags:["drunk"],text:"Oh wow what was that! You kicked something on your way out of the bar! Or did you just imagine it?"}]},82129:{actions:[{dest:"59840",label:"Next",needsFlags:[]}],addsFlags:["askedGFQuestion"],id:"82129",label:"Ask hamster for info",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.5,x:.1,y:.75},{angle:0,img:"character/hamster/neutral.png",scale:.25,x:.75,y:.45},{angle:0,animation:"still",img:"setting/hotel/desk.png",scale:.65,x:.6,y:.7},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.185,x:.23,y:.465}],bg:"bg/shop.png"},text:`You screw up the courage to ask a somewhat embarrassing question. "Are you the beagle's girlfriend?" The hamster smiles and says, "Oh yes!" You are shocked. "Then how do you guys-" you stop yourself. There's an awkward pause.`,textVariants:[{flags:["drunk"],text:`You screw up the courage to ask a somewhat embarrassing question. "Are you the beagle's girlfriend?" The hamster smiles and says, "Oh yes!" You are shocked. "Then how do you guys-" you're slurring a little and you trail off.`}]},84301:{actions:[{dest:"18968",label:"Throw them in! Complete the sacrifice!",needsFlags:[]},{dest:"74372",label:"Put the rocks down and step Away From The Edge",needsFlags:[]}],addsFlags:[],id:"84301",label:"Rock Pile",scene:{actors:[{angle:0,img:"prop/jungleRocks.png",scale:.65,x:.5,y:.6}],bg:"bg/volcano.png"},text:"You manage to locate some rocks and you pick them up. The volcano is smoking and you second-guess whether it's a good idea to throw them in."},84892:{actions:[{dest:"94630",label:"Next",needsFlags:[]}],addsFlags:["kavaBarOpen"],id:"84892",label:"Kava Bar Opening Tag",scene:{actors:[{angle:0,animation:"spin_slow",img:"character/parrot/neutral.png",scale:.5,x:.41,y:.595}],bg:"bg/backAlley.png"},text:"You feel something calling to you from the jungle and know that you must go back there."},85368:{actions:[{dest:"12073",label:"Talk to beagle",needsFlags:["!talkedToBeagle"]},{dest:"85550",label:"Next",needsFlags:[]},{dest:"12073",label:"Talk to beagle again",needsFlags:["talkedToBeagle"]}],addsFlags:["haveMetBeagle"],id:"85368",label:"Playing with beagle",scene:{actors:[{angle:0,img:"character/parrot/happy2.png",needsFlags:["!drunk"],scale:.2,x:.3,y:.6},{angle:0,img:"character/egg/neutral2.png",scale:.1,x:.2,y:.7},{angle:0,img:"character/beagle/playing.png",scale:.3,x:.45,y:.55},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.325,y:.45},{angle:0,img:"character/parrot/neutral.png",needsFlags:["drunk"],scale:.155,x:.305,y:.595}],bg:"bg/dogPark.png"},text:"You and the beagle have a wonderful time playing together!",textVariants:[{flags:["drunk"],text:"The beagle is a lot of fun to be around. You do your best to play but you're a bit uncoordinated."}]},85550:{actions:[{dest:"85368",label:"Play with beagle",needsFlags:[]},{dest:"31710",label:"Play with dachshund",needsFlags:[]},{dest:"11635",label:"Play with doberman",needsFlags:[]},{dest:"1826",label:"Offer dachshund martini",needsFlags:["haveMetDachshund","haveMartini"]},{dest:"75760",label:"Offer dachshund cosmo",needsFlags:["haveMetDachshund","haveCosmo"]},{dest:"73855",label:"Offer beagle a martini",needsFlags:["haveMartini","haveMetBeagle"]},{dest:"53381",label:"Offer beagle a cosmo",needsFlags:["haveCosmo","haveMetBeagle"]},{dest:"13631",label:"Return to wandering city",needsFlags:[]}],addsFlags:["haveBeenToDogPark"],id:"85550",label:"Dog Park",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.2,x:.2061067679975821,y:.7864465120197012},{angle:0,img:"character/doberman/neutral.png",scale:.5,x:.85,y:.615},{angle:0,img:"character/dachshund/neutral.png",scale:.15,x:.58,y:.63},{angle:0,img:"character/beagle/neutral.png",scale:.2,x:.4,y:.75},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.215,y:.625}],bg:"bg/dogPark.png"},text:"You seem to have found some dogs at the dog park! The dachshund and beagle seem friendly enough, but you get a shiver down your spine when you see the doberman.",textVariants:[{flags:["haveBeenToDogPark"],text:"The day is young! What will you do at the dog park next?"}]},85914:{actions:[{dest:"29900",label:"What is happening",needsFlags:[]}],addsFlags:[],id:"85914",label:"Rat Leader 3",scene:{actors:[{angle:0,animation:"hop_fast",img:"character/rat/leader_talking.png",scale:1.055,x:.555,y:.575},{angle:0,animation:"hop_fast",img:"prop/mask_1.png",scale:.27,x:.705,y:.435}],bg:"bg/insideSewer.png"},text:'"Now rise with me!!!! Put on your masks of the spirit!!!!"'},85940:{actions:[{dest:"2839",label:"Next",needsFlags:[]}],addsFlags:[],id:"85940",label:"Egg Hatching 2",scene:{actors:[{angle:0,animation:"shake_fast",img:"character/egg/hatch2.png",scale:.95,x:.55,y:.4681562441308301}],bg:"bg/shop.png"},text:"The cracks begin to spread!"},86146:{actions:[{dest:"91030",label:"Sunflowers",needsFlags:[]},{dest:"22555",label:"Lilac",needsFlags:[]},{dest:"56065",label:"Daffodil",needsFlags:[]},{dest:"40581",label:"Change your mind",needsFlags:[]}],addsFlags:[],id:"86146",label:"Flower Purchase",scene:{actors:[{angle:0,img:"prop/sunflowers.png",scale:.5,x:.2,y:.45},{angle:0,img:"prop/lilac.png",scale:.6,x:.45,y:.45},{angle:0,img:"prop/daffodil.png",scale:.5,x:.75,y:.45},{angle:0,img:"character/rat/rat_2.png",needsFlags:["haveRatVision"],scale:.165,x:.925,y:.8315672297093334},{angle:.465,animation:"wobble_fast",flipped:!0,img:"character/possum/talking.png",needsFlags:["haveFlower"],scale:.53,x:1,y:1}],bg:"bg/flower-shop.png"},text:'"Sure," the possum says, "I have sunflowers, lilacs, and daffodils in stock. Which will it be?" You look them over hard.',textVariants:[{flags:["haveFlower"],text:'"Gettin greedy," the possum teases with a laugh, "which additional flower would you like?"'},{flags:["haveFlower","askForPossumName"],text:'"Gettin greedy," Pat teases with a laugh, "which additional flower would you like?"'},{flags:["askForPossumName"],text:'"Sure," Pat says, "I have sunflowers, lilacs, and daffodils in stock. Which will it be?" You look them over hard.'}]},87223:{actions:[{dest:"37515",label:"Next",needsFlags:[]}],addsFlags:["discoveredHole"],id:"87223",label:"Hole travel",scene:{actors:[{angle:0,img:"character/rat/rat_in_tunnel.png",scale:.985,x:.495,y:.54}],bg:"bg/gray.png"},text:"You follow the rats through the hole!"},87790:{actions:[{dest:"48059",label:"Inspect Egg",needsFlags:["!sawEgg"]},{dest:"90619",label:"Climb Down Tree",needsFlags:[]}],addsFlags:[],id:"87790",label:"resting in nest",scene:{actors:[{angle:0,img:"setting/nest.png",scale:.6,x:.5,y:.55},{angle:0,img:"character/parrot/happy.png",scale:.25,x:.2,y:.4},{angle:0,img:"character/egg/medium.png",scale:.1,x:.35,y:.45},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.18,x:.265,y:.19}],bg:"bg/canopy.png"},text:"You settle into the nest with your egg and take a short nap. "},87811:{actions:[{dest:"57590",label:"Next",needsFlags:[]}],addsFlags:["playedWithJaguar"],id:"87811",label:"Playing with jaguar",scene:{actors:[{angle:0,img:"character/jaguar/playing.png",scale:.9,x:.7,y:.5},{angle:0,img:"character/parrot/happy.png",scale:.5,x:.25,y:.7},{angle:0,img:"character/egg/neutral.png",scale:.1,x:.35,y:.9},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.21,x:.405,y:.44}],bg:"bg/jungle.png"},text:"The jaguar is really just kind of a large house cat- you play with it and have a nice time.",textVariants:[{flags:["drunk"],text:"The jaguar is really just kind of a large house cat- you play with it and have a nice time despite feeling a bit nauseous."}]},90619:{actions:[{dest:"20907",label:"Visit animals again",needsFlags:["metAnimals"]},{dest:"74372",label:"Go to volcano",needsFlags:[]},{dest:"87790",label:"Return to the nest",needsFlags:[]},{dest:"23888",label:"Look for animals",needsFlags:["!metAnimals"]},{dest:"45463",label:"Go to city",needsFlags:[]},{dest:"64042",label:"Go to kava bar",needsFlags:["kavaBarOpen"]}],addsFlags:[],id:"90619",label:"Jungle Hub",scene:{actors:[{angle:0,img:"character/parrot/bindle.png",scale:.5,x:.4,y:.6},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.225,x:.58,y:.31},{angle:0,img:"character/rat/rat_1.png",needsFlags:["haveRatVision","drunk"],scale:.22,x:.845,y:.9},{angle:0,flipped:!0,img:"prop/mask_side.png",needsFlags:["drunk","haveRatVision"],scale:.115,x:.8,y:.845},{angle:0,animation:"still",img:"prop/jungle_plants/tree_trunk.png",scale:1.365,x:.845,y:.485},{angle:0,animation:"still",img:"prop/jungle_plants/vines.png",scale:1.55,x:.185,y:.4267470347022603},{angle:0,img:"prop/jungle_plants/flower.png",scale:.32,x:.21,y:.165},{angle:0,img:"prop/jungle_plants/monstera.png",scale:.305,x:.285,y:.87},{angle:0,img:"prop/jungle_plants/philodendron.png",scale:.695,x:1,y:.34}],bg:"bg/jungle.png"},text:"You wander the jungle and wonder where you should go.",textVariants:[{flags:["drunk"],text:"You wander the jungle and wonder where you should go. You feel a little disoriented."}]},91030:{actions:[{dest:"43130",label:"Oh no!",needsFlags:[]}],addsFlags:["haveSunflowers","haveFlower"],id:"91030",label:"Sunflower sneeze",scene:{actors:[{angle:0,animation:"shake_slow",img:"character/parrot/sneeze.png",scale:.5,x:.25,y:.65},{angle:0,animation:"spin_slow",img:"prop/pollenFlower1.png",scale:.2,x:.5,y:.65},{angle:0,animation:"spin_slow",img:"prop/pollenFlower2.png",scale:.25,x:.75,y:.7},{angle:1.01,animation:"spin_fast",img:"character/egg/neutral3.png",scale:.1,x:.55,y:.48}],bg:"bg/flower-shop.png"},text:"You take the sunflowers. The possum doesn't seem to care about you paying so you start to head out the door. All of a sudden, your nose tickles and you sneeze! Your egg goes flying!"},91404:{actions:[{dest:"64965",label:"Pick up one of the bottles",needsFlags:[]},{dest:"61921",label:"Leave the back alley",needsFlags:[]},{dest:"20169",label:"Continue watching the drum circle",needsFlags:["haveRatVision"]}],addsFlags:["haveSeenBackAlley"],id:"91404",label:"Bar back alley",scene:{actors:[{angle:0,img:"character/parrot/backWingsSpread.png",scale:.14,x:.12,y:.905},{angle:-1.535,img:"prop/poisonBottle.png",scale:.1,x:.945,y:.9},{angle:1.715,img:"prop/poisonBottle.png",scale:.1,x:.05,y:.935},{angle:0,animation:"hop_slow",img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.12,y:.79},{angle:0,animation:"still",img:"prop/drum_lower_left.png",needsFlags:["haveRatVision"],scale:.25,x:.37,y:.85},{angle:0,img:"character/rat/drum_cirlce_rat_lowerLeft.png",needsFlags:["haveRatVision"],scale:.29,x:.305,y:.855},{angle:0,animation:"hop_slow",img:"character/rat/rat_hands.png",needsFlags:["haveRatVision"],scale:.14,x:.36,y:.825},{angle:0,img:"character/rat/drum_circle_rat_upperLeft.png",needsFlags:["haveRatVision"],scale:.275,x:.385,y:.6},{angle:0,img:"text/music_notes_1.png",needsFlags:["!haveRatVision"],scale:.1,x:.54,y:.655},{angle:0,animation:"still",img:"prop/drum_lower_right.png",needsFlags:["haveRatVision"],scale:.255,x:.68,y:.8503258298768752},{angle:0,img:"text/music_notes_1.png",needsFlags:["haveRatVision"],scale:.23,x:.53,y:.24},{angle:0,animation:"hop_slow",flipped:!0,img:"character/rat/rat_hands.png",needsFlags:["haveRatVision"],scale:.135,x:.69,y:.785},{angle:0,img:"character/rat/drum_circle_rat_lowerRight.png",needsFlags:["haveRatVision"],scale:.31,x:.745,y:.815},{angle:.2,animation:"still",img:"prop/drum_upper_right.png",needsFlags:["haveRatVision"],scale:.205,x:.62,y:.62},{angle:0,img:"character/rat/drum_circle_rat_upperRight.png",needsFlags:["haveRatVision"],scale:.23,x:.685,y:.555}],bg:"bg/backAlley.png"},text:"You find a spooky alley behind the bar. It gives you the creeps. You hear faint chanting and drumming but don't see anything other than mysterious bottles strewn about.",textVariants:[{flags:["haveWatchedDrumRoutine"],text:"You return to the back alley and the rats are at it again!"},{flags:["haveRatVision","!haveSeenBackAlley"],text:"You find a spooky alley behind the bar and you behold a bizarre scene. Rats seem to have formed a drum circle and are chanting in a crazed way."},{flags:["haveSeenBackAlley","haveRatVision"],text:"You return to the back alley and behold a bizarre scene. Rats seem to have formed a drum circle and are chanting in a crazed way."},{flags:["haveSeenBackAlley"],text:"The back alley looks spookier by the minute. What do you do?"}]},91471:{actions:[{dest:"58259",label:"Next",needsFlags:[]}],addsFlags:["hasDrink"],id:"91471",label:"Bear shakes martini",scene:{actors:[{angle:0,animation:"still",img:"character/parrot/in-transit.png",scale:.45,x:.1,y:.75},{angle:0,animation:"hop_fast",img:"setting/barCounter.png",scale:.5,x:.55,y:.8},{angle:0,animation:"hop_fast",img:"character/bear/shaking.png",scale:.5,x:.7,y:.35},{angle:.325,animation:"hop_slow",img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.09,y:.555}],bg:"bg/bar.png"},text:'"Coming right up!" the strange panda says as he works furiously to make it.',textVariants:[{flags:["drunk"],text:'"Coming right up!" the strange panda says as he works furiously to make it. Is the room spinning?'}]},93644:{actions:[{dest:"64042",label:"Stop Listening In",needsFlags:[]}],id:"93644",label:"Dunnock talking 3",scene:{actors:[{angle:0,img:"character/dunnock/dunnock_talking_happy.png",scale:1.115,x:.54,y:.515}],bg:"bg/kavaBar.png"},text:'"Really, the god of the universe gave us enough self-awareness to see everything- all of existence- in its discreteness." He seems to be turning his head every which way wildly, hoping everyone hears him.'},94275:{actions:[{dest:"10255",label:"Shame on you!",needsFlags:["!drunk"]},{dest:"5936",label:"Ruh roh",needsFlags:["drunk"]}],addsFlags:["hasClimbedFountain"],id:"94275",label:"Climbing Fountain",scene:{actors:[{angle:0,animation:"still",img:"setting/city_fountain.png",scale:1.05,x:.505,y:.5},{angle:-.295,animation:"wobble_fast",img:"character/parrot/flying.png",needsFlags:["!hasClimbedFountain","!drunk"],scale:.16,x:.495,y:.23},{angle:0,animation:"zoom_fast",img:"character/parrot/backWingsSpread.png",needsFlags:["hasClimbedFountain","!drunk"],scale:.155,x:.63,y:.085},{angle:2.75,img:"character/egg/neutral.png",needsFlags:["hasClimbedFountain","!drunk"],scale:.1,x:.095,y:.905},{angle:-2.4,animation:"spin_fast",img:"character/parrot/flying.png",needsFlags:["drunk"],scale:.11,x:.715,y:.195}],bg:"bg/citySquare.png"},text:"You climb the fountain and almost slip! It's extremely slick, you should be MUCH more careful when you're carrying your egg!",textVariants:[{flags:["hasClimbedFountain"],text:"This time, you carefully put your egg on the ground ahead of time. However, the fountain is still slippery and you're really putting yourself at risk!"},{flags:["drunk"],text:"You climb the fountain and slip!"}]},94630:{actions:[{dest:"13631",label:"Return to wandering the city",needsFlags:[]},{dest:"48799",label:"Ask therapy mouse about his day",needsFlags:[]},{dest:"53838",label:"Ask him about what there is to do",needsFlags:[]},{dest:"33614",label:"Complain to him that he hasn't offered new ideas for a while",needsFlags:[]}],id:"94630",label:"Therapy Mouse Hub",scene:{actors:[{angle:0,img:"character/mouse/neutral.png",scale:2,x:.49,y:.965}],bg:"bg/backAlley.png"},text:"There seems to be a pause in your conversation. You feel the mouse watching you closely."},94709:{actions:[{dest:"91471",label:"Martini",needsFlags:[]},{dest:"46692",label:"Cosmopolitan",needsFlags:[]}],addsFlags:["termsAgreedTo"],id:"94709",label:"Bear offers drinks",scene:{actors:[{angle:0,img:"character/parrot/in-transit.png",scale:.45,x:.1,y:.7301802155435473},{angle:0,img:"character/bear/neutral.png",scale:.5,x:.7,y:.25},{angle:0,animation:"still",img:"setting/barCounter.png",scale:.65,x:.55,y:.7115674718410626},{angle:0,animation:"hop_slow",img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.1,x:.155,y:.435}],bg:"bg/bar.png"},text:'"Sure thing!" the strange panda says. "Would you like a martini or a cosmopolitan?" '},95956:{actions:[{dest:"13817",label:"Accept Gift",needsFlags:[]}],addsFlags:["haveGivenBone"],id:"95956",label:"Gift Hamster",scene:{actors:[{angle:0,img:"character/hamster/neutral.png",scale:.45,x:.5,y:.5682735794913},{angle:.31,img:"prop/bonePresent.png",scale:.9,x:.5,y:.6183196847164483}],bg:"bg/shop.png"},text:`"I have something for you!" you say as you present the beagle's dog bone gift to the hamster. It almost makes you laugh cause she's so much smaller than the bone. She squeals with excitement. "I love these things! They aren't really part of my natural diet but that doesn't matter to me. For your generosity, I have a gift for YOU!"`},95982:{actions:[{dest:"64950",label:"Follow the tunnel",needsFlags:[]}],addsFlags:["discoverJunglePath"],id:"95982",label:"Right Tunnel",scene:{actors:[{angle:0,animation:"still",img:"setting/sewer_system_tunnel.png",scale:1.05,x:.55,y:.57},{angle:.04,animation:"hop_slow",flipped:!1,img:"character/rat/rat_1.png",scale:.15,x:.65,y:.7069580646524997},{angle:0,animation:"shake_slow",flipped:!0,img:"character/rat/rat_1.png",scale:.1,x:.54,y:.385},{angle:0,animation:"shake_slow",img:"character/rat/rat_2.png",scale:.18,x:.66,y:.84},{angle:0,flipped:!0,img:"character/rat/rat_2.png",scale:.145,x:.355,y:.7559195178358672},{angle:0,flipped:!0,img:"character/rat/rat_2.png",scale:.15,x:.415,y:.53},{angle:0,img:"character/rat/rat_3.png",scale:.155,x:.31,y:.585},{angle:-.92,flipped:!1,img:"character/rat/rat_3.png",scale:.1,x:.67,y:.35},{angle:0,img:"character/parrot/bindle.png",scale:.22,x:.4,y:.87}],bg:"bg/gray.png"},text:"You turn right and follow the rats down the tunnel."},96204:{actions:[{dest:"94630",label:"Next",needsFlags:[]}],id:"96204",label:"Therapy Mouse Glad",scene:{actors:[{angle:0,img:"character/mouse/neutral.png",scale:.88,x:.495,y:.57}],bg:"bg/backAlley.png"},text:`"I'm so glad to hear it!" he says. `},99585:{actions:[{dest:"56143",label:`"I haven't been feeling so good."`,needsFlags:["drunk"]},{dest:"96204",label:`"I'm doing great!"`,needsFlags:[]},{dest:"53838",label:`"I'm a little bored, there isn't much to do."`,needsFlags:[]}],id:"99585",label:"Therapy Mouse 1",scene:{actors:[{angle:0,img:"character/parrot/back.png",scale:.5,x:.205,y:.73},{angle:0,img:"character/mouse/neutral.png",scale:.18,x:.54,y:.605},{angle:0,img:"prop/drunk_bubbles.png",needsFlags:["drunk"],scale:.195,x:.32,y:.38}],bg:"bg/backAlley.png"},text:'Therapy mouse looks closely at you. "So how have you been doing, parrot? Are you enjoying the city?"'}},o0=(r,e)=>{const t=r.split(" "),s=[t[0]];var i=0;for(const n of t.slice(1))s[i].length+(n.length+1)>=e?(i++,s.push(n)):s[i]+=" "+n;return s.join(`
`)};class Rs extends ae{constructor({label:e,x:t,y:s,width:i,height:n,wrapLength:a,onclick:o}){super(),e=o0(e,a);const l=e.split(`
`).length;console.log(`line count ${l} -> font size ${n/2/l}`);const h=10,c=10,u=new Bp({text:e,style:{fontFamily:"Arial",fontSize:n/2/l,fill:1122867,align:"center"}});u.anchor.set(.5),u.position.set(t,s),u.scale.set(Math.min((i-h*2-c*2)/u.width,(n-h*2-c*2)/u.height)),u.zIndex=2;const d=new is;d.strokeStyle={width:3,color:"#ffffffaa"},d.roundRect(u.position.x-u.width/2-h,u.position.y-u.height/2-h,u.width+h*2,u.height+h*2,10).fill("#ffffff88").stroke(),d.zIndex=1,o!==void 0&&(d.eventMode="static",d.cursor="pointer",d.on("mouseup",o)),this.addChild(d),this.addChild(u)}}class un extends ae{constructor(t,s,i,n){super();pe(this,"flags");pe(this,"app");pe(this,"screen");pe(this,"setScene");pe(this,"actorSprites");this.app=t,this.screen=s,this.setScene=i,this.actorSprites=[],this.flags=n,this.loadStuff()}onTick(t){for(const s of this.actorSprites)s.onTick(t)}takeAction(t){const s=kc[t.dest],i={...this.flags};for(const n of this.screen.addsFlags??[])i[n]=1;this.setScene(new un(this.app,s,this.setScene,i))}async loadStuff(){const t=await lt.load(`images/${this.screen.scene.bg}`),s=new k(t),i=new Ue(s);i.setSize(this.app.screen.width,this.app.screen.height),this.addChild(i);const n=this.app.screen.height*.8,a=n*3/2,o=this.app.screen.width-a;Ks.setViewport({x:this.app.screen.width-a/2,y:n/2,w:a,h:n});for(const f of this.screen.scene.actors){if(!Ye.matches(f.needsFlags,Object.keys(this.flags)))continue;const g=await Ks.create(this.app,f);this.actorSprites.push(g),this.addChild(g)}var l=0;const h=this.screen.actions.filter(f=>Ye.matches(f.needsFlags??[],Object.keys(this.flags))),c=h.length,u=this.app.screen.width*.8;for(const f of h){const g=new Rs({label:f.label,x:this.app.screen.width/2-u/2+u*(l+.5)/c,y:this.app.screen.height*9/10,width:u/c*.8,height:this.app.screen.height*.15,wrapLength:16,onclick:()=>this.takeAction(f)});this.addChild(g),l++}if(this.screen.endgame==="win"){const f=new Rs({label:`Congrats, your egg hatched!
(No restarting. Because you only get one)`,x:this.app.screen.width/2,y:this.app.screen.height*8.5/10,width:u/c*.6,height:this.app.screen.height*.15,wrapLength:1e3,onclick:void 0});this.addChild(f)}if(this.screen.endgame==="lose"){const f=new Rs({label:`Game Over :(
(No restarting. Because you only get one)`,x:this.app.screen.width/2,y:this.app.screen.height*8.5/10,width:u/c*.6,height:this.app.screen.height*.15,wrapLength:1e3,onclick:void 0});this.addChild(f)}const d=new Rs({label:cn.getText(this.screen,Object.keys(this.flags)),x:o/2,y:n/2,width:o,height:n,wrapLength:30,onclick:void 0});this.addChild(d)}async createSprite(t){const s=await lt.load(`images/${t.img}`);return new Ue(new k(s))}}(async()=>{const r=new sl;await r.init({background:"#eee",resizeTo:window}),document.getElementById("pixi-container").appendChild(r.canvas);var e=void 0;const t=s=>{e!==void 0&&r.stage.removeChild(e),r.stage.addChild(s),e=s};t(new un(r,kc[0],t,{})),r.ticker.add(s=>{e==null||e.onTick(s)})})();M.add(zu);M.mixin(ae,Yu);M.add(rl);M.add(il);M.add(Il);M.mixin(ae,bp);M.add(Rl);M.add(cc);M.add(Ni);M.add(fc);M.add(pc);M.add(mc);M.add(Pc);M.add(Ac);M.add(vc);M.add(Sc);M.add(wc);M.add(bc);M.add(xc);M.add(Dl);M.add(Gl);const l0=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),h0=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));</script>
</head>

<body style="margin: 0px">
  <div id="pixi-container"></div>
</body>

</html>